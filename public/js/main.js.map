{"version":3,"sources":["file:///C:/Users/maxim/Documents/Dev/arsrepairs.com/themes/arsrepairs-theme/assets/ts/main.ts"],"sourcesContent":["/**\r\n * DOM utility functions\r\n */\r\n\r\n/**\r\n * Checks if the current viewport is mobile size\r\n */\r\nexport const isMobile = (): boolean =\u003e window.innerWidth \u003c= 1280;\r\n\r\n/**\r\n * Checks if running on localhost\r\n */\r\nexport const isLocalhost = (): boolean =\u003e {\r\n  return window.location.hostname === \"localhost\" || window.location.hostname === \"127.0.0.1\";\r\n};\r\n\r\n/**\r\n * Safely executes a function when DOM is ready\r\n */\r\nexport const onDOMReady = (callback: () =\u003e void): void =\u003e {\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", callback);\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\n\r\n","/**\r\n * Dev UI Utilities (DEV-ONLY)\r\n * ============================================================================\r\n * Shared UI components for dev tools (page-list, dev-score-bubble).\r\n * Provides dialogs, toasts, and input dialogs with consistent styling.\r\n * ============================================================================\r\n */\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Show toast notification\r\n */\r\nexport function showToast(\r\n  message: string,\r\n  type: 'success' | 'error' | 'info' = 'info',\r\n  duration: number = 5000,\r\n  prefix: string = 'dev' // 'dev' for dev-score-bubble, 'page-list' for page-list\r\n): void {\r\n  const toast = document.createElement('div');\r\n  toast.className = `${prefix}-toast ${prefix}-toast--${type}`;\r\n  toast.setAttribute('role', 'alert');\r\n  toast.setAttribute('aria-live', 'polite');\r\n  \r\n  const iconMap = {\r\n    success: 'check_circle',\r\n    error: 'error',\r\n    info: 'info'\r\n  };\r\n  \r\n  const baseClass = prefix === 'page-list' ? 'page-list' : 'dev-score-bubble';\r\n  \r\n  toast.innerHTML = `\r\n    \u003cspan class=\"${baseClass}-toast__icon material-symbols-outlined\" aria-hidden=\"true\"\u003e${iconMap[type]}\u003c/span\u003e\r\n    \u003cspan class=\"${baseClass}-toast__message\"\u003e${escapeHtml(message)}\u003c/span\u003e\r\n    \u003cbutton class=\"${baseClass}-toast__close\" aria-label=\"Close notification\" type=\"button\"\u003e\r\n      \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n    \u003c/button\u003e\r\n  `;\r\n  \r\n  document.body.appendChild(toast);\r\n  \r\n  // Trigger animation\r\n  requestAnimationFrame(() =\u003e {\r\n    toast.classList.add(`${prefix}-toast--show`);\r\n  });\r\n  \r\n  // Close button handler\r\n  const closeBtn = toast.querySelector(`.${baseClass}-toast__close`);\r\n  const closeToast = () =\u003e {\r\n    toast.classList.remove(`${prefix}-toast--show`);\r\n    setTimeout(() =\u003e toast.remove(), 300);\r\n  };\r\n  \r\n  if (closeBtn) {\r\n    closeBtn.addEventListener('click', closeToast);\r\n  }\r\n  \r\n  // Auto-close\r\n  if (duration \u003e 0) {\r\n    setTimeout(closeToast, duration);\r\n  }\r\n}\r\n\r\n/**\r\n * Create confirmation dialog\r\n */\r\nexport function createConfirmationDialog(\r\n  title: string,\r\n  message: string,\r\n  confirmText: string = 'Continue',\r\n  cancelText?: string,\r\n  prefix: string = 'dev' // 'dev' for dev-score-bubble, 'page-list' for page-list\r\n): Promise\u003cboolean\u003e {\r\n  return new Promise((resolve) =\u003e {\r\n    const isSingleButton = !cancelText;\r\n    const baseClass = prefix === 'page-list' ? 'page-list' : 'dev-score-bubble';\r\n    const dialog = document.createElement('div');\r\n    dialog.className = `${baseClass}-modal`;\r\n    dialog.setAttribute('role', 'dialog');\r\n    dialog.setAttribute('aria-labelledby', `${baseClass}-confirm-title`);\r\n    dialog.setAttribute('aria-modal', 'true');\r\n    \r\n    const modalContentClass = prefix === 'page-list' \r\n      ? `${baseClass}-modal__content ${baseClass}-modal__content--small`\r\n      : `${baseClass}-modal-content ${baseClass}-modal-content--small`;\r\n    \r\n    const headerClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__header`\r\n      : `${baseClass}-modal-header`;\r\n    \r\n    const headerIconClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__header-icon ${baseClass}-modal__header-icon--${isSingleButton ? 'info' : 'warning'}`\r\n      : `${baseClass}-modal-header-icon ${baseClass}-modal-header-icon--${isSingleButton ? 'info' : 'warning'}`;\r\n    \r\n    const titleClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__title`\r\n      : `${baseClass}-modal-title`;\r\n    \r\n    const bodyClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__body`\r\n      : `${baseClass}-modal-body`;\r\n    \r\n    const messageClass = prefix === 'page-list'\r\n      ? `${baseClass}-confirm-message`\r\n      : `${baseClass}-confirm-message`;\r\n    \r\n    const actionsClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__actions`\r\n      : `${baseClass}-modal-actions`;\r\n    \r\n    const buttonClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__button`\r\n      : `${baseClass}-modal-button`;\r\n    \r\n    const overlayClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__overlay`\r\n      : `${baseClass}-modal-overlay`;\r\n    \r\n    dialog.innerHTML = `\r\n      \u003cdiv class=\"${overlayClass}\" aria-hidden=\"true\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"${modalContentClass}\"\u003e\r\n        \u003cdiv class=\"${headerClass}\"\u003e\r\n          \u003cdiv class=\"${headerIconClass}\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003e${isSingleButton ? 'info' : 'warning'}\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003ch2 class=\"${titleClass}\" id=\"${baseClass}-confirm-title\"\u003e${escapeHtml(title)}\u003c/h2\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"${bodyClass}\"\u003e\r\n          \u003cdiv class=\"${messageClass}\"\u003e${escapeHtml(message).replace(/\\n/g, '\u003cbr\u003e')}\u003c/div\u003e\r\n          \u003cdiv class=\"${actionsClass}\"\u003e\r\n            ${!isSingleButton ? `\r\n            \u003cbutton \r\n              class=\"${buttonClass} ${buttonClass}--secondary\" \r\n              id=\"${baseClass}-confirm-cancel\"\r\n              type=\"button\"\r\n            \u003e\r\n              ${escapeHtml(cancelText || 'Cancel')}\r\n            \u003c/button\u003e\r\n            ` : ''}\r\n            \u003cbutton \r\n              class=\"${buttonClass} ${buttonClass}--primary\" \r\n              id=\"${baseClass}-confirm-ok\"\r\n              type=\"button\"\r\n              autofocus\r\n            \u003e\r\n              ${!isSingleButton ? '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e' : ''}\r\n              ${escapeHtml(confirmText)}\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    document.body.appendChild(dialog);\r\n    \r\n    // Focus management\r\n    const okBtn = dialog.querySelector(`#${baseClass}-confirm-ok`) as HTMLElement;\r\n    const cancelBtn = dialog.querySelector(`#${baseClass}-confirm-cancel`) as HTMLElement;\r\n    \r\n    if (okBtn) {\r\n      okBtn.focus();\r\n    }\r\n    \r\n    const cleanup = () =\u003e {\r\n      dialog.remove();\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n    \r\n    const handleEscape = (e: KeyboardEvent) =\u003e {\r\n      if (e.key === 'Escape') {\r\n        resolve(isSingleButton ? true : false);\r\n        cleanup();\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('keydown', handleEscape);\r\n    \r\n    okBtn?.addEventListener('click', () =\u003e {\r\n      resolve(true);\r\n      cleanup();\r\n    });\r\n    \r\n    if (cancelBtn) {\r\n      cancelBtn.addEventListener('click', () =\u003e {\r\n        resolve(false);\r\n        cleanup();\r\n      });\r\n    }\r\n    \r\n    // Close on overlay click (only if not single button)\r\n    if (!isSingleButton) {\r\n      const overlay = dialog.querySelector(`.${overlayClass}`);\r\n      overlay?.addEventListener('click', () =\u003e {\r\n        resolve(false);\r\n        cleanup();\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create URL input dialog (replaces native prompt)\r\n */\r\nexport function createUrlInputDialog(\r\n  label: string,\r\n  defaultValue: string = '',\r\n  prefix: string = 'dev' // 'dev' for dev-score-bubble, 'page-list' for page-list\r\n): Promise\u003cstring | null\u003e {\r\n  return new Promise((resolve) =\u003e {\r\n    const baseClass = prefix === 'page-list' ? 'page-list' : 'dev-score-bubble';\r\n    const dialog = document.createElement('div');\r\n    dialog.className = `${baseClass}-modal`;\r\n    dialog.setAttribute('role', 'dialog');\r\n    dialog.setAttribute('aria-labelledby', `${baseClass}-url-input-title`);\r\n    dialog.setAttribute('aria-modal', 'true');\r\n    \r\n    const modalContentClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__content ${baseClass}-modal__content--small`\r\n      : `${baseClass}-modal-content ${baseClass}-modal-content--small`;\r\n    \r\n    const headerClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__header`\r\n      : `${baseClass}-modal-header`;\r\n    \r\n    const titleClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__title`\r\n      : `${baseClass}-modal-title`;\r\n    \r\n    const bodyClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__body`\r\n      : `${baseClass}-modal-body`;\r\n    \r\n    const actionsClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__actions`\r\n      : `${baseClass}-modal-actions`;\r\n    \r\n    const buttonClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__button`\r\n      : `${baseClass}-modal-button`;\r\n    \r\n    const overlayClass = prefix === 'page-list'\r\n      ? `${baseClass}-modal__overlay`\r\n      : `${baseClass}-modal-overlay`;\r\n    \r\n    dialog.innerHTML = `\r\n      \u003cdiv class=\"${overlayClass}\" aria-hidden=\"true\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"${modalContentClass}\"\u003e\r\n        \u003cdiv class=\"${headerClass}\"\u003e\r\n          \u003ch2 class=\"${titleClass}\" id=\"${baseClass}-url-input-title\"\u003e${escapeHtml(label)}\u003c/h2\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"${bodyClass}\"\u003e\r\n          \u003clabel class=\"${baseClass}-input-label\" for=\"${baseClass}-url-input-field\"\u003e\r\n            Enter new URL:\r\n          \u003c/label\u003e\r\n          \u003cinput\r\n            type=\"text\"\r\n            id=\"${baseClass}-url-input-field\"\r\n            class=\"${baseClass}-input-field\"\r\n            value=\"${escapeHtml(defaultValue)}\"\r\n            placeholder=\"/path/to/page\"\r\n            autofocus\r\n          /\u003e\r\n          \u003cdiv class=\"${actionsClass}\"\u003e\r\n            \u003cbutton \r\n              class=\"${buttonClass} ${buttonClass}--secondary\" \r\n              id=\"${baseClass}-url-input-cancel\"\r\n              type=\"button\"\r\n            \u003e\r\n              Cancel\r\n            \u003c/button\u003e\r\n            \u003cbutton \r\n              class=\"${buttonClass} ${buttonClass}--primary\" \r\n              id=\"${baseClass}-url-input-ok\"\r\n              type=\"button\"\r\n            \u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e\r\n              Update\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    document.body.appendChild(dialog);\r\n    \r\n    const input = dialog.querySelector(`#${baseClass}-url-input-field`) as HTMLInputElement;\r\n    const okBtn = dialog.querySelector(`#${baseClass}-url-input-ok`) as HTMLElement;\r\n    const cancelBtn = dialog.querySelector(`#${baseClass}-url-input-cancel`) as HTMLElement;\r\n    \r\n    if (input) {\r\n      input.focus();\r\n      input.select();\r\n    }\r\n    \r\n    const cleanup = () =\u003e {\r\n      dialog.remove();\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n    \r\n    const handleKeyDown = (e: KeyboardEvent) =\u003e {\r\n      if (e.key === 'Escape') {\r\n        resolve(null);\r\n        cleanup();\r\n      } else if (e.key === 'Enter' \u0026\u0026 e.target === input) {\r\n        e.preventDefault();\r\n        resolve(input.value.trim() || null);\r\n        cleanup();\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('keydown', handleKeyDown);\r\n    \r\n    okBtn?.addEventListener('click', () =\u003e {\r\n      resolve(input?.value.trim() || null);\r\n      cleanup();\r\n    });\r\n    \r\n    cancelBtn?.addEventListener('click', () =\u003e {\r\n      resolve(null);\r\n      cleanup();\r\n    });\r\n    \r\n    // Close on overlay click\r\n    const overlay = dialog.querySelector(`.${overlayClass}`);\r\n    overlay?.addEventListener('click', () =\u003e {\r\n      resolve(null);\r\n      cleanup();\r\n    });\r\n  });\r\n}\r\n\r\n","/**\r\n * Keyword Research Module (DEV-ONLY)\r\n * ============================================================================\r\n * Provides keyword research and analysis tools for content optimization.\r\n * Features:\r\n * - Keyword extraction from content\r\n * - Keyword density analysis\r\n * - Related keyword suggestions\r\n * - Long-tail keyword generation\r\n * - Keyword gap analysis\r\n * - Content optimization suggestions\r\n * - External Canadian keyword dataset integration\r\n * - Live seed keyword search\r\n * ============================================================================\r\n */\r\n\r\nimport { isLocalhost } from \"../utils/dom\";\r\nimport { showToast, escapeHtml } from \"../utils/dev-ui\";\r\n\r\n/**\r\n * External keyword data from Canadian keyword dataset\r\n */\r\ninterface ExternalKeyword {\r\n  keyword: string;\r\n  volume: number;\r\n  cpc: number;\r\n  competition: number;\r\n  intent?: 'informational' | 'navigational' | 'commercial' | 'transactional';\r\n}\r\n\r\n/**\r\n * Enhanced keyword data with external metrics\r\n */\r\ninterface KeywordData {\r\n  keyword: string;\r\n  frequency: number;\r\n  density: number; // Percentage\r\n  positions: number[]; // Line numbers where keyword appears\r\n  context: string[]; // Surrounding text snippets\r\n  volume?: number; // Search volume from external dataset\r\n  cpc?: number; // Cost per click\r\n  competition?: number; // Competition level (0-1)\r\n  intent?: string; // Search intent\r\n}\r\n\r\n/**\r\n * Keyword analysis results\r\n */\r\ninterface KeywordRecommendation {\r\n  text: string;\r\n  type: 'error' | 'warning' | 'info' | 'success';\r\n}\r\n\r\ninterface KeywordAnalysis {\r\n  primaryKeywords: KeywordData[];\r\n  secondaryKeywords: KeywordData[];\r\n  longTailKeywords: string[];\r\n  keywordDensity: number;\r\n  keywordRichness: number; // Unique keywords / total words\r\n  recommendations: KeywordRecommendation[];\r\n}\r\n\r\n/**\r\n * Page keyword data for gap analysis\r\n */\r\ninterface PageKeywordData {\r\n  pageUrl: string;\r\n  pageTitle: string;\r\n  keywords: KeywordData[];\r\n  topKeywords: string[];\r\n}\r\n\r\n/**\r\n * Gap analysis results with opportunity scores\r\n */\r\ninterface GapAnalysisResult {\r\n  missingKeywords: string[];\r\n  opportunities: Array\u003c{\r\n    keyword: string;\r\n    usedBy: number;\r\n    pages: string[];\r\n    opportunityScore?: number;\r\n    volume?: number;\r\n    competition?: number;\r\n  }\u003e;\r\n}\r\n\r\n// Global external keywords dataset (loaded once, cached)\r\nlet externalKeywords: ExternalKeyword[] = [];\r\nlet externalKeywordsLoaded = false;\r\nlet externalKeywordsLoading = false;\r\n\r\n/**\r\n * Canadian keyword modifiers for generating variants\r\n */\r\nconst PREFIXES = [\r\n  'best', 'top 10', 'top', 'cheap', 'affordable', 'budget', 'how to', 'guide to',\r\n  'review', 'canada', 'canadian', 'toronto', 'ontario', '2025', '2024', 'near me',\r\n  'vs', 'versus', 'compare', 'difference between', 'what is', 'why', 'when', 'where',\r\n  'free', 'discount', 'sale', 'deals', 'professional', 'expert', 'certified'\r\n];\r\n\r\nconst SUFFIXES = [\r\n  'canada', 'canadian', 'toronto', 'ontario', 'near me', '2025', '2024', 'review',\r\n  'guide', 'tips', 'tricks', 'hacks', 'cost', 'price', 'service', 'repair',\r\n  'installation', 'maintenance', 'replacement', 'vs', 'comparison', 'alternatives'\r\n];\r\n\r\n/**\r\n * Load external Canadian keyword dataset from static JSON file\r\n * @returns Promise that resolves when keywords are loaded\r\n */\r\nasync function loadExternalKeywords(): Promise\u003cvoid\u003e {\r\n  if (externalKeywordsLoaded || externalKeywordsLoading) {\r\n    return;\r\n  }\r\n\r\n  externalKeywordsLoading = true;\r\n\r\n  try {\r\n    // Try .json first, then .json.gz\r\n    let response = await fetch('/data/keywords-canada.json');\r\n    \r\n    if (!response.ok) {\r\n      // Try compressed version\r\n      response = await fetch('/data/keywords-canada.json.gz');\r\n    }\r\n\r\n    if (!response.ok) {\r\n      console.warn('External keyword dataset not found. Continuing without external data.');\r\n      externalKeywordsLoaded = true;\r\n      externalKeywordsLoading = false;\r\n      return;\r\n    }\r\n\r\n    const data = await response.json();\r\n    \r\n    if (Array.isArray(data)) {\r\n      externalKeywords = data;\r\n    } else if (data.keywords \u0026\u0026 Array.isArray(data.keywords)) {\r\n      externalKeywords = data.keywords;\r\n    } else {\r\n      throw new Error('Invalid keyword dataset format');\r\n    }\r\n\r\n    externalKeywordsLoaded = true;\r\n    console.log(`Loaded ${externalKeywords.length} external keywords from Canadian dataset`);\r\n  } catch (error) {\r\n    console.error('Error loading external keywords:', error);\r\n    showToast('Could not load external keyword dataset. Some features may be limited.', 'info', 5000, 'dev');\r\n    externalKeywords = [];\r\n  } finally {\r\n    externalKeywordsLoading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Search external keywords by seed keyword\r\n * @param seed - Seed keyword to search for\r\n * @param options - Search options (minVolume, maxCompetition, limit)\r\n * @returns Array of matching external keywords sorted by volume\r\n */\r\nfunction searchKeywords(\r\n  seed: string,\r\n  options?: { minVolume?: number; maxCompetition?: number; limit?: number }\r\n): ExternalKeyword[] {\r\n  const {\r\n    minVolume = 0,\r\n    maxCompetition = 1,\r\n    limit = 50\r\n  } = options ?? {};\r\n\r\n  const seedLower = seed.toLowerCase().trim();\r\n  if (!seedLower) {\r\n    return [];\r\n  }\r\n\r\n  const matches = externalKeywords.filter(kw =\u003e {\r\n    const keywordLower = kw.keyword.toLowerCase();\r\n    return (\r\n      keywordLower.includes(seedLower) \u0026\u0026\r\n      kw.volume \u003e= minVolume \u0026\u0026\r\n      kw.competition \u003c= maxCompetition\r\n    );\r\n  });\r\n\r\n  // Sort by volume descending\r\n  matches.sort((a, b) =\u003e b.volume - a.volume);\r\n\r\n  return matches.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Generate alphabet soup variants (a-z combinations)\r\n * @param seed - Seed keyword\r\n * @returns Array of alphabet soup variants\r\n */\r\nfunction generateAlphabetSoup(seed: string): string[] {\r\n  const variants: string[] = [];\r\n  const seedLower = seed.toLowerCase().trim();\r\n  const words = seedLower.split(/\\s+/);\r\n\r\n  // Generate variants with alphabet prefixes/suffixes\r\n  const alphabet = 'abcdefghijklmnopqrstuvwxyz';\r\n  \r\n  // Single letter prefixes\r\n  for (let i = 0; i \u003c Math.min(5, alphabet.length); i++) {\r\n    variants.push(`${alphabet[i]} ${seedLower}`);\r\n    variants.push(`${seedLower} ${alphabet[i]}`);\r\n  }\r\n\r\n  // Common letter combinations\r\n  const commonLetters = ['a', 'b', 'c', 'x', 'z'];\r\n  commonLetters.forEach(letter =\u003e {\r\n    variants.push(`${letter}${seedLower}`);\r\n    variants.push(`${seedLower}${letter}`);\r\n  });\r\n\r\n  return variants;\r\n}\r\n\r\n/**\r\n * Generate long-tail keyword variants using prefixes and suffixes\r\n * @param seed - Seed keyword\r\n * @returns Array of long-tail variants\r\n */\r\nfunction generateLongTailVariants(seed: string): string[] {\r\n  const variants: Set\u003cstring\u003e = new Set();\r\n  const seedLower = seed.toLowerCase().trim();\r\n\r\n  // Add prefix combinations\r\n  PREFIXES.forEach(prefix =\u003e {\r\n    variants.add(`${prefix} ${seedLower}`);\r\n    variants.add(`${seedLower} ${prefix}`);\r\n  });\r\n\r\n  // Add suffix combinations\r\n  SUFFIXES.forEach(suffix =\u003e {\r\n    variants.add(`${seedLower} ${suffix}`);\r\n    variants.add(`${suffix} ${seedLower}`);\r\n  });\r\n\r\n  // Add prefix + suffix combinations\r\n  PREFIXES.slice(0, 5).forEach(prefix =\u003e {\r\n    SUFFIXES.slice(0, 5).forEach(suffix =\u003e {\r\n      variants.add(`${prefix} ${seedLower} ${suffix}`);\r\n    });\r\n  });\r\n\r\n  // Word order swaps (for 2+ word keywords)\r\n  const words = seedLower.split(/\\s+/);\r\n  if (words.length \u003e= 2) {\r\n    // Swap first two words\r\n    const swapped = [words[1], words[0], ...words.slice(2)].join(' ');\r\n    variants.add(swapped);\r\n    \r\n    // Reverse all words\r\n    if (words.length === 2) {\r\n      variants.add(words.reverse().join(' '));\r\n    }\r\n  }\r\n\r\n  return Array.from(variants);\r\n}\r\n\r\n/**\r\n * Extract keywords from text content\r\n * @param text - Text content to analyze\r\n * @param minLength - Minimum keyword length\r\n * @param stopWords - Additional stop words to exclude\r\n * @returns Map of keywords to their data\r\n */\r\nfunction extractKeywords(text: string, minLength: number = 3, stopWords: Set\u003cstring\u003e = new Set()): Map\u003cstring, KeywordData\u003e {\r\n  // Common English stop words with Canadian variants\r\n  const defaultStopWords = new Set([\r\n    'a', 'an', 'and', 'are', 'as', 'at', 'be', 'by', 'for', 'from',\r\n    'has', 'he', 'in', 'is', 'it', 'its', 'of', 'on', 'that', 'the',\r\n    'to', 'was', 'will', 'with', 'the', 'this', 'but', 'they', 'have',\r\n    'had', 'what', 'said', 'each', 'which', 'their', 'time', 'if', 'up',\r\n    'out', 'many', 'then', 'them', 'these', 'so', 'some', 'her', 'would',\r\n    'make', 'like', 'into', 'him', 'has', 'two', 'more', 'very', 'after',\r\n    'words', 'long', 'than', 'first', 'been', 'call', 'who', 'oil', 'sit',\r\n    'now', 'find', 'down', 'day', 'did', 'get', 'come', 'made', 'may', 'part',\r\n    // Canadian spelling variants\r\n    'colour', 'colours', 'favourite', 'favourites', 'centre', 'centres',\r\n    'organise', 'organised', 'organising', 'realise', 'realised', 'realising'\r\n  ]);\r\n  \r\n  const allStopWords = new Set([...defaultStopWords, ...stopWords]);\r\n  \r\n  // Normalize text: lowercase, remove punctuation, split into words\r\n  // Note: If external dataset uses US spelling, map Canadian to US here\r\n  // For now, we keep both variants\r\n  const normalized = text\r\n    .toLowerCase()\r\n    .replace(/[^\\w\\s]/g, ' ')\r\n    .replace(/\\s+/g, ' ')\r\n    .trim();\r\n  \r\n  const words = normalized.split(/\\s+/);\r\n  const keywordMap = new Map\u003cstring, KeywordData\u003e();\r\n  \r\n  words.forEach((word, index) =\u003e {\r\n    // Skip stop words and short words\r\n    if (word.length \u003c minLength || allStopWords.has(word)) {\r\n      return;\r\n    }\r\n    \r\n    // Count single words\r\n    let keywordData = keywordMap.get(word);\r\n    if (!keywordData) {\r\n      keywordData = {\r\n        keyword: word,\r\n        frequency: 0,\r\n        density: 0,\r\n        positions: [],\r\n        context: []\r\n      };\r\n      keywordMap.set(word, keywordData);\r\n    }\r\n    keywordData.frequency++;\r\n    keywordData.positions.push(index);\r\n    \r\n    // Extract context (surrounding words)\r\n    const start = Math.max(0, index - 3);\r\n    const end = Math.min(words.length, index + 4);\r\n    const contextWords = words.slice(start, end);\r\n    keywordData.context.push(contextWords.join(' '));\r\n    \r\n    // Count 2-word phrases\r\n    if (index \u003c words.length - 1) {\r\n      const nextWord = words[index + 1];\r\n      if (nextWord.length \u003e= minLength \u0026\u0026 !allStopWords.has(nextWord)) {\r\n        const phrase = `${word} ${nextWord}`;\r\n        let phraseData = keywordMap.get(phrase);\r\n        if (!phraseData) {\r\n          phraseData = {\r\n            keyword: phrase,\r\n            frequency: 0,\r\n            density: 0,\r\n            positions: [],\r\n            context: []\r\n          };\r\n          keywordMap.set(phrase, phraseData);\r\n        }\r\n        phraseData.frequency++;\r\n        phraseData.positions.push(index);\r\n        phraseData.context.push(contextWords.join(' '));\r\n      }\r\n    }\r\n    \r\n    // Count 3-word phrases (long-tail)\r\n    if (index \u003c words.length - 2) {\r\n      const nextWord = words[index + 1];\r\n      const nextNextWord = words[index + 2];\r\n      if (nextWord.length \u003e= minLength \u0026\u0026 nextNextWord.length \u003e= minLength \u0026\u0026\r\n          !allStopWords.has(nextWord) \u0026\u0026 !allStopWords.has(nextNextWord)) {\r\n        const phrase = `${word} ${nextWord} ${nextNextWord}`;\r\n        let phraseData = keywordMap.get(phrase);\r\n        if (!phraseData) {\r\n          phraseData = {\r\n            keyword: phrase,\r\n            frequency: 0,\r\n            density: 0,\r\n            positions: [],\r\n            context: []\r\n          };\r\n          keywordMap.set(phrase, phraseData);\r\n        }\r\n        phraseData.frequency++;\r\n        phraseData.positions.push(index);\r\n        phraseData.context.push(contextWords.join(' '));\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Calculate density\r\n  const totalWords = words.length;\r\n  keywordMap.forEach((data) =\u003e {\r\n    data.density = (data.frequency / totalWords) * 100;\r\n  });\r\n  \r\n  return keywordMap;\r\n}\r\n\r\n/**\r\n * Enrich keyword data with external dataset metrics\r\n * @param keywordMap - Map of keywords to enrich\r\n */\r\n/**\r\n * Enrich keyword data with external dataset metrics\r\n * @param keywordMap - Map of keywords to enrich\r\n */\r\nfunction enrichKeywordsWithExternalData(keywordMap: Map\u003cstring, KeywordData\u003e): void {\r\n  if (externalKeywords.length === 0) {\r\n    return;\r\n  }\r\n\r\n  keywordMap.forEach((data) =\u003e {\r\n    // Find case-insensitive match (both exact and case-insensitive are the same check)\r\n    const match = externalKeywords.find(\r\n      ek =\u003e ek.keyword.toLowerCase() === data.keyword.toLowerCase()\r\n    );\r\n\r\n    if (match) {\r\n      data.volume = match.volume;\r\n      data.cpc = match.cpc;\r\n      data.competition = match.competition;\r\n      data.intent = match.intent;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Analyze keywords from page content\r\n * @param content - Page content text\r\n * @param title - Page title\r\n * @param description - Meta description\r\n * @returns Keyword analysis results\r\n */\r\nfunction analyzeKeywords(content: string, title: string, description: string): KeywordAnalysis {\r\n  // Combine all text sources\r\n  const fullText = `${title} ${description} ${content}`.toLowerCase();\r\n  \r\n  // Extract keywords\r\n  const keywordMap = extractKeywords(fullText);\r\n  \r\n  // Enrich with external data\r\n  enrichKeywordsWithExternalData(keywordMap);\r\n  \r\n  // Sort by frequency\r\n  const sortedKeywords = Array.from(keywordMap.values())\r\n    .sort((a, b) =\u003e b.frequency - a.frequency);\r\n  \r\n  // Separate primary (high frequency) and secondary keywords\r\n  const primaryKeywords = sortedKeywords\r\n    .filter(k =\u003e k.frequency \u003e= 3 \u0026\u0026 k.density \u003e= 0.5)\r\n    .slice(0, 20);\r\n  \r\n  const secondaryKeywords = sortedKeywords\r\n    .filter(k =\u003e k.frequency \u003e= 2 \u0026\u0026 k.density \u003e= 0.2 \u0026\u0026 !primaryKeywords.includes(k))\r\n    .slice(0, 30);\r\n  \r\n  // Generate long-tail keywords (3+ word phrases)\r\n  const longTailKeywords = sortedKeywords\r\n    .filter(k =\u003e k.keyword.split(' ').length \u003e= 3)\r\n    .map(k =\u003e k.keyword)\r\n    .slice(0, 15);\r\n  \r\n  // Calculate overall metrics\r\n  const totalWords = fullText.split(/\\s+/).length;\r\n  const uniqueKeywords = keywordMap.size;\r\n  const keywordRichness = (uniqueKeywords / totalWords) * 100;\r\n  const avgDensity = primaryKeywords.length \u003e 0\r\n    ? primaryKeywords.reduce((sum, k) =\u003e sum + k.density, 0) / primaryKeywords.length\r\n    : 0;\r\n  \r\n  // Generate recommendations with color coding\r\n  const recommendations: KeywordRecommendation[] = [];\r\n  \r\n  if (primaryKeywords.length === 0) {\r\n    recommendations.push({\r\n      text: 'No primary keywords found. Consider adding more relevant keywords to your content.',\r\n      type: 'error'\r\n    });\r\n  }\r\n  \r\n  // Primary keyword density recommendations\r\n  const primary = primaryKeywords[0];\r\n  if (primary) {\r\n    if (primary.density \u003c 0.8) {\r\n      recommendations.push({\r\n        text: `Top primary keyword \"${primary.keyword}\" density too low (${primary.density.toFixed(2)}%). Aim for 1.1–1.9%.`,\r\n        type: 'warning'\r\n      });\r\n    } else if (primary.density \u003e 2.2) {\r\n      recommendations.push({\r\n        text: `Top primary keyword \"${primary.keyword}\" density too high (${primary.density.toFixed(2)}%). Reduce naturally to avoid penalties.`,\r\n        type: 'error'\r\n      });\r\n    } else if (primary.density \u003e= 1.1 \u0026\u0026 primary.density \u003c= 1.9) {\r\n      recommendations.push({\r\n        text: `Top primary keyword \"${primary.keyword}\" density is optimal (${primary.density.toFixed(2)}%)`,\r\n        type: 'success'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Keyword richness recommendations\r\n  if (keywordRichness \u003c 6.5) {\r\n    recommendations.push({\r\n      text: `Keyword richness low (${keywordRichness.toFixed(1)}%). Add synonyms, LSI terms, and related phrases to reach 9–12%.`,\r\n      type: 'warning'\r\n    });\r\n  } else if (keywordRichness \u003e= 9) {\r\n    recommendations.push({\r\n      text: `Excellent keyword richness (${keywordRichness.toFixed(1)}%) – strong topical authority signal!`,\r\n      type: 'success'\r\n    });\r\n  } else if (keywordRichness \u003e= 6.5 \u0026\u0026 keywordRichness \u003c 9) {\r\n    recommendations.push({\r\n      text: `Keyword richness is good (${keywordRichness.toFixed(1)}%). Consider adding more related terms to reach 9–12% for optimal topical authority.`,\r\n      type: 'info'\r\n    });\r\n  }\r\n  \r\n  if (avgDensity \u003e 3) {\r\n    recommendations.push({\r\n      text: 'Overall keyword density may be too high. Aim for 1-2% for primary keywords to avoid over-optimization.',\r\n      type: 'warning'\r\n    });\r\n  }\r\n  \r\n  if (longTailKeywords.length \u003c 5) {\r\n    recommendations.push({\r\n      text: 'Consider adding more long-tail keywords (3+ word phrases) for better targeting.',\r\n      type: 'info'\r\n    });\r\n  }\r\n  \r\n  return {\r\n    primaryKeywords,\r\n    secondaryKeywords,\r\n    longTailKeywords,\r\n    keywordDensity: avgDensity,\r\n    keywordRichness,\r\n    recommendations\r\n  };\r\n}\r\n\r\n/**\r\n * Generate related keyword suggestions using multiple strategies\r\n * @param seedKeyword - Seed keyword to generate variants for\r\n * @param allPages - Array of all page data\r\n * @returns Array of related keywords (max 30)\r\n */\r\nfunction generateRelatedKeywords(seedKeyword: string, allPages: any[]): string[] {\r\n  const related: Set\u003cstring\u003e = new Set();\r\n  const seedLower = seedKeyword.toLowerCase().trim();\r\n  \r\n  // Strategy 1: Find pages with similar keywords\r\n  allPages.forEach(page =\u003e {\r\n    const pageText = `${page.title ?? ''} ${page.metaDescription ?? ''} ${page.summary ?? ''}`.toLowerCase();\r\n    \r\n    // Extract keywords from similar pages\r\n    const keywords = extractKeywords(pageText);\r\n    keywords.forEach((data, keyword) =\u003e {\r\n      // Check if keyword is related (contains seed or seed contains keyword)\r\n      if (keyword.includes(seedLower) || seedLower.includes(keyword) || \r\n          keyword.split(' ').some(word =\u003e seedLower.includes(word))) {\r\n        related.add(keyword);\r\n      }\r\n    });\r\n  });\r\n  \r\n  // Strategy 2: Alphabet soup variants\r\n  const alphabetSoup = generateAlphabetSoup(seedKeyword);\r\n  alphabetSoup.forEach(variant =\u003e related.add(variant));\r\n  \r\n  // Strategy 3: Long-tail variants with prefixes/suffixes\r\n  const longTailVariants = generateLongTailVariants(seedKeyword);\r\n  longTailVariants.forEach(variant =\u003e related.add(variant));\r\n  \r\n  // Strategy 4: Word order swaps\r\n  const words = seedLower.split(/\\s+/);\r\n  if (words.length \u003e= 2) {\r\n    // Try different word orders\r\n    for (let i = 0; i \u003c words.length; i++) {\r\n      for (let j = i + 1; j \u003c words.length; j++) {\r\n        const swapped = [...words];\r\n        [swapped[i], swapped[j]] = [swapped[j], swapped[i]];\r\n        related.add(swapped.join(' '));\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Strategy 5: External keyword matches\r\n  if (externalKeywords.length \u003e 0) {\r\n    const externalMatches = searchKeywords(seedKeyword, { limit: 10 });\r\n    externalMatches.forEach(match =\u003e related.add(match.keyword));\r\n  }\r\n  \r\n  return Array.from(related).slice(0, 30);\r\n}\r\n\r\n/**\r\n * Analyze keywords from page metadata (title, description, summary)\r\n * @param page - Page data with title, metaDescription, summary\r\n * @returns PageKeywordData with extracted keywords\r\n */\r\nfunction analyzePageKeywords(page: { title: string; metaDescription?: string; summary?: string; relPermalink: string }): PageKeywordData {\r\n  const pageText = `${page.title} ${page.metaDescription ?? ''} ${page.summary ?? ''}`.toLowerCase();\r\n  const keywordMap = extractKeywords(pageText);\r\n  \r\n  // Enrich with external data\r\n  enrichKeywordsWithExternalData(keywordMap);\r\n  \r\n  // Get top keywords sorted by frequency\r\n  const sortedKeywords = Array.from(keywordMap.values())\r\n    .sort((a, b) =\u003e b.frequency - a.frequency);\r\n  \r\n  const primaryKeywords = sortedKeywords\r\n    .filter(k =\u003e k.frequency \u003e= 2)\r\n    .slice(0, 30);\r\n  \r\n  return {\r\n    pageUrl: page.relPermalink,\r\n    pageTitle: page.title,\r\n    keywords: primaryKeywords,\r\n    topKeywords: primaryKeywords.map(k =\u003e k.keyword)\r\n  };\r\n}\r\n\r\n/**\r\n * Compare keywords across pages (gap analysis) with opportunity scoring\r\n * @param currentPage - Current page keyword data\r\n * @param allPages - All pages keyword data (will be analyzed if not already)\r\n * @returns Gap analysis with opportunity scores\r\n */\r\nfunction analyzeKeywordGaps(currentPage: PageKeywordData, allPages: PageKeywordData[]): GapAnalysisResult {\r\n  const currentKeywords = new Set(currentPage.topKeywords.map(k =\u003e k.toLowerCase()));\r\n  const allKeywords = new Map\u003cstring, { count: number; pages: string[]; avgVolume?: number; avgCompetition?: number }\u003e();\r\n  \r\n  // Collect all keywords from other pages\r\n  allPages.forEach(page =\u003e {\r\n    if (page.pageUrl !== currentPage.pageUrl \u0026\u0026 page.topKeywords.length \u003e 0) {\r\n      page.topKeywords.forEach(keyword =\u003e {\r\n        const key = keyword.toLowerCase();\r\n        let data = allKeywords.get(key);\r\n        if (!data) {\r\n          data = { count: 0, pages: [] };\r\n          allKeywords.set(key, data);\r\n        }\r\n        data.count++;\r\n        data.pages.push(page.pageTitle);\r\n        \r\n        // Collect volume and competition data if available\r\n        const keywordData = page.keywords.find(k =\u003e k.keyword.toLowerCase() === key);\r\n        if (keywordData) {\r\n          if (keywordData.volume !== undefined) {\r\n            const currentAvg = data.avgVolume ?? 0;\r\n            data.avgVolume = (currentAvg * (data.count - 1) + keywordData.volume) / data.count;\r\n          }\r\n          if (keywordData.competition !== undefined) {\r\n            const currentAvg = data.avgCompetition ?? 0;\r\n            data.avgCompetition = (currentAvg * (data.count - 1) + keywordData.competition) / data.count;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n  \r\n  // Find keywords used by others but not in current page\r\n  const missingKeywords: string[] = [];\r\n  const opportunities: Array\u003c{ keyword: string; usedBy: number; pages: string[]; opportunityScore?: number; volume?: number; competition?: number }\u003e = [];\r\n  \r\n  allKeywords.forEach((data, keyword) =\u003e {\r\n    if (!currentKeywords.has(keyword) \u0026\u0026 data.count \u003e= 2) {\r\n      missingKeywords.push(keyword);\r\n      \r\n      // Calculate opportunity score\r\n      let opportunityScore = data.count; // Base score = usage count\r\n      \r\n      // Enhance with external data if available\r\n      if (externalKeywords.length \u003e 0) {\r\n        const externalMatch = externalKeywords.find(\r\n          ek =\u003e ek.keyword.toLowerCase() === keyword.toLowerCase()\r\n        );\r\n        \r\n        if (externalMatch) {\r\n          // Opportunity score = usedBy × volume × (1 - competition)\r\n          // Higher volume + lower competition = higher opportunity\r\n          const volumeWeight = Math.log10(externalMatch.volume + 1) / 10; // Normalize volume\r\n          opportunityScore = data.count * volumeWeight * (1 - externalMatch.competition);\r\n        } else if (data.avgVolume !== undefined \u0026\u0026 data.avgCompetition !== undefined) {\r\n          // Use average from pages if external data not available\r\n          const volumeWeight = Math.log10(data.avgVolume + 1) / 10;\r\n          opportunityScore = data.count * volumeWeight * (1 - data.avgCompetition);\r\n        }\r\n      } else if (data.avgVolume !== undefined \u0026\u0026 data.avgCompetition !== undefined) {\r\n        // Use average from pages if external data not available\r\n        const volumeWeight = Math.log10(data.avgVolume + 1) / 10;\r\n        opportunityScore = data.count * volumeWeight * (1 - data.avgCompetition);\r\n      }\r\n      \r\n      // Get volume and competition from external or page data\r\n      let volume: number | undefined;\r\n      let competition: number | undefined;\r\n      \r\n      if (externalKeywords.length \u003e 0) {\r\n        const externalMatch = externalKeywords.find(\r\n          ek =\u003e ek.keyword.toLowerCase() === keyword.toLowerCase()\r\n        );\r\n        if (externalMatch) {\r\n          volume = externalMatch.volume;\r\n          competition = externalMatch.competition;\r\n        }\r\n      }\r\n      \r\n      if (volume === undefined \u0026\u0026 data.avgVolume !== undefined) {\r\n        volume = Math.round(data.avgVolume);\r\n      }\r\n      if (competition === undefined \u0026\u0026 data.avgCompetition !== undefined) {\r\n        competition = data.avgCompetition;\r\n      }\r\n      \r\n      opportunities.push({\r\n        keyword,\r\n        usedBy: data.count,\r\n        pages: data.pages.slice(0, 5),\r\n        opportunityScore,\r\n        volume,\r\n        competition\r\n      });\r\n    }\r\n  });\r\n  \r\n  // Sort by opportunity score (or usedBy if no score)\r\n  opportunities.sort((a, b) =\u003e {\r\n    const scoreA = a.opportunityScore ?? a.usedBy;\r\n    const scoreB = b.opportunityScore ?? b.usedBy;\r\n    return scoreB - scoreA;\r\n  });\r\n  \r\n  return {\r\n    missingKeywords: missingKeywords.slice(0, 20),\r\n    opportunities: opportunities.slice(0, 15)\r\n  };\r\n}\r\n\r\n/**\r\n * Get CSS class for keyword density based on value\r\n * @param density - Keyword density percentage\r\n * @returns CSS class name for density state\r\n */\r\nfunction getDensityClass(density: number): string {\r\n  if (density \u003c 0.8) {\r\n    return 'dev-keyword-research-keyword-density--low';\r\n  } else if (density \u003e= 1.1 \u0026\u0026 density \u003c= 1.9) {\r\n    return 'dev-keyword-research-keyword-density--optimal';\r\n  } else if (density \u003e 2.2) {\r\n    return 'dev-keyword-research-keyword-density--high';\r\n  } else {\r\n    return 'dev-keyword-research-keyword-density--ok';\r\n  }\r\n}\r\n\r\n/**\r\n * Render keyword research modal with seed search panel\r\n * @param analysis - Keyword analysis results\r\n * @param pageTitle - Page title\r\n * @param pageUrl - Page URL\r\n * @param gapAnalysis - Optional gap analysis results\r\n * @returns HTML string for modal\r\n */\r\nfunction renderKeywordResearchModal(\r\n  analysis: KeywordAnalysis, \r\n  pageTitle: string, \r\n  pageUrl: string,\r\n  gapAnalysis?: GapAnalysisResult,\r\n  competitorKeywords?: Array\u003c{ url: string; keywords: KeywordAnalysis }\u003e\r\n): string {\r\n  const prefix = 'dev';\r\n  \r\n  return `\r\n    \u003cdiv class=\"dev-score-bubble-modal\" id=\"dev-keyword-research-modal\" role=\"dialog\" aria-labelledby=\"dev-keyword-research-title\" aria-modal=\"true\"\u003e\r\n      \u003cdiv class=\"dev-score-bubble-modal-overlay\" aria-hidden=\"true\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"dev-score-bubble-modal-content dev-score-bubble-modal-content--large\"\u003e\r\n        \u003cdiv class=\"dev-score-bubble-modal-header\"\u003e\r\n          \u003cdiv class=\"dev-score-bubble-modal-header-icon dev-score-bubble-modal-header-icon--info\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003esearch\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003ch2 class=\"dev-score-bubble-modal-title\" id=\"dev-keyword-research-title\"\u003eKeyword Research\u003c/h2\u003e\r\n          \u003cbutton class=\"dev-score-bubble-modal-close\" aria-label=\"Close dialog\" type=\"button\"\u003e×\u003c/button\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"dev-score-bubble-modal-body\"\u003e\r\n          \u003cdiv class=\"dev-keyword-research-page-info\"\u003e\r\n            \u003ch3\u003e${escapeHtml(pageTitle)}\u003c/h3\u003e\r\n            \u003ccode\u003e${escapeHtml(pageUrl)}\u003c/code\u003e\r\n          \u003c/div\u003e\r\n          \r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003eExternal Keyword Research (Canada)\u003c/h3\u003e\r\n            \u003cdiv class=\"dev-keyword-research-search-container\"\u003e\r\n              \u003cinput \r\n                id=\"dev-seed-input\" \r\n                type=\"text\" \r\n                placeholder=\"Enter seed keyword…\" \r\n                class=\"dev-keyword-research-search-input\"\r\n                aria-label=\"Seed keyword input\"\r\n              \u003e\r\n              \u003cbutton \r\n                id=\"dev-seed-search\" \r\n                type=\"button\"\r\n                class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--primary dev-keyword-research-search-button\"\r\n                aria-label=\"Search keywords\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003esearch\u003c/span\u003e\r\n                Search\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv id=\"dev-seed-results\" class=\"dev-keyword-research-results-container\"\u003e\u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \r\n          \u003cdiv class=\"dev-keyword-research-metrics\"\u003e\r\n            \u003cdiv class=\"dev-keyword-research-metric\"\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-label\"\u003eAvg Keyword Density\u003c/span\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-value\"\u003e${analysis.keywordDensity.toFixed(2)}%\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"dev-keyword-research-metric\"\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-label\"\u003eKeyword Richness\u003c/span\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-value\"\u003e${analysis.keywordRichness.toFixed(1)}%\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"dev-keyword-research-metric\"\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-label\"\u003ePrimary Keywords\u003c/span\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-value\"\u003e${analysis.primaryKeywords.length}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"dev-keyword-research-metric\"\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-label\"\u003eLong-Tail Keywords\u003c/span\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-value\"\u003e${analysis.longTailKeywords.length}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            ${analysis.recommendations.length \u003e 0 ? `\r\n            \u003cdiv class=\"dev-keyword-research-metric dev-keyword-research-metric--recommendations dev-keyword-research-metric--full-width\"\u003e\r\n              \u003cspan class=\"dev-keyword-research-metric-label\"\u003eRecommendations\u003c/span\u003e\r\n              \u003cul class=\"dev-keyword-research-recommendations\"\u003e\r\n                ${analysis.recommendations.map(rec =\u003e `\r\n                  \u003cli class=\"dev-keyword-research-recommendation dev-keyword-research-recommendation--${rec.type}\"\u003e\r\n                    ${escapeHtml(rec.text)}\r\n                  \u003c/li\u003e\r\n                `).join('')}\r\n              \u003c/ul\u003e\r\n            \u003c/div\u003e\r\n            ` : ''}\r\n          \u003c/div\u003e\r\n          \r\n          ${analysis.primaryKeywords.length \u003e 0 ? `\r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003estar\u003c/span\u003e\r\n              Primary Keywords\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"dev-keyword-research-keywords\"\u003e\r\n              ${analysis.primaryKeywords.map(k =\u003e `\r\n                \u003cdiv class=\"dev-keyword-research-keyword\"\u003e\r\n                  \u003cspan class=\"dev-keyword-research-keyword-text\"\u003e${escapeHtml(k.keyword)}\u003c/span\u003e\r\n                  \u003cdiv class=\"dev-keyword-research-keyword-stats\"\u003e\r\n                    \u003cspan class=\"dev-keyword-research-keyword-frequency\"\u003e${k.frequency}x\u003c/span\u003e\r\n                    \u003cspan class=\"dev-keyword-research-keyword-density ${getDensityClass(k.density)}\"\u003e${k.density.toFixed(2)}%\u003c/span\u003e\r\n                    ${k.volume !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-volume\" title=\"Search volume\"\u003e${k.volume.toLocaleString()}\u003c/span\u003e` : ''}\r\n                    ${k.competition !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-competition\" title=\"Competition\"\u003e${(k.competition * 100).toFixed(0)}%\u003c/span\u003e` : ''}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              `).join('')}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n          \r\n          ${analysis.secondaryKeywords.length \u003e 0 ? `\r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elabel\u003c/span\u003e\r\n              Secondary Keywords\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"dev-keyword-research-keywords\"\u003e\r\n              ${analysis.secondaryKeywords.map(k =\u003e `\r\n                \u003cdiv class=\"dev-keyword-research-keyword\"\u003e\r\n                  \u003cspan class=\"dev-keyword-research-keyword-text\"\u003e${escapeHtml(k.keyword)}\u003c/span\u003e\r\n                  \u003cdiv class=\"dev-keyword-research-keyword-stats\"\u003e\r\n                    \u003cspan class=\"dev-keyword-research-keyword-frequency\"\u003e${k.frequency}x\u003c/span\u003e\r\n                    \u003cspan class=\"dev-keyword-research-keyword-density ${getDensityClass(k.density)}\"\u003e${k.density.toFixed(2)}%\u003c/span\u003e\r\n                    ${k.volume !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-volume\" title=\"Search volume\"\u003e${k.volume.toLocaleString()}\u003c/span\u003e` : ''}\r\n                    ${k.competition !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-competition\" title=\"Competition\"\u003e${(k.competition * 100).toFixed(0)}%\u003c/span\u003e` : ''}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              `).join('')}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n          \r\n          ${analysis.longTailKeywords.length \u003e 0 ? `\r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_awesome\u003c/span\u003e\r\n              Long-Tail Keywords\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"dev-keyword-research-keywords\"\u003e\r\n              ${analysis.longTailKeywords.map(keyword =\u003e `\r\n                \u003cdiv class=\"dev-keyword-research-keyword\"\u003e\r\n                  \u003cspan class=\"dev-keyword-research-keyword-text\"\u003e${escapeHtml(keyword)}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n              `).join('')}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n          \r\n          ${gapAnalysis \u0026\u0026 gapAnalysis.opportunities.length \u003e 0 ? `\r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003etrending_up\u003c/span\u003e\r\n              Keyword Opportunities\r\n            \u003c/h3\u003e\r\n            \u003cp class=\"dev-keyword-research-section-description\"\u003e\r\n              Keywords used by other pages that you might want to consider:\r\n            \u003c/p\u003e\r\n            \u003cdiv class=\"dev-keyword-research-keywords\"\u003e\r\n              ${gapAnalysis.opportunities.slice(0, 10).map(opp =\u003e `\r\n                \u003cdiv class=\"dev-keyword-research-keyword dev-keyword-research-keyword--opportunity\"\u003e\r\n                  \u003cspan class=\"dev-keyword-research-keyword-text\"\u003e${escapeHtml(opp.keyword)}\u003c/span\u003e\r\n                  \u003cdiv class=\"dev-keyword-research-keyword-stats\"\u003e\r\n                    \u003cspan class=\"dev-keyword-research-keyword-frequency\"\u003eUsed by ${opp.usedBy} page${opp.usedBy !== 1 ? 's' : ''}\u003c/span\u003e\r\n                    ${opp.volume !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-volume\" title=\"Search volume\"\u003e${opp.volume.toLocaleString()}\u003c/span\u003e` : ''}\r\n                    ${opp.competition !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-competition\" title=\"Competition\"\u003e${(opp.competition * 100).toFixed(0)}%\u003c/span\u003e` : ''}\r\n                    ${opp.opportunityScore !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-opportunity-score\" title=\"Opportunity score\"\u003eScore: ${opp.opportunityScore.toFixed(1)}\u003c/span\u003e` : ''}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              `).join('')}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n          \r\n          ${competitorKeywords \u0026\u0026 competitorKeywords.length \u003e 0 ? `\r\n          \u003cdiv class=\"dev-keyword-research-section\"\u003e\r\n            \u003ch3 class=\"dev-keyword-research-section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ebusiness\u003c/span\u003e\r\n              Competitor Keywords\r\n            \u003c/h3\u003e\r\n            \u003cp class=\"dev-keyword-research-section-description\"\u003e\r\n              Keywords found on competitor pages:\r\n            \u003c/p\u003e\r\n            ${competitorKeywords.map(comp =\u003e {\r\n              const primaryKeywords = comp.keywords?.primaryKeywords || [];\r\n              const secondaryKeywords = comp.keywords?.secondaryKeywords || [];\r\n              const allKeywords = [...primaryKeywords, ...secondaryKeywords].slice(0, 20);\r\n              \r\n              if (allKeywords.length === 0) return '';\r\n              \r\n              return `\r\n                \u003cdiv class=\"dev-keyword-research-competitor\"\u003e\r\n                  \u003ch4 class=\"dev-keyword-research-competitor-url\"\u003e${escapeHtml(comp.url)}\u003c/h4\u003e\r\n                  \u003cdiv class=\"dev-keyword-research-keywords\"\u003e\r\n                    ${allKeywords.map(k =\u003e {\r\n                      const keywordId = `${comp.url}:${k.keyword}`.replace(/[^a-zA-Z0-9:]/g, '_');\r\n                      return `\r\n                      \u003cdiv class=\"dev-keyword-research-keyword\" data-competitor-keyword-id=\"${keywordId}\"\u003e\r\n                        \u003cspan class=\"dev-keyword-research-keyword-text\"\u003e${escapeHtml(k.keyword)}\u003c/span\u003e\r\n                        \u003cdiv class=\"dev-keyword-research-keyword-stats\"\u003e\r\n                          \u003cspan class=\"dev-keyword-research-keyword-frequency\"\u003e${k.frequency}x\u003c/span\u003e\r\n                          \u003cspan class=\"dev-keyword-research-keyword-density ${getDensityClass(k.density)}\"\u003e${k.density.toFixed(2)}%\u003c/span\u003e\r\n                          ${k.volume !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-volume\" title=\"Search volume\"\u003e${k.volume.toLocaleString()}\u003c/span\u003e` : ''}\r\n                          ${k.competition !== undefined ? `\u003cspan class=\"dev-keyword-research-keyword-competition\" title=\"Competition\"\u003e${(k.competition * 100).toFixed(0)}%\u003c/span\u003e` : ''}\r\n                          \u003cbutton \r\n                            class=\"dev-keyword-research-remove-btn\" \r\n                            data-competitor-keyword-id=\"${keywordId}\"\r\n                            type=\"button\"\r\n                            aria-label=\"Remove keyword\"\r\n                            title=\"Remove this keyword\"\r\n                          \u003e\r\n                            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n                          \u003c/button\u003e\r\n                        \u003c/div\u003e\r\n                      \u003c/div\u003e\r\n                    `;\r\n                    }).join('')}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              `;\r\n            }).join('')}\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"dev-score-bubble-modal-actions\"\u003e\r\n          \u003cdiv class=\"dev-keyword-research-export-buttons\"\u003e\r\n            \u003cbutton class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--secondary\" id=\"dev-keyword-research-export-page-csv\" type=\"button\" title=\"Export current page keywords as CSV\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edownload\u003c/span\u003e\r\n              Export Page (CSV)\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--secondary\" id=\"dev-keyword-research-export-page-json\" type=\"button\" title=\"Export current page keywords as JSON\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edownload\u003c/span\u003e\r\n              Export Page (JSON)\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--secondary\" id=\"dev-keyword-research-export-site-csv\" type=\"button\" title=\"Export all site keywords as CSV\" style=\"display: none;\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edownload\u003c/span\u003e\r\n              Export All Site (CSV)\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--secondary\" id=\"dev-keyword-research-export-site-json\" type=\"button\" title=\"Export all site keywords as JSON\" style=\"display: none;\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edownload\u003c/span\u003e\r\n              Export All Site (JSON)\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n          \u003cbutton class=\"dev-score-bubble-modal-button dev-score-bubble-modal-button--primary\" id=\"dev-keyword-research-close\" type=\"button\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e\r\n            Close\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Attach competitor keyword removal functionality to modal\r\n * @param modal - Modal element\r\n */\r\nfunction attachCompetitorKeywordRemoval(modal: HTMLElement | null): void {\r\n  if (!modal) return;\r\n\r\n  const STORAGE_KEY = 'page-list-competitors';\r\n\r\n  const removeButtons = modal.querySelectorAll('.dev-keyword-research-remove-btn');\r\n  \r\n  removeButtons.forEach(button =\u003e {\r\n    button.addEventListener('click', () =\u003e {\r\n      const keywordId = button.getAttribute('data-competitor-keyword-id');\r\n      if (!keywordId) return;\r\n\r\n      // Find the keyword element to get the actual keyword text and competitor URL\r\n      const keywordElement = modal.querySelector(`[data-competitor-keyword-id=\"${keywordId}\"]`);\r\n      if (!keywordElement) return;\r\n\r\n      // Get the keyword text from the element\r\n      const keywordTextEl = keywordElement.querySelector('.dev-keyword-research-keyword-text');\r\n      const keywordText = keywordTextEl?.textContent?.trim();\r\n      \r\n      // Get the competitor URL from the parent competitor section\r\n      const competitorSection = keywordElement.closest('.dev-keyword-research-competitor');\r\n      const competitorUrlEl = competitorSection?.querySelector('.dev-keyword-research-competitor-url');\r\n      const competitorUrl = competitorUrlEl?.textContent?.trim();\r\n\r\n      if (!keywordText || !competitorUrl) {\r\n        showToast('Could not identify keyword to remove', 'error', 3000, 'dev');\r\n        return;\r\n      }\r\n\r\n      // Update localStorage: remove the keyword from stored competitor data\r\n      try {\r\n        const stored = localStorage.getItem(STORAGE_KEY);\r\n        if (stored) {\r\n          const competitors: Array\u003c{ url: string; keywords: any }\u003e = JSON.parse(stored);\r\n          \r\n          // Find the competitor and remove the keyword\r\n          const competitorIndex = competitors.findIndex(c =\u003e c.url === competitorUrl);\r\n          if (competitorIndex !== -1 \u0026\u0026 competitors[competitorIndex].keywords) {\r\n            const competitor = competitors[competitorIndex];\r\n            \r\n            // Remove from primaryKeywords\r\n            if (competitor.keywords.primaryKeywords) {\r\n              competitor.keywords.primaryKeywords = competitor.keywords.primaryKeywords.filter(\r\n                (k: KeywordData) =\u003e k.keyword !== keywordText\r\n              );\r\n            }\r\n            \r\n            // Remove from secondaryKeywords\r\n            if (competitor.keywords.secondaryKeywords) {\r\n              competitor.keywords.secondaryKeywords = competitor.keywords.secondaryKeywords.filter(\r\n                (k: KeywordData) =\u003e k.keyword !== keywordText\r\n              );\r\n            }\r\n            \r\n            // Save updated data back to localStorage\r\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(competitors));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error updating stored competitor keywords:', error);\r\n        // Continue with UI removal even if storage update fails\r\n      }\r\n\r\n      // Add fade-out animation\r\n      (keywordElement as HTMLElement).style.transition = 'opacity 0.3s ease, transform 0.3s ease';\r\n      (keywordElement as HTMLElement).style.opacity = '0';\r\n      (keywordElement as HTMLElement).style.transform = 'scale(0.9)';\r\n      \r\n      // Remove after animation\r\n      setTimeout(() =\u003e {\r\n        keywordElement.remove();\r\n        \r\n        // Check if the competitor section is now empty\r\n        if (competitorSection) {\r\n          const remainingKeywords = competitorSection.querySelectorAll('.dev-keyword-research-keyword');\r\n          if (remainingKeywords.length === 0) {\r\n            // Hide the entire competitor section if no keywords remain\r\n            (competitorSection as HTMLElement).style.transition = 'opacity 0.3s ease';\r\n            (competitorSection as HTMLElement).style.opacity = '0';\r\n            setTimeout(() =\u003e {\r\n              competitorSection.remove();\r\n              \r\n              // Check if the entire competitor keywords section is now empty\r\n              const allSections = modal.querySelectorAll('.dev-keyword-research-section');\r\n              allSections.forEach(section =\u003e {\r\n                const sectionTitle = section.querySelector('.dev-keyword-research-section-title');\r\n                if (sectionTitle \u0026\u0026 sectionTitle.textContent?.includes('Competitor Keywords')) {\r\n                  const allCompetitors = section.querySelectorAll('.dev-keyword-research-competitor');\r\n                  if (allCompetitors.length === 0) {\r\n                    section.remove();\r\n                  }\r\n                }\r\n              });\r\n            }, 300);\r\n          }\r\n        }\r\n        \r\n        showToast('Keyword removed', 'success', 2000, 'dev');\r\n      }, 300);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Export keyword data to CSV format\r\n * @param data - Array of keyword data objects\r\n * @param filename - Name for the downloaded file\r\n */\r\nfunction exportKeywordsToCSV(data: KeywordData[], filename: string): void {\r\n  if (data.length === 0) {\r\n    showToast('No keywords to export', 'info', 3000, 'dev');\r\n    return;\r\n  }\r\n\r\n  // CSV header\r\n  const headers = ['Keyword', 'Frequency', 'Density (%)', 'Search Volume', 'CPC ($)', 'Competition (%)', 'Intent', 'Positions Count'];\r\n  const rows = [headers.join(',')];\r\n\r\n  // CSV rows\r\n  data.forEach(kw =\u003e {\r\n    const row = [\r\n      `\"${kw.keyword.replace(/\"/g, '\"\"')}\"`, // Escape quotes in keyword\r\n      kw.frequency.toString(),\r\n      kw.density.toFixed(2),\r\n      kw.volume?.toLocaleString() || '',\r\n      kw.cpc?.toFixed(2) || '',\r\n      kw.competition !== undefined ? (kw.competition * 100).toFixed(0) : '',\r\n      kw.intent || '',\r\n      kw.positions.length.toString()\r\n    ];\r\n    rows.push(row.join(','));\r\n  });\r\n\r\n  // Create blob and download\r\n  const csvContent = rows.join('\\n');\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.style.display = 'none';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n\r\n  showToast(`Exported ${data.length} keywords to ${filename}`, 'success', 3000, 'dev');\r\n}\r\n\r\n/**\r\n * Export keyword data to JSON format\r\n * @param data - Array of keyword data objects\r\n * @param filename - Name for the downloaded file\r\n */\r\nfunction exportKeywordsToJSON(data: KeywordData[], filename: string): void {\r\n  if (data.length === 0) {\r\n    showToast('No keywords to export', 'info', 3000, 'dev');\r\n    return;\r\n  }\r\n\r\n  // Prepare JSON data (remove context arrays if too large)\r\n  const jsonData = data.map(kw =\u003e ({\r\n    keyword: kw.keyword,\r\n    frequency: kw.frequency,\r\n    density: kw.density,\r\n    volume: kw.volume,\r\n    cpc: kw.cpc,\r\n    competition: kw.competition,\r\n    intent: kw.intent,\r\n    positionsCount: kw.positions.length,\r\n    // Include first few positions and contexts for reference\r\n    firstPositions: kw.positions.slice(0, 5),\r\n    sampleContexts: kw.context.slice(0, 3)\r\n  }));\r\n\r\n  // Create blob and download\r\n  const jsonContent = JSON.stringify(jsonData, null, 2);\r\n  const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.style.display = 'none';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n\r\n  showToast(`Exported ${data.length} keywords to ${filename}`, 'success', 3000, 'dev');\r\n}\r\n\r\n/**\r\n * Export all site keywords grouped by page\r\n * @param allPageKeywords - Array of page keyword data\r\n * @param format - Export format ('csv' or 'json')\r\n */\r\nfunction exportAllSiteKeywords(allPageKeywords: PageKeywordData[], format: 'csv' | 'json'): void {\r\n  if (allPageKeywords.length === 0) {\r\n    showToast('No page keywords to export', 'info', 3000, 'dev');\r\n    return;\r\n  }\r\n\r\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n  const filename = `all-site-keywords-${timestamp}.${format}`;\r\n\r\n  if (format === 'csv') {\r\n    // CSV with page grouping\r\n    const headers = ['Page URL', 'Page Title', 'Keyword', 'Frequency', 'Density (%)', 'Search Volume', 'CPC ($)', 'Competition (%)', 'Intent'];\r\n    const rows = [headers.join(',')];\r\n\r\n    allPageKeywords.forEach(page =\u003e {\r\n      page.keywords.forEach(kw =\u003e {\r\n        const row = [\r\n          `\"${page.pageUrl.replace(/\"/g, '\"\"')}\"`,\r\n          `\"${page.pageTitle.replace(/\"/g, '\"\"')}\"`,\r\n          `\"${kw.keyword.replace(/\"/g, '\"\"')}\"`,\r\n          kw.frequency.toString(),\r\n          kw.density.toFixed(2),\r\n          kw.volume?.toLocaleString() || '',\r\n          kw.cpc?.toFixed(2) || '',\r\n          kw.competition !== undefined ? (kw.competition * 100).toFixed(0) : '',\r\n          kw.intent || ''\r\n        ];\r\n        rows.push(row.join(','));\r\n      });\r\n    });\r\n\r\n    const csvContent = rows.join('\\n');\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = filename;\r\n    link.style.display = 'none';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n\r\n    const totalKeywords = allPageKeywords.reduce((sum, page) =\u003e sum + page.keywords.length, 0);\r\n    showToast(`Exported ${totalKeywords} keywords from ${allPageKeywords.length} pages to ${filename}`, 'success', 3000, 'dev');\r\n  } else {\r\n    // JSON format with page grouping\r\n    const jsonData = allPageKeywords.map(page =\u003e ({\r\n      pageUrl: page.pageUrl,\r\n      pageTitle: page.pageTitle,\r\n      keywords: page.keywords.map(kw =\u003e ({\r\n        keyword: kw.keyword,\r\n        frequency: kw.frequency,\r\n        density: kw.density,\r\n        volume: kw.volume,\r\n        cpc: kw.cpc,\r\n        competition: kw.competition,\r\n        intent: kw.intent,\r\n        positionsCount: kw.positions.length\r\n      })),\r\n      totalKeywords: page.keywords.length\r\n    }));\r\n\r\n    const jsonContent = JSON.stringify(jsonData, null, 2);\r\n    const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = filename;\r\n    link.style.display = 'none';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n\r\n    const totalKeywords = allPageKeywords.reduce((sum, page) =\u003e sum + page.keywords.length, 0);\r\n    showToast(`Exported ${totalKeywords} keywords from ${allPageKeywords.length} pages to ${filename}`, 'success', 3000, 'dev');\r\n  }\r\n}\r\n\r\n/**\r\n * Attach export functionality to modal\r\n * @param modal - Modal element\r\n * @param analysis - Keyword analysis results for current page\r\n * @param allPageKeywords - Optional array of all page keywords for site-wide export\r\n */\r\nfunction attachExportHandlers(\r\n  modal: HTMLElement | null,\r\n  analysis: KeywordAnalysis,\r\n  allPageKeywords?: PageKeywordData[]\r\n): void {\r\n  if (!modal) return;\r\n\r\n  // Export current page - CSV\r\n  const exportPageCsvBtn = modal.querySelector('#dev-keyword-research-export-page-csv') as HTMLButtonElement;\r\n  if (exportPageCsvBtn) {\r\n    exportPageCsvBtn.addEventListener('click', () =\u003e {\r\n      const allKeywords = [...analysis.primaryKeywords, ...analysis.secondaryKeywords];\r\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n      const pageTitle = modal.querySelector('.dev-keyword-research-page-info h3')?.textContent || 'page';\r\n      const safeTitle = pageTitle.replace(/[^a-z0-9]/gi, '-').toLowerCase();\r\n      exportKeywordsToCSV(allKeywords, `keywords-${safeTitle}-${timestamp}.csv`);\r\n    });\r\n  }\r\n\r\n  // Export current page - JSON\r\n  const exportPageJsonBtn = modal.querySelector('#dev-keyword-research-export-page-json') as HTMLButtonElement;\r\n  if (exportPageJsonBtn) {\r\n    exportPageJsonBtn.addEventListener('click', () =\u003e {\r\n      const allKeywords = [...analysis.primaryKeywords, ...analysis.secondaryKeywords];\r\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n      const pageTitle = modal.querySelector('.dev-keyword-research-page-info h3')?.textContent || 'page';\r\n      const safeTitle = pageTitle.replace(/[^a-z0-9]/gi, '-').toLowerCase();\r\n      exportKeywordsToJSON(allKeywords, `keywords-${safeTitle}-${timestamp}.json`);\r\n    });\r\n  }\r\n\r\n  // Export all site - CSV (only show if allPageKeywords is provided)\r\n  const exportSiteCsvBtn = modal.querySelector('#dev-keyword-research-export-site-csv') as HTMLButtonElement;\r\n  if (exportSiteCsvBtn \u0026\u0026 allPageKeywords \u0026\u0026 allPageKeywords.length \u003e 0) {\r\n    exportSiteCsvBtn.style.display = 'inline-flex';\r\n    exportSiteCsvBtn.addEventListener('click', () =\u003e {\r\n      exportAllSiteKeywords(allPageKeywords, 'csv');\r\n    });\r\n  }\r\n\r\n  // Export all site - JSON (only show if allPageKeywords is provided)\r\n  const exportSiteJsonBtn = modal.querySelector('#dev-keyword-research-export-site-json') as HTMLButtonElement;\r\n  if (exportSiteJsonBtn \u0026\u0026 allPageKeywords \u0026\u0026 allPageKeywords.length \u003e 0) {\r\n    exportSiteJsonBtn.style.display = 'inline-flex';\r\n    exportSiteJsonBtn.addEventListener('click', () =\u003e {\r\n      exportAllSiteKeywords(allPageKeywords, 'json');\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Attach seed keyword search functionality to modal\r\n * @param modal - Modal element\r\n */\r\nfunction attachSeedKeywordSearch(modal: HTMLElement | null): void {\r\n  if (!modal) return;\r\n\r\n  const seedInput = modal.querySelector('#dev-seed-input') as HTMLInputElement;\r\n  const searchButton = modal.querySelector('#dev-seed-search') as HTMLButtonElement;\r\n  const resultsContainer = modal.querySelector('#dev-seed-results') as HTMLElement;\r\n\r\n  if (!seedInput || !searchButton || !resultsContainer) return;\r\n\r\n  let debounceTimeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n\r\n  const performSearch = () =\u003e {\r\n    const seed = seedInput.value.trim();\r\n    if (!seed) {\r\n      resultsContainer.innerHTML = '\u003cp class=\"dev-keyword-research-empty-message\"\u003eEnter a keyword to search\u003c/p\u003e';\r\n      return;\r\n    }\r\n\r\n    // Search external keywords\r\n    const externalResults = searchKeywords(seed, { limit: 20 });\r\n    \r\n    // Generate variants\r\n    const alphabetSoup = generateAlphabetSoup(seed);\r\n    const longTailVariants = generateLongTailVariants(seed);\r\n    \r\n    // Combine and deduplicate\r\n    const allVariants = new Set([...alphabetSoup, ...longTailVariants]);\r\n    \r\n    // Search variants in external dataset\r\n    const variantResults: ExternalKeyword[] = [];\r\n    allVariants.forEach(variant =\u003e {\r\n      const matches = searchKeywords(variant, { limit: 5 });\r\n      variantResults.push(...matches);\r\n    });\r\n    \r\n    // Combine all results\r\n    const allResults = [...externalResults, ...variantResults];\r\n    \r\n    // Deduplicate by keyword\r\n    const uniqueResults = new Map\u003cstring, ExternalKeyword\u003e();\r\n    allResults.forEach(kw =\u003e {\r\n      const key = kw.keyword.toLowerCase();\r\n      if (!uniqueResults.has(key) || (uniqueResults.get(key)?.volume ?? 0) \u003c kw.volume) {\r\n        uniqueResults.set(key, kw);\r\n      }\r\n    });\r\n    \r\n    const sortedResults = Array.from(uniqueResults.values())\r\n      .sort((a, b) =\u003e b.volume - a.volume)\r\n      .slice(0, 30);\r\n\r\n    // Render results table\r\n    if (sortedResults.length === 0) {\r\n      resultsContainer.innerHTML = '\u003cp class=\"dev-keyword-research-empty-message\"\u003eNo keywords found. Try a different search term.\u003c/p\u003e';\r\n      return;\r\n    }\r\n\r\n    const tableHtml = `\r\n      \u003ctable class=\"dev-keyword-research-results-table\"\u003e\r\n        \u003cthead\u003e\r\n          \u003ctr\u003e\r\n            \u003cth\u003eKeyword\u003c/th\u003e\r\n            \u003cth class=\"dev-keyword-research-th-numeric\"\u003eVolume\u003c/th\u003e\r\n            \u003cth class=\"dev-keyword-research-th-numeric\"\u003eCPC\u003c/th\u003e\r\n            \u003cth class=\"dev-keyword-research-th-numeric\"\u003eCompetition\u003c/th\u003e\r\n            \u003cth class=\"dev-keyword-research-th-center\"\u003eIntent\u003c/th\u003e\r\n            \u003cth class=\"dev-keyword-research-th-center\"\u003eAction\u003c/th\u003e\r\n          \u003c/tr\u003e\r\n        \u003c/thead\u003e\r\n        \u003ctbody\u003e\r\n          ${sortedResults.map(kw =\u003e `\r\n            \u003ctr\u003e\r\n              \u003ctd class=\"dev-keyword-research-keyword-cell\"\u003e${escapeHtml(kw.keyword)}\u003c/td\u003e\r\n              \u003ctd class=\"dev-keyword-research-numeric-cell\"\u003e${kw.volume.toLocaleString()}\u003c/td\u003e\r\n              \u003ctd class=\"dev-keyword-research-numeric-cell\"\u003e$${kw.cpc.toFixed(2)}\u003c/td\u003e\r\n              \u003ctd class=\"dev-keyword-research-numeric-cell\"\u003e${(kw.competition * 100).toFixed(0)}%\u003c/td\u003e\r\n              \u003ctd class=\"dev-keyword-research-center-cell\"\u003e${kw.intent ? escapeHtml(kw.intent) : '-'}\u003c/td\u003e\r\n              \u003ctd class=\"dev-keyword-research-center-cell\"\u003e\r\n                \u003cbutton \r\n                  class=\"dev-keyword-research-copy-btn\" \r\n                  data-keyword=\"${escapeHtml(kw.keyword)}\"\r\n                  type=\"button\"\r\n                  aria-label=\"Copy keyword\"\r\n                \u003e\r\n                  Copy\r\n                \u003c/button\u003e\r\n              \u003c/td\u003e\r\n            \u003c/tr\u003e\r\n          `).join('')}\r\n        \u003c/tbody\u003e\r\n      \u003c/table\u003e\r\n    `;\r\n\r\n    resultsContainer.innerHTML = tableHtml;\r\n\r\n    // Attach copy handlers\r\n    const copyButtons = resultsContainer.querySelectorAll('.dev-keyword-research-copy-btn');\r\n    copyButtons.forEach(btn =\u003e {\r\n      btn.addEventListener('click', () =\u003e {\r\n        const keyword = btn.getAttribute('data-keyword');\r\n        if (keyword) {\r\n          navigator.clipboard.writeText(keyword).then(() =\u003e {\r\n            showToast(`Copied: ${keyword}`, 'success', 2000, 'dev');\r\n            (btn as HTMLButtonElement).textContent = 'Copied!';\r\n            setTimeout(() =\u003e {\r\n              (btn as HTMLButtonElement).textContent = 'Copy';\r\n            }, 1000);\r\n          }).catch(() =\u003e {\r\n            showToast('Failed to copy keyword', 'error', 2000, 'dev');\r\n          });\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  // Debounced search on input\r\n  seedInput.addEventListener('input', () =\u003e {\r\n    if (debounceTimeout) {\r\n      clearTimeout(debounceTimeout);\r\n    }\r\n    debounceTimeout = setTimeout(performSearch, 250);\r\n  });\r\n\r\n  // Immediate search on button click\r\n  searchButton.addEventListener('click', () =\u003e {\r\n    if (debounceTimeout) {\r\n      clearTimeout(debounceTimeout);\r\n    }\r\n    performSearch();\r\n  });\r\n\r\n  // Search on Enter key\r\n  seedInput.addEventListener('keydown', (e) =\u003e {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      if (debounceTimeout) {\r\n        clearTimeout(debounceTimeout);\r\n      }\r\n      performSearch();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Initialize keyword research feature\r\n * Loads external keyword dataset and sets up event handlers\r\n */\r\nexport function initKeywordResearch(): void {\r\n  if (!isLocalhost()) {\r\n    return;\r\n  }\r\n  \r\n  // Load external keywords automatically\r\n  loadExternalKeywords().catch(error =\u003e {\r\n    console.error('Failed to load external keywords:', error);\r\n  });\r\n  \r\n  // Add keyword research button to dev-score-bubble if it exists\r\n  const scoreBubble = document.querySelector('.dev-score-bubble');\r\n  if (scoreBubble) {\r\n    // This will be integrated into dev-score-bubble\r\n    console.log('Keyword research module loaded (integrate with dev-score-bubble)');\r\n  }\r\n  \r\n  // Add keyword research to page-list if available\r\n  const pageListContainer = document.querySelector('.page-list-container');\r\n  if (pageListContainer) {\r\n    // This will be integrated into page-list\r\n    console.log('Keyword research module loaded (integrate with page-list)');\r\n  }\r\n}\r\n\r\n// Export types and functions for use in other modules\r\nexport type { KeywordData, KeywordAnalysis, PageKeywordData, ExternalKeyword, GapAnalysisResult };\r\nexport { \r\n  extractKeywords, \r\n  analyzeKeywords, \r\n  analyzePageKeywords,\r\n  generateRelatedKeywords, \r\n  analyzeKeywordGaps, \r\n  renderKeywordResearchModal,\r\n  attachSeedKeywordSearch,\r\n  attachCompetitorKeywordRemoval,\r\n  attachExportHandlers,\r\n  exportKeywordsToCSV,\r\n  exportKeywordsToJSON,\r\n  exportAllSiteKeywords,\r\n  searchKeywords,\r\n  loadExternalKeywords\r\n};\r\n","/**\r\n * Application-wide constants\r\n */\r\nexport const PHONE_DATA_ATTR = \"phone\";\r\n\r\nexport const MOBILE_BREAKPOINT = 1280;\r\n\r\nexport const SCROLL_SHADOW_THRESHOLD = 8;\r\n\r\nexport const RESIZE_DEBOUNCE_DELAY = 250;\r\n\r\n","/**\r\n * Main entry point\r\n * Initializes all application modules\r\n */\r\n\r\nimport { MOBILE_BREAKPOINT, RESIZE_DEBOUNCE_DELAY } from \"./constants\";\r\nimport { onDOMReady } from \"./utils/dom\";\r\nimport { initNav, initDropdownHover, resetDropdowns } from \"./modules/navigation\";\r\nimport { initHeaderShadow } from \"./modules/header\";\r\nimport { initPhoneLinks } from \"./modules/phone-links\";\r\nimport { initYearStamp } from \"./modules/year-stamp\";\r\nimport { initPageHeaderCityPersonalization, initGeolocationShortcodes } from \"./utils/city-personalization\";\r\nimport { initServicesAutoScroll } from \"./modules/services-auto-scroll\";\r\nimport { initPageList } from \"./modules/page-list\";\r\nimport { initPageListSidebar } from \"./modules/page-list-sidebar\";\r\nimport { initTOC } from \"./modules/toc\";\r\nimport { initDevScoreBubble } from \"./modules/dev-score-bubble\";\r\nimport { initBlog } from \"./modules/blog\";\r\nimport { initSitemap } from \"./modules/sitemap\";\r\nimport { initSmoothScroll } from \"./modules/smooth-scroll\";\r\nimport { initFAQ } from \"./modules/faq\";\r\nimport { initFeedback } from \"./modules/feedback\";\r\nimport { initServiceAreasLeaflet } from \"./modules/service-areas-leaflet\";\r\nimport { initReviewsForm } from \"./modules/reviews-form\";\r\nimport { initReviews } from \"./modules/reviews\";\r\nimport { initVIPModal } from \"./modules/vip-modal\";\r\nimport { initBookingIframe } from \"./modules/booking-iframe\";\r\n\r\n/**\r\n * Initialize all modules\r\n */\r\nconst init = (): void =\u003e {\r\n  try {\r\n    initNav();\r\n    initHeaderShadow();\r\n    initPhoneLinks();\r\n    initYearStamp();\r\n    initDropdownHover();\r\n    initPageHeaderCityPersonalization();\r\n    initGeolocationShortcodes();\r\n    initServicesAutoScroll();\r\n    initTOC();\r\n    initSmoothScroll();\r\n    initFAQ();\r\n    initVIPModal();\r\n\r\n    // Initialize feedback form + sidebar progress if present\r\n    if (document.querySelector('form[name=\"feedback\"]')) {\r\n      initFeedback();\r\n    }\r\n\r\n    // Initialize reviews form if present\r\n    if (document.querySelector('[data-reviews-form=\"true\"]')) {\r\n      initReviewsForm();\r\n    }\r\n    \r\n    // Initialize reviews filter if present\r\n    if (document.querySelector('.reviews')) {\r\n      initReviews();\r\n    }\r\n    \r\n    // Initialize service areas Leaflet map if present\r\n    if (document.getElementById('service-areas-leaflet-map')) {\r\n      initServiceAreasLeaflet();\r\n    }\r\n    \r\n    // Initialize booking iframe tracking if present\r\n    if (document.querySelector('.booking-iframe')) {\r\n      initBookingIframe();\r\n    }\r\n    \r\n    // ============================================================================\r\n    // Dev-Only Modules (Development Mode Only)\r\n    // ============================================================================\r\n    // These modules are only initialized in development (localhost).\r\n    // Both modules also check isLocalhost() internally as a safety measure.\r\n    // ============================================================================\r\n    const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\r\n    \r\n    if (isDev) {\r\n      // Mark document as dev mode (for CSS safety rules if needed)\r\n      document.documentElement.setAttribute('data-dev-mode', 'true');\r\n      \r\n      // Initialize page list if on page-list page\r\n      if (document.querySelector('.page-list-container')) {\r\n        initPageList();\r\n        initPageListSidebar();\r\n      }\r\n      \r\n      // Initialize dev score bubble\r\n      initDevScoreBubble();\r\n    }\r\n    \r\n    // Initialize blog if on blog page\r\n    if (document.querySelector('[data-blog-controls]')) {\r\n      initBlog();\r\n    }\r\n    \r\n    // Initialize sitemap if on sitemap page\r\n    if (document.querySelector('.section-sitemap')) {\r\n      initSitemap();\r\n    }\r\n  } catch (error) {\r\n    console.error('Error initializing application:', error);\r\n    // Don't let errors break the page - content should still render\r\n  }\r\n};\r\n\r\n// Run on DOM ready\r\nonDOMReady(init);\r\n\r\n// Responsive dropdown handling\r\nlet resizeTimeout: ReturnType\u003ctypeof setTimeout\u003e;\r\nwindow.addEventListener(\"resize\", () =\u003e {\r\n  clearTimeout(resizeTimeout);\r\n  resizeTimeout = setTimeout(() =\u003e {\r\n    if (window.innerWidth \u003e MOBILE_BREAKPOINT) {\r\n      resetDropdowns();\r\n    }\r\n    initDropdownHover();\r\n    // Re-initialize services auto-scroll on resize\r\n    initServicesAutoScroll();\r\n    // Re-initialize TOC to handle responsive state changes\r\n    initTOC();\r\n  }, RESIZE_DEBOUNCE_DELAY);\r\n});","/**\r\n* Navigation module\r\n* Handles mobile navigation toggle, dropdown menus, and hover interactions\r\n*/\r\n\r\nimport { isMobile } from \"../utils/dom\";\r\n\r\n/**\r\n * Flattens navGroups on mobile by removing group headers and ungrouping items\r\n */\r\nconst flattenNavGroups = (): void =\u003e {\r\n  if (!isMobile()) return;\r\n\r\n  const dropdownMenus = document.querySelectorAll\u003cHTMLElement\u003e(\".dropdown-menu\");\r\n  \r\n  dropdownMenus.forEach((menu) =\u003e {\r\n    const dropdownLinks = menu.querySelector\u003cHTMLElement\u003e(\".dropdown-links\");\r\n    if (!dropdownLinks) return;\r\n\r\n    const groups = dropdownLinks.querySelectorAll\u003cHTMLElement\u003e(\".dropdown-group\");\r\n    if (groups.length === 0) return;\r\n\r\n    // Flatten groups by moving all links out and removing group containers\r\n    groups.forEach((group) =\u003e {\r\n      const links = group.querySelectorAll\u003cHTMLAnchorElement\u003e(\".dropdown-link\");\r\n      links.forEach((link) =\u003e {\r\n        // Move link out of group to dropdownLinks container\r\n        dropdownLinks.appendChild(link);\r\n      });\r\n      // Remove the group (including header)\r\n      group.remove();\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n* Initializes the main navigation functionality\r\n*/\r\nexport const initNav = (): void =\u003e {\r\nconst nav = document.querySelector\u003cHTMLElement\u003e(\"[data-site-nav]\");\r\nconst toggleBtn = document.querySelector\u003cHTMLButtonElement\u003e(\"[data-nav-toggle]\");\r\n\r\nif (!nav || !toggleBtn) return;\r\n\r\n  // Flatten navGroups on mobile\r\n  flattenNavGroups();\r\n\r\nconst toggle = () =\u003e {\r\nconst isOpen = toggleBtn.getAttribute(\"aria-expanded\") === \"true\";\r\ntoggleBtn.setAttribute(\"aria-expanded\", (!isOpen).toString());\r\nnav.classList.toggle(\"is-open\", !isOpen);\r\n};\r\n\r\ntoggleBtn.addEventListener(\"click\", (event) =\u003e {\r\nevent.preventDefault();\r\ntoggle();\r\n});\r\n\r\n// Handle dropdown menu toggles on mobile\r\nconst dropdownItems = nav.querySelectorAll\u003cHTMLElement\u003e(\".nav-item--dropdown\");\r\n\r\nconst setDropdownHeight = (dropdownMenu: HTMLElement) =\u003e {\r\nif (!isMobile()) return;\r\n\r\nconst siteNav = nav;\r\nif (siteNav) {\r\ndropdownMenu.style.position = \"fixed\";\r\ndropdownMenu.style.left = \"0\";\r\ndropdownMenu.style.right = \"0\";\r\ndropdownMenu.style.width = \"100%\";\r\n}\r\n};\r\n\r\nconst closeDropdown = (dropdownMenu: HTMLElement, dropdownArrow: HTMLElement | null) =\u003e {\r\ndropdownMenu.classList.remove(\"is-open\");\r\nif (isMobile()) {\r\ndropdownMenu.style.position = \"\";\r\ndropdownMenu.style.top = \"\";\r\ndropdownMenu.style.height = \"\";\r\ndropdownMenu.style.left = \"\";\r\ndropdownMenu.style.right = \"\";\r\ndropdownMenu.style.width = \"\";\r\n}\r\nif (dropdownArrow) {\r\ndropdownArrow.style.transform = \"rotate(0deg)\";\r\n}\r\n};\r\n\r\ndropdownItems.forEach((item) =\u003e {\r\nconst dropdownLink = item.querySelector\u003cHTMLAnchorElement\u003e(\".nav-link\");\r\nconst dropdownMenu = item.querySelector\u003cHTMLElement\u003e(\".dropdown-menu\");\r\nconst dropdownArrow = item.querySelector\u003cHTMLElement\u003e(\".dropdown-arrow\");\r\nconst dropdownClose = dropdownMenu?.querySelector\u003cHTMLButtonElement\u003e(\"[data-dropdown-close]\");\r\n\r\nif (!dropdownLink || !dropdownMenu) return;\r\n\r\nif (dropdownClose) {\r\ndropdownClose.addEventListener(\"click\", (e) =\u003e {\r\ne.preventDefault();\r\ne.stopPropagation();\r\ncloseDropdown(dropdownMenu, dropdownArrow);\r\n});\r\n}\r\n\r\nconst handleDropdownToggle = (event: Event) =\u003e {\r\nif (isMobile()) {\r\nevent.preventDefault();\r\nevent.stopPropagation();\r\nconst isOpen = dropdownMenu.classList.contains(\"is-open\");\r\ndropdownMenu.classList.toggle(\"is-open\");\r\n\r\nif (!isOpen) {\r\nsetDropdownHeight(dropdownMenu);\r\n} else {\r\ndropdownMenu.style.position = \"\";\r\ndropdownMenu.style.top = \"\";\r\ndropdownMenu.style.height = \"\";\r\ndropdownMenu.style.left = \"\";\r\ndropdownMenu.style.right = \"\";\r\ndropdownMenu.style.width = \"\";\r\n}\r\n\r\nif (dropdownArrow) {\r\ndropdownArrow.style.transform = isOpen ? \"rotate(0deg)\" : \"rotate(180deg)\";\r\n}\r\n}\r\n};\r\n\r\ndropdownLink.addEventListener(\"click\", handleDropdownToggle);\r\n\r\ndropdownMenu.querySelectorAll(\"a\").forEach((childLink) =\u003e {\r\nchildLink.addEventListener(\"click\", () =\u003e {\r\ntoggleBtn.setAttribute(\"aria-expanded\", \"false\");\r\nnav.classList.remove(\"is-open\");\r\ncloseDropdown(dropdownMenu, dropdownArrow);\r\n});\r\n});\r\n});\r\n\r\nnav.querySelectorAll(\"a\").forEach((link) =\u003e {\r\nif (link.closest(\".nav-item--dropdown\")?.querySelector(\".nav-link\") === link) return;\r\nif (link.closest(\".dropdown-menu\")) return;\r\n\r\nlink.addEventListener(\"click\", () =\u003e {\r\ntoggleBtn.setAttribute(\"aria-expanded\", \"false\");\r\nnav.classList.remove(\"is-open\");\r\n});\r\n});\r\n};\r\n\r\n/**\r\n* Initializes dropdown hover interactions for desktop\r\n*/\r\nexport const initDropdownHover = (): void =\u003e {\r\nif (window.innerWidth \u003c= 1280) return;\r\n\r\nconst dropdownItems = document.querySelectorAll\u003cHTMLElement\u003e(\".nav-item--dropdown\");\r\n\r\n// Center grouped dropdowns to viewport\r\nconst centerGroupedDropdown = (dropdownItem: HTMLElement, dropdownMenu: HTMLElement) =\u003e {\r\nconst hasGroups = dropdownMenu.querySelector(\".dropdown-links \u003e .dropdown-group\");\r\nif (!hasGroups) return;\r\n\r\nconst updatePosition = () =\u003e {\r\n// Don't apply inline positioning at 1400px and below - let CSS handle it\r\nif (window.innerWidth \u003c= 1400) {\r\ndropdownMenu.style.left = \"\";\r\nreturn;\r\n}\r\n\r\nconst rect = dropdownItem.getBoundingClientRect();\r\nconst viewportCenter = window.innerWidth / 2;\r\nconst parentCenter = rect.left + rect.width / 2;\r\n// Calculate offset needed to center dropdown to viewport\r\nconst offset = viewportCenter - parentCenter;\r\ndropdownMenu.style.left = `calc(50% + ${offset}px)`;\r\n};\r\n\r\nconst handleShow = () =\u003e {\r\nupdatePosition();\r\nwindow.addEventListener(\"scroll\", updatePosition, { passive: true });\r\nwindow.addEventListener(\"resize\", updatePosition, { passive: true });\r\n};\r\n\r\nconst handleHide = () =\u003e {\r\nwindow.removeEventListener(\"scroll\", updatePosition);\r\nwindow.removeEventListener(\"resize\", updatePosition);\r\n};\r\n\r\n    dropdownItem.addEventListener(\"mouseenter\", handleShow);\r\n    dropdownItem.addEventListener(\"focusin\", handleShow);\r\n    dropdownItem.addEventListener(\"mouseleave\", handleHide);\r\n    dropdownItem.addEventListener(\"focusout\", (e) =\u003e {\r\nif (!dropdownItem.contains(e.relatedTarget as Node)) handleHide();\r\n});\r\n};\r\n\r\ndropdownItems.forEach((dropdownItem) =\u003e {\r\nconst dropdownMenu = dropdownItem.querySelector\u003cHTMLElement\u003e(\".dropdown-menu\");\r\nconst dropdownLinks = dropdownItem.querySelectorAll\u003cHTMLAnchorElement\u003e(\".dropdown-link\");\r\nconst featureImage = dropdownItem.querySelector\u003cHTMLImageElement\u003e(\".dropdown-feature-image\");\r\nconst featureTitle = dropdownItem.querySelector\u003cHTMLElement\u003e(\".dropdown-feature-title\");\r\nconst featureText = dropdownItem.querySelector\u003cHTMLElement\u003e(\".dropdown-feature-text\");\r\nconst featureLink = dropdownItem.querySelector\u003cHTMLAnchorElement\u003e(\".dropdown-feature-body .btn\");\r\n\r\nif (!dropdownMenu) return;\r\n\r\n// Center grouped dropdowns to viewport\r\ncenterGroupedDropdown(dropdownItem, dropdownMenu);\r\n\r\nif (!featureImage) return;\r\n\r\nconst defaultImage = featureImage.getAttribute(\"data-default-image\") || featureImage.src;\r\nconst defaultTitle = featureTitle?.getAttribute(\"data-default-title\") || featureTitle?.textContent || \"\";\r\nconst defaultText = featureText?.getAttribute(\"data-default-text\") || featureText?.textContent || \"\";\r\nconst defaultLink = featureLink?.getAttribute(\"data-default-link\") || featureLink?.href || \"\";\r\nconst defaultButtonDisplay = featureLink ? window.getComputedStyle(featureLink).display : \"\";\r\n\r\n// Timeout ID for delayed reset\r\nlet resetTimeoutId: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n\r\nconst resetFeature = () =\u003e {\r\nif (featureImage \u0026\u0026 defaultImage) {\r\nfeatureImage.style.opacity = \"0\";\r\nsetTimeout(() =\u003e {\r\nfeatureImage.src = defaultImage;\r\nfeatureImage.onload = () =\u003e (featureImage.style.opacity = \"1\");\r\nsetTimeout(() =\u003e (featureImage.style.opacity = \"1\"), 100);\r\n}, 150);\r\n}\r\nif (featureTitle) featureTitle.textContent = defaultTitle;\r\nif (featureText) featureText.textContent = defaultText;\r\nif (featureLink \u0026\u0026 defaultLink) {\r\nfeatureLink.href = defaultLink;\r\nif (defaultButtonDisplay) featureLink.style.display = defaultButtonDisplay;\r\n}\r\n};\r\n\r\nconst scheduleReset = () =\u003e {\r\n// Clear any existing timeout\r\nif (resetTimeoutId) {\r\nclearTimeout(resetTimeoutId);\r\nresetTimeoutId = null;\r\n}\r\n// Schedule reset with delay\r\nresetTimeoutId = setTimeout(() =\u003e {\r\nresetFeature();\r\nresetTimeoutId = null;\r\n}, 3000);\r\n};\r\n\r\nconst cancelReset = () =\u003e {\r\nif (resetTimeoutId) {\r\nclearTimeout(resetTimeoutId);\r\nresetTimeoutId = null;\r\n}\r\n};\r\n\r\ndropdownLinks.forEach((link) =\u003e {\r\nconst ogImage = link.getAttribute(\"data-og-image\");\r\nconst featureTitleText = link.getAttribute(\"data-feature-title\");\r\nconst featureTextContent = link.getAttribute(\"data-feature-text\");\r\n\r\nif (!ogImage) return;\r\n\r\nconst updateFeature = () =\u003e {\r\n// Cancel any pending reset when hovering over a new link\r\ncancelReset();\r\nif (featureImage \u0026\u0026 ogImage) {\r\nfeatureImage.style.opacity = \"0\";\r\nsetTimeout(() =\u003e {\r\nfeatureImage.src = ogImage;\r\nfeatureImage.onload = () =\u003e (featureImage.style.opacity = \"1\");\r\nsetTimeout(() =\u003e (featureImage.style.opacity = \"1\"), 100);\r\n}, 150);\r\n}\r\nif (featureTitle \u0026\u0026 featureTitleText) featureTitle.textContent = featureTitleText;\r\nif (featureText \u0026\u0026 featureTextContent) featureText.textContent = featureTextContent;\r\nif (featureLink) {\r\nfeatureLink.href = link.href;\r\nfeatureLink.style.display = \"none\";\r\n}\r\n};\r\n\r\n      link.addEventListener(\"mouseenter\", updateFeature);\r\n      link.addEventListener(\"focus\", updateFeature);\r\n      link.addEventListener(\"mouseleave\", scheduleReset);\r\n      link.addEventListener(\"blur\", () =\u003e {\r\nif (!dropdownItem.contains(document.activeElement)) scheduleReset();\r\n});\r\n});\r\n\r\n    dropdownMenu.addEventListener(\"mouseenter\", cancelReset);\r\n    dropdownMenu.addEventListener(\"mouseleave\", scheduleReset);\r\n    dropdownMenu.addEventListener(\"focusout\", (e) =\u003e {\r\nif (!dropdownMenu.contains(e.relatedTarget as Node)) scheduleReset();\r\n});\r\n});\r\n};\r\n\r\n/**\r\n* Resets all dropdown menus to closed state\r\n*/\r\nexport const resetDropdowns = (): void =\u003e {\r\ndocument.querySelectorAll\u003cHTMLElement\u003e(\".nav-item--dropdown\").forEach((item) =\u003e {\r\nconst menu = item.querySelector\u003cHTMLElement\u003e(\".dropdown-menu\");\r\nconst arrow = item.querySelector\u003cHTMLElement\u003e(\".dropdown-arrow\");\r\nif (menu) {\r\nmenu.classList.remove(\"is-open\");\r\nmenu.style.position = \"\";\r\nmenu.style.top = \"\";\r\nmenu.style.height = \"\";\r\nmenu.style.left = \"\";\r\nmenu.style.right = \"\";\r\nmenu.style.width = \"\";\r\n}\r\nif (arrow) arrow.style.transform = \"\";\r\n});\r\n};","/**\r\n * Header module\r\n * Handles header shadow on scroll and city personalization\r\n */\r\n\r\nimport { SCROLL_SHADOW_THRESHOLD } from \"../constants\";\r\nimport { isLocalhost, onDOMReady } from \"../utils/dom\";\r\nimport { normalizeCity, isKnownCity, getCityName, parseCitiesFromData } from \"../utils/geolocation\";\r\n\r\n/**\r\n * Initializes the header shadow effect on scroll\r\n */\r\nexport const initHeaderShadow = (): void =\u003e {\r\n  const header = document.querySelector\u003cHTMLElement\u003e(\".site-header\");\r\n  if (!header) return;\r\n\r\n  const apply = () =\u003e header.classList.toggle(\"has-shadow\", window.scrollY \u003e SCROLL_SHADOW_THRESHOLD);\r\n  apply();\r\n  document.addEventListener(\"scroll\", apply, { passive: true });\r\n};\r\n\r\n/**\r\n * Updates the page header with city-specific content\r\n */\r\nconst updateHeaderWithCity = (\r\n  cityName: string | null,\r\n  knownCities: string[],\r\n  region: string | null = null\r\n): void =\u003e {\r\n  const titleEl = document.querySelector\u003cHTMLElement\u003e(\".page-header__title[data-base-title]\");\r\n  const taglineEl = document.querySelector\u003cHTMLElement\u003e(\".page-header__tagline[data-base-tagline]\");\r\n\r\n  if (!titleEl) return;\r\n\r\n  const baseTitle = titleEl.getAttribute(\"data-base-title\") || \"\";\r\n  const fallbackCity = titleEl.getAttribute(\"data-city-placeholder\") || \"Miami\";\r\n  let cityToUse = fallbackCity;\r\n\r\n  if (cityName \u0026\u0026 isKnownCity(cityName, knownCities)) {\r\n    const canonicalName = getCityName(cityName, knownCities);\r\n    if (canonicalName) cityToUse = canonicalName;\r\n  }\r\n\r\n  const newTitle = `${baseTitle} in ${cityToUse}`;\r\n  titleEl.textContent = newTitle;\r\n\r\n  if (taglineEl \u0026\u0026 taglineEl.hasAttribute(\"data-base-tagline\")) {\r\n    const baseTagline = taglineEl.getAttribute(\"data-base-tagline\") || \"\";\r\n    const newTagline = baseTagline.replace(/\\bMiami\\b/i, cityToUse);\r\n    taglineEl.textContent = newTagline;\r\n  }\r\n\r\n  if (isLocalhost()) {\r\n    console.log(\"City Personalization →\", {\r\n      detected: cityName,\r\n      region,\r\n      used: cityToUse,\r\n      fallback: fallbackCity,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Detects user's city via geolocation API and updates header\r\n */\r\nconst detectCity = (knownCities: string[]): void =\u003e {\r\n  const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n  if (!pageHeader) return;\r\n\r\n  if (isLocalhost()) {\r\n    console.log(\"Skipping geolocation on localhost → using fallback (Miami)\");\r\n    updateHeaderWithCity(null, knownCities);\r\n    return;\r\n  }\r\n\r\n  // Get API key from data attribute (set by Hugo from site.Params.geolocationApiKey)\r\n  const apiKey = pageHeader.getAttribute(\"data-geo-api-key\") || \"\";\r\n  const apiUrl = apiKey\r\n    ? `https://ipgeolocation.bigdatacloud.net/?ip\u0026key=${encodeURIComponent(apiKey)}`\r\n    : \"https://ipgeolocation.bigdatacloud.net/?ip\";\r\n\r\n  // Using BigDataCloud IP Geolocation API\r\n  fetch(apiUrl, {\r\n    headers: { Accept: \"application/json\" },\r\n  })\r\n    .then((r) =\u003e (r.ok ? r.json() : Promise.reject(r.status)))\r\n    .then((data: any) =\u003e {\r\n      if (isLocalhost()) console.log(\"Geolocation raw response:\", data);\r\n\r\n      const city = data.city || null;\r\n      const region = data.countryName || null; // Or use data.localityInfo.administrative for suburbs\r\n\r\n      updateHeaderWithCity(city, knownCities, region);\r\n    })\r\n    .catch(() =\u003e {\r\n      if (isLocalhost()) console.warn(\"Geolocation failed, using fallback\");\r\n      updateHeaderWithCity(null, knownCities);\r\n    });\r\n};\r\n\r\n/**\r\n * Initializes page header city personalization\r\n */\r\nexport const initPageHeaderCityPersonalization = (): void =\u003e {\r\n  const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n  if (!pageHeader) return;\r\n\r\n  // Get cities from Hugo data file (data/cities.yaml)\r\n  const citiesDataAttr = pageHeader.getAttribute(\"data-cities\");\r\n  const knownCities = parseCitiesFromData(citiesDataAttr);\r\n\r\n  // Minimal fallback: only use if data file failed to load\r\n  // Cities should come from data/cities.yaml, not hardcoded\r\n  const citiesToUse = knownCities.length \u003e 0 ? knownCities : [\"Miami\"];\r\n\r\n  if (isLocalhost() \u0026\u0026 knownCities.length === 0) {\r\n    console.warn(\"No cities loaded from data/cities.yaml, using minimal fallback (Miami only)\");\r\n  }\r\n\r\n  onDOMReady(() =\u003e detectCity(citiesToUse));\r\n};\r\n\r\n","/**\r\n * Logger Utility\r\n * Gates console statements based on environment\r\n * Production builds should strip console.log/warn statements\r\n */\r\n\r\n/**\r\n * Check if we're in development mode\r\n */\r\nfunction isDevelopment(): boolean {\r\n  if (typeof window === 'undefined') return false;\r\n  const hostname = window.location.hostname;\r\n  return hostname === 'localhost' || \r\n         hostname === '127.0.0.1' || \r\n         hostname === '[::1]' ||\r\n         hostname.startsWith('192.168.') ||\r\n         hostname.startsWith('10.') ||\r\n         hostname.endsWith('.local');\r\n}\r\n\r\n/**\r\n * Logger utility that gates console statements based on environment\r\n */\r\nexport const logger = {\r\n  /**\r\n   * Log message (development only)\r\n   * Use for debugging and development information\r\n   */\r\n  log: (...args: any[]): void =\u003e {\r\n    if (isDevelopment()) {\r\n      console.log(...args);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log error (always logged)\r\n   * Errors should always be visible for debugging production issues\r\n   */\r\n  error: (...args: any[]): void =\u003e {\r\n    console.error(...args);\r\n  },\r\n\r\n  /**\r\n   * Log warning (development only)\r\n   * Use for non-critical warnings during development\r\n   */\r\n  warn: (...args: any[]): void =\u003e {\r\n    if (isDevelopment()) {\r\n      console.warn(...args);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log info (development only)\r\n   * Use for informational messages\r\n   */\r\n  info: (...args: any[]): void =\u003e {\r\n    if (isDevelopment()) {\r\n      console.info(...args);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Log debug (development only)\r\n   * Use for detailed debugging information\r\n   */\r\n  debug: (...args: any[]): void =\u003e {\r\n    if (isDevelopment()) {\r\n      console.debug(...args);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if logging is enabled\r\n   * Useful for conditional logging logic\r\n   */\r\n  isEnabled: (): boolean =\u003e isDevelopment(),\r\n};\r\n\r\n/**\r\n * Legacy support: Export as default for easier migration\r\n */\r\nexport default logger;\r\n\r\n","// src/utils/geolocation.ts\r\n\r\nimport { logger } from './logger';\r\n\r\nexport interface BigDataCloudResponse {\r\n  city?: string;\r\n  localityInfo?: {\r\n    administrative?: Array\u003c{\r\n      name?: string;\r\n      order?: number;\r\n    }\u003e;\r\n  };\r\n  confidence?: {\r\n    city?: number;\r\n  };\r\n  region?: {\r\n    name?: string;\r\n  };\r\n  country?: {\r\n    name?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Secure \u0026 accurate city detection (2025)\r\n * Uses Hugo server-side proxy → API key NEVER exposed in frontend\r\n * Optimized for South Florida region detection\r\n */\r\nexport const getAccurateCity = async (): Promise\u003cstring | null\u003e =\u003e {\r\n  try {\r\n    const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n    const rawData = pageHeader?.getAttribute(\"data-geolocation\");\r\n\r\n    // No data = fallback to Miami later\r\n    if (!rawData || rawData.trim() === \"\" || rawData === \"{}\") {\r\n      logger.warn(\"Geolocation: No data from server-side proxy\");\r\n      return null;\r\n    }\r\n\r\n    const data: BigDataCloudResponse = JSON.parse(rawData);\r\n\r\n    // Primary: use detected city\r\n    let detectedCity = data.city?.trim();\r\n\r\n    // Fallback 1: Use administrative locality (more accurate in South Florida)\r\n    if (!detectedCity || data.confidence?.city === 0) {\r\n      const adminLevels = data.localityInfo?.administrative;\r\n      if (adminLevels \u0026\u0026 adminLevels.length \u003e 0) {\r\n        // Level 1 = municipality (e.g., Coral Gables), Level 0 = broader (e.g., Miami-Dade County)\r\n        detectedCity = adminLevels.find(l =\u003e l.order === 1)?.name\r\n                    || adminLevels.find(l =\u003e l.order === 0)?.name\r\n                    || adminLevels[0]?.name;\r\n      }\r\n    }\r\n\r\n    return detectedCity || null;\r\n\r\n  } catch (err) {\r\n    logger.warn(\"Geolocation parsing failed:\", err);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Parses cities from Hugo data-cities attribute (JSON array from cities.yaml)\r\n */\r\nexport const parseCitiesFromData = (dataAttr: string | null): string[] =\u003e {\r\n  if (!dataAttr) return [];\r\n\r\n  try {\r\n    const parsed = JSON.parse(dataAttr);\r\n    if (Array.isArray(parsed)) {\r\n      return parsed.filter((c): c is string =\u003e typeof c === \"string\" \u0026\u0026 c.trim() !== \"\");\r\n    }\r\n  } catch {\r\n    // Ignore JSON errors\r\n  }\r\n\r\n  return [];\r\n};\r\n\r\n/**\r\n * Normalize city name for comparison\r\n */\r\nexport const normalizeCity = (city: string | null | undefined): string =\u003e {\r\n  return city?.trim().toLowerCase().replace(/\\s+/g, \" \") || \"\";\r\n};\r\n\r\n/**\r\n * Check if detected city is in known cities list\r\n */\r\nexport const isKnownCity = (city: string | null | undefined, knownCities: string[]): boolean =\u003e {\r\n  if (!city) return false;\r\n  const norm = normalizeCity(city);\r\n  return knownCities.some(known =\u003e normalizeCity(known) === norm);\r\n};\r\n\r\n/**\r\n * Get canonical (properly capitalized) city name from known list\r\n */\r\nexport const getCityName = (city: string | null | undefined, knownCities: string[]): string | null =\u003e {\r\n  if (!city) return null;\r\n  const norm = normalizeCity(city);\r\n  return knownCities.find(known =\u003e normalizeCity(known) === norm) || null;\r\n};\r\n\r\n/**\r\n * Gets province/state from geolocation data\r\n * Uses the same geolocation system as city detection\r\n */\r\nexport const getProvinceState = async (): Promise\u003cstring | null\u003e =\u003e {\r\n  try {\r\n    const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n    const rawData = pageHeader?.getAttribute(\"data-geolocation\");\r\n\r\n    // No data = fallback later\r\n    if (!rawData || rawData.trim() === \"\" || rawData === \"{}\") {\r\n      return null;\r\n    }\r\n\r\n    const data: BigDataCloudResponse = JSON.parse(rawData);\r\n    const region = data.region?.name?.trim();\r\n\r\n    return region || null;\r\n\r\n  } catch (err) {\r\n    logger.warn(\"Province/State parsing failed:\", err);\r\n    return null;\r\n  }\r\n};","/**\r\n * Phone links module\r\n * Initializes phone number links throughout the site\r\n */\r\n\r\nimport { PHONE_DATA_ATTR } from \"../constants\";\r\n\r\n/**\r\n * Initializes phone links by setting href and text content\r\n */\r\nexport const initPhoneLinks = (): void =\u003e {\r\n  const phone = document.body.dataset[PHONE_DATA_ATTR as keyof DOMStringMap];\r\n  if (!phone) return;\r\n\r\n  const telHref = `tel:${phone.replace(/[^0-9+]/g, \"\")}`;\r\n  document.querySelectorAll\u003cHTMLAnchorElement\u003e(\"[data-phone-link]\").forEach((link) =\u003e {\r\n    if (!link.textContent?.trim()) link.textContent = phone;\r\n    link.href = telHref;\r\n  });\r\n};\r\n\r\n","/**\r\n * Year stamp module\r\n * Updates elements with the current year\r\n */\r\n\r\n/**\r\n * Initializes year stamp by setting current year in elements with [data-current-year]\r\n */\r\nexport const initYearStamp = (): void =\u003e {\r\n  const el = document.querySelector\u003cHTMLElement\u003e(\"[data-current-year]\");\r\n  if (el) el.textContent = new Date().getFullYear().toString();\r\n};\r\n\r\n","import { parseCitiesFromData, normalizeCity, isKnownCity, getCityName } from \"./geolocation\";\r\nimport { getAccurateCity, getProvinceState } from \"./geolocation\";\r\n\r\nconst FALLBACK_CITY = \"Miami\";\r\n\r\n/**\r\n * Updates all geolocation shortcode elements on the page\r\n */\r\nexport const initGeolocationShortcodes = () =\u003e {\r\n  const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n  if (!pageHeader) return;\r\n\r\n  const isDev = location.hostname === \"localhost\" || location.hostname === \"127.0.0.1\";\r\n\r\n  // Load cities from Hugo (your cities.yaml)\r\n  const citiesDataAttr = pageHeader.getAttribute(\"data-cities\");\r\n  const knownCities = parseCitiesFromData(citiesDataAttr);\r\n\r\n  const updateShortcodes = (detectedCity: string | null) =\u003e {\r\n    const shortcodes = document.querySelectorAll\u003cHTMLElement\u003e(\".geolocation-shortcode\");\r\n    \r\n    shortcodes.forEach((shortcode) =\u003e {\r\n      const cityEl = shortcode.querySelector\u003cHTMLElement\u003e(\".geolocation-shortcode__city\");\r\n      if (!cityEl) return;\r\n\r\n      const requestedCity = shortcode.getAttribute(\"data-geo-detected\") || \"\";\r\n      const fallbackText = shortcode.getAttribute(\"data-geo-fallback\") || FALLBACK_CITY;\r\n      \r\n      let finalCity = fallbackText;\r\n\r\n      // If a specific city was requested in the shortcode\r\n      if (requestedCity) {\r\n        if (detectedCity) {\r\n          const normalizedDetected = normalizeCity(detectedCity);\r\n          const normalizedRequested = normalizeCity(requestedCity);\r\n          \r\n          // If detected city matches the requested city, use the canonical name\r\n          if (normalizedDetected === normalizedRequested) {\r\n            finalCity = getCityName(detectedCity, knownCities) || requestedCity;\r\n          } else if (isKnownCity(detectedCity, knownCities)) {\r\n            // Detected city doesn't match requested, but is known - use detected city\r\n            finalCity = getCityName(detectedCity, knownCities) || fallbackText;\r\n          }\r\n          // Otherwise use fallback\r\n        }\r\n        // If no detected city, use fallback\r\n      } else {\r\n        // No specific city requested - use detected city if known, otherwise fallback\r\n        if (detectedCity \u0026\u0026 isKnownCity(detectedCity, knownCities)) {\r\n          finalCity = getCityName(detectedCity, knownCities) || fallbackText;\r\n        }\r\n        // Otherwise use fallback (already set)\r\n      }\r\n\r\n      cityEl.textContent = finalCity;\r\n    });\r\n\r\n    if (isDev \u0026\u0026 shortcodes.length \u003e 0) {\r\n      console.log(\"Geolocation Shortcodes →\", { detected: detectedCity, updated: shortcodes.length });\r\n    }\r\n  };\r\n\r\n  const updateProvinceShortcodes = (detectedProvince: string | null) =\u003e {\r\n    const shortcodes = document.querySelectorAll\u003cHTMLElement\u003e(\".geostate-province-shortcode\");\r\n    \r\n    shortcodes.forEach((shortcode) =\u003e {\r\n      const provinceEl = shortcode.querySelector\u003cHTMLElement\u003e(\".geostate-province-shortcode__province\");\r\n      if (!provinceEl) return;\r\n\r\n      const fallbackText = shortcode.getAttribute(\"data-geo-fallback\") || \"Florida\";\r\n      const finalProvince = detectedProvince || fallbackText;\r\n\r\n      provinceEl.textContent = finalProvince;\r\n    });\r\n\r\n    if (isDev \u0026\u0026 shortcodes.length \u003e 0) {\r\n      console.log(\"Province/State Shortcodes →\", { detected: detectedProvince, updated: shortcodes.length });\r\n    }\r\n  };\r\n\r\n  const detectAndUpdate = async () =\u003e {\r\n    if (isDev) {\r\n      updateShortcodes(null);\r\n      updateProvinceShortcodes(null);\r\n      return;\r\n    }\r\n\r\n    const city = await getAccurateCity();\r\n    const province = await getProvinceState();\r\n    updateShortcodes(city);\r\n    updateProvinceShortcodes(province);\r\n  };\r\n\r\n  // Run immediately or on DOM ready\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", detectAndUpdate);\r\n  } else {\r\n    detectAndUpdate();\r\n  }\r\n};\r\n\r\nexport const initPageHeaderCityPersonalization = () =\u003e {\r\n  const pageHeader = document.querySelector\u003cHTMLElement\u003e(\".page-header\");\r\n  if (!pageHeader) return;\r\n\r\n  const isDev = location.hostname === \"localhost\" || location.hostname === \"127.0.0.1\";\r\n\r\n  // Load cities from Hugo (your cities.yaml)\r\n  const citiesDataAttr = pageHeader.getAttribute(\"data-cities\");\r\n  const knownCities = parseCitiesFromData(citiesDataAttr);\r\n\r\n  const updateHeader = (detectedCity: string | null) =\u003e {\r\n    const titleEl = document.querySelector\u003cHTMLElement\u003e(\".page-header__title[data-base-title]\");\r\n    const taglineEl = document.querySelector\u003cHTMLElement\u003e(\".page-header__tagline[data-base-tagline]\");\r\n    if (!titleEl) return;\r\n\r\n    const baseTitle = titleEl.getAttribute(\"data-base-title\") || \"\";\r\n    let finalCity = titleEl.getAttribute(\"data-city-placeholder\") || FALLBACK_CITY;\r\n\r\n    if (detectedCity \u0026\u0026 isKnownCity(detectedCity, knownCities)) {\r\n      finalCity = getCityName(detectedCity, knownCities) || finalCity;\r\n    }\r\n\r\n    titleEl.textContent = `${baseTitle} in ${finalCity}`;\r\n\r\n    if (taglineEl?.hasAttribute(\"data-base-tagline\")) {\r\n      const base = taglineEl.getAttribute(\"data-base-tagline\") || \"\";\r\n      taglineEl.textContent = base.replace(/\\bMiami\\b/i, finalCity);\r\n    }\r\n\r\n    if (isDev) {\r\n      console.log(\"City Personalization →\", { detected: detectedCity, final: finalCity });\r\n    }\r\n  };\r\n\r\n  const detectAndUpdate = async () =\u003e {\r\n    if (isDev) {\r\n      updateHeader(null);\r\n      return;\r\n    }\r\n\r\n    const city = await getAccurateCity();\r\n    updateHeader(city);\r\n  };\r\n\r\n  // Run immediately or on DOM ready\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", detectAndUpdate);\r\n  } else {\r\n    detectAndUpdate();\r\n  }\r\n};","/**\r\n * Services Auto-Scroll Module\r\n * Handles automatic horizontal scrolling for services section\r\n * - Auto-scrolls from right to left at steady pace\r\n * - Loops when reaching the end\r\n * - Pauses on hover (desktop) or touch (mobile)\r\n * - Allows manual scrolling\r\n */\r\n\r\nimport { MOBILE_BREAKPOINT } from \"../constants\";\r\n\r\nconst SCROLL_SPEED = 0.5; // pixels per frame (adjust for speed)\r\n\r\nlet animationFrameId: number | null = null;\r\nlet isPaused = false;\r\nlet isUserScrolling = false;\r\nlet isProgrammaticScroll = false; // Flag to prevent scroll event from pausing auto-scroll\r\nlet userScrollTimeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\nlet servicesGrid: HTMLElement | null = null;\r\nlet isInitialized = false;\r\nlet originalContentWidth = 0; // Width of the original content (before duplication)\r\nlet isDesktopLayout = false;\r\nlet resizeTimeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\nlet isResizeListenerAttached = false;\r\n\r\n/**\r\n * Checks if we're on desktop viewport\r\n */\r\nconst isDesktop = (): boolean =\u003e window.innerWidth \u003e MOBILE_BREAKPOINT;\r\n\r\n/**\r\n * Resets scroll position to start for seamless looping\r\n * When we've scrolled past the original content, reset to beginning\r\n */\r\nconst resetScrollPosition = (): void =\u003e {\r\n  if (!servicesGrid || originalContentWidth === 0) return;\r\n  \r\n  // If we've scrolled past the original content width, reset to beginning\r\n  // This creates a seamless loop since the duplicate content matches the original\r\n  if (servicesGrid.scrollLeft \u003e= originalContentWidth) {\r\n    isProgrammaticScroll = true;\r\n    servicesGrid.scrollLeft = servicesGrid.scrollLeft - originalContentWidth;\r\n    requestAnimationFrame(() =\u003e {\r\n      isProgrammaticScroll = false;\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Performs one frame of auto-scrolling\r\n */\r\nconst scrollFrame = (): void =\u003e {\r\n  if (!servicesGrid || isPaused || isUserScrolling) {\r\n    animationFrameId = null;\r\n    return;\r\n  }\r\n\r\n  const scrollWidth = servicesGrid.scrollWidth;\r\n  const clientWidth = servicesGrid.clientWidth;\r\n  const maxScroll = scrollWidth - clientWidth;\r\n\r\n  // If content doesn't overflow, don't scroll\r\n  if (maxScroll \u003c= 0) {\r\n    animationFrameId = null;\r\n    return;\r\n  }\r\n\r\n  // Increment scroll position (mark as programmatic to prevent scroll event handler from interfering)\r\n  isProgrammaticScroll = true;\r\n  servicesGrid.scrollLeft += SCROLL_SPEED;\r\n\r\n  // Reset scroll position when we've scrolled past the original content\r\n  // This creates a seamless infinite loop\r\n  resetScrollPosition();\r\n  \r\n  // Reset flag after a brief moment to allow scroll event to process\r\n  requestAnimationFrame(() =\u003e {\r\n    isProgrammaticScroll = false;\r\n  });\r\n\r\n  // Continue animation\r\n  animationFrameId = requestAnimationFrame(scrollFrame);\r\n};\r\n\r\n/**\r\n * Starts the auto-scroll animation\r\n */\r\nconst startAutoScroll = (): void =\u003e {\r\n  if (animationFrameId !== null) return;\r\n  \r\n  isPaused = false;\r\n  animationFrameId = requestAnimationFrame(scrollFrame);\r\n};\r\n\r\n/**\r\n * Stops the auto-scroll animation\r\n */\r\nconst stopAutoScroll = (): void =\u003e {\r\n  if (animationFrameId !== null) {\r\n    cancelAnimationFrame(animationFrameId);\r\n    animationFrameId = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Handles mouse enter - pauses auto-scroll\r\n */\r\nconst handleMouseEnter = (): void =\u003e {\r\n  isPaused = true;\r\n  stopAutoScroll();\r\n};\r\n\r\n/**\r\n * Handles mouse leave - resumes auto-scroll (desktop)\r\n */\r\nconst handleMouseLeave = (): void =\u003e {\r\n  if (!isUserScrolling) {\r\n    isPaused = false;\r\n    startAutoScroll();\r\n  }\r\n};\r\n\r\n/**\r\n * Handles touch start - pauses auto-scroll (mobile)\r\n */\r\nconst handleTouchStart = (): void =\u003e {\r\n  isPaused = true;\r\n  stopAutoScroll();\r\n};\r\n\r\n/**\r\n * Handles touch end - resumes auto-scroll (mobile)\r\n */\r\nconst handleTouchEnd = (): void =\u003e {\r\n  // Resume after a brief delay to allow for scrolling\r\n  setTimeout(() =\u003e {\r\n    if (!isUserScrolling) {\r\n      isPaused = false;\r\n      startAutoScroll();\r\n    }\r\n  }, 100);\r\n};\r\n\r\n/**\r\n * Handles user scroll - pauses auto-scroll temporarily\r\n */\r\nconst handleUserScroll = (): void =\u003e {\r\n  // Ignore programmatic scrolling (from auto-scroll)\r\n  if (isProgrammaticScroll) {\r\n    // Still need to check for reset even during programmatic scroll\r\n    resetScrollPosition();\r\n    return;\r\n  }\r\n  \r\n  isUserScrolling = true;\r\n  stopAutoScroll();\r\n\r\n  // Reset scroll position for seamless loop during user scrolling\r\n  resetScrollPosition();\r\n\r\n  // Clear existing timeout\r\n  if (userScrollTimeout) {\r\n    clearTimeout(userScrollTimeout);\r\n  }\r\n\r\n  // Resume auto-scroll after user stops scrolling for 2 seconds\r\n  userScrollTimeout = setTimeout(() =\u003e {\r\n    isUserScrolling = false;\r\n    if (!isPaused) {\r\n      startAutoScroll();\r\n    }\r\n  }, 2000);\r\n};\r\n\r\n/**\r\n * Duplicates the content for seamless infinite scrolling\r\n */\r\nconst duplicateContent = (): void =\u003e {\r\n  if (!servicesGrid) return;\r\n  \r\n  // Clone all service items and append them to create seamless loop\r\n  const serviceItems = servicesGrid.querySelectorAll\u003cHTMLElement\u003e(\".service-item\");\r\n  \r\n  if (serviceItems.length === 0) return;\r\n  \r\n  // Store the width of original content before duplication\r\n  // This is the scrollWidth of just the original items\r\n  originalContentWidth = servicesGrid.scrollWidth;\r\n  \r\n  // Only duplicate if content actually overflows (needs scrolling)\r\n  const clientWidth = servicesGrid.clientWidth;\r\n  if (originalContentWidth \u003c= clientWidth) {\r\n    // Content doesn't overflow, no need to duplicate or scroll\r\n    originalContentWidth = 0;\r\n    return;\r\n  }\r\n  \r\n  // Clone each service item and append\r\n  serviceItems.forEach((item) =\u003e {\r\n    const clone = item.cloneNode(true) as HTMLElement;\r\n    servicesGrid!.appendChild(clone);\r\n  });\r\n};\r\n\r\n/**\r\n * Cleans up event listeners and stops animation\r\n */\r\nconst cleanup = (): void =\u003e {\r\n  stopAutoScroll();\r\n  \r\n  if (userScrollTimeout) {\r\n    clearTimeout(userScrollTimeout);\r\n    userScrollTimeout = null;\r\n  }\r\n  \r\n  if (servicesGrid \u0026\u0026 isInitialized) {\r\n    servicesGrid.removeEventListener(\"mouseenter\", handleMouseEnter);\r\n    servicesGrid.removeEventListener(\"mouseleave\", handleMouseLeave);\r\n    servicesGrid.removeEventListener(\"touchstart\", handleTouchStart);\r\n    servicesGrid.removeEventListener(\"touchend\", handleTouchEnd);\r\n    servicesGrid.removeEventListener(\"scroll\", handleUserScroll);\r\n    \r\n    // Remove duplicated content\r\n    const serviceItems = servicesGrid.querySelectorAll\u003cHTMLElement\u003e(\".service-item\");\r\n    const originalCount = serviceItems.length / 2; // Assuming we duplicated, so half are duplicates\r\n    if (originalCount \u003e 0) {\r\n      // Remove the duplicated items (the second half)\r\n      for (let i = serviceItems.length - 1; i \u003e= originalCount; i--) {\r\n        serviceItems[i].remove();\r\n      }\r\n    }\r\n  }\r\n  \r\n  isInitialized = false;\r\n  isPaused = false;\r\n  isUserScrolling = false;\r\n  originalContentWidth = 0;\r\n  servicesGrid = null;\r\n};\r\n\r\n/**\r\n * Handles viewport changes; re-initialize when crossing the desktop breakpoint.\r\n */\r\nconst handleResize = (): void =\u003e {\r\n  if (resizeTimeout) {\r\n    clearTimeout(resizeTimeout);\r\n  }\r\n\r\n  // Debounce resize to avoid thrashing during orientation changes.\r\n  resizeTimeout = setTimeout(() =\u003e {\r\n    const nowDesktop = isDesktop();\r\n\r\n    // Only act when we cross the breakpoint to avoid unnecessary work.\r\n    if (nowDesktop !== isDesktopLayout) {\r\n      cleanup();\r\n      // Only initialize on desktop; mobile/tablet stays static grid.\r\n      if (nowDesktop) {\r\n        initServicesAutoScroll();\r\n      }\r\n    }\r\n\r\n    isDesktopLayout = nowDesktop;\r\n  }, 150);\r\n};\r\n\r\n/**\r\n * Initializes the services auto-scroll functionality\r\n */\r\nexport const initServicesAutoScroll = (): void =\u003e {\r\n  // Clean up previous initialization if it exists\r\n  if (isInitialized) {\r\n    cleanup();\r\n  }\r\n  \r\n  // Only enable auto-scroll on desktop viewports; mobile/tablet stays static grid.\r\n  if (!isDesktop()) {\r\n    isDesktopLayout = false;\r\n    return;\r\n  }\r\n  isDesktopLayout = true;\r\n\r\n  servicesGrid = document.querySelector\u003cHTMLElement\u003e(\".services-grid\");\r\n  \r\n  if (!servicesGrid) return;\r\n\r\n  // Duplicate content for seamless infinite loop\r\n  duplicateContent();\r\n\r\n  // Set up event listeners\r\n  // Desktop: hover events\r\n  servicesGrid.addEventListener(\"mouseenter\", handleMouseEnter);\r\n  servicesGrid.addEventListener(\"mouseleave\", handleMouseLeave);\r\n  // Mobile: touch events\r\n  servicesGrid.addEventListener(\"touchstart\", handleTouchStart, { passive: true });\r\n  servicesGrid.addEventListener(\"touchend\", handleTouchEnd, { passive: true });\r\n  // Both: scroll detection\r\n  servicesGrid.addEventListener(\"scroll\", handleUserScroll, { passive: true });\r\n  \r\n  isInitialized = true;\r\n\r\n  // Start auto-scroll\r\n  startAutoScroll();\r\n\r\n  // Attach a resize listener once to react to breakpoint changes.\r\n  if (!isResizeListenerAttached) {\r\n    window.addEventListener(\"resize\", handleResize, { passive: true });\r\n    isResizeListenerAttached = true;\r\n  }\r\n};\r\n\r\n","/**\r\n * Page List Module\r\n * Fetches page metadata and renders the page list table client-side\r\n */\r\n\r\nimport { isLocalhost } from \"../utils/dom\";\r\nimport {\r\n  requestSiteRootAccess,\r\n  getSiteRootDirectoryHandle,\r\n  setSiteRootDirectoryHandle,\r\n  readFileContent,\r\n  writeFileContent,\r\n  findActualFilePath,\r\n  createBackupFilename,\r\n  relPermalinkToContentFile,\r\n  removeLinkFromContent,\r\n  escapeRegex\r\n} from \"../utils/file-system\";\r\nimport {\r\n  showToast,\r\n  createConfirmationDialog,\r\n  createUrlInputDialog,\r\n  escapeHtml\r\n} from \"../utils/dev-ui\";\r\nimport {\r\n  analyzeKeywords,\r\n  generateRelatedKeywords,\r\n  analyzeKeywordGaps,\r\n  renderKeywordResearchModal,\r\n  attachSeedKeywordSearch,\r\n  attachCompetitorKeywordRemoval,\r\n  attachExportHandlers,\r\n  type KeywordAnalysis,\r\n  type PageKeywordData\r\n} from \"./keyword-research\";\r\nimport { renderLinkMap } from \"./link-map\";\r\n\r\ninterface BrokenLinkInfo {\r\n  brokenUrl: string;\r\n  sourcePage: string; // relPermalink of page containing the broken link\r\n  sourceFile?: string; // Will be determined from sourcePage\r\n  lineNumber?: number; // Will be determined when reading file\r\n}\r\n\r\ninterface LinkFix {\r\n  brokenUrl: string;\r\n  fixedUrl: string | null; // null means link should be removed\r\n  sourceFile: string;\r\n  lineNumber: number;\r\n  matchReason: string;\r\n  action: 'fix' | 'remove'; // Whether to fix the URL or remove the link entirely\r\n}\r\n\r\ninterface LinkSuggestion {\r\n  url: string;\r\n  title?: string;\r\n  similarity: number;\r\n  reason: string;\r\n}\r\n\r\ninterface FixResult {\r\n  attempted: number;\r\n  fixed: number;\r\n  skipped: number;\r\n  fixes: LinkFix[];\r\n  skippedLinks: Array\u003c{ brokenUrl: string; sourceFile: string; sourcePage: string; suggestions?: LinkSuggestion[] }\u003e; // Links that couldn't be fixed\r\n  modifiedFiles: string[];\r\n  backups: string[];\r\n}\r\n\r\ninterface PageData {\r\n  title: string;\r\n  relPermalink: string;\r\n  section: string;\r\n  metaTitle: string;\r\n  metaDescription: string;\r\n  summary: string;\r\n  hasMetaTitle: boolean;\r\n  hasMetaDescription: boolean;\r\n  metaTitleLength: number;\r\n  metaDescriptionLength: number;\r\n  titleOverLimit: boolean;\r\n  descriptionOverLimit: boolean;\r\n  titlePixels: number;\r\n  descriptionPixels: number;\r\n  titleOverPixels: boolean;\r\n  descriptionOverPixels: boolean;\r\n  seoScore: number;\r\n  aiCrawlabilityScore: number;\r\n  hasSummary: boolean;\r\n  summaryGood: boolean;\r\n  summaryLength: number;\r\n  summaryOptimal: boolean;\r\n  summaryFair: boolean;\r\n  summaryTooShort: boolean;\r\n  summaryTooLong: boolean;\r\n  hasHeadings: boolean;\r\n  headingsGood: boolean;\r\n  hasContent: boolean;\r\n  contentGood: boolean;\r\n  htmlToContentRatio: number;\r\n  htmlRatioGood: boolean;\r\n  brokenLinks: number;\r\n  brokenLinkUrls?: string[];\r\n  totalInternalLinks: number;\r\n  hasBrokenLinks: boolean;\r\n  brokenImages: number;\r\n  brokenImageUrls?: string[];\r\n  hasBrokenImages: boolean;\r\n  imagesWithoutAlt: number;\r\n  totalImages: number;\r\n  hasImagesWithoutAlt: boolean;\r\n  headingStructureGood: boolean;\r\n  h1Count: number;\r\n  hasOneH1: boolean;\r\n  hasMultipleH1: boolean;\r\n  h2Count: number;\r\n  hasH2s: boolean;\r\n  internalLinkCount: number;\r\n  internalLinksGood: boolean;\r\n  internalLinksTooFew: boolean;\r\n  internalLinksTooMany: boolean;\r\n  genericAnchorCount: number;\r\n  hasGenericAnchors: boolean;\r\n  imagesWithGenericAlt: number;\r\n  hasGenericAltText: boolean;\r\n  hasSchemaMarkup: boolean;\r\n  hasCommonSchema: boolean;\r\n  firstParaLength: number;\r\n  firstParaGood: boolean;\r\n  wordCount: number;\r\n  wordCountGood: boolean;\r\n  wordCountFair: boolean;\r\n  wordCountPoor: boolean;\r\n  hasLists: boolean;\r\n  hasBoldText: boolean;\r\n  isStale: boolean;\r\n  daysSinceUpdate: number;\r\n  citationCount: number;\r\n  hasCitations: boolean;\r\n  citationsGood: boolean;\r\n  hasAuthor: boolean;\r\n  authorName?: string | null;\r\n  hasVideos: boolean;\r\n  videoCount: number;\r\n  hasTranscript: boolean;\r\n  avgSentenceLength: number;\r\n  longSentences?: string[];\r\n  readabilityGood: boolean;\r\n  hasAnalytics: boolean;\r\n  hasGoogleAnalytics: boolean;\r\n  hasGoogleTagManager: boolean;\r\n  hasFacebookPixel: boolean;\r\n  hasMicrosoftClarity: boolean;\r\n  hasCustomTracking: boolean;\r\n  analyticsTypes: string[];\r\n  urlLength: number;\r\n  urlLengthGood: boolean;\r\n  urlLengthOver: boolean;\r\n  outboundLinks: number;\r\n  dofollowOutboundLinks: number;\r\n  outboundLinksGood: boolean;\r\n  outboundLinksTooFew: boolean;\r\n  longParagraphs: number;\r\n  paragraphLengthIssues: number;\r\n  paragraphLengthGood: boolean;\r\n  subheadingDistributionGood: boolean;\r\n  hasPowerWord: boolean;\r\n  hasNumberInTitle: boolean;\r\n  totalMedia: number;\r\n  mediaUsageGood: boolean;\r\n  mediaUsageTooFew: boolean;\r\n  contentTier600: boolean;\r\n  contentTier1000: boolean;\r\n  contentTier2000: boolean;\r\n  contentTier2500: boolean;\r\n  hasDatePublished: boolean;\r\n  hasDateUpdated: boolean;\r\n  hasDateInfo: boolean;\r\n  hasMobileViewport: boolean;\r\n  hasOpenGraph: boolean;\r\n  hasTwitterCard: boolean;\r\n  socialMetaGood: boolean;\r\n  imagesNotNextGen: number;\r\n  hasImagesNotNextGen: boolean;\r\n  imagesWithoutLazyLoading: number;\r\n  hasImagesWithoutLazyLoading: boolean;\r\n  hasLangAttribute: boolean;\r\n  hasCanonical: boolean;\r\n  mixedContentIssues: number;\r\n  hasMixedContent: boolean;\r\n  // Accessibility fields\r\n  contrastRatioIssues?: number;\r\n  hasContrastRatioIssues?: boolean;\r\n  contrastRatioBelow45?: number;\r\n  contrastRatioBelow3?: number;\r\n  hasFocusIndicators?: boolean;\r\n  missingAriaLabels?: number;\r\n  hasMissingAriaLabels?: boolean;\r\n  keyboardNavigationIssues?: number;\r\n  hasKeyboardNavigationIssues?: boolean;\r\n  accessibilityScore?: number;\r\n  isDraft?: boolean;\r\n}\r\n\r\ninterface SiteTechnicalSEO {\r\n  isHTTPS: boolean;\r\n  hasSitemap: boolean;\r\n  hasRobotsTxt: boolean;\r\n  hasAnalytics: boolean;\r\n  hasGoogleAnalytics: boolean;\r\n  hasGoogleTagManager: boolean;\r\n  hasFacebookPixel: boolean;\r\n  hasMicrosoftClarity: boolean;\r\n}\r\n\r\ninterface SiteAICrawlability {\r\n  score: number;\r\n  aiBotsAllowed: boolean;\r\n  gptBotAllowed: boolean;\r\n  claudeBotAllowed: boolean;\r\n  perplexityBotAllowed: boolean;\r\n  grokBotAllowed: boolean;\r\n  googleExtendedAllowed: boolean;\r\n  ccBotAllowed: boolean;\r\n  applebotExtendedAllowed: boolean;\r\n  bingbotAllowed: boolean;\r\n  pagesWithNoindex: number;\r\n  importantPagesWithNoindex: number;\r\n  duplicateTitles: number;\r\n  duplicateDescriptions: number;\r\n  pagesWithSchema: number;\r\n  totalPages: number;\r\n  schemaCoverage: number;\r\n  noindexRatio: number;\r\n  hasLlmTxt: boolean;\r\n}\r\n\r\nconst TITLE_PIXEL_LIMIT_DESKTOP = 920;\r\nconst TITLE_PIXEL_LIMIT_MOBILE = 1300;\r\nconst DESC_PIXEL_LIMIT_DESKTOP = 1970;\r\nconst DESC_PIXEL_LIMIT_MOBILE = 1300;\r\n\r\ninterface PageListData {\r\n  siteTechnicalSEO?: SiteTechnicalSEO;\r\n  siteAICrawlability?: SiteAICrawlability;\r\n  pages: PageData[];\r\n}\r\n\r\ninterface SchemaValidationError {\r\n  type: 'error' | 'warning' | 'info';\r\n  severity: 'critical' | 'high' | 'medium' | 'low';\r\n  message: string;\r\n  property?: string;\r\n  expected?: string;\r\n  actual?: string;\r\n  suggestion?: string;\r\n  code?: string;\r\n}\r\n\r\ninterface SchemaValidationIssue {\r\n  schemaType: string;\r\n  format: 'json-ld' | 'microdata' | 'rdfa';\r\n  schemaIndex: number;\r\n  errors: SchemaValidationError[];\r\n  warnings: SchemaValidationError[];\r\n  recommendations: SchemaValidationError[];\r\n  isValid: boolean;\r\n  rawSchema: any;\r\n  schemaString: string;\r\n  location?: {\r\n    line?: number;\r\n    column?: number;\r\n  };\r\n}\r\n\r\ninterface SchemaProperty {\r\n  name: string;\r\n  value?: any;\r\n  required: boolean;\r\n  recommended: boolean;\r\n  dataType: string;\r\n  description?: string;\r\n}\r\n\r\ninterface SchemaTypeInfo {\r\n  type: string;\r\n  parent?: string;\r\n  required: string[];\r\n  recommended: string[];\r\n  properties: Record\u003cstring, SchemaProperty\u003e;\r\n  isGeneric: boolean;\r\n  alternatives?: string[];\r\n}\r\n\r\ninterface ContentMatch {\r\n  property: string;\r\n  schemaValue: string;\r\n  pageValue?: string;\r\n  matches: boolean;\r\n  confidence: number;\r\n  location?: string;\r\n}\r\n\r\ninterface PageSchemaData {\r\n  pageUrl: string;\r\n  pageTitle: string;\r\n  relPermalink: string;\r\n  hasSchema: boolean;\r\n  schemaCount: number;\r\n  formatCounts: {\r\n    jsonld: number;\r\n    microdata: number;\r\n    rdfa: number;\r\n  };\r\n  schemas: SchemaValidationIssue[];\r\n  overallValid: boolean;\r\n  errorCount: number;\r\n  warningCount: number;\r\n  recommendationCount: number;\r\n  schemaTypes: string[];\r\n  missingRequiredProperties: string[];\r\n  contentMatches: ContentMatch[];\r\n  hasContentMismatches: boolean;\r\n  hasHiddenContent: boolean;\r\n  hasDuplicateTypes: boolean;\r\n  hasMixedFormats: boolean;\r\n  score: number; // 0-100\r\n  scoreBreakdown: {\r\n    syntax: number;\r\n    completeness: number;\r\n    accuracy: number;\r\n    bestPractices: number;\r\n  };\r\n  suggestions: string[];\r\n}\r\n\r\nconst TITLE_LIMIT = 60;\r\nconst DESC_LIMIT = 160;\r\n\r\n// Development logging flag - can be toggled for debugging\r\nconst DEV_LOG = isLocalhost();\r\n\r\n/**\r\n * Development logging helper\r\n */\r\nfunction devLog(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.log(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Development error logging helper\r\n */\r\nfunction devError(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.error(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Development warning logging helper\r\n */\r\nfunction devWarn(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.warn(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Show loading indicator\r\n */\r\nfunction showLoading(): void {\r\n  const container = document.querySelector('.page-list-container');\r\n  if (!container) return;\r\n\r\n  // Hide initial content and show loading\r\n  const initialContent = container.querySelector('.page-list-initial-content');\r\n  const loading = container.querySelector('.page-list-loading');\r\n  \r\n  if (initialContent) {\r\n    (initialContent as HTMLElement).style.display = 'none';\r\n  }\r\n  if (loading) {\r\n    loading.classList.remove('page-list-loading--hidden');\r\n  } else {\r\n    // Fallback if structure is different\r\n    container.innerHTML = `\r\n      \u003cdiv class=\"page-list-loading\"\u003e\r\n        \u003cdiv class=\"page-list-loading-bar\"\u003e\r\n          \u003cdiv class=\"page-list-loading-progress\"\u003e\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cp class=\"page-list-loading-text\"\u003eLoading page metadata...\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Hide loading indicator\r\n */\r\nfunction hideLoading(): void {\r\n  const loading = document.querySelector('.page-list-loading');\r\n  if (loading) {\r\n    loading.remove();\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate statistics from pages\r\n */\r\nfunction calculateStats(pages: PageData[]): {\r\n  total: number;\r\n  withIssues: number;\r\n  titleOverLimit: number;\r\n  descOverLimit: number;\r\n  titleOverPixels: number;\r\n  descOverPixels: number;\r\n  missingTitle: number;\r\n  missingDesc: number;\r\n  siteSeoScore: number;\r\n  siteAiScore: number;\r\n  seoBreakdown: {\r\n    hasTitle: number;\r\n    titleOptimal: number;\r\n    hasDescription: number;\r\n    descOptimal: number;\r\n  };\r\n  aiBreakdown: {\r\n    hasSummary: number;\r\n    summaryOptimal: number;\r\n    summaryTooShort: number;\r\n    summaryTooLong: number;\r\n    summaryMissing: number;\r\n    hasHeadings: number;\r\n    headingsOptimal: number;\r\n    hasContent: number;\r\n    contentOptimal: number;\r\n    htmlRatioGood: number;\r\n  };\r\n  technicalSEO: {\r\n    brokenLinks: number;\r\n    brokenImages: number;\r\n    imagesWithoutAlt: number;\r\n    headingStructureIssues: number;\r\n    pagesWithoutAnalytics: number;\r\n  };\r\n  onPageSEO: {\r\n    multipleH1Issues: number;\r\n    noH1Issues: number;\r\n    noH2Issues: number;\r\n    internalLinkIssues: number;\r\n    genericAnchorIssues: number;\r\n    genericAltTextIssues: number;\r\n    noSchemaMarkup: number;\r\n    firstParaIssues: number;\r\n    urlLengthIssues: number;\r\n    outboundLinksTooFew: number;\r\n    paragraphLengthIssues: number;\r\n    subheadingDistributionIssues: number;\r\n    mediaUsageTooFew: number;\r\n    noDateInfo: number;\r\n    noMobileViewport: number;\r\n    socialMetaIncomplete: number;\r\n    imagesNotNextGen: number;\r\n    imagesWithoutLazyLoading: number;\r\n    noLangAttribute: number;\r\n    noCanonical: number;\r\n    mixedContent: number;\r\n  };\r\n  contentQuality: {\r\n    wordCountIssues: number;\r\n    noLists: number;\r\n    noBoldText: number;\r\n    staleContent: number;\r\n    noCitations: number;\r\n    noAuthor: number;\r\n    videosWithoutTranscript: number;\r\n    readabilityIssues: number;\r\n    noExcerpt: number;\r\n    excerptTooShort: number;\r\n    excerptTooLong: number;\r\n  };\r\n  accessibility: {\r\n    contrastRatioIssues: number;\r\n    missingAriaLabels: number;\r\n    keyboardNavigationIssues: number;\r\n    noFocusIndicators: number;\r\n    totalAccessibilityIssues: number;\r\n  };\r\n} {\r\n  let withIssues = 0;\r\n  let titleOverLimit = 0;\r\n  let descOverLimit = 0;\r\n  let titleOverPixels = 0;\r\n  let descOverPixels = 0;\r\n  let missingTitle = 0;\r\n  let missingDesc = 0;\r\n  let totalSeoScore = 0;\r\n  let totalAiScore = 0;\r\n  \r\n  // SEO breakdown\r\n  let hasTitle = 0;\r\n  let titleOptimal = 0;\r\n  let hasDescription = 0;\r\n  let descOptimal = 0;\r\n  \r\n  // AI breakdown\r\n  let hasSummary = 0;\r\n  let summaryOptimal = 0;\r\n  let summaryTooShort = 0;\r\n  let summaryTooLong = 0;\r\n  let summaryMissing = 0;\r\n  let hasHeadings = 0;\r\n  let headingsOptimal = 0;\r\n  let hasContent = 0;\r\n  let contentOptimal = 0;\r\n  let htmlRatioGood = 0;\r\n  \r\n  // Technical SEO breakdown\r\n  let brokenLinks = 0;\r\n  let brokenImages = 0;\r\n  let imagesWithoutAlt = 0;\r\n  let headingStructureIssues = 0;\r\n  let pagesWithoutAnalytics = 0;\r\n  \r\n  // On-page SEO breakdown\r\n  let multipleH1Issues = 0;\r\n  let noH1Issues = 0;\r\n  let noH2Issues = 0;\r\n  let internalLinkIssues = 0;\r\n  let genericAnchorIssues = 0;\r\n  let genericAltTextIssues = 0;\r\n  let noSchemaMarkup = 0;\r\n  let firstParaIssues = 0;\r\n  let urlLengthIssues = 0;\r\n  let outboundLinksTooFew = 0;\r\n  let paragraphLengthIssues = 0;\r\n  let subheadingDistributionIssues = 0;\r\n  let mediaUsageTooFew = 0;\r\n  let noDateInfo = 0;\r\n  let noMobileViewport = 0;\r\n  let socialMetaIncomplete = 0;\r\n  let imagesNotNextGen = 0;\r\n  let imagesWithoutLazyLoading = 0;\r\n  let noLangAttribute = 0;\r\n  let noCanonical = 0;\r\n  let mixedContent = 0;\r\n  \r\n  // Content Quality breakdown\r\n  let wordCountIssues = 0;\r\n  let noLists = 0;\r\n  let noBoldText = 0;\r\n  let staleContent = 0;\r\n  let noCitations = 0;\r\n  let noAuthor = 0;\r\n  let videosWithoutTranscript = 0;\r\n  let readabilityIssues = 0;\r\n  let noExcerpt = 0;\r\n  let excerptTooShort = 0;\r\n  let excerptTooLong = 0;\r\n  \r\n  // Accessibility breakdown\r\n  let contrastRatioIssues = 0;\r\n  let missingAriaLabels = 0;\r\n  let keyboardNavigationIssues = 0;\r\n  let noFocusIndicators = 0;\r\n\r\n  pages.forEach(page =\u003e {\r\n    let hasIssue = false;\r\n\r\n    if (!page.hasMetaTitle) {\r\n      missingTitle++;\r\n      hasIssue = true;\r\n    } else {\r\n      hasTitle++;\r\n      if (page.metaTitleLength \u003e= 30 \u0026\u0026 page.metaTitleLength \u003c= TITLE_LIMIT \u0026\u0026 !page.titleOverLimit \u0026\u0026 !page.titleOverPixels) {\r\n        titleOptimal++;\r\n      }\r\n      if (page.titleOverLimit) {\r\n        titleOverLimit++;\r\n        hasIssue = true;\r\n      }\r\n      if (page.titleOverPixels) {\r\n        titleOverPixels++;\r\n        hasIssue = true;\r\n      }\r\n    }\r\n\r\n    if (!page.hasMetaDescription) {\r\n      missingDesc++;\r\n      hasIssue = true;\r\n    } else {\r\n      hasDescription++;\r\n      if (page.metaDescriptionLength \u003e= 120 \u0026\u0026 page.metaDescriptionLength \u003c= DESC_LIMIT \u0026\u0026 !page.descriptionOverLimit \u0026\u0026 !page.descriptionOverPixels) {\r\n        descOptimal++;\r\n      }\r\n      if (page.descriptionOverLimit) {\r\n        descOverLimit++;\r\n        hasIssue = true;\r\n      }\r\n      if (page.descriptionOverPixels) {\r\n        descOverPixels++;\r\n        hasIssue = true;\r\n      }\r\n    }\r\n\r\n    // Technical SEO checks\r\n    if (page.hasBrokenLinks) {\r\n      brokenLinks += page.brokenLinks;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasBrokenImages) {\r\n      brokenImages += page.brokenImages || 0;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasImagesWithoutAlt) {\r\n      imagesWithoutAlt += page.imagesWithoutAlt;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.headingStructureGood) {\r\n      headingStructureIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasAnalytics) {\r\n      pagesWithoutAnalytics++;\r\n      hasIssue = true;\r\n    }\r\n    \r\n    // On-page SEO checks\r\n    if (page.hasMultipleH1) {\r\n      multipleH1Issues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.h1Count === 0) {\r\n      noH1Issues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasH2s) {\r\n      noH2Issues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.internalLinksTooFew || page.internalLinksTooMany) {\r\n      internalLinkIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasGenericAnchors) {\r\n      genericAnchorIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasGenericAltText) {\r\n      genericAltTextIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasSchemaMarkup) {\r\n      noSchemaMarkup++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.firstParaGood) {\r\n      firstParaIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.urlLengthOver) {\r\n      urlLengthIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.outboundLinksTooFew) {\r\n      outboundLinksTooFew++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.paragraphLengthGood) {\r\n      paragraphLengthIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.subheadingDistributionGood) {\r\n      subheadingDistributionIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.mediaUsageTooFew) {\r\n      mediaUsageTooFew++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasDateInfo) {\r\n      noDateInfo++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasMobileViewport) {\r\n      noMobileViewport++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.socialMetaGood) {\r\n      socialMetaIncomplete++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasImagesNotNextGen) {\r\n      imagesNotNextGen++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasImagesWithoutLazyLoading) {\r\n      imagesWithoutLazyLoading++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasLangAttribute) {\r\n      noLangAttribute++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasCanonical) {\r\n      noCanonical++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasMixedContent) {\r\n      mixedContent++;\r\n      hasIssue = true;\r\n    }\r\n    \r\n    // Content Quality checks\r\n    if (page.wordCountPoor) {\r\n      wordCountIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasLists) {\r\n      noLists++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasBoldText) {\r\n      noBoldText++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.isStale) {\r\n      staleContent++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasCitations) {\r\n      noCitations++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasAuthor) {\r\n      noAuthor++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasVideos \u0026\u0026 !page.hasTranscript) {\r\n      videosWithoutTranscript++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.readabilityGood \u0026\u0026 page.avgSentenceLength \u003e 0) {\r\n      readabilityIssues++;\r\n      hasIssue = true;\r\n    }\r\n    if (!page.hasSummary) {\r\n      noExcerpt++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.summaryTooShort) {\r\n      excerptTooShort++;\r\n      hasIssue = true;\r\n    }\r\n    if (page.summaryTooLong) {\r\n      excerptTooLong++;\r\n      hasIssue = true;\r\n    }\r\n    \r\n    // Accessibility checks (only if fields are defined - they may be null/undefined if not calculated)\r\n    if (page.hasContrastRatioIssues \u0026\u0026 page.contrastRatioIssues) {\r\n      contrastRatioIssues += page.contrastRatioIssues;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasMissingAriaLabels \u0026\u0026 page.missingAriaLabels) {\r\n      missingAriaLabels += page.missingAriaLabels;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasKeyboardNavigationIssues \u0026\u0026 page.keyboardNavigationIssues) {\r\n      keyboardNavigationIssues += page.keyboardNavigationIssues;\r\n      hasIssue = true;\r\n    }\r\n    if (page.hasFocusIndicators !== undefined \u0026\u0026 page.hasFocusIndicators === false) {\r\n      noFocusIndicators++;\r\n      hasIssue = true;\r\n    }\r\n\r\n    if (hasIssue) {\r\n      withIssues++;\r\n    }\r\n\r\n    // AI breakdown - check summary/excerpt\r\n    if (page.summary \u0026\u0026 page.summary.trim() !== '') {\r\n      hasSummary++;\r\n      // Use the new summaryOptimal field which checks for 100-300 range\r\n      if (page.summaryOptimal) {\r\n        summaryOptimal++;\r\n      } else if (page.summaryTooShort) {\r\n        summaryTooShort++;\r\n      } else if (page.summaryTooLong) {\r\n        summaryTooLong++;\r\n      }\r\n    } else {\r\n      summaryMissing++;\r\n    }\r\n\r\n    // Check HTML to content ratio\r\n    if (page.htmlRatioGood) {\r\n      htmlRatioGood++;\r\n    }\r\n\r\n    // AI breakdown - headings\r\n    if (page.hasHeadings) {\r\n      hasHeadings++;\r\n      if (page.headingsGood) {\r\n        headingsOptimal++;\r\n      }\r\n    }\r\n\r\n    // AI breakdown - content\r\n    if (page.hasContent) {\r\n      hasContent++;\r\n      if (page.contentGood) {\r\n        contentOptimal++;\r\n      }\r\n    }\r\n\r\n    totalSeoScore += page.seoScore;\r\n    totalAiScore += page.aiCrawlabilityScore;\r\n  });\r\n\r\n  return {\r\n    total: pages.length,\r\n    withIssues,\r\n    titleOverLimit,\r\n    descOverLimit,\r\n    titleOverPixels,\r\n    descOverPixels,\r\n    missingTitle,\r\n    missingDesc,\r\n    siteSeoScore: pages.length \u003e 0 ? Math.round(totalSeoScore / pages.length) : 0,\r\n    siteAiScore: pages.length \u003e 0 ? Math.round(totalAiScore / pages.length) : 0,\r\n    seoBreakdown: {\r\n      hasTitle,\r\n      titleOptimal,\r\n      hasDescription,\r\n      descOptimal\r\n    },\r\n    aiBreakdown: {\r\n      hasSummary,\r\n      summaryOptimal,\r\n      summaryTooShort,\r\n      summaryTooLong,\r\n      summaryMissing,\r\n      hasHeadings,\r\n      headingsOptimal,\r\n      hasContent,\r\n      contentOptimal,\r\n      htmlRatioGood\r\n    },\r\n    technicalSEO: {\r\n      brokenLinks,\r\n      brokenImages,\r\n      imagesWithoutAlt,\r\n      headingStructureIssues,\r\n      pagesWithoutAnalytics\r\n    },\r\n    onPageSEO: {\r\n      multipleH1Issues,\r\n      noH1Issues,\r\n      noH2Issues,\r\n      internalLinkIssues,\r\n      genericAnchorIssues,\r\n      genericAltTextIssues,\r\n      noSchemaMarkup,\r\n      firstParaIssues,\r\n      urlLengthIssues,\r\n      outboundLinksTooFew,\r\n      paragraphLengthIssues,\r\n      subheadingDistributionIssues,\r\n      mediaUsageTooFew,\r\n      noDateInfo,\r\n      noMobileViewport,\r\n      socialMetaIncomplete,\r\n      imagesNotNextGen,\r\n      imagesWithoutLazyLoading,\r\n      noLangAttribute,\r\n      noCanonical,\r\n      mixedContent\r\n    },\r\n    contentQuality: {\r\n      wordCountIssues,\r\n      noLists,\r\n      noBoldText,\r\n      staleContent,\r\n      noCitations,\r\n      noAuthor,\r\n      videosWithoutTranscript,\r\n      readabilityIssues,\r\n      noExcerpt,\r\n      excerptTooShort,\r\n      excerptTooLong\r\n    },\r\n    accessibility: {\r\n      contrastRatioIssues,\r\n      missingAriaLabels,\r\n      keyboardNavigationIssues,\r\n      noFocusIndicators,\r\n      totalAccessibilityIssues: contrastRatioIssues + missingAriaLabels + keyboardNavigationIssues + noFocusIndicators\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Get score color class based on score value\r\n */\r\nfunction getScoreClass(score: number): string {\r\n  if (score \u003e= 80) return 'score-excellent';\r\n  if (score \u003e= 60) return 'score-good';\r\n  if (score \u003e= 40) return 'score-fair';\r\n  return 'score-poor';\r\n}\r\n\r\n/**\r\n * Get color class for overview stat based on value and context\r\n */\r\nfunction getOverviewStatClass(value: number, total: number, isIssue: boolean = true, isScore: boolean = false): string {\r\n  if (isScore) {\r\n    return getScoreClass(value);\r\n  }\r\n  \r\n  if (isIssue) {\r\n    // For issue counts, lower is better\r\n    if (value === 0) return 'overview-stat--success';\r\n    if (value \u003c= 5) return 'overview-stat--warning';\r\n    return 'overview-stat--error';\r\n  } else {\r\n    // For positive metrics (like \"Good Pages\"), higher percentage is better\r\n    const percentage = total \u003e 0 ? (value / total) * 100 : 0;\r\n    if (percentage \u003e= 80) return 'overview-stat--success';\r\n    if (percentage \u003e= 60) return 'overview-stat--warning';\r\n    if (percentage \u003e= 40) return 'overview-stat--warning';\r\n    return 'overview-stat--error';\r\n  }\r\n}\r\n\r\n/**\r\n * Render page-specific overview section\r\n */\r\nfunction renderPageOverview(section: string, stats: ReturnType\u003ctypeof calculateStats\u003e, siteTechnicalSEO?: SiteTechnicalSEO, siteAICrawlability?: SiteAICrawlability, activeFilter?: string): string {\r\n  const buildOverviewStat = (value: number | string, label: string, filter?: string, extraClass = '', extraAttributes = ''): string =\u003e {\r\n    const isActive = activeFilter \u0026\u0026 filter === activeFilter;\r\n    const classes = [\r\n      'page-list-overview-stat', \r\n      extraClass, \r\n      filter ? 'page-list-overview-stat--clickable' : '',\r\n      isActive ? 'page-list-overview-stat--active' : ''\r\n    ].filter(Boolean).join(' ');\r\n    const filterAttributes = filter ? `data-filter=\"${filter}\" role=\"button\" tabindex=\"0\"${isActive ? ' aria-pressed=\"true\"' : ' aria-pressed=\"false\"'}` : '';\r\n    const attributes = [filterAttributes, extraAttributes].filter(Boolean).join(' ');\r\n    return `\r\n      \u003cdiv class=\"${classes}\"${attributes ? ` ${attributes}` : ''}\u003e\r\n        \u003cdiv class=\"page-list-overview-stat__value\"\u003e${value}\u003c/div\u003e\r\n        \u003cdiv class=\"page-list-overview-stat__label\"\u003e${label}\u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  };\r\n\r\n  const overviews: Record\u003cstring, string\u003e = {\r\n    'overview': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat(stats.total, 'Total Pages', 'all')}\r\n        ${buildOverviewStat(stats.withIssues, 'Pages with Issues', 'with-issues', getOverviewStatClass(stats.withIssues, stats.total, true))}\r\n        ${buildOverviewStat(stats.total - stats.withIssues, 'Good Pages', 'good', getOverviewStatClass(stats.total - stats.withIssues, stats.total, false))}\r\n      \u003c/div\u003e\r\n    `,\r\n    'seo-analysis': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat(stats.missingTitle + stats.missingDesc, 'Missing Meta Tags', 'missing-meta', getOverviewStatClass(stats.missingTitle + stats.missingDesc, stats.total, true))}\r\n        ${buildOverviewStat(stats.titleOverLimit + stats.titleOverPixels + stats.descOverLimit + stats.descOverPixels, 'Meta Tag Issues', 'meta-issues', getOverviewStatClass(stats.titleOverLimit + stats.titleOverPixels + stats.descOverLimit + stats.descOverPixels, stats.total, true))}\r\n        ${buildOverviewStat(stats.onPageSEO.noSchemaMarkup, 'Missing Schema', 'no-schema', getOverviewStatClass(stats.onPageSEO.noSchemaMarkup, stats.total, true))}\r\n        ${buildOverviewStat(Math.round(stats.siteSeoScore), 'Average SEO Score', undefined, getOverviewStatClass(Math.round(stats.siteSeoScore), 100, false, true))}\r\n      \u003c/div\u003e\r\n    `,\r\n    'content-quality': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat(stats.contentQuality.wordCountIssues, 'Low Word Count', 'low-word-count', getOverviewStatClass(stats.contentQuality.wordCountIssues, stats.total, true))}\r\n        ${buildOverviewStat(stats.contentQuality.noCitations, 'No Citations', 'no-citations', getOverviewStatClass(stats.contentQuality.noCitations, stats.total, true))}\r\n        ${buildOverviewStat(stats.contentQuality.noAuthor, 'No Author', 'no-author', getOverviewStatClass(stats.contentQuality.noAuthor, stats.total, true))}\r\n        ${buildOverviewStat(stats.contentQuality.staleContent, 'Stale Content', 'stale-content', getOverviewStatClass(stats.contentQuality.staleContent, stats.total, true))}\r\n        ${buildOverviewStat(stats.contentQuality.excerptTooShort, 'Excerpt Too Short', 'excerpt-too-short', getOverviewStatClass(stats.contentQuality.excerptTooShort, stats.total, true))}\r\n        ${buildOverviewStat(stats.contentQuality.excerptTooLong, 'Excerpt Too Long', 'excerpt-too-long', getOverviewStatClass(stats.contentQuality.excerptTooLong, stats.total, true))}\r\n      \u003c/div\u003e\r\n    `,\r\n    'technical-issues': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat(stats.technicalSEO.brokenLinks, 'Broken Links', 'broken-links', getOverviewStatClass(stats.technicalSEO.brokenLinks, stats.total, true))}\r\n        ${buildOverviewStat(stats.technicalSEO.brokenImages, 'Broken Images', 'broken-images', getOverviewStatClass(stats.technicalSEO.brokenImages, stats.total, true))}\r\n        ${buildOverviewStat(stats.technicalSEO.imagesWithoutAlt, 'Images w/o Alt', 'images-no-alt', getOverviewStatClass(stats.technicalSEO.imagesWithoutAlt, stats.total, true))}\r\n        ${buildOverviewStat(stats.technicalSEO.headingStructureIssues, 'Heading Issues', 'heading-structure', getOverviewStatClass(stats.technicalSEO.headingStructureIssues, stats.total, true))}\r\n      \u003c/div\u003e\r\n    `,\r\n    'keyword-research': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat('-', 'Total Keywords', undefined, '', 'id=\"page-list-keyword-stat-total\"')}\r\n        ${buildOverviewStat('-', 'Unique Keywords', undefined, '', 'id=\"page-list-keyword-stat-unique\"')}\r\n        ${buildOverviewStat(0, 'Competitors', undefined, '', 'id=\"page-list-keyword-stat-competitors\"')}\r\n        ${buildOverviewStat('-', 'Opportunities', undefined, '', 'id=\"page-list-keyword-stat-opportunities\"')}\r\n      \u003c/div\u003e\r\n    `,\r\n    'link-map': `\r\n      \u003cdiv class=\"page-list-overview-grid\"\u003e\r\n        ${buildOverviewStat(stats.total, 'Total Pages')}\r\n        ${buildOverviewStat('-', 'Total Links', undefined, '', 'id=\"page-list-link-map-total-links\"')}\r\n        ${buildOverviewStat(stats.technicalSEO.brokenLinks, 'Broken Links', 'broken-links', getOverviewStatClass(stats.technicalSEO.brokenLinks, stats.total, true))}\r\n        ${buildOverviewStat('-', 'Avg Links/Page', undefined, '', 'id=\"page-list-link-map-avg-links\"')}\r\n      \u003c/div\u003e\r\n    `\r\n  };\r\n\r\n  return overviews[section] || overviews['overview'];\r\n}\r\n\r\n/**\r\n * Render statistics summary\r\n */\r\nfunction renderStats(stats: ReturnType\u003ctypeof calculateStats\u003e, activeFilter: string = 'all', siteTechnicalSEO?: SiteTechnicalSEO, siteAICrawlability?: SiteAICrawlability, showFilters: boolean = true, section: string = 'overview', heroOnly: boolean = false): string {\r\n  const seoClass = getScoreClass(stats.siteSeoScore);\r\n  const aiClass = getScoreClass(stats.siteAiScore);\r\n  const siteAIClass = siteAICrawlability ? getScoreClass(siteAICrawlability.score) : '';\r\n  const circumference = 2 * Math.PI * 54; // radius 54\r\n\r\n  // Render combined site-wide technical SEO and Analytics section (only on overview page)\r\n  const technicalSEOHtml = (section === 'overview' \u0026\u0026 siteTechnicalSEO) ? `\r\n    \u003cdiv class=\"page-list-summary__technical-seo\"\u003e\r\n      \u003cdiv class=\"page-list-summary__technical-seo-columns\"\u003e\r\n        \u003cdiv class=\"page-list-summary__technical-seo-column\"\u003e\r\n          \u003ch3 class=\"page-list-summary__technical-seo-title\"\u003eSite-Wide Technical SEO\u003c/h3\u003e\r\n          \u003cdiv class=\"page-list-summary__technical-seo-grid\"\u003e\r\n            \u003cdiv class=\"page-list-summary__technical-seo-item ${siteTechnicalSEO.isHTTPS ? 'page-list-summary__technical-seo-item--success' : 'page-list-summary__technical-seo-item--error'}\"\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-icon\"\u003e${siteTechnicalSEO.isHTTPS ? '🔒' : '⚠️'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-label\"\u003eHTTPS\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-status\"\u003e${siteTechnicalSEO.isHTTPS ? 'Enabled' : 'Not Enabled'}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-summary__technical-seo-item ${siteTechnicalSEO.hasSitemap ? 'page-list-summary__technical-seo-item--success' : 'page-list-summary__technical-seo-item--warning'}\"\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-icon\"\u003e${siteTechnicalSEO.hasSitemap ? '✓' : '⚠️'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-label\"\u003eXML Sitemap\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-status\"\u003e${siteTechnicalSEO.hasSitemap ? 'Found' : 'Missing'}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-summary__technical-seo-item ${siteTechnicalSEO.hasRobotsTxt ? 'page-list-summary__technical-seo-item--success' : 'page-list-summary__technical-seo-item--warning'}\"\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-icon\"\u003e${siteTechnicalSEO.hasRobotsTxt ? '✓' : '⚠️'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-label\"\u003eRobots.txt\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-status\"\u003e${siteTechnicalSEO.hasRobotsTxt ? 'Found' : 'Missing'}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-summary__technical-seo-column\"\u003e\r\n          \u003ch3 class=\"page-list-summary__technical-seo-title\"\u003eSite-Wide Analytics\u003c/h3\u003e\r\n          \u003cdiv class=\"page-list-summary__technical-seo-grid\"\u003e\r\n            \u003cdiv class=\"page-list-summary__technical-seo-item ${siteTechnicalSEO.hasAnalytics ? 'page-list-summary__technical-seo-item--success' : 'page-list-summary__technical-seo-item--warning'}\"\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-icon\"\u003e${siteTechnicalSEO.hasAnalytics ? '📊' : '⚠️'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-label\"\u003eAnalytics\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-status\"\u003e${siteTechnicalSEO.hasAnalytics ? 'Configured' : 'Not Configured'}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n            ${siteTechnicalSEO.hasAnalytics ? `\r\n            \u003cdiv class=\"page-list-summary__technical-seo-item page-list-summary__technical-seo-item--info\"\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-icon\"\u003e📈\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-label\"\u003eAnalytics Types\u003c/span\u003e\r\n              \u003cspan class=\"page-list-summary__technical-seo-status\"\u003e\r\n                ${siteTechnicalSEO.hasGoogleAnalytics ? 'GA4 ' : ''}\r\n                ${siteTechnicalSEO.hasGoogleTagManager ? 'GTM ' : ''}\r\n                ${siteTechnicalSEO.hasFacebookPixel ? 'FB ' : ''}\r\n                ${siteTechnicalSEO.hasMicrosoftClarity ? 'Clarity' : ''}\r\n              \u003c/span\u003e\r\n            \u003c/div\u003e\r\n            ` : ''}\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  ` : '';\r\n\r\n  // Analytics section is now combined above\r\n  const analyticsHtml = '';\r\n\r\n  // Calculate arc paths for half circles\r\n  const halfCircumference = circumference / 2;\r\n  const seoArcLength = (stats.siteSeoScore / 100) * halfCircumference;\r\n  const aiScoreValue = siteAICrawlability ? siteAICrawlability.score : stats.siteAiScore;\r\n  const aiArcLength = (aiScoreValue / 100) * halfCircumference;\r\n  \r\n  // Calculate average score\r\n  const averageScore = Math.round((stats.siteSeoScore + aiScoreValue) / 2);\r\n  \r\n  // SEO arc (top half) - starts at top (after -90deg rotation, that's at 3 o'clock), goes clockwise\r\n  // Since SVG is rotated -90deg, top is at 3 o'clock, so we start at offset 0\r\n  const seoArcDash = `${seoArcLength} ${halfCircumference}`;\r\n  // AI arc (bottom half) - starts at bottom (after -90deg rotation, that's at 9 o'clock)\r\n  // We need to offset by half the circumference to start at the bottom\r\n  const aiArcDash = `${aiArcLength} ${halfCircumference}`;\r\n  const aiArcOffset = halfCircumference; // Start from bottom (9 o'clock after rotation)\r\n\r\n  // Page-specific titles and descriptions\r\n  const pageInfo: Record\u003cstring, { title: string; description: string }\u003e = {\r\n    'overview': {\r\n      title: 'Site Overview',\r\n      description: 'Comprehensive dashboard showing overall site health, SEO scores, and key metrics across all pages.'\r\n    },\r\n    'seo-analysis': {\r\n      title: 'SEO Analysis',\r\n      description: 'Analyze meta tags, schema markup, and on-page SEO factors to identify optimization opportunities.'\r\n    },\r\n    'content-quality': {\r\n      title: 'Content Quality',\r\n      description: 'Evaluate content quality metrics including word count, readability, citations, and content structure.'\r\n    },\r\n    'technical-issues': {\r\n      title: 'Technical Issues',\r\n      description: 'Identify and fix technical problems including broken links, images, accessibility issues, and more.'\r\n    },\r\n    'keyword-research': {\r\n      title: 'Keyword Research',\r\n      description: 'Research keywords and analyze competitor content to discover SEO opportunities and content gaps.'\r\n    }\r\n  };\r\n\r\n  const pageData = pageInfo[section] || pageInfo['overview'];\r\n\r\n  // If heroOnly is true, return just the hero section with overview\r\n  // For keyword-research, also include the competitor input section\r\n  if (heroOnly) {\r\n    return `\r\n      \u003cdiv class=\"page-list-summary\"\u003e\r\n        \u003cdiv class=\"page-list-summary__hero page-list-summary__hero--expanded\"\u003e\r\n          \u003cdiv class=\"page-list-summary__hero-header\"\u003e\r\n            \u003cdiv class=\"page-list-summary__hero-header-content\"\u003e\r\n              \u003ch2 class=\"page-list-summary__hero-title\"\u003e${pageData.title}\u003c/h2\u003e\r\n              \u003cp class=\"page-list-summary__hero-description\"\u003e${pageData.description}\u003c/p\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-summary__hero-actions\"\u003e\r\n              \u003cbutton \r\n                class=\"page-list-rescan-button\" \r\n                id=\"page-list-rescan-button\" \r\n                type=\"button\"\r\n                aria-label=\"Rescan site to refresh page data\"\r\n                title=\"Rescan site\"\r\n                data-tooltip=\"Reload page data from the site. This will refresh all page information.\"\r\n              \u003e\r\n                \u003cspan class=\"page-list-rescan-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003erefresh\u003c/span\u003e\r\n                \u003cspan class=\"page-list-rescan-button__text\"\u003eRescan Site\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-summary__hero-overview\"\u003e\r\n            ${renderPageOverview(section, stats, siteTechnicalSEO, siteAICrawlability, activeFilter)}\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        ${section === 'keyword-research' ? `\r\n          \u003cdiv class=\"page-list-keyword-research\"\u003e\r\n            \u003cdiv class=\"page-list-keyword-research__site-keywords\"\u003e\r\n              \u003cdiv class=\"page-list-keyword-research__site-keywords-list\" id=\"page-list-site-keywords-list\"\u003e\r\n                \u003cdiv class=\"page-list-keyword-research__loading\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e\r\n                  Extracting keywords from all pages...\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-keyword-research__competitor-section\"\u003e\r\n              \u003cdiv class=\"page-list-keyword-research__header\"\u003e\r\n                \u003ch3 class=\"page-list-keyword-research__title\"\u003eCompetitor Keyword Analysis\u003c/h3\u003e\r\n                \u003cp class=\"page-list-keyword-research__description\"\u003eAdd competitor URLs to analyze their keywords and compare against your site.\u003c/p\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-keyword-research__competitors\"\u003e\r\n                \u003cdiv class=\"page-list-keyword-research__add-competitor\"\u003e\r\n                  \u003cinput \r\n                    type=\"url\" \r\n                    class=\"page-list-keyword-research__url-input\" \r\n                    id=\"page-list-competitor-url-input\"\r\n                    placeholder=\"https://competitor.com/page\"\r\n                    aria-label=\"Competitor URL\"\r\n                  /\u003e\r\n                  \u003cbutton \r\n                    class=\"page-list-keyword-research__add-btn\" \r\n                    id=\"page-list-add-competitor-btn\"\r\n                    type=\"button\"\r\n                    aria-label=\"Add competitor URL\"\r\n                  \u003e\r\n                    \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eadd\u003c/span\u003e\r\n                    Add Competitor\r\n                  \u003c/button\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-keyword-research__competitor-list\" id=\"page-list-competitor-list\"\u003e\u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-keyword-research__results\" id=\"page-list-keyword-research-results\" style=\"display: none;\"\u003e\r\n                \u003ch4 class=\"page-list-keyword-research__results-title\"\u003eKeyword Comparison\u003c/h4\u003e\r\n                \u003cdiv class=\"page-list-keyword-research__comparison\" id=\"page-list-keyword-comparison\"\u003e\u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        ` : ''}\r\n        ${section === 'link-map' ? `\r\n          \u003cdiv id=\"page-list-link-map-container\"\u003e\u003c/div\u003e\r\n        ` : ''}\r\n      \u003c/div\u003e\r\n      ${technicalSEOHtml}\r\n    `;\r\n  }\r\n\r\n  return `\r\n    \u003cdiv class=\"page-list-summary\"\u003e\r\n      \u003cdiv class=\"page-list-summary__hero page-list-summary__hero--expanded\"\u003e\r\n        \u003cdiv class=\"page-list-summary__hero-header\"\u003e\r\n          \u003cdiv class=\"page-list-summary__hero-header-content\"\u003e\r\n            \u003ch2 class=\"page-list-summary__hero-title\"\u003e${pageData.title}\u003c/h2\u003e\r\n            \u003cp class=\"page-list-summary__hero-description\"\u003e${pageData.description}\u003c/p\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-summary__hero-actions\"\u003e\r\n            \u003cbutton \r\n              class=\"page-list-rescan-button\" \r\n              id=\"page-list-rescan-button\" \r\n              type=\"button\"\r\n              aria-label=\"Rescan site to refresh page data\"\r\n              title=\"Rescan site\"\r\n              data-tooltip=\"Reload page data from the site. This will refresh all page information.\"\r\n            \u003e\r\n              \u003cspan class=\"page-list-rescan-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003erefresh\u003c/span\u003e\r\n              \u003cspan class=\"page-list-rescan-button__text\"\u003eRescan Site\u003c/span\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-summary__hero-score\"\u003e\r\n            \u003cdiv class=\"page-list-summary-score__circle\"\u003e\r\n              \u003csvg class=\"page-list-summary-score__circle-svg\" viewBox=\"0 0 120 120\"\u003e\r\n                \u003c!-- Background circle --\u003e\r\n                \u003ccircle class=\"page-list-summary-score__circle-bg\" cx=\"60\" cy=\"60\" r=\"54\"\u003e\u003c/circle\u003e\r\n                \u003c!-- SEO arc (top half) --\u003e\r\n                \u003ccircle class=\"page-list-summary-score__circle-fill page-list-summary-score__circle-fill--seo ${seoClass}\" \r\n                  cx=\"60\" cy=\"60\" r=\"54\" \r\n                  style=\"stroke-dasharray: ${seoArcDash}; stroke-dashoffset: 0;\"\u003e\u003c/circle\u003e\r\n                \u003c!-- AI arc (bottom half) --\u003e\r\n                \u003ccircle class=\"page-list-summary-score__circle-fill page-list-summary-score__circle-fill--ai ${siteAICrawlability ? siteAIClass : aiClass}\" \r\n                  cx=\"60\" cy=\"60\" r=\"54\" \r\n                  style=\"stroke-dasharray: ${aiArcDash}; stroke-dashoffset: ${aiArcOffset};\"\u003e\u003c/circle\u003e\r\n              \u003c/svg\u003e\r\n              \u003cdiv class=\"page-list-summary-score__circle-value\"\u003e\r\n                \u003cspan class=\"page-list-summary-score__circle-number\"\u003e${averageScore}\u003c/span\u003e\r\n                \u003cspan class=\"page-list-summary-score__circle-label\"\u003eAverage\u003c/span\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-summary__hero-overview\"\u003e\r\n          ${renderPageOverview(section, stats, siteTechnicalSEO, siteAICrawlability, activeFilter)}\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-summary__hero-content\"\u003e\r\n        \u003cdiv class=\"page-list-summary-score page-list-summary-score--combined\"\u003e\r\n          \u003cdiv class=\"page-list-summary-score__content\"\u003e\r\n            \u003cdiv class=\"page-list-summary-score__content-section\"\u003e\r\n            \u003ch3 class=\"page-list-summary-score__title\"\u003eSite SEO Score\u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-summary-score__breakdown\"\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eMeta Titles\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${stats.seoBreakdown.titleOptimal}/${stats.total}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-bar\"\u003e\r\n                  \u003cdiv class=\"page-list-summary-score__metric-fill\" style=\"width: ${Math.round((stats.seoBreakdown.titleOptimal / stats.total) * 100)}%\"\u003e\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-optimal ${stats.seoBreakdown.titleOptimal === stats.total ? 'metric-optimal--complete' : ''}\"\u003e\r\n                    ${stats.seoBreakdown.titleOptimal} optimal (30-${TITLE_LIMIT} chars, \u0026lt;920px)\r\n                  \u003c/span\u003e\r\n                  ${stats.seoBreakdown.titleOptimal \u003c stats.total ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.total - stats.seoBreakdown.titleOptimal} need optimization\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eMeta Descriptions\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${stats.seoBreakdown.descOptimal}/${stats.total}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-bar\"\u003e\r\n                  \u003cdiv class=\"page-list-summary-score__metric-fill\" style=\"width: ${Math.round((stats.seoBreakdown.descOptimal / stats.total) * 100)}%\"\u003e\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-optimal ${stats.seoBreakdown.descOptimal === stats.total ? 'metric-optimal--complete' : ''}\"\u003e\r\n                    ${stats.seoBreakdown.descOptimal} optimal (120-${DESC_LIMIT} chars, \u0026lt;1970px)\r\n                  \u003c/span\u003e\r\n                  ${stats.seoBreakdown.descOptimal \u003c stats.total ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.total - stats.seoBreakdown.descOptimal} need optimization\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eHTML/Content Ratio\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${stats.aiBreakdown.htmlRatioGood}/${stats.total}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-bar\"\u003e\r\n                  \u003cdiv class=\"page-list-summary-score__metric-fill\" style=\"width: ${Math.round((stats.aiBreakdown.htmlRatioGood / stats.total) * 100)}%\"\u003e\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-optimal ${stats.aiBreakdown.htmlRatioGood === stats.total ? 'metric-optimal--complete' : ''}\"\u003e\r\n                    ${stats.aiBreakdown.htmlRatioGood} with good ratio (25%+)\r\n                  \u003c/span\u003e\r\n                  ${stats.aiBreakdown.htmlRatioGood \u003c stats.total ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.total - stats.aiBreakdown.htmlRatioGood} need optimization\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-summary-score__content-section\"\u003e\r\n            \u003ch3 class=\"page-list-summary-score__title\"\u003eSite AI Crawlability\u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-summary-score__breakdown\"\u003e\r\n              ${siteAICrawlability ? `\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eAI Bots Allowed\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${siteAICrawlability.aiBotsAllowed ? '✓' : '✗'}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-note\"\u003e\r\n                    GPTBot: ${siteAICrawlability.gptBotAllowed ? '✓' : '✗'} | \r\n                    ClaudeBot: ${siteAICrawlability.claudeBotAllowed ? '✓' : '✗'} | \r\n                    PerplexityBot: ${siteAICrawlability.perplexityBotAllowed ? '✓' : '✗'} | \r\n                    Grok: ${siteAICrawlability.grokBotAllowed ? '✓' : '✗'} | \r\n                    Google-Extended: ${siteAICrawlability.googleExtendedAllowed ? '✓' : '✗'} | \r\n                    CCBot: ${siteAICrawlability.ccBotAllowed ? '✓' : '✗'} | \r\n                    Applebot-Extended: ${siteAICrawlability.applebotExtendedAllowed ? '✓' : '✗'} | \r\n                    Bingbot: ${siteAICrawlability.bingbotAllowed ? '✓' : '✗'}\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eLLMs.txt File\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${siteAICrawlability.hasLlmTxt ? '✓' : '✗'}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-note\"\u003e\r\n                    ${siteAICrawlability.hasLlmTxt ? 'LLMs.txt file found (provides structured information to AI crawlers)' : 'LLMs.txt file missing (recommended for AI crawlability)'}\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eSchema Coverage\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${Math.round(siteAICrawlability.schemaCoverage)}%\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-bar\"\u003e\r\n                  \u003cdiv class=\"page-list-summary-score__metric-fill\" style=\"width: ${siteAICrawlability.schemaCoverage}%\"\u003e\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-optimal\"\u003e\r\n                    ${siteAICrawlability.pagesWithSchema}/${siteAICrawlability.totalPages} pages with schema\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eIndexability\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${Math.round(siteAICrawlability.noindexRatio)}% noindex\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-note\"\u003e\r\n                    ${siteAICrawlability.pagesWithNoindex} pages with noindex\r\n                    ${siteAICrawlability.importantPagesWithNoindex \u003e 0 ? `| ${siteAICrawlability.importantPagesWithNoindex} important pages blocked` : ''}\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eDuplicate Content\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${siteAICrawlability.duplicateTitles + siteAICrawlability.duplicateDescriptions}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-note\"\u003e\r\n                    ${siteAICrawlability.duplicateTitles} duplicate titles | ${siteAICrawlability.duplicateDescriptions} duplicate descriptions\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              ` : ''}\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003ePage Excerpts\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003e${stats.aiBreakdown.summaryOptimal}/${stats.total}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-bar\"\u003e\r\n                  \u003cdiv class=\"page-list-summary-score__metric-fill\" style=\"width: ${Math.round((stats.aiBreakdown.summaryOptimal / stats.total) * 100)}%\"\u003e\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-optimal ${stats.aiBreakdown.summaryOptimal === stats.total ? 'metric-optimal--complete' : ''}\"\u003e\r\n                    ${stats.aiBreakdown.summaryOptimal} with optimal length (100-300 chars)\r\n                  \u003c/span\u003e\r\n                  ${stats.aiBreakdown.summaryMissing \u003e 0 ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.aiBreakdown.summaryMissing} missing\u003c/span\u003e` : ''}\r\n                  ${stats.aiBreakdown.summaryTooShort \u003e 0 ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.aiBreakdown.summaryTooShort} too short\u003c/span\u003e` : ''}\r\n                  ${stats.aiBreakdown.summaryTooLong \u003e 0 ? `\u003cspan class=\"page-list-summary-score__metric-issues\"\u003e${stats.aiBreakdown.summaryTooLong} too long\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary-score__metric\"\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-header\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-label\"\u003eContent Structure\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-value\"\u003ePer page\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-summary-score__metric-details\"\u003e\r\n                  \u003cspan class=\"page-list-summary-score__metric-note\"\u003eHeadings (H2/H3) and content length (500+ chars) calculated per page\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      ${technicalSEOHtml}\r\n      ${section === 'keyword-research' ? `\r\n        \u003cdiv class=\"page-list-keyword-research\"\u003e\r\n          \u003cdiv class=\"page-list-keyword-research__header\"\u003e\r\n            \u003ch3 class=\"page-list-keyword-research__title\"\u003eCompetitor Keyword Analysis\u003c/h3\u003e\r\n            \u003cp class=\"page-list-keyword-research__description\"\u003eAdd competitor URLs to analyze their keywords and compare against your site.\u003c/p\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-keyword-research__competitors\"\u003e\r\n            \u003cdiv class=\"page-list-keyword-research__add-competitor\"\u003e\r\n              \u003cinput \r\n                type=\"url\" \r\n                class=\"page-list-keyword-research__url-input\" \r\n                id=\"page-list-competitor-url-input\"\r\n                placeholder=\"https://competitor.com/page\"\r\n                aria-label=\"Competitor URL\"\r\n              /\u003e\r\n              \u003cbutton \r\n                class=\"page-list-keyword-research__add-btn\" \r\n                id=\"page-list-add-competitor-btn\"\r\n                type=\"button\"\r\n                aria-label=\"Add competitor URL\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eadd\u003c/span\u003e\r\n                Add Competitor\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-keyword-research__competitor-list\" id=\"page-list-competitor-list\"\u003e\u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-keyword-research__results\" id=\"page-list-keyword-research-results\" style=\"display: none;\"\u003e\r\n            \u003ch4 class=\"page-list-keyword-research__results-title\"\u003eKeyword Comparison\u003c/h4\u003e\r\n            \u003cdiv class=\"page-list-keyword-research__comparison\" id=\"page-list-keyword-comparison\"\u003e\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      ` : showFilters ? `\r\n      \u003cdiv class=\"page-list-filters-grouped\"\u003e\r\n        \u003cdiv class=\"page-list-filter-tabs\"\u003e\r\n          \u003cbutton class=\"page-list-filter-tab page-list-filter-tab--active\" data-tab=\"overview\"\u003eOverview\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"meta\"\u003eMeta Tags\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"technical\"\u003eTechnical SEO\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"analytics\"\u003eAnalytics\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"onpage\"\u003eOn-Page SEO\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"content\"\u003eContent Quality\u003c/button\u003e\r\n          \u003cbutton class=\"page-list-filter-tab\" data-tab=\"accessibility\"\u003eAccessibility\u003c/button\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content page-list-filter-tab-content--active\" data-tab-content=\"overview\"\u003e\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable ${activeFilter === 'all' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"all\"\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${stats.total}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eTotal Pages\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--warning ${activeFilter === 'with-issues' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"with-issues\" ${stats.withIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${stats.withIssues}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003ePages with Issues\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--success ${activeFilter === 'good' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"good\" ${(stats.total - stats.withIssues) === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${stats.total - stats.withIssues}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eGood Pages\u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"meta\"\u003e\r\n          ${isLocalhost() \u0026\u0026 (stats.missingTitle \u003e 0 || stats.missingDesc \u003e 0) ? `\r\n            \u003cdiv class=\"page-list-tab-actions\"\u003e\r\n              \u003cbutton \r\n                class=\"page-list-fix-button\" \r\n                id=\"page-list-bulk-add-meta\" \r\n                type=\"button\"\r\n                aria-label=\"Bulk add missing meta tags (development mode only)\"\r\n                title=\"Bulk add missing meta tags (dev-only)\"\r\n                data-tooltip=\"Automatically generate and add missing meta titles and descriptions. Only available in development mode.\"\r\n              \u003e\r\n                \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n                \u003cspan class=\"page-list-fix-button__text\"\u003eBulk Add Meta Tags\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.missingTitle \u003e 0 ? 'error' : 'success'} ${activeFilter === 'missing-title' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"missing-title\" ${stats.missingTitle === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.missingTitle)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eMissing Titles\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.missingDesc \u003e 0 ? 'error' : 'success'} ${activeFilter === 'missing-description' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"missing-description\" ${stats.missingDesc === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.missingDesc)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eMissing Descriptions\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${(stats.titleOverLimit + stats.titleOverPixels) \u003e 0 ? 'error' : 'success'} ${activeFilter === 'title-over-limit' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"title-over-limit\" ${(stats.titleOverLimit + stats.titleOverPixels) === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.titleOverLimit + stats.titleOverPixels)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eTitle Issues\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${(stats.descOverLimit + stats.descOverPixels) \u003e 0 ? 'error' : 'success'} ${activeFilter === 'description-over-limit' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"description-over-limit\" ${(stats.descOverLimit + stats.descOverPixels) === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.descOverLimit + stats.descOverPixels)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eDescription Issues\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.titleOverPixels \u003e 0 || stats.descOverPixels \u003e 0 ? 'error' : 'success'} ${activeFilter === 'pixel-issues' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"pixel-issues\" ${(stats.titleOverPixels + stats.descOverPixels) === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.titleOverPixels + stats.descOverPixels)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Pixel Issues\r\n                ${createTooltip('Titles and descriptions can be cut off in search results if they exceed pixel width limits (920px desktop, 1300px mobile). Even if character count is acceptable, long words or wide characters can cause truncation.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"technical\"\u003e\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.brokenLinks \u003e 0 ? 'error' : 'success'} ${activeFilter === 'broken-links' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"broken-links\" ${stats.technicalSEO.brokenLinks === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.brokenLinks)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eBroken Links\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.brokenImages \u003e 0 ? 'error' : 'success'} ${activeFilter === 'broken-images' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"broken-images\" ${stats.technicalSEO.brokenImages === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.brokenImages)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eBroken Images\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.imagesWithoutAlt \u003e 0 ? 'error' : 'success'} ${activeFilter === 'images-no-alt' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"images-no-alt\" ${stats.technicalSEO.imagesWithoutAlt === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.imagesWithoutAlt)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eImages w/o Alt\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.headingStructureIssues \u003e 0 ? 'error' : 'success'} ${activeFilter === 'heading-structure' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"heading-structure\" ${stats.technicalSEO.headingStructureIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.headingStructureIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Heading Structure\r\n                ${createTooltip('Headings should follow a logical hierarchy (H1 → H2 → H3). Skipping levels (e.g., H1 to H3) confuses search engines and screen readers. Maintain proper nesting for better SEO and accessibility.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.imagesNotNextGen \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'images-not-nextgen' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"images-not-nextgen\" ${stats.onPageSEO.imagesNotNextGen === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.imagesNotNextGen)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Images Not Next-Gen\r\n                ${createTooltip('Next-generation image formats (WebP, AVIF) provide better compression and faster loading than JPEG/PNG. Converting images to WebP or AVIF can reduce file sizes by 25-50% while maintaining quality, improving page load times and Core Web Vitals.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.imagesWithoutLazyLoading \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'images-no-lazy' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"images-no-lazy\" ${stats.onPageSEO.imagesWithoutLazyLoading === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.imagesWithoutLazyLoading)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Images w/o Lazy Load\r\n                ${createTooltip('Lazy loading defers loading images until they\\'re needed (when scrolling into view). This reduces initial page load time, saves bandwidth, and improves Core Web Vitals (LCP, FCP). Add loading=\"lazy\" to offscreen images.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noLangAttribute \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-lang' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-lang\" ${stats.onPageSEO.noLangAttribute === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noLangAttribute)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Lang Attribute\r\n                ${createTooltip('The HTML lang attribute helps screen readers pronounce content correctly and helps search engines understand the page language. Essential for accessibility and SEO. Should be set on the \u003chtml\u003e tag.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noCanonical \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-canonical' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-canonical\" ${stats.onPageSEO.noCanonical === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noCanonical)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Canonical Link\r\n                ${createTooltip('Canonical links tell search engines which version of a page is the preferred one, preventing duplicate content issues. Essential for SEO when you have multiple URLs pointing to the same content.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.mixedContent \u003e 0 ? 'error' : 'success'} ${activeFilter === 'mixed-content' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"mixed-content\" ${stats.onPageSEO.mixedContent === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.mixedContent)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Mixed Content\r\n                ${createTooltip('Mixed content occurs when an HTTPS page loads resources (images, scripts, stylesheets) over HTTP. This creates security vulnerabilities, triggers browser warnings, and can break functionality. All resources should use HTTPS.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"analytics\"\u003e\r\n          ${isLocalhost() \u0026\u0026 stats.technicalSEO.pagesWithoutAnalytics \u003e 0 ? `\r\n            \u003cdiv class=\"page-list-tab-actions\"\u003e\r\n              \u003cbutton \r\n                class=\"page-list-fix-button\" \r\n                id=\"page-list-bulk-add-analytics\" \r\n                type=\"button\"\r\n                aria-label=\"Bulk add analytics tracking (development mode only)\"\r\n                title=\"Add analytics (dev-only)\"\r\n                data-tooltip=\"Automatically add analytics tracking code to pages missing it. Only available in development mode.\"\r\n              \u003e\r\n                \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eanalytics\u003c/span\u003e\r\n                \u003cspan class=\"page-list-fix-button__text\"\u003eAdd Analytics\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.pagesWithoutAnalytics \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-analytics' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-analytics\" ${stats.technicalSEO.pagesWithoutAnalytics === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.pagesWithoutAnalytics)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eNo Analytics\u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"onpage\"\u003e\r\n          ${isLocalhost() \u0026\u0026 (stats.onPageSEO.noSchemaMarkup \u003e 0 || stats.onPageSEO.genericAnchorIssues \u003e 0) ? `\r\n            \u003cdiv class=\"page-list-tab-actions\"\u003e\r\n              ${stats.onPageSEO.noSchemaMarkup \u003e 0 ? `\r\n                \u003cbutton \r\n                  class=\"page-list-fix-button\" \r\n                  id=\"page-list-bulk-add-schema\" \r\n                  type=\"button\"\r\n                  aria-label=\"Bulk add schema markup (development mode only)\"\r\n                  title=\"Bulk add schema (dev-only)\"\r\n                  data-tooltip=\"Automatically generate and add basic schema markup to pages. Only available in development mode.\"\r\n                \u003e\r\n                  \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eschema\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-fix-button__text\"\u003eAdd Schema Markup\u003c/span\u003e\r\n                \u003c/button\u003e\r\n              ` : ''}\r\n              ${stats.onPageSEO.genericAnchorIssues \u003e 0 ? `\r\n                \u003cbutton \r\n                  class=\"page-list-fix-button\" \r\n                  id=\"page-list-fix-generic-anchors\" \r\n                  type=\"button\"\r\n                  aria-label=\"Fix generic anchor text (development mode only)\"\r\n                  title=\"Fix generic anchors (dev-only)\"\r\n                  data-tooltip=\"Automatically improve generic anchor text with more descriptive alternatives. Only available in development mode.\"\r\n                \u003e\r\n                  \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eedit\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-fix-button__text\"\u003eFix Generic Anchors\u003c/span\u003e\r\n                \u003c/button\u003e\r\n              ` : ''}\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.multipleH1Issues \u003e 0 ? 'error' : 'success'} ${activeFilter === 'multiple-h1' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"multiple-h1\" ${stats.onPageSEO.multipleH1Issues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.multipleH1Issues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eMultiple H1\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noH1Issues \u003e 0 ? 'error' : 'success'} ${activeFilter === 'no-h1' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-h1\" ${stats.onPageSEO.noH1Issues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noH1Issues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eNo H1\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noH2Issues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-h2' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-h2\" ${stats.onPageSEO.noH2Issues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noH2Issues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eNo H2\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.internalLinkIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'internal-links' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"internal-links\" ${stats.onPageSEO.internalLinkIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.internalLinkIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Link Count Issues\r\n                ${createTooltip('Pages should have 3-5 internal links. Too few (0-2) limits discoverability and site structure understanding. Too many (6+) can look spammy and dilute link value. Aim for quality, relevant internal links.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.genericAnchorIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'generic-anchors' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"generic-anchors\" ${stats.onPageSEO.genericAnchorIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.genericAnchorIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Generic Anchors\r\n                ${createTooltip('Generic anchor text like \"click here\", \"read more\", or \"here\" doesn\\'t help search engines understand the link destination. Use descriptive anchor text that explains what users will find when they click.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noSchemaMarkup \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-schema' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-schema\" ${stats.onPageSEO.noSchemaMarkup === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noSchemaMarkup)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Schema\r\n                ${createTooltip('Schema markup (JSON-LD) helps search engines understand your content structure. It can enable rich snippets in search results, improving click-through rates. All pages should have at least LocalBusiness schema.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.urlLengthIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'url-length' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"url-length\" ${stats.onPageSEO.urlLengthIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.urlLengthIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                URL Too Long\r\n                ${createTooltip('URLs should be under 75 characters ideally, and under 100 characters maximum. Shorter URLs are easier to read, share, and remember. Long URLs can be cut off in search results and look unprofessional.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.outboundLinksTooFew \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'outbound-links' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"outbound-links\" ${stats.onPageSEO.outboundLinksTooFew === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.outboundLinksTooFew)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Outbound Links\r\n                ${createTooltip('Outbound links (external, dofollow links) to authoritative sources show you\\'ve researched your content and provide value to readers. Aim for at least 1-2 relevant external links per page to support E-E-A-T signals.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.paragraphLengthIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'paragraph-length' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"paragraph-length\" ${stats.onPageSEO.paragraphLengthIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.paragraphLengthIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Long Paragraphs\r\n                ${createTooltip('Paragraphs should be under 150 words ideally, and under 200 words maximum. Long paragraphs are hard to read, especially on mobile devices. Break up long paragraphs into shorter, digestible chunks for better readability.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.subheadingDistributionIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'subheading-distribution' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"subheading-distribution\" ${stats.onPageSEO.subheadingDistributionIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.subheadingDistributionIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Subheading Spacing\r\n                ${createTooltip('Subheadings (H2, H3) should appear roughly every 300 words to break up long content blocks. This improves readability, helps users scan content, and signals content structure to search engines.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.mediaUsageTooFew \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'media-usage' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"media-usage\" ${stats.onPageSEO.mediaUsageTooFew === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.mediaUsageTooFew)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Low Media Usage\r\n                ${createTooltip('Pages should have at least 3-4 images or videos to enhance engagement and break up text. Visual content improves user experience, increases time on page, and can help with rankings.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noDateInfo \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-date-info' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-date-info\" ${stats.onPageSEO.noDateInfo === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noDateInfo)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Date Info\r\n                ${createTooltip('Pages should have a published date and/or last modified date. This helps establish content freshness, builds trust with users, and is an important E-E-A-T (Experience, Expertise, Authoritativeness, Trustworthiness) signal for search engines.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.noMobileViewport \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-mobile-viewport' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-mobile-viewport\" ${stats.onPageSEO.noMobileViewport === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.noMobileViewport)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Mobile Viewport\r\n                ${createTooltip('The viewport meta tag tells mobile browsers how to display your page. Without it, mobile devices may render pages at desktop width, creating a poor user experience. Essential for mobile-first indexing.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.onPageSEO.socialMetaIncomplete \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'social-meta' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"social-meta\" ${stats.onPageSEO.socialMetaIncomplete === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.onPageSEO.socialMetaIncomplete)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Incomplete Social Meta\r\n                ${createTooltip('Open Graph (Facebook) and Twitter Card meta tags control how your content appears when shared on social media. Complete social meta tags (title, description, image) improve click-through rates and brand presentation.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"content\"\u003e\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.wordCountIssues \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'low-word-count' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"low-word-count\" ${stats.contentQuality.wordCountIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.wordCountIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eLow Word Count\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.staleContent \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'stale-content' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"stale-content\" ${stats.contentQuality.staleContent === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.staleContent)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eStale Content\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.noCitations \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-citations' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-citations\" ${stats.contentQuality.noCitations === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.noCitations)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eNo Citations\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.noAuthor \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'no-author' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-author\" ${stats.contentQuality.noAuthor === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.noAuthor)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eNo Author\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.videosWithoutTranscript \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'videos-no-transcript' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"videos-no-transcript\" ${stats.contentQuality.videosWithoutTranscript === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.videosWithoutTranscript)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003eVideos w/o Transcript\u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.noExcerpt \u003e 0 ? 'error' : 'success'} ${activeFilter === 'no-excerpt' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-excerpt\" ${stats.contentQuality.noExcerpt === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.noExcerpt)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Excerpt\r\n                ${createTooltip('Page excerpts (summaries) help AI crawlers and search engines understand page content quickly. They appear in search results, social shares, and help with content discovery. Every page should have a meaningful excerpt (100-300 characters optimal).')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.excerptTooShort \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'excerpt-too-short' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"excerpt-too-short\" ${stats.contentQuality.excerptTooShort === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.excerptTooShort)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Excerpt Too Short\r\n                ${createTooltip('Excerpts under 50 characters provide insufficient context. Optimal excerpts are 100-300 characters, providing enough detail for AI crawlers and search engines to understand the page content without being too long.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.contentQuality.excerptTooLong \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'excerpt-too-long' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"excerpt-too-long\" ${stats.contentQuality.excerptTooLong === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.contentQuality.excerptTooLong)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Excerpt Too Long\r\n                ${createTooltip('Excerpts over 300 characters may be truncated in search results and social shares, losing important information. Keep excerpts concise (100-300 characters) to ensure the full message is displayed.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-filter-tab-content\" data-tab-content=\"accessibility\"\u003e\r\n          ${isLocalhost() \u0026\u0026 (stats.accessibility.missingAriaLabels \u003e 0 || stats.accessibility.noFocusIndicators \u003e 0) ? `\r\n            \u003cdiv class=\"page-list-tab-actions\"\u003e\r\n              ${stats.accessibility.missingAriaLabels \u003e 0 ? `\r\n                \u003cbutton \r\n                  class=\"page-list-fix-button\" \r\n                  id=\"page-list-bulk-add-aria\" \r\n                  type=\"button\"\r\n                  aria-label=\"Bulk add ARIA labels (development mode only)\"\r\n                  title=\"Add ARIA labels (dev-only)\"\r\n                  data-tooltip=\"Automatically add ARIA labels to interactive elements missing them. Only available in development mode.\"\r\n                \u003e\r\n                  \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eaccessibility_new\u003c/span\u003e\r\n                  \u003cspan class=\"page-list-fix-button__text\"\u003eAdd ARIA Labels\u003c/span\u003e\r\n                \u003c/button\u003e\r\n              ` : ''}\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          \u003cdiv class=\"page-list-summary__grid\"\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.accessibility.contrastRatioIssues \u003e 0 ? 'error' : 'success'} ${activeFilter === 'contrast-ratio' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"contrast-ratio\" ${stats.accessibility.contrastRatioIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.accessibility.contrastRatioIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Contrast Ratio Issues\r\n                ${createTooltip('WCAG AA requires 4.5:1 contrast ratio for normal text (3:1 for large text). Low contrast makes content hard to read, especially for users with visual impairments. Check text/background color combinations.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.accessibility.missingAriaLabels \u003e 0 ? 'warning' : 'success'} ${activeFilter === 'missing-aria' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"missing-aria\" ${stats.accessibility.missingAriaLabels === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.accessibility.missingAriaLabels)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Missing ARIA Labels\r\n                ${createTooltip('ARIA labels provide accessible names for interactive elements. Missing labels make it difficult for screen readers to identify buttons, links, and form controls. Add aria-label or aria-labelledby attributes.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.accessibility.keyboardNavigationIssues \u003e 0 ? 'error' : 'success'} ${activeFilter === 'keyboard-nav' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"keyboard-nav\" ${stats.accessibility.keyboardNavigationIssues === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.accessibility.keyboardNavigationIssues)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Keyboard Navigation Issues\r\n                ${createTooltip('All interactive elements must be keyboard accessible. Users should be able to navigate and activate all controls using only the keyboard (Tab, Enter, Space, Arrow keys). Check for elements that can\\'t be reached or activated via keyboard.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.accessibility.noFocusIndicators \u003e 0 ? 'error' : 'success'} ${activeFilter === 'no-focus-indicators' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"no-focus-indicators\" ${stats.accessibility.noFocusIndicators === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.accessibility.noFocusIndicators)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                No Focus Indicators\r\n                ${createTooltip('Focus indicators (outlines) show which element is currently focused when navigating with keyboard. Without visible focus indicators, keyboard users can\\'t tell where they are on the page. Ensure focus styles are visible and meet contrast requirements.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-summary__stat page-list-summary__stat--clickable page-list-summary__stat--${stats.technicalSEO.imagesWithoutAlt \u003e 0 ? 'error' : 'success'} ${activeFilter === 'images-no-alt' ? 'page-list-summary__stat--active' : ''}\" data-filter=\"images-no-alt\" ${stats.technicalSEO.imagesWithoutAlt === 0 ? 'disabled' : ''}\u003e\r\n              \u003cdiv class=\"page-list-summary__value\"\u003e${formatIssueCount(stats.technicalSEO.imagesWithoutAlt)}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-summary__label\"\u003e\r\n                Images w/o Alt Text\r\n                ${createTooltip('Alt text describes images for screen reader users. All images should have descriptive alt attributes. Decorative images should have empty alt=\"\" attributes. Missing alt text prevents visually impaired users from understanding image content.')}\r\n              \u003c/div\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      ` : ''}\r\n      ${analyticsHtml}\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n/**\r\n * Get status badges for a page\r\n */\r\nfunction getStatusBadges(page: PageData): Array\u003c{ text: string; class: string }\u003e {\r\n  const badges: Array\u003c{ text: string; class: string }\u003e = [];\r\n\r\n  if (!page.hasMetaTitle) {\r\n    badges.push({ text: 'Missing Title', class: 'badge-error' });\r\n  } else if (page.titleOverPixels) {\r\n    badges.push({ text: 'Title Over Pixels', class: 'badge-error' });\r\n  } else if (page.titleOverLimit) {\r\n    badges.push({ text: 'Title Too Long', class: 'badge-error' });\r\n  }\r\n\r\n  if (!page.hasMetaDescription) {\r\n    badges.push({ text: 'Missing Desc', class: 'badge-error' });\r\n  } else if (page.descriptionOverPixels) {\r\n    badges.push({ text: 'Desc Over Pixels', class: 'badge-error' });\r\n  } else if (page.descriptionOverLimit) {\r\n    badges.push({ text: 'Desc Too Long', class: 'badge-error' });\r\n  }\r\n\r\n  // Technical SEO badges\r\n  if (page.hasBrokenLinks) {\r\n    badges.push({ text: `${page.brokenLinks} Broken Link${page.brokenLinks \u003e 1 ? 's' : ''}`, class: 'badge-error' });\r\n  }\r\n  if (page.hasBrokenImages) {\r\n    badges.push({ text: `${page.brokenImages || 0} Broken Image${(page.brokenImages || 0) \u003e 1 ? 's' : ''}`, class: 'badge-error' });\r\n  }\r\n  if (page.hasImagesWithoutAlt) {\r\n    badges.push({ text: `${page.imagesWithoutAlt} Image${page.imagesWithoutAlt \u003e 1 ? 's' : ''} w/o Alt`, class: 'badge-warning' });\r\n  }\r\n  if (!page.headingStructureGood) {\r\n    badges.push({ text: 'Heading Structure', class: 'badge-warning' });\r\n  }\r\n  \r\n  // On-page SEO badges\r\n  if (page.hasMultipleH1) {\r\n    badges.push({ text: `${page.h1Count} H1${page.h1Count \u003e 1 ? 's' : ''}`, class: 'badge-error' });\r\n  }\r\n  if (page.h1Count === 0) {\r\n    badges.push({ text: 'No H1', class: 'badge-error' });\r\n  }\r\n  if (!page.hasH2s) {\r\n    badges.push({ text: 'No H2', class: 'badge-warning' });\r\n  }\r\n  if (page.internalLinksTooFew) {\r\n    badges.push({ text: `Only ${page.internalLinkCount} Link${page.internalLinkCount !== 1 ? 's' : ''}`, class: 'badge-warning' });\r\n  }\r\n  if (page.internalLinksTooMany) {\r\n    badges.push({ text: `${page.internalLinkCount} Links`, class: 'badge-warning' });\r\n  }\r\n  if (page.hasGenericAnchors) {\r\n    badges.push({ text: `${page.genericAnchorCount} Generic Anchor${page.genericAnchorCount \u003e 1 ? 's' : ''}`, class: 'badge-warning' });\r\n  }\r\n  if (page.hasGenericAltText) {\r\n    badges.push({ text: `${page.imagesWithGenericAlt} Generic Alt`, class: 'badge-warning' });\r\n  }\r\n  if (!page.hasSchemaMarkup) {\r\n    badges.push({ text: 'No Schema', class: 'badge-warning' });\r\n  }\r\n  if (!page.firstParaGood) {\r\n    badges.push({ text: 'Short First Para', class: 'badge-warning' });\r\n  }\r\n  \r\n  // Content Quality badges\r\n  if (page.wordCountPoor) {\r\n    badges.push({ text: `${page.wordCount} Words`, class: 'badge-warning' });\r\n  }\r\n  if (page.isStale) {\r\n    const months = Math.floor(page.daysSinceUpdate / 30);\r\n    badges.push({ text: `${months}M Old`, class: 'badge-warning' });\r\n  }\r\n  if (!page.hasCitations) {\r\n    badges.push({ text: 'No Citations', class: 'badge-warning' });\r\n  }\r\n  if (!page.hasAuthor) {\r\n    badges.push({ text: 'No Author', class: 'badge-warning' });\r\n  }\r\n  if (page.hasVideos \u0026\u0026 !page.hasTranscript) {\r\n    badges.push({ text: 'No Transcript', class: 'badge-warning' });\r\n  }\r\n  if (!page.readabilityGood \u0026\u0026 page.avgSentenceLength \u003e 0) {\r\n    badges.push({ text: `Avg ${Math.round(page.avgSentenceLength)}w/sent`, class: 'badge-warning' });\r\n  }\r\n  \r\n  // Analytics badges\r\n  if (!page.hasAnalytics) {\r\n    badges.push({ text: 'No Analytics', class: 'badge-warning' });\r\n  }\r\n  \r\n  // Accessibility badges\r\n  if (page.hasContrastRatioIssues \u0026\u0026 page.contrastRatioIssues) {\r\n    badges.push({ text: `${page.contrastRatioIssues} Contrast Issue${page.contrastRatioIssues \u003e 1 ? 's' : ''}`, class: 'badge-error' });\r\n  }\r\n  if (page.hasMissingAriaLabels \u0026\u0026 page.missingAriaLabels) {\r\n    badges.push({ text: `${page.missingAriaLabels} Missing ARIA`, class: 'badge-warning' });\r\n  }\r\n  if (page.hasKeyboardNavigationIssues \u0026\u0026 page.keyboardNavigationIssues) {\r\n    badges.push({ text: 'Keyboard Nav Issues', class: 'badge-error' });\r\n  }\r\n  if (page.hasFocusIndicators === false) {\r\n    badges.push({ text: 'No Focus Indicators', class: 'badge-error' });\r\n  }\r\n\r\n  return badges;\r\n}\r\n\r\n/**\r\n * Render a score badge\r\n * Shows circular progress bar for all scores\r\n */\r\nfunction renderScore(score: number, label: string): string {\r\n  // Defensive check: don't render if score is null, undefined, or not a number\r\n  if (score === null || score === undefined || typeof score !== 'number' || isNaN(score)) {\r\n    return '';\r\n  }\r\n  \r\n  const scoreClass = getScoreClass(score);\r\n  const CIRCLE_RADIUS = 54;\r\n  const CIRCUMFERENCE = 2 * Math.PI * CIRCLE_RADIUS;\r\n  const dashArray = (score / 100) * CIRCUMFERENCE;\r\n  \r\n  // Normalize label to ensure consistency (SEO, AI, A11y)\r\n  const normalizedLabel = label.toUpperCase();\r\n  \r\n  return `\r\n    \u003cdiv class=\"page-list-score ${scoreClass} page-list-score--circular\"\u003e\r\n      \u003cdiv class=\"page-list-score__circle\"\u003e\r\n        \u003csvg class=\"page-list-score__circle-svg\" viewBox=\"0 0 120 120\"\u003e\r\n          \u003ccircle class=\"page-list-score__circle-bg\" cx=\"60\" cy=\"60\" r=\"${CIRCLE_RADIUS}\"\u003e\u003c/circle\u003e\r\n          \u003ccircle class=\"page-list-score__circle-fill ${scoreClass}\" cx=\"60\" cy=\"60\" r=\"${CIRCLE_RADIUS}\" \r\n            style=\"stroke-dasharray: ${dashArray} ${CIRCUMFERENCE};\"\u003e\u003c/circle\u003e\r\n        \u003c/svg\u003e\r\n        \u003cdiv class=\"page-list-score__circle-value\"\u003e\r\n          \u003cspan class=\"page-list-score__circle-number\"\u003e${score}\u003c/span\u003e\r\n          \u003cspan class=\"page-list-score__circle-label\"\u003e${normalizedLabel}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Render page detail modal\r\n */\r\nfunction renderPageDetailModal(page: PageData): string {\r\n  const badges = getStatusBadges(page);\r\n  const badgesHtml = badges.length \u003e 0\r\n    ? `\u003cdiv class=\"page-list-detail-badges\"\u003e${badges.map(b =\u003e `\u003cspan class=\"page-list-badge ${b.class}\"\u003e${b.text}\u003c/span\u003e`).join('')}\u003c/div\u003e`\r\n    : '\u003cdiv class=\"page-list-detail-badges\"\u003e\u003cspan class=\"page-list-badge badge-success\"\u003eAll Good ✓\u003c/span\u003e\u003c/div\u003e';\r\n\r\n  return `\r\n    \u003cdiv class=\"page-list-modal\" id=\"page-list-modal\"\u003e\r\n      \u003cdiv class=\"page-list-modal__overlay\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"page-list-modal__content\"\u003e\r\n        \u003cbutton class=\"page-list-modal__close\" id=\"page-list-modal-close\"\u003e×\u003c/button\u003e\r\n        \u003cdiv class=\"page-list-modal__header\"\u003e\r\n          \u003ch2 class=\"page-list-modal__title\"\u003e${escapeHtml(page.title)}\u003c/h2\u003e\r\n          \u003ca href=\"${page.relPermalink}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"page-list-modal__link\"\u003e\r\n            ${page.relPermalink} ↗\r\n          \u003c/a\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-modal__body\"\u003e\r\n          \u003cdiv class=\"page-list-modal__scores\"\u003e\r\n            ${renderScore(page.seoScore, 'SEO')}\r\n            ${renderScore(page.aiCrawlabilityScore, 'AI')}\r\n            ${page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? renderScore(page.accessibilityScore, 'A11y') : ''}\r\n          \u003c/div\u003e\r\n          ${badgesHtml}\r\n          \u003cdiv class=\"page-list-modal__tabs\" role=\"tablist\" aria-label=\"Page details sections\"\u003e\r\n            \u003cbutton class=\"page-list-modal__tab page-list-modal__tab--active\" role=\"tab\" aria-selected=\"true\" aria-controls=\"page-list-tab-meta\" id=\"page-list-tab-btn-meta\" data-tab=\"meta\"\u003e\r\n              Meta Tags\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-modal__tab\" role=\"tab\" aria-selected=\"false\" aria-controls=\"page-list-tab-technical\" id=\"page-list-tab-btn-technical\" data-tab=\"technical\"\u003e\r\n              Technical SEO\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-modal__tab\" role=\"tab\" aria-selected=\"false\" aria-controls=\"page-list-tab-onpage\" id=\"page-list-tab-btn-onpage\" data-tab=\"onpage\"\u003e\r\n              On-Page SEO\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-modal__tab\" role=\"tab\" aria-selected=\"false\" aria-controls=\"page-list-tab-accessibility\" id=\"page-list-tab-btn-accessibility\" data-tab=\"accessibility\"\u003e\r\n              Accessibility\r\n            \u003c/button\u003e\r\n            \u003cbutton class=\"page-list-modal__tab\" role=\"tab\" aria-selected=\"false\" aria-controls=\"page-list-tab-content\" id=\"page-list-tab-btn-content\" data-tab=\"content\"\u003e\r\n              Content Quality\r\n            \u003c/button\u003e\r\n            ${isLocalhost() ? `\r\n            \u003cbutton class=\"page-list-modal__tab\" role=\"tab\" aria-selected=\"false\" aria-controls=\"page-list-tab-keywords\" id=\"page-list-tab-btn-keywords\" data-tab=\"keywords\"\u003e\r\n              Keyword Research\r\n            \u003c/button\u003e\r\n            ` : ''}\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-modal__sections\"\u003e\r\n            \u003cdiv class=\"page-list-modal__section page-list-modal__section--active\" id=\"page-list-tab-meta\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-meta\" data-section=\"meta\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eMeta Tags\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Meta Title\r\n                    ${createTooltip('Meta titles should be 30-60 characters and under 920px wide on desktop. They appear in search results and browser tabs. Keep them concise and descriptive.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasMetaTitle ? 'page-list-modal__value--missing' : ''}\"\u003e\r\n                    ${page.hasMetaTitle ? escapeHtml(page.metaTitle) : '\u003cem\u003eMissing\u003c/em\u003e'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasMetaTitle ? `\r\n                    \u003cdiv class=\"page-list-modal__metrics\"\u003e\r\n                      \u003cspan\u003e${page.metaTitleLength} chars / ${TITLE_LIMIT}\u003c/span\u003e\r\n                      \u003cspan\u003e${Math.round(page.titlePixels)}px / ${TITLE_PIXEL_LIMIT_DESKTOP}\u003c/span\u003e\r\n                    \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Meta Description\r\n                    ${createTooltip('Meta descriptions should be 120-160 characters and under 1970px wide on desktop. They appear in search results below the title. Write compelling summaries that encourage clicks.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasMetaDescription ? 'page-list-modal__value--missing' : ''}\"\u003e\r\n                    ${page.hasMetaDescription ? escapeHtml(page.metaDescription) : '\u003cem\u003eMissing\u003c/em\u003e'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasMetaDescription ? `\r\n                    \u003cdiv class=\"page-list-modal__metrics\"\u003e\r\n                      \u003cspan\u003e${page.metaDescriptionLength} chars / ${DESC_LIMIT}\u003c/span\u003e\r\n                      \u003cspan\u003e${Math.round(page.descriptionPixels)}px / ${DESC_PIXEL_LIMIT_DESKTOP}\u003c/span\u003e\r\n                    \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-modal__section\" id=\"page-list-tab-technical\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-technical\" data-section=\"technical\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eTechnical SEO\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Broken Links\r\n                    ${createTooltip('Broken links point to pages that don\\'t exist on your site. They create poor user experience and can negatively impact SEO. Fix or remove broken links to improve site quality.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasBrokenLinks ? 'page-list-modal__value--bad' : 'page-list-modal__value--good'}\"\u003e\r\n                    ${page.brokenLinks} / ${page.totalInternalLinks} ${page.hasBrokenLinks ? '✗' : '✓'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasBrokenLinks \u0026\u0026 page.brokenLinkUrls \u0026\u0026 Array.isArray(page.brokenLinkUrls) \u0026\u0026 page.brokenLinkUrls.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-modal__broken-links\"\u003e\r\n                    \u003cdiv class=\"page-list-modal__broken-links-title\"\u003eBroken Link URLs:\u003c/div\u003e\r\n                    \u003cul class=\"page-list-modal__broken-links-list\"\u003e\r\n                      ${page.brokenLinkUrls.map(url =\u003e `\r\n                        \u003cli class=\"page-list-modal__broken-link-item\" data-broken-url=\"${escapeHtml(url)}\" data-source-page=\"${escapeHtml(page.relPermalink)}\"\u003e\r\n                          \u003ccode class=\"page-list-modal__broken-link-url\"\u003e${escapeHtml(url)}\u003c/code\u003e\r\n                          ${isLocalhost() ? `\r\n                          \u003cdiv class=\"page-list-modal__broken-link-actions\"\u003e\r\n                            \u003cbutton \r\n                              class=\"dev-score-bubble__broken-link-menu-action\" \r\n                              data-action=\"fix\"\r\n                              data-broken-url=\"${escapeHtml(url)}\"\r\n                              data-source-page=\"${escapeHtml(page.relPermalink)}\"\r\n                              type=\"button\"\r\n                              aria-label=\"Auto-fix broken link\"\r\n                              title=\"Auto-fix broken link\"\r\n                            \u003e\r\n                              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n                              \u003cspan\u003eFix\u003c/span\u003e\r\n                            \u003c/button\u003e\r\n                            \u003cbutton \r\n                              class=\"dev-score-bubble__broken-link-menu-action\" \r\n                              data-action=\"edit\"\r\n                              data-broken-url=\"${escapeHtml(url)}\"\r\n                              data-source-page=\"${escapeHtml(page.relPermalink)}\"\r\n                              type=\"button\"\r\n                              aria-label=\"Edit broken link URL\"\r\n                              title=\"Edit broken link URL\"\r\n                            \u003e\r\n                              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eedit\u003c/span\u003e\r\n                              \u003cspan\u003eEdit\u003c/span\u003e\r\n                            \u003c/button\u003e\r\n                            \u003cbutton \r\n                              class=\"dev-score-bubble__broken-link-menu-action\" \r\n                              data-action=\"remove\"\r\n                              data-broken-url=\"${escapeHtml(url)}\"\r\n                              data-source-page=\"${escapeHtml(page.relPermalink)}\"\r\n                              type=\"button\"\r\n                              aria-label=\"Remove broken link\"\r\n                              title=\"Remove broken link\"\r\n                            \u003e\r\n                              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elink_off\u003c/span\u003e\r\n                              \u003cspan\u003eRemove\u003c/span\u003e\r\n                            \u003c/button\u003e\r\n                          \u003c/div\u003e\r\n                          ` : ''}\r\n                        \u003c/li\u003e\r\n                      `).join('')}\r\n                    \u003c/ul\u003e\r\n                  \u003c/div\u003e\r\n                  ` : page.hasBrokenLinks ? `\r\n                  \u003cdiv class=\"page-list-modal__broken-links\"\u003e\r\n                    \u003cdiv class=\"page-list-modal__broken-links-note\"\u003eBroken link URLs not available. Please regenerate the page list.\u003c/div\u003e\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Broken Images\r\n                    ${createTooltip('Broken images have src attributes pointing to files that don\\'t exist. This creates broken image icons on your pages and hurts user experience. Fix image paths or remove broken image references.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasBrokenImages ? 'page-list-modal__value--bad' : 'page-list-modal__value--good'}\"\u003e\r\n                    ${page.brokenImages || 0} / ${page.totalImages || 0} ${page.hasBrokenImages ? '✗' : '✓'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasBrokenImages \u0026\u0026 page.brokenImageUrls \u0026\u0026 Array.isArray(page.brokenImageUrls) \u0026\u0026 page.brokenImageUrls.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-modal__broken-links\"\u003e\r\n                    \u003cdiv class=\"page-list-modal__broken-links-title\"\u003eBroken Image URLs:\u003c/div\u003e\r\n                    \u003cul class=\"page-list-modal__broken-links-list\"\u003e\r\n                      ${page.brokenImageUrls.map(url =\u003e `\r\n                        \u003cli class=\"page-list-modal__broken-link-item\" data-broken-image-url=\"${escapeHtml(url)}\" data-source-page=\"${escapeHtml(page.relPermalink)}\"\u003e\r\n                          \u003ccode class=\"page-list-modal__broken-link-url\"\u003e${escapeHtml(url)}\u003c/code\u003e\r\n                        \u003c/li\u003e\r\n                      `).join('')}\r\n                    \u003c/ul\u003e\r\n                  \u003c/div\u003e\r\n                  ` : page.hasBrokenImages ? `\r\n                  \u003cdiv class=\"page-list-modal__broken-links\"\u003e\r\n                    \u003cdiv class=\"page-list-modal__broken-links-note\"\u003eBroken image URLs not available. Please regenerate the page list.\u003c/div\u003e\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eImages Without Alt\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value\"\u003e${page.imagesWithoutAlt} / ${page.totalImages}\u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Heading Structure\r\n                    ${createTooltip('Headings should follow a logical hierarchy (H1 → H2 → H3). Skipping levels (e.g., H1 to H3) confuses search engines and screen readers. Maintain proper nesting for better SEO and accessibility.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.headingStructureGood ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.headingStructureGood ? '✓ Good' : '✗ Issues Found'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eH1 Count\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasOneH1 ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.h1Count} ${page.hasOneH1 ? '✓' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eH2 Count\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasH2s ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.h2Count} ${page.hasH2s ? '✓' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Analytics Tracking\r\n                    ${createTooltip('Analytics tracking (Google Analytics, GTM, etc.) helps you understand visitor behaviour, track conversions, and measure content performance. All pages should have analytics configured for comprehensive site insights.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasAnalytics ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasAnalytics ? '✓ Configured' : '✗ Not Configured'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasAnalytics \u0026\u0026 page.analyticsTypes \u0026\u0026 page.analyticsTypes.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-modal__value page-list-modal__value--info\" style=\"margin-top: 0.5rem; font-size: 0.875rem;\"\u003e\r\n                    Types: ${page.analyticsTypes.join(', ')}\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Image Formats\r\n                    ${createTooltip('Next-generation image formats (WebP, AVIF) provide better compression and faster loading than JPEG/PNG. Converting images to WebP or AVIF can reduce file sizes by 25-50% while maintaining quality, improving page load times and Core Web Vitals.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasImagesNotNextGen ? 'page-list-modal__value--good' : 'page-list-modal__value--warning'}\"\u003e\r\n                    ${!page.hasImagesNotNextGen ? '✓ All Next-Gen' : `⚠ ${page.imagesNotNextGen} Not Next-Gen`}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Lazy Loading\r\n                    ${createTooltip('Lazy loading defers loading images until they\\'re needed (when scrolling into view). This reduces initial page load time, saves bandwidth, and improves Core Web Vitals (LCP, FCP). Add loading=\"lazy\" to offscreen images.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasImagesWithoutLazyLoading ? 'page-list-modal__value--good' : 'page-list-modal__value--warning'}\"\u003e\r\n                    ${!page.hasImagesWithoutLazyLoading ? '✓ All Lazy Loaded' : `⚠ ${page.imagesWithoutLazyLoading} Not Lazy Loaded`}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    HTML Lang Attribute\r\n                    ${createTooltip('The HTML lang attribute helps screen readers pronounce content correctly and helps search engines understand the page language. Essential for accessibility and SEO. Should be set on the \u003chtml\u003e tag.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasLangAttribute ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasLangAttribute ? '✓ Present' : '✗ Missing'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Canonical Link\r\n                    ${createTooltip('Canonical links tell search engines which version of a page is the preferred one, preventing duplicate content issues. Essential for SEO when you have multiple URLs pointing to the same content.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasCanonical ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasCanonical ? '✓ Present' : '✗ Missing'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Mixed Content\r\n                    ${createTooltip('Mixed content occurs when an HTTPS page loads resources (images, scripts, stylesheets) over HTTP. This creates security vulnerabilities, triggers browser warnings, and can break functionality. All resources should use HTTPS.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasMixedContent ? 'page-list-modal__value--good' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${!page.hasMixedContent ? '✓ No Issues' : `✗ ${page.mixedContentIssues} Issue(s) Found`}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-modal__section\" id=\"page-list-tab-onpage\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-onpage\" data-section=\"onpage\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eOn-Page SEO\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Internal Links\r\n                    ${createTooltip('Internal links help users navigate and help search engines understand your site structure. Aim for 3-5 relevant internal links per page. Too few limits discoverability; too many can look spammy.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.internalLinksGood ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.internalLinkCount} ${page.internalLinksGood ? '✓ (3-5 recommended)' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eGeneric Anchors\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasGenericAnchors ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.genericAnchorCount} ${!page.hasGenericAnchors ? '✓' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Schema Markup\r\n                    ${createTooltip('Schema markup (JSON-LD) helps search engines understand your content structure. It can enable rich snippets in search results, improving click-through rates. All pages should have at least LocalBusiness schema.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasSchemaMarkup ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasSchemaMarkup ? '✓ Present' : '✗ Missing'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-modal__section\" id=\"page-list-tab-accessibility\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-accessibility\" data-section=\"accessibility\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eAccessibility\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Contrast Ratio\r\n                    ${createTooltip('WCAG AA requires 4.5:1 contrast ratio for normal text (3:1 for large text 18pt+ or 14pt+ bold). Low contrast makes content hard to read, especially for users with visual impairments. Check all text/background color combinations.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasContrastRatioIssues ? 'page-list-modal__value--good' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${!page.hasContrastRatioIssues ? '✓ Meets WCAG AA (4.5:1)' : `✗ ${page.contrastRatioIssues || 0} Issue(s) Found`}\r\n                  \u003c/div\u003e\r\n                  ${page.hasContrastRatioIssues ? `\r\n                  \u003cdiv class=\"page-list-modal__value page-list-modal__value--info\" style=\"margin-top: 0.5rem; font-size: 0.875rem;\"\u003e\r\n                    ${(page.contrastRatioBelow45 || 0) \u003e 0 ? `${page.contrastRatioBelow45} below 4.5:1 (normal text)` : ''}\r\n                    ${(page.contrastRatioBelow45 || 0) \u003e 0 \u0026\u0026 (page.contrastRatioBelow3 || 0) \u003e 0 ? ' | ' : ''}\r\n                    ${(page.contrastRatioBelow3 || 0) \u003e 0 ? `${page.contrastRatioBelow3} below 3:1 (large text)` : ''}\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    ARIA Labels\r\n                    ${createTooltip('ARIA labels provide accessible names for interactive elements. Missing labels make it difficult for screen readers to identify buttons, links, and form controls. Add aria-label or aria-labelledby attributes to interactive elements without visible text.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasMissingAriaLabels ? 'page-list-modal__value--good' : 'page-list-modal__value--warning'}\"\u003e\r\n                    ${!page.hasMissingAriaLabels ? '✓ All Interactive Elements Labeled' : `⚠ ${page.missingAriaLabels || 0} Missing`}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Keyboard Navigation\r\n                    ${createTooltip('All interactive elements must be keyboard accessible. Users should be able to navigate and activate all controls using only the keyboard (Tab, Enter, Space, Arrow keys). Check for elements that can\\'t be reached or activated via keyboard.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasKeyboardNavigationIssues ? 'page-list-modal__value--good' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${!page.hasKeyboardNavigationIssues ? '✓ Fully Keyboard Accessible' : `✗ ${page.keyboardNavigationIssues || 0} Issue(s) Found`}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Focus Indicators\r\n                    ${createTooltip('Focus indicators (outlines) show which element is currently focused when navigating with keyboard. Without visible focus indicators, keyboard users can\\'t tell where they are on the page. Ensure focus styles are visible and meet contrast requirements (3:1 minimum).')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasFocusIndicators !== false ? 'page-list-modal__value--good' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${page.hasFocusIndicators !== false ? '✓ Present' : '✗ Missing'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Image Alt Text\r\n                    ${createTooltip('Alt text describes images for screen reader users. All images should have descriptive alt attributes. Decorative images should have empty alt=\"\" attributes. Missing alt text prevents visually impaired users from understanding image content.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.hasImagesWithoutAlt ? 'page-list-modal__value--good' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${page.imagesWithoutAlt} / ${page.totalImages} ${!page.hasImagesWithoutAlt ? '✓' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                ${page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? `\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eAccessibility Score\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.accessibilityScore \u003e= 80 ? 'page-list-modal__value--good' : page.accessibilityScore \u003e= 60 ? 'page-list-modal__value--warning' : 'page-list-modal__value--error'}\"\u003e\r\n                    ${page.accessibilityScore}/100 ${page.accessibilityScore \u003e= 80 ? '✓' : page.accessibilityScore \u003e= 60 ? '⚠' : '✗'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                ` : ''}\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-modal__section\" id=\"page-list-tab-content\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-content\" data-section=\"content\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eContent Quality\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Word Count\r\n                    ${createTooltip('Longer content typically ranks better. Pages with 1400+ words are considered optimal for SEO. 800-1399 words is acceptable. Under 800 words may not provide enough depth for search engines to understand the topic comprehensively.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.wordCountGood ? 'page-list-modal__value--good' : page.wordCountFair ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.wordCount} ${page.wordCountGood ? '✓ (1400+ optimal)' : page.wordCountFair ? '✓ (800-1399 acceptable)' : '✗ (\u003c800)'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eContent Freshness\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${!page.isStale ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.isStale ? `${Math.floor(page.daysSinceUpdate / 30)} months old ✗` : '✓ Recent'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Citations\r\n                    ${createTooltip('Citations (external links to authoritative sources) support E-E-A-T (Experience, Expertise, Authoritativeness, Trustworthiness). They show you\\'ve researched your content and provide sources for readers. Aim for 2+ citations per page.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.citationsGood ? 'page-list-modal__value--good' : page.hasCitations ? 'page-list-modal__value--warning' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.citationCount} ${page.citationsGood ? '✓ (2+ recommended)' : page.hasCitations ? '⚠ (1)' : '✗ (0)'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eAuthor\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasAuthor ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasAuthor \u0026\u0026 page.authorName ? escapeHtml(page.authorName) : (page.hasAuthor ? '✓ Present' : '✗ Missing')}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Readability\r\n                    ${createTooltip('Average sentence length affects readability. 10-25 words per sentence is ideal (8th grade reading level). Shorter sentences are easier to understand. Longer sentences (30+ words) can be hard to follow and may reduce engagement. Break up long sentences for better readability.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.readabilityGood ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.avgSentenceLength \u003e 0 ? `Avg ${Math.round(page.avgSentenceLength)} words/sentence` : 'N/A'} ${page.readabilityGood ? '✓' : '✗'}\r\n                  \u003c/div\u003e\r\n                  ${page.longSentences \u0026\u0026 Array.isArray(page.longSentences) \u0026\u0026 page.longSentences.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-modal__long-sentences\"\u003e\r\n                    \u003cdiv class=\"page-list-modal__long-sentences-title\"\u003eLong Sentences (over 25 words):\u003c/div\u003e\r\n                    \u003cdiv class=\"page-list-modal__long-sentences-list\"\u003e\r\n                      ${page.longSentences.map((sentence, index) =\u003e {\r\n                        const wordCount = sentence.trim().split(/\\s+/).filter(w =\u003e w.length \u003e 0).length;\r\n                        return `\r\n                        \u003cdiv class=\"page-list-modal__long-sentence-item\"\u003e\r\n                          \u003cdiv class=\"page-list-modal__long-sentence-header\"\u003e\r\n                            \u003cspan class=\"page-list-modal__long-sentence-number\"\u003eSentence ${index + 1}\u003c/span\u003e\r\n                            \u003cspan class=\"page-list-modal__long-sentence-count\"\u003e${wordCount} words\u003c/span\u003e\r\n                          \u003c/div\u003e\r\n                          \u003cdiv class=\"page-list-modal__long-sentence-text\"\u003e${escapeHtml(sentence.trim())}\u003c/div\u003e\r\n                        \u003c/div\u003e\r\n                        `;\r\n                      }).join('')}\r\n                    \u003c/div\u003e\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n                ${page.hasVideos ? `\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eVideo Transcript\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.hasTranscript ? 'page-list-modal__value--good' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.videoCount} video(s) ${page.hasTranscript ? '✓' : '✗ Missing transcript'}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n                ` : ''}\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003e\r\n                    Page Excerpt\r\n                    ${createTooltip('Page excerpts (summaries) help AI crawlers and search engines understand page content quickly. They appear in search results, social shares, and help with content discovery. Optimal length is 100-300 characters. Too short (\u003c50) provides insufficient context. Too long (\u003e300) may be truncated.')}\r\n                  \u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value ${page.summaryOptimal ? 'page-list-modal__value--good' : page.summaryFair ? 'page-list-modal__value--warning' : page.hasSummary ? 'page-list-modal__value--warning' : 'page-list-modal__value--bad'}\"\u003e\r\n                    ${page.hasSummary ? `${page.summaryLength} chars ${page.summaryOptimal ? '✓ (100-300 optimal)' : page.summaryTooShort ? '✗ (too short, \u003c50)' : page.summaryTooLong ? '✗ (too long, \u003e300)' : '⚠ (50-99 acceptable)'}` : '✗ Missing'}\r\n                  \u003c/div\u003e\r\n                  ${page.hasSummary ? `\r\n                  \u003cdiv class=\"page-list-modal__value page-list-modal__value--info\" style=\"margin-top: 0.5rem; font-size: 0.875rem; font-style: italic;\"\u003e\r\n                    ${escapeHtml(page.summary.substring(0, 150))}${page.summary.length \u003e 150 ? '...' : ''}\r\n                  \u003c/div\u003e\r\n                  ` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            ${isLocalhost() ? `\r\n            \u003cdiv class=\"page-list-modal__section\" id=\"page-list-tab-keywords\" role=\"tabpanel\" aria-labelledby=\"page-list-tab-btn-keywords\" data-section=\"keywords\"\u003e\r\n              \u003ch3 class=\"page-list-modal__section-title\"\u003eKeyword Research\u003c/h3\u003e\r\n              \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n                \u003cdiv class=\"page-list-modal__field\"\u003e\r\n                  \u003clabel\u003eAnalyze Keywords\u003c/label\u003e\r\n                  \u003cdiv class=\"page-list-modal__value\"\u003e\r\n                    \u003cbutton \r\n                      class=\"page-list-modal__button page-list-modal__button--primary\" \r\n                      id=\"page-list-keyword-research-btn\"\r\n                      data-page-url=\"${escapeHtml(page.relPermalink)}\"\r\n                      data-page-title=\"${escapeHtml(page.title)}\"\r\n                      type=\"button\"\r\n                      aria-label=\"Analyze keywords for this page\"\r\n                    \u003e\r\n                      \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003esearch\u003c/span\u003e\r\n                      Analyze Keywords\r\n                    \u003c/button\u003e\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n            ` : ''}\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a single page row\r\n */\r\nfunction renderPageRow(page: PageData, compact: boolean = false, filterType: string = 'all'): string {\r\n  const badges = getStatusBadges(page);\r\n  const hasIssues = badges.length \u003e 0;\r\n  const statusClass = hasIssues ? 'page-list-status--warning' : 'page-list-status--good';\r\n\r\n  const badgesHtml = badges.length \u003e 0\r\n    ? `\u003cdiv class=\"page-list-badges\"\u003e${badges.map(b =\u003e `\u003cspan class=\"page-list-badge ${b.class}\"\u003e${b.text}\u003c/span\u003e`).join('')}\u003c/div\u003e`\r\n    : '';\r\n\r\n  // Special rendering for broken links filter\r\n  if (filterType === 'broken-links' \u0026\u0026 page.hasBrokenLinks \u0026\u0026 page.brokenLinkUrls \u0026\u0026 page.brokenLinkUrls.length \u003e 0) {\r\n    const brokenLinksHtml = compact \r\n      ? page.brokenLinkUrls.slice(0, 2).map(url =\u003e \r\n          `\u003cdiv class=\"page-list-broken-item\"\u003e\r\n            \u003ccode class=\"page-list-broken-item__url\"\u003e${escapeHtml(truncate(url, 40))}\u003c/code\u003e\r\n          \u003c/div\u003e`\r\n        ).join('')\r\n      : page.brokenLinkUrls.map(url =\u003e \r\n          `\u003cdiv class=\"page-list-broken-item\"\u003e\r\n            \u003ccode class=\"page-list-broken-item__url\"\u003e${escapeHtml(url)}\u003c/code\u003e\r\n          \u003c/div\u003e`\r\n        ).join('');\r\n    \r\n    const moreCount = compact \u0026\u0026 page.brokenLinkUrls.length \u003e 2 ? `+${page.brokenLinkUrls.length - 2} more` : '';\r\n    const countHtml = !compact ? `\u003cdiv class=\"page-list-broken-count\"\u003e${page.brokenLinks} broken link${page.brokenLinks !== 1 ? 's' : ''}\u003c/div\u003e` : (moreCount ? `\u003cdiv class=\"page-list-broken-count\"\u003e${moreCount}\u003c/div\u003e` : '');\r\n    \r\n    const actionsHtml = isLocalhost() ? `\r\n      \u003cdiv class=\"page-list-actions\"\u003e\r\n        \u003cbutton \r\n          class=\"page-list-action-button page-list-action-button--fix\" \r\n          data-action=\"fix-links\"\r\n          data-page-url=\"${escapeHtml(page.relPermalink)}\"\r\n          data-broken-links='${escapeHtml(JSON.stringify(page.brokenLinkUrls))}'\r\n          aria-label=\"Fix broken links on this page\"\r\n          title=\"Fix broken links\"\r\n          type=\"button\"\r\n        \u003e\r\n          \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n          ${!compact ? '\u003cspan\u003eFix Links\u003c/span\u003e' : ''}\r\n        \u003c/button\u003e\r\n      \u003c/div\u003e\r\n    ` : '\u003cdiv class=\"page-list-actions\"\u003e\u003cspan class=\"text-muted\"\u003eView details to fix\u003c/span\u003e\u003c/div\u003e';\r\n    \r\n    const scoresHtml = `\r\n      \u003cdiv class=\"page-list-row-scores\"\u003e\r\n        ${renderScore(page.seoScore, 'SEO')}\r\n        ${renderScore(page.aiCrawlabilityScore, 'AI')}\r\n        ${!compact \u0026\u0026 page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? renderScore(page.accessibilityScore, 'A11y') : ''}\r\n      \u003c/div\u003e\r\n    `;\r\n\r\n    return `\r\n      \u003ctr class=\"${statusClass} page-list-row\" data-page-url=\"${page.relPermalink}\"\u003e\r\n        \u003ctd\u003e\r\n          \u003cdiv class=\"page-list-title-cell\"\u003e\r\n            \u003cstrong\u003e${escapeHtml(page.title)}\u003c/strong\u003e\r\n            ${badgesHtml}\r\n          \u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Broken Links\"\u003e\r\n          \u003cdiv class=\"page-list-broken-items\"\u003e\r\n            ${brokenLinksHtml}\r\n            ${countHtml}\r\n          \u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Actions\"\u003e\r\n          ${actionsHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Scores\"\u003e\r\n          ${scoresHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"${compact ? 'Link' : 'Page Link'}\"\u003e\r\n          \u003ca href=\"${page.relPermalink}\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\r\n            ${compact ? 'View →' : page.relPermalink}\r\n          \u003c/a\u003e\r\n        \u003c/td\u003e\r\n      \u003c/tr\u003e\r\n    `;\r\n  }\r\n\r\n  // Special rendering for broken images filter\r\n  if (filterType === 'broken-images' \u0026\u0026 page.hasBrokenImages \u0026\u0026 page.brokenImageUrls \u0026\u0026 page.brokenImageUrls.length \u003e 0) {\r\n    const brokenImagesHtml = compact \r\n      ? page.brokenImageUrls.slice(0, 2).map(url =\u003e \r\n          `\u003cdiv class=\"page-list-broken-item\"\u003e\r\n            \u003ccode class=\"page-list-broken-item__url\"\u003e${escapeHtml(truncate(url, 40))}\u003c/code\u003e\r\n          \u003c/div\u003e`\r\n        ).join('')\r\n      : page.brokenImageUrls.map(url =\u003e \r\n          `\u003cdiv class=\"page-list-broken-item\"\u003e\r\n            \u003ccode class=\"page-list-broken-item__url\"\u003e${escapeHtml(url)}\u003c/code\u003e\r\n          \u003c/div\u003e`\r\n        ).join('');\r\n    \r\n    const moreCount = compact \u0026\u0026 page.brokenImageUrls.length \u003e 2 ? `+${page.brokenImageUrls.length - 2} more` : '';\r\n    const countHtml = !compact ? `\u003cdiv class=\"page-list-broken-count\"\u003e${page.brokenImages} broken image${page.brokenImages !== 1 ? 's' : ''}\u003c/div\u003e` : (moreCount ? `\u003cdiv class=\"page-list-broken-count\"\u003e${moreCount}\u003c/div\u003e` : '');\r\n    \r\n    const actionsHtml = isLocalhost() ? `\r\n      \u003cdiv class=\"page-list-actions\"\u003e\r\n        \u003cbutton \r\n          class=\"page-list-action-button page-list-action-button--fix\" \r\n          data-action=\"fix-images\"\r\n          data-page-url=\"${escapeHtml(page.relPermalink)}\"\r\n          data-broken-images='${escapeHtml(JSON.stringify(page.brokenImageUrls))}'\r\n          aria-label=\"Fix broken images on this page\"\r\n          title=\"Fix broken images\"\r\n          type=\"button\"\r\n        \u003e\r\n          \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n          ${!compact ? '\u003cspan\u003eFix Images\u003c/span\u003e' : ''}\r\n        \u003c/button\u003e\r\n      \u003c/div\u003e\r\n    ` : '\u003cdiv class=\"page-list-actions\"\u003e\u003cspan class=\"text-muted\"\u003eView details to fix\u003c/span\u003e\u003c/div\u003e';\r\n    \r\n    const scoresHtml = `\r\n      \u003cdiv class=\"page-list-row-scores\"\u003e\r\n        ${renderScore(page.seoScore, 'SEO')}\r\n        ${renderScore(page.aiCrawlabilityScore, 'AI')}\r\n        ${!compact \u0026\u0026 page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? renderScore(page.accessibilityScore, 'A11y') : ''}\r\n      \u003c/div\u003e\r\n    `;\r\n\r\n    return `\r\n      \u003ctr class=\"${statusClass} page-list-row\" data-page-url=\"${page.relPermalink}\"\u003e\r\n        \u003ctd\u003e\r\n          \u003cdiv class=\"page-list-title-cell\"\u003e\r\n            \u003cstrong\u003e${escapeHtml(page.title)}\u003c/strong\u003e\r\n            ${badgesHtml}\r\n          \u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Broken Images\"\u003e\r\n          \u003cdiv class=\"page-list-broken-items\"\u003e\r\n            ${brokenImagesHtml}\r\n            ${countHtml}\r\n          \u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Actions\"\u003e\r\n          ${actionsHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Scores\"\u003e\r\n          ${scoresHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"${compact ? 'Link' : 'Page Link'}\"\u003e\r\n          \u003ca href=\"${page.relPermalink}\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\r\n            ${compact ? 'View →' : page.relPermalink}\r\n          \u003c/a\u003e\r\n        \u003c/td\u003e\r\n      \u003c/tr\u003e\r\n    `;\r\n  }\r\n\r\n  if (compact) {\r\n    // Compact layout: simplified view\r\n    const scoresHtml = `\r\n      \u003cdiv class=\"page-list-row-scores\"\u003e\r\n        ${renderScore(page.seoScore, 'SEO')}\r\n        ${renderScore(page.aiCrawlabilityScore, 'AI')}\r\n        ${page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? renderScore(page.accessibilityScore, 'A11y') : ''}\r\n      \u003c/div\u003e\r\n    `;\r\n\r\n    const metaDescHtml = page.hasMetaDescription\r\n      ? `\u003cspan class=\"${page.descriptionOverLimit || page.descriptionOverPixels ? 'text-warning' : ''}\"\u003e${escapeHtml(truncate(page.metaDescription, 80))}\u003c/span\u003e`\r\n      : '\u003cspan class=\"text-error\"\u003eMissing\u003c/span\u003e';\r\n\r\n    return `\r\n      \u003ctr class=\"${statusClass} page-list-row\" data-page-url=\"${page.relPermalink}\"\u003e\r\n        \u003ctd\u003e\r\n          \u003cdiv class=\"page-list-title-cell\"\u003e\r\n            \u003cstrong\u003e${escapeHtml(page.title)}\u003c/strong\u003e\r\n            ${badgesHtml}\r\n          \u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Meta Title\"\u003e\r\n          ${page.hasMetaTitle ? `\u003cspan class=\"${page.titleOverLimit || page.titleOverPixels ? 'text-warning' : ''}\"\u003e${escapeHtml(truncate(page.metaTitle, 50))}\u003c/span\u003e` : '\u003cspan class=\"text-error\"\u003eMissing\u003c/span\u003e'}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Meta Description\"\u003e\r\n          ${metaDescHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Scores\"\u003e\r\n          ${scoresHtml}\r\n        \u003c/td\u003e\r\n        \u003ctd data-label=\"Link\"\u003e\r\n          \u003ca href=\"${page.relPermalink}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"page-list-link-compact\"\u003e\r\n            View →\r\n          \u003c/a\u003e\r\n        \u003c/td\u003e\r\n      \u003c/tr\u003e\r\n    `;\r\n  }\r\n\r\n  // Normal layout: full details\r\n  const metaTitleHtml = page.hasMetaTitle\r\n    ? `\u003cdiv class=\"page-list-meta-content-wrapper\"\u003e\r\n         \u003cdiv class=\"page-list-meta-content\"\u003e${escapeHtml(page.metaTitle)}\u003c/div\u003e\r\n         \u003cdiv class=\"page-list-meta-metrics\"\u003e\r\n           \u003cdiv class=\"page-list-meta-metric ${page.titleOverLimit || page.titleOverPixels ? 'metric--warning' : 'metric--good'}\"\u003e\r\n             \u003cspan class=\"page-list-meta-metric__icon\"\u003e${page.titleOverLimit || page.titleOverPixels ? '⚠️' : '✓'}\u003c/span\u003e\r\n             \u003cdiv class=\"page-list-meta-metric__info\"\u003e\r\n               \u003cspan class=\"page-list-meta-metric__label\"\u003eCharacters\u003c/span\u003e\r\n               \u003cspan class=\"page-list-meta-metric__value ${page.titleOverLimit ? 'value--over' : ''}\"\u003e${page.metaTitleLength}/${TITLE_LIMIT}\u003c/span\u003e\r\n             \u003c/div\u003e\r\n           \u003c/div\u003e\r\n           \u003cdiv class=\"page-list-meta-metric ${page.titleOverPixels ? 'metric--warning' : 'metric--good'}\"\u003e\r\n             \u003cspan class=\"page-list-meta-metric__icon\"\u003e${page.titleOverPixels ? '⚠️' : '✓'}\u003c/span\u003e\r\n             \u003cdiv class=\"page-list-meta-metric__info\"\u003e\r\n               \u003cspan class=\"page-list-meta-metric__label\"\u003ePixels\u003c/span\u003e\r\n               \u003cspan class=\"page-list-meta-metric__value ${page.titleOverPixels ? 'value--over' : ''}\"\u003e${Math.round(page.titlePixels)}/${TITLE_PIXEL_LIMIT_DESKTOP}\u003c/span\u003e\r\n             \u003c/div\u003e\r\n           \u003c/div\u003e\r\n         \u003c/div\u003e\r\n       \u003c/div\u003e`\r\n    : `\u003cdiv class=\"page-list-meta-missing\"\u003e\r\n         \u003cspan class=\"page-list-meta-missing__icon\"\u003e✗\u003c/span\u003e\r\n         \u003cspan class=\"page-list-meta-missing__text\"\u003eMissing Meta Title\u003c/span\u003e\r\n       \u003c/div\u003e`;\r\n\r\n  const metaDescHtml = page.hasMetaDescription\r\n    ? `\u003cdiv class=\"page-list-meta-content-wrapper\"\u003e\r\n         \u003cdiv class=\"page-list-meta-content\"\u003e${escapeHtml(truncate(page.metaDescription, 150))}\u003c/div\u003e\r\n         \u003cdiv class=\"page-list-meta-metrics\"\u003e\r\n           \u003cdiv class=\"page-list-meta-metric ${page.descriptionOverLimit || page.descriptionOverPixels ? 'metric--warning' : 'metric--good'}\"\u003e\r\n             \u003cspan class=\"page-list-meta-metric__icon\"\u003e${page.descriptionOverLimit || page.descriptionOverPixels ? '⚠️' : '✓'}\u003c/span\u003e\r\n             \u003cdiv class=\"page-list-meta-metric__info\"\u003e\r\n               \u003cspan class=\"page-list-meta-metric__label\"\u003eCharacters\u003c/span\u003e\r\n               \u003cspan class=\"page-list-meta-metric__value ${page.descriptionOverLimit ? 'value--over' : ''}\"\u003e${page.metaDescriptionLength}/${DESC_LIMIT}\u003c/span\u003e\r\n             \u003c/div\u003e\r\n           \u003c/div\u003e\r\n           \u003cdiv class=\"page-list-meta-metric ${page.descriptionOverPixels ? 'metric--warning' : 'metric--good'}\"\u003e\r\n             \u003cspan class=\"page-list-meta-metric__icon\"\u003e${page.descriptionOverPixels ? '⚠️' : '✓'}\u003c/span\u003e\r\n             \u003cdiv class=\"page-list-meta-metric__info\"\u003e\r\n               \u003cspan class=\"page-list-meta-metric__label\"\u003ePixels\u003c/span\u003e\r\n               \u003cspan class=\"page-list-meta-metric__value ${page.descriptionOverPixels ? 'value--over' : ''}\"\u003e${Math.round(page.descriptionPixels)}/${DESC_PIXEL_LIMIT_DESKTOP}\u003c/span\u003e\r\n             \u003c/div\u003e\r\n           \u003c/div\u003e\r\n         \u003c/div\u003e\r\n       \u003c/div\u003e`\r\n    : `\u003cdiv class=\"page-list-meta-missing\"\u003e\r\n         \u003cspan class=\"page-list-meta-missing__icon\"\u003e✗\u003c/span\u003e\r\n         \u003cspan class=\"page-list-meta-missing__text\"\u003eMissing Meta Description\u003c/span\u003e\r\n       \u003c/div\u003e`;\r\n\r\n  const summaryHtml = page.summary\r\n    ? escapeHtml(truncate(page.summary, 200))\r\n    : '\u003cem\u003eNo summary available\u003c/em\u003e';\r\n\r\n  const scoresHtml = `\r\n    \u003cdiv class=\"page-list-row-scores\"\u003e\r\n      ${renderScore(page.seoScore, 'SEO')}\r\n      ${renderScore(page.aiCrawlabilityScore, 'AI')}\r\n      ${page.accessibilityScore !== undefined \u0026\u0026 page.accessibilityScore !== null ? renderScore(page.accessibilityScore, 'A11y') : ''}\r\n    \u003c/div\u003e\r\n  `;\r\n\r\n  return `\r\n    \u003ctr class=\"${statusClass} page-list-row\" data-page-url=\"${page.relPermalink}\"\u003e\r\n      \u003ctd\u003e\r\n        \u003cdiv class=\"page-list-title-cell\"\u003e\r\n          \u003cstrong\u003e${escapeHtml(page.title)}\u003c/strong\u003e\r\n          ${badgesHtml}\r\n        \u003c/div\u003e\r\n      \u003c/td\u003e\r\n      \u003ctd data-label=\"Meta Title\"\u003e\r\n        \u003cdiv class=\"page-list-meta-field ${page.titleOverLimit ? 'page-list-meta-field--over-limit' : ''}\"\u003e\r\n          ${metaTitleHtml}\r\n        \u003c/div\u003e\r\n      \u003c/td\u003e\r\n      \u003ctd data-label=\"Meta Description\"\u003e\r\n        \u003cdiv class=\"page-list-meta-field ${page.descriptionOverLimit ? 'page-list-meta-field--over-limit' : ''}\"\u003e\r\n          ${metaDescHtml}\r\n        \u003c/div\u003e\r\n      \u003c/td\u003e\r\n      \u003ctd data-label=\"Summary\"\u003e\r\n        \u003cdiv class=\"page-list-summary-content\"\u003e\r\n          ${summaryHtml}\r\n        \u003c/div\u003e\r\n      \u003c/td\u003e\r\n      \u003ctd data-label=\"Scores\"\u003e\r\n        ${scoresHtml}\r\n      \u003c/td\u003e\r\n      \u003ctd data-label=\"Page Link\"\u003e\r\n        \u003ca href=\"${page.relPermalink}\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\r\n          ${page.relPermalink}\r\n        \u003c/a\u003e\r\n      \u003c/td\u003e\r\n    \u003c/tr\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Sort pages based on sort type and direction\r\n */\r\nfunction sortPages(pages: PageData[], sortType: string, sortDirection: 'asc' | 'desc'): PageData[] {\r\n  const sorted = [...pages];\r\n  \r\n  switch (sortType) {\r\n    case 'seo':\r\n      sorted.sort((a, b) =\u003e {\r\n        const diff = a.seoScore - b.seoScore;\r\n        return sortDirection === 'asc' ? diff : -diff;\r\n      });\r\n      break;\r\n    case 'ai':\r\n      sorted.sort((a, b) =\u003e {\r\n        const diff = a.aiCrawlabilityScore - b.aiCrawlabilityScore;\r\n        return sortDirection === 'asc' ? diff : -diff;\r\n      });\r\n      break;\r\n    case 'title':\r\n      sorted.sort((a, b) =\u003e {\r\n        const diff = a.title.localeCompare(b.title);\r\n        return sortDirection === 'asc' ? diff : -diff;\r\n      });\r\n      break;\r\n    case 'accessibility':\r\n      sorted.sort((a, b) =\u003e {\r\n        const scoreA = a.accessibilityScore ?? 0;\r\n        const scoreB = b.accessibilityScore ?? 0;\r\n        const diff = scoreA - scoreB;\r\n        return sortDirection === 'asc' ? diff : -diff;\r\n      });\r\n      break;\r\n    default:\r\n      // Default: sort by title ascending\r\n      sorted.sort((a, b) =\u003e a.title.localeCompare(b.title));\r\n  }\r\n  \r\n  return sorted;\r\n}\r\n\r\n/**\r\n * Group pages by section\r\n */\r\nfunction groupPagesBySection(pages: PageData[], sortType: string = 'title', sortDirection: 'asc' | 'desc' = 'asc'): Map\u003cstring, PageData[]\u003e {\r\n  const groups = new Map\u003cstring, PageData[]\u003e();\r\n\r\n  pages.forEach(page =\u003e {\r\n    const section = page.section || 'root';\r\n    if (!groups.has(section)) {\r\n      groups.set(section, []);\r\n    }\r\n    groups.get(section)!.push(page);\r\n  });\r\n\r\n  // Sort pages within each group\r\n  groups.forEach((groupPages) =\u003e {\r\n    const sorted = sortPages(groupPages, sortType, sortDirection);\r\n    groupPages.length = 0;\r\n    groupPages.push(...sorted);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Get column headers based on active filter\r\n */\r\nfunction getTableHeaders(filterType: string, compact: boolean = false): string {\r\n  const getHeaderLabel = (defaultLabel: string, filterType: string): string =\u003e {\r\n    const filterLabels: Record\u003cstring, Record\u003cstring, string\u003e\u003e = {\r\n      'missing-title': { 'Meta Title': 'Missing Title' },\r\n      'missing-description': { 'Meta Description': 'Missing Description' },\r\n      'missing-meta': { 'Meta Title': 'Missing Title', 'Meta Description': 'Missing Description' },\r\n      'title-over-limit': { 'Meta Title': 'Title Issues' },\r\n      'description-over-limit': { 'Meta Description': 'Description Issues' },\r\n      'meta-issues': { 'Meta Title': 'Title Issues', 'Meta Description': 'Description Issues' },\r\n      'pixel-issues': { 'Meta Title': 'Pixel Issues', 'Meta Description': 'Pixel Issues' },\r\n      'broken-links': { 'Page Title': 'Pages with Broken Links' },\r\n      'broken-images': { 'Page Title': 'Pages with Broken Images' },\r\n      'images-no-alt': { 'Page Title': 'Pages w/o Alt Text' },\r\n      'heading-structure': { 'Page Title': 'Heading Issues' },\r\n      'no-schema': { 'Page Title': 'Missing Schema' },\r\n      'low-word-count': { 'Summary': 'Low Word Count' },\r\n      'no-citations': { 'Page Title': 'No Citations' },\r\n      'no-author': { 'Page Title': 'No Author' },\r\n      'stale-content': { 'Page Title': 'Stale Content' },\r\n      'excerpt-too-short': { 'Summary': 'Excerpt Too Short' },\r\n      'excerpt-too-long': { 'Summary': 'Excerpt Too Long' },\r\n      'with-issues': { 'Page Title': 'Pages with Issues' },\r\n      'good': { 'Page Title': 'Good Pages' }\r\n    };\r\n    \r\n    return filterLabels[filterType]?.[defaultLabel] || defaultLabel;\r\n  };\r\n\r\n  // Special handling for broken links and images - show relevant columns\r\n  if (filterType === 'broken-links') {\r\n    if (compact) {\r\n      return `\u003ctr\u003e\u003cth\u003ePage Title\u003c/th\u003e\u003cth\u003eBroken Links\u003c/th\u003e\u003cth\u003eActions\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003eLink\u003c/th\u003e\u003c/tr\u003e`;\r\n    } else {\r\n      return `\u003ctr\u003e\u003cth\u003ePage Title\u003c/th\u003e\u003cth\u003eBroken Links\u003c/th\u003e\u003cth\u003eActions\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003ePage Link\u003c/th\u003e\u003c/tr\u003e`;\r\n    }\r\n  }\r\n  \r\n  if (filterType === 'broken-images') {\r\n    if (compact) {\r\n      return `\u003ctr\u003e\u003cth\u003ePage Title\u003c/th\u003e\u003cth\u003eBroken Images\u003c/th\u003e\u003cth\u003eActions\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003eLink\u003c/th\u003e\u003c/tr\u003e`;\r\n    } else {\r\n      return `\u003ctr\u003e\u003cth\u003ePage Title\u003c/th\u003e\u003cth\u003eBroken Images\u003c/th\u003e\u003cth\u003eActions\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003ePage Link\u003c/th\u003e\u003c/tr\u003e`;\r\n    }\r\n  }\r\n\r\n  if (compact) {\r\n    const title = getHeaderLabel('Page Title', filterType);\r\n    const metaTitle = getHeaderLabel('Meta Title', filterType);\r\n    const metaDesc = getHeaderLabel('Meta Description', filterType);\r\n    return `\u003ctr\u003e\u003cth\u003e${title}\u003c/th\u003e\u003cth\u003e${metaTitle}\u003c/th\u003e\u003cth\u003e${metaDesc}\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003eLink\u003c/th\u003e\u003c/tr\u003e`;\r\n  } else {\r\n    const title = getHeaderLabel('Page Title', filterType);\r\n    const metaTitle = getHeaderLabel('Meta Title', filterType);\r\n    const metaDesc = getHeaderLabel('Meta Description', filterType);\r\n    const summary = getHeaderLabel('Summary', filterType);\r\n    return `\u003ctr\u003e\u003cth\u003e${title}\u003c/th\u003e\u003cth\u003e${metaTitle}\u003c/th\u003e\u003cth\u003e${metaDesc}\u003c/th\u003e\u003cth\u003e${summary}\u003c/th\u003e\u003cth\u003eScores\u003c/th\u003e\u003cth\u003ePage Link\u003c/th\u003e\u003c/tr\u003e`;\r\n  }\r\n}\r\n\r\n/**\r\n * Render ungrouped pages (all in one list)\r\n */\r\nfunction renderUngroupedPages(pages: PageData[], compact: boolean = false, sortType: string = 'title', sortDirection: 'asc' | 'desc' = 'asc', filterType: string = 'all'): string {\r\n  const tableHeaders = getTableHeaders(filterType, compact);\r\n\r\n  // Sort pages based on sort type and direction\r\n  const sortedPages = sortPages(pages, sortType, sortDirection);\r\n\r\n  return `\r\n    \u003cdiv class=\"page-list-group\"\u003e\r\n      \u003ctable class=\"page-list-table\"\u003e\r\n        \u003cthead\u003e\r\n          ${tableHeaders}\r\n        \u003c/thead\u003e\r\n        \u003ctbody\u003e\r\n          ${sortedPages.map(p =\u003e renderPageRow(p, compact, filterType)).join('')}\r\n        \u003c/tbody\u003e\r\n      \u003c/table\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * ============================================================================\r\n * COMPREHENSIVE SCHEMA.ORG VALIDATION SYSTEM\r\n * ============================================================================\r\n * \r\n * Architecture Overview:\r\n * \r\n * 1. PARSING LAYER\r\n *    - extractAllSchemasFromHTML(): Main entry point, extracts all formats\r\n *    - extractJSONLDSchemas(): Parses JSON-LD script tags\r\n *    - extractMicrodataSchemas(): Parses Microdata attributes\r\n *    - extractRDFaSchemas(): Parses RDFa attributes\r\n * \r\n * 2. VALIDATION LAYER\r\n *    - validateAllSchemas(): Orchestrates validation for all schemas\r\n *    - validateSchema(): Core validation logic\r\n *    - validateSyntax(): JSON/HTML syntax validation\r\n *    - validateStructure(): Structure and format validation\r\n *    - validateTypes(): Type hierarchy and appropriateness\r\n *    - validateProperties(): Required/recommended property checks\r\n *    - validateDataTypes(): Data type validation (URLs, dates, numbers)\r\n *    - validateContentAccuracy(): Cross-check with visible page content\r\n *    - validateBestPractices(): Best practices and optimization checks\r\n * \r\n * 3. SCORING LAYER\r\n *    - calculateSchemaScore(): Comprehensive scoring with breakdown\r\n * \r\n * 4. RECOMMENDATION LAYER\r\n *    - generateRecommendations(): Actionable improvement suggestions\r\n * \r\n * ============================================================================\r\n */\r\n\r\n/**\r\n * Schema.org Type Hierarchy and Property Definitions\r\n */\r\nconst SCHEMA_TYPE_DEFINITIONS: Record\u003cstring, SchemaTypeInfo\u003e = {\r\n  'Thing': {\r\n    type: 'Thing',\r\n    required: [],\r\n    recommended: ['name', 'description', 'url', 'image'],\r\n    properties: {},\r\n    isGeneric: true,\r\n    alternatives: []\r\n  },\r\n  'LocalBusiness': {\r\n    type: 'LocalBusiness',\r\n    parent: 'Organization',\r\n    required: ['name'],\r\n    recommended: ['address', 'telephone', 'priceRange', 'image', 'openingHours', 'geo'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'address': { name: 'address', required: false, recommended: true, dataType: 'PostalAddress' },\r\n      'telephone': { name: 'telephone', required: false, recommended: true, dataType: 'Text' },\r\n      'priceRange': { name: 'priceRange', required: false, recommended: true, dataType: 'Text' },\r\n      'image': { name: 'image', required: false, recommended: true, dataType: 'URL' },\r\n      'openingHours': { name: 'openingHours', required: false, recommended: true, dataType: 'Text' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: ['Organization', 'Place']\r\n  },\r\n  'Organization': {\r\n    type: 'Organization',\r\n    parent: 'Thing',\r\n    required: ['name'],\r\n    recommended: ['url', 'logo', 'sameAs', 'contactPoint'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'url': { name: 'url', required: false, recommended: true, dataType: 'URL' },\r\n      'logo': { name: 'logo', required: false, recommended: true, dataType: 'ImageObject' },\r\n      'sameAs': { name: 'sameAs', required: false, recommended: true, dataType: 'URL' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: ['LocalBusiness', 'Corporation']\r\n  },\r\n  'Article': {\r\n    type: 'Article',\r\n    parent: 'CreativeWork',\r\n    required: ['headline'],\r\n    recommended: ['datePublished', 'dateModified', 'author', 'publisher', 'image', 'description'],\r\n    properties: {\r\n      'headline': { name: 'headline', required: true, recommended: true, dataType: 'Text' },\r\n      'datePublished': { name: 'datePublished', required: false, recommended: true, dataType: 'Date' },\r\n      'dateModified': { name: 'dateModified', required: false, recommended: true, dataType: 'Date' },\r\n      'author': { name: 'author', required: false, recommended: true, dataType: 'Person' },\r\n      'publisher': { name: 'publisher', required: false, recommended: true, dataType: 'Organization' },\r\n      'image': { name: 'image', required: false, recommended: true, dataType: 'ImageObject' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: ['NewsArticle', 'BlogPosting', 'ScholarlyArticle']\r\n  },\r\n  'WebPage': {\r\n    type: 'WebPage',\r\n    parent: 'CreativeWork',\r\n    required: ['name'],\r\n    recommended: ['description', 'url', 'breadcrumb', 'mainEntity'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'description': { name: 'description', required: false, recommended: true, dataType: 'Text' },\r\n      'url': { name: 'url', required: false, recommended: true, dataType: 'URL' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: ['AboutPage', 'ContactPage', 'FAQPage']\r\n  },\r\n  'Product': {\r\n    type: 'Product',\r\n    parent: 'Thing',\r\n    required: ['name'],\r\n    recommended: ['image', 'description', 'brand', 'offers', 'aggregateRating'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'image': { name: 'image', required: false, recommended: true, dataType: 'ImageObject' },\r\n      'description': { name: 'description', required: false, recommended: true, dataType: 'Text' },\r\n      'brand': { name: 'brand', required: false, recommended: true, dataType: 'Brand' },\r\n      'offers': { name: 'offers', required: false, recommended: true, dataType: 'Offer' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  },\r\n  'Service': {\r\n    type: 'Service',\r\n    parent: 'Thing',\r\n    required: ['name', 'serviceType'],\r\n    recommended: ['description', 'provider', 'areaServed', 'offers'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'serviceType': { name: 'serviceType', required: true, recommended: true, dataType: 'Text' },\r\n      'description': { name: 'description', required: false, recommended: true, dataType: 'Text' },\r\n      'provider': { name: 'provider', required: false, recommended: true, dataType: 'Organization' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  },\r\n  'Person': {\r\n    type: 'Person',\r\n    parent: 'Thing',\r\n    required: ['name'],\r\n    recommended: ['email', 'jobTitle', 'image', 'sameAs'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'email': { name: 'email', required: false, recommended: true, dataType: 'Text' },\r\n      'jobTitle': { name: 'jobTitle', required: false, recommended: true, dataType: 'Text' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  },\r\n  'Event': {\r\n    type: 'Event',\r\n    parent: 'Thing',\r\n    required: ['name', 'startDate'],\r\n    recommended: ['endDate', 'location', 'description', 'image'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'startDate': { name: 'startDate', required: true, recommended: true, dataType: 'DateTime' },\r\n      'endDate': { name: 'endDate', required: false, recommended: true, dataType: 'DateTime' },\r\n      'location': { name: 'location', required: false, recommended: true, dataType: 'Place' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: ['BusinessEvent', 'SportsEvent']\r\n  },\r\n  'FAQPage': {\r\n    type: 'FAQPage',\r\n    parent: 'WebPage',\r\n    required: [],\r\n    recommended: ['mainEntity'],\r\n    properties: {\r\n      'mainEntity': { name: 'mainEntity', required: false, recommended: true, dataType: 'Question' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  },\r\n  'Recipe': {\r\n    type: 'Recipe',\r\n    parent: 'CreativeWork',\r\n    required: ['name'],\r\n    recommended: ['image', 'recipeIngredient', 'recipeInstructions', 'prepTime', 'cookTime', 'totalTime'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'image': { name: 'image', required: false, recommended: true, dataType: 'ImageObject' },\r\n      'recipeIngredient': { name: 'recipeIngredient', required: false, recommended: true, dataType: 'Text' },\r\n      'recipeInstructions': { name: 'recipeInstructions', required: false, recommended: true, dataType: 'HowToStep' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  },\r\n  'VideoObject': {\r\n    type: 'VideoObject',\r\n    parent: 'MediaObject',\r\n    required: ['name'],\r\n    recommended: ['thumbnailUrl', 'uploadDate', 'duration', 'description', 'contentUrl'],\r\n    properties: {\r\n      'name': { name: 'name', required: true, recommended: true, dataType: 'Text' },\r\n      'thumbnailUrl': { name: 'thumbnailUrl', required: false, recommended: true, dataType: 'URL' },\r\n      'uploadDate': { name: 'uploadDate', required: false, recommended: true, dataType: 'Date' },\r\n      'duration': { name: 'duration', required: false, recommended: true, dataType: 'Duration' }\r\n    },\r\n    isGeneric: false,\r\n    alternatives: []\r\n  }\r\n};\r\n\r\n/**\r\n * Extract all schemas from HTML (JSON-LD, Microdata, RDFa)\r\n */\r\nfunction extractAllSchemasFromHTML(html: string): Array\u003c{ \r\n  type: string; \r\n  format: 'json-ld' | 'microdata' | 'rdfa';\r\n  data: any; \r\n  raw: string;\r\n  index: number;\r\n}\u003e {\r\n  const schemas: Array\u003c{ type: string; format: 'json-ld' | 'microdata' | 'rdfa'; data: any; raw: string; index: number }\u003e = [];\r\n  let index = 0;\r\n  \r\n  // Extract JSON-LD\r\n  const jsonLdSchemas = extractJSONLDSchemas(html);\r\n  jsonLdSchemas.forEach(schema =\u003e {\r\n    schemas.push({ ...schema, format: 'json-ld', index: index++ });\r\n  });\r\n  \r\n  // Extract Microdata\r\n  const microdataSchemas = extractMicrodataSchemas(html);\r\n  microdataSchemas.forEach(schema =\u003e {\r\n    schemas.push({ ...schema, format: 'microdata', index: index++ });\r\n  });\r\n  \r\n  // Extract RDFa\r\n  const rdfaSchemas = extractRDFaSchemas(html);\r\n  rdfaSchemas.forEach(schema =\u003e {\r\n    schemas.push({ ...schema, format: 'rdfa', index: index++ });\r\n  });\r\n  \r\n  return schemas;\r\n}\r\n\r\n/**\r\n * Extract JSON-LD schema from HTML content\r\n */\r\nfunction extractJSONLDSchemas(html: string): Array\u003c{ type: string; data: any; raw: string }\u003e {\r\n  const schemas: Array\u003c{ type: string; data: any; raw: string }\u003e = [];\r\n  \r\n  // Match all JSON-LD script tags\r\n  const jsonLdRegex = /\u003cscript[^\u003e]*type=[\"']application\\/ld\\+json[\"'][^\u003e]*\u003e(.*?)\u003c\\/script\u003e/gis;\r\n  let match;\r\n  \r\n  while ((match = jsonLdRegex.exec(html)) !== null) {\r\n    try {\r\n      const jsonContent = match[1].trim();\r\n      const parsed = JSON.parse(jsonContent);\r\n      \r\n      // Handle both single objects and arrays\r\n      const items = Array.isArray(parsed) ? parsed : [parsed];\r\n      \r\n      items.forEach((item: any) =\u003e {\r\n        if (item \u0026\u0026 typeof item === 'object') {\r\n          if (item['@type']) {\r\n            schemas.push({\r\n              type: item['@type'],\r\n              data: item,\r\n              raw: jsonContent\r\n            });\r\n          } else if (item['@context']) {\r\n            // Handle top-level objects with @context (Graph format)\r\n            if (item['@graph'] \u0026\u0026 Array.isArray(item['@graph'])) {\r\n              item['@graph'].forEach((graphItem: any) =\u003e {\r\n                if (graphItem['@type']) {\r\n                  schemas.push({\r\n                    type: graphItem['@type'],\r\n                    data: graphItem,\r\n                    raw: jsonContent\r\n                  });\r\n                }\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    } catch (error) {\r\n      devWarn('Failed to parse JSON-LD schema:', error);\r\n    }\r\n  }\r\n  \r\n  return schemas;\r\n}\r\n\r\n/**\r\n * Extract Microdata schema from HTML content\r\n */\r\nfunction extractMicrodataSchemas(html: string): Array\u003c{ type: string; data: any; raw: string }\u003e {\r\n  const schemas: Array\u003c{ type: string; data: any; raw: string }\u003e = [];\r\n  \r\n  try {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    \r\n    // Find all elements with itemscope\r\n    const itemScopeElements = doc.querySelectorAll('[itemscope]');\r\n    \r\n    itemScopeElements.forEach((element) =\u003e {\r\n      const itemType = element.getAttribute('itemtype');\r\n      if (!itemType) return;\r\n      \r\n      // Extract Schema.org type from URL (e.g., http://schema.org/Product -\u003e Product)\r\n      const typeMatch = itemType.match(/schema\\.org\\/([^\\/\\#]+)/i);\r\n      if (!typeMatch) return;\r\n      \r\n      const schemaType = typeMatch[1];\r\n      const schemaData: any = {\r\n        '@type': schemaType\r\n      };\r\n      \r\n      // Extract all itemprop attributes within this itemscope\r\n      const itemProps = element.querySelectorAll('[itemprop]');\r\n      itemProps.forEach((propElement) =\u003e {\r\n        const propName = propElement.getAttribute('itemprop');\r\n        if (!propName) return;\r\n        \r\n        // Get the value\r\n        let propValue: string | null = null;\r\n        if (propElement.hasAttribute('content')) {\r\n          propValue = propElement.getAttribute('content');\r\n        } else if (propElement.hasAttribute('href')) {\r\n          propValue = propElement.getAttribute('href');\r\n        } else if (propElement.hasAttribute('src')) {\r\n          propValue = propElement.getAttribute('src');\r\n        } else if (propElement.hasAttribute('datetime')) {\r\n          propValue = propElement.getAttribute('datetime');\r\n        } else {\r\n          propValue = propElement.textContent?.trim() || null;\r\n        }\r\n        \r\n        if (propValue !== null) {\r\n          // Handle nested itemscope\r\n          const nestedScope = propElement.querySelector('[itemscope]');\r\n          if (nestedScope) {\r\n            // Recursively extract nested schema (simplified)\r\n            schemaData[propName] = { '@type': nestedScope.getAttribute('itemtype')?.match(/schema\\.org\\/([^\\/\\#]+)/i)?.[1] || 'Thing' };\r\n          } else {\r\n            schemaData[propName] = propValue;\r\n          }\r\n        }\r\n      });\r\n      \r\n      schemas.push({\r\n        type: schemaType,\r\n        data: schemaData,\r\n        raw: element.outerHTML.substring(0, 500) // Store first 500 chars as raw\r\n      });\r\n    });\r\n  } catch (error) {\r\n    devWarn('Failed to parse Microdata:', error);\r\n  }\r\n  \r\n  return schemas;\r\n}\r\n\r\n/**\r\n * Extract RDFa schema from HTML content\r\n */\r\nfunction extractRDFaSchemas(html: string): Array\u003c{ type: string; data: any; raw: string }\u003e {\r\n  const schemas: Array\u003c{ type: string; data: any; raw: string }\u003e = [];\r\n  \r\n  try {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    \r\n    // Find all elements with typeof\r\n    const typeofElements = doc.querySelectorAll('[typeof]');\r\n    \r\n    typeofElements.forEach((element) =\u003e {\r\n      const typeofValue = element.getAttribute('typeof');\r\n      if (!typeofValue) return;\r\n      \r\n      // Extract Schema.org type (e.g., schema:Product -\u003e Product)\r\n      const typeMatch = typeofValue.match(/schema:([^\\s]+)/i) || typeofValue.match(/schema\\.org\\/([^\\/\\#\\s]+)/i);\r\n      if (!typeMatch) return;\r\n      \r\n      const schemaType = typeMatch[1];\r\n      const schemaData: any = {\r\n        '@type': schemaType\r\n      };\r\n      \r\n      // Extract all property attributes\r\n      const properties = element.querySelectorAll('[property]');\r\n      properties.forEach((propElement) =\u003e {\r\n        const propName = propElement.getAttribute('property');\r\n        if (!propName) return;\r\n        \r\n        // Clean property name (remove schema: prefix)\r\n        const cleanPropName = propName.replace(/^schema:/i, '').replace(/^http:\\/\\/schema\\.org\\//i, '');\r\n        \r\n        // Get the value\r\n        let propValue: string | null = null;\r\n        if (propElement.hasAttribute('content')) {\r\n          propValue = propElement.getAttribute('content');\r\n        } else if (propElement.hasAttribute('href')) {\r\n          propValue = propElement.getAttribute('href');\r\n        } else if (propElement.hasAttribute('src')) {\r\n          propValue = propElement.getAttribute('src');\r\n        } else {\r\n          propValue = propElement.textContent?.trim() || null;\r\n        }\r\n        \r\n        if (propValue !== null) {\r\n          schemaData[cleanPropName] = propValue;\r\n        }\r\n      });\r\n      \r\n      schemas.push({\r\n        type: schemaType,\r\n        data: schemaData,\r\n        raw: element.outerHTML.substring(0, 500) // Store first 500 chars as raw\r\n      });\r\n    });\r\n  } catch (error) {\r\n    devWarn('Failed to parse RDFa:', error);\r\n  }\r\n  \r\n  return schemas;\r\n}\r\n\r\n/**\r\n * Get Schema.org type definition\r\n */\r\nfunction getSchemaTypeInfo(type: string): SchemaTypeInfo | null {\r\n  return SCHEMA_TYPE_DEFINITIONS[type] || null;\r\n}\r\n\r\n/**\r\n * Check if a type is generic (like \"Thing\")\r\n */\r\nfunction isGenericType(type: string): boolean {\r\n  const typeInfo = getSchemaTypeInfo(type);\r\n  return typeInfo?.isGeneric || type === 'Thing';\r\n}\r\n\r\n/**\r\n * Validate JSON syntax\r\n */\r\nfunction validateJSONSyntax(jsonString: string): { valid: boolean; error?: SchemaValidationError } {\r\n  try {\r\n    JSON.parse(jsonString);\r\n    return { valid: true };\r\n  } catch (error) {\r\n    return {\r\n      valid: false,\r\n      error: {\r\n        type: 'error',\r\n        severity: 'critical',\r\n        message: `Invalid JSON syntax: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        code: 'INVALID_JSON'\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate data types (URLs, dates, numbers, booleans, enumerations)\r\n */\r\nfunction validateDataType(value: any, expectedType: string, propertyName: string): SchemaValidationError | null {\r\n  if (value === null || value === undefined) return null;\r\n  \r\n  switch (expectedType.toLowerCase()) {\r\n    case 'url':\r\n    case 'urlorlink':\r\n      if (typeof value === 'string') {\r\n        try {\r\n          const url = typeof value === 'object' \u0026\u0026 value['@id'] ? value['@id'] : value;\r\n          new URL(url);\r\n          // Check if it's absolute\r\n          if (!url.startsWith('http://') \u0026\u0026 !url.startsWith('https://') \u0026\u0026 !url.startsWith('/')) {\r\n            return {\r\n              type: 'warning',\r\n              severity: 'medium',\r\n              message: `Relative URL in \"${propertyName}\" - prefer absolute URLs for better compatibility`,\r\n              property: propertyName,\r\n              actual: url,\r\n              expected: 'Absolute URL (https://...)'\r\n            };\r\n          }\r\n        } catch {\r\n          return {\r\n            type: 'error',\r\n            severity: 'high',\r\n            message: `Invalid URL in property \"${propertyName}\": ${value}`,\r\n            property: propertyName,\r\n            actual: String(value),\r\n            expected: 'Valid URL'\r\n          };\r\n        }\r\n      }\r\n      break;\r\n      \r\n    case 'date':\r\n    case 'datetime':\r\n    case 'datepublished':\r\n    case 'datemodified':\r\n    case 'datecreated':\r\n    case 'startdate':\r\n    case 'enddate':\r\n    case 'dateposted':\r\n      if (typeof value === 'string') {\r\n        const date = new Date(value);\r\n        if (isNaN(date.getTime())) {\r\n          return {\r\n            type: 'error',\r\n            severity: 'high',\r\n            message: `Invalid date format in property \"${propertyName}\": ${value}`,\r\n            property: propertyName,\r\n            actual: value,\r\n            expected: 'ISO 8601 date format (YYYY-MM-DD or YYYY-MM-DDTHH:mm:ssZ)',\r\n            suggestion: 'Use ISO 8601 format, e.g., \"2024-01-15\" or \"2024-01-15T10:30:00Z\"'\r\n          };\r\n        }\r\n        // Check if date is in the future (for published dates, might be suspicious)\r\n        if ((propertyName.includes('Published') || propertyName.includes('Posted')) \u0026\u0026 date \u003e new Date()) {\r\n          return {\r\n            type: 'warning',\r\n            severity: 'medium',\r\n            message: `Future date in \"${propertyName}\" - ensure this is intentional`,\r\n            property: propertyName,\r\n            actual: value\r\n          };\r\n        }\r\n      }\r\n      break;\r\n      \r\n    case 'number':\r\n    case 'integer':\r\n    case 'float':\r\n      if (typeof value !== 'number' \u0026\u0026 (typeof value === 'string' \u0026\u0026 isNaN(Number(value)))) {\r\n        return {\r\n          type: 'error',\r\n          severity: 'high',\r\n          message: `Invalid number in property \"${propertyName}\": ${value}`,\r\n          property: propertyName,\r\n          actual: String(value),\r\n          expected: 'Number'\r\n        };\r\n      }\r\n      break;\r\n      \r\n    case 'boolean':\r\n      if (typeof value !== 'boolean' \u0026\u0026 value !== 'true' \u0026\u0026 value !== 'false') {\r\n        return {\r\n          type: 'warning',\r\n          severity: 'low',\r\n          message: `Boolean property \"${propertyName}\" should be true/false, not: ${value}`,\r\n          property: propertyName,\r\n          actual: String(value),\r\n          expected: 'true or false'\r\n        };\r\n      }\r\n      break;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Comprehensive schema validation function\r\n */\r\nfunction validateSchemaComprehensive(\r\n  schema: any, \r\n  schemaType: string, \r\n  format: 'json-ld' | 'microdata' | 'rdfa',\r\n  schemaIndex: number\r\n): SchemaValidationIssue {\r\n  const errors: SchemaValidationError[] = [];\r\n  const warnings: SchemaValidationError[] = [];\r\n  const recommendations: SchemaValidationError[] = [];\r\n  \r\n  // 1. Syntax Validation (JSON-LD only)\r\n  // Note: schema is the data object, not the extracted object with raw property\r\n  // JSON syntax validation happens during extraction, so we skip it here\r\n  \r\n  // 2. Type Validation\r\n  if (!schema['@type'] \u0026\u0026 !schemaType) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'critical',\r\n      message: 'Missing required property: @type',\r\n      property: '@type',\r\n      code: 'MISSING_TYPE'\r\n    });\r\n    return {\r\n      schemaType: 'Unknown',\r\n      format,\r\n      schemaIndex,\r\n      errors,\r\n      warnings,\r\n      recommendations,\r\n      isValid: false,\r\n      rawSchema: schema,\r\n      schemaString: JSON.stringify(schema, null, 2)\r\n    };\r\n  }\r\n  \r\n  const finalType = schema['@type'] || schemaType;\r\n  const typeInfo = getSchemaTypeInfo(finalType);\r\n  \r\n  // Check for generic types\r\n  if (isGenericType(finalType)) {\r\n    warnings.push({\r\n      type: 'warning',\r\n      severity: 'medium',\r\n      message: `Using generic type \"${finalType}\" - consider using a more specific type`,\r\n      property: '@type',\r\n      actual: finalType,\r\n      suggestion: typeInfo?.alternatives?.length ? `Consider: ${typeInfo.alternatives.join(', ')}` : 'Use a more specific Schema.org type'\r\n    });\r\n  }\r\n  \r\n  // 3. Structure Validation (JSON-LD specific)\r\n  if (format === 'json-ld') {\r\n    if (!schema['@context']) {\r\n      warnings.push({\r\n        type: 'warning',\r\n        severity: 'low',\r\n        message: 'Missing @context property (recommended for Schema.org)',\r\n        property: '@context',\r\n        expected: 'https://schema.org',\r\n        suggestion: 'Add \"@context\": \"https://schema.org\" to your JSON-LD'\r\n      });\r\n    } else if (schema['@context'] !== 'https://schema.org' \u0026\u0026 schema['@context'] !== 'http://schema.org') {\r\n      warnings.push({\r\n        type: 'warning',\r\n        severity: 'medium',\r\n        message: `Unexpected @context value: ${schema['@context']}`,\r\n        property: '@context',\r\n        actual: schema['@context'],\r\n        expected: 'https://schema.org',\r\n        suggestion: 'Use \"https://schema.org\" for the @context'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // 4. Property Completeness Validation\r\n  if (typeInfo) {\r\n    // Check required properties\r\n    typeInfo.required.forEach(propName =\u003e {\r\n      const propValue = schema[propName];\r\n      if (!propValue || (typeof propValue === 'string' \u0026\u0026 propValue.trim() === '')) {\r\n        errors.push({\r\n          type: 'error',\r\n          severity: 'high',\r\n          message: `Missing required property: ${propName}`,\r\n          property: propName,\r\n          expected: 'non-empty value',\r\n          code: 'MISSING_REQUIRED_PROPERTY',\r\n          suggestion: `Add \"${propName}\" property to your schema`\r\n        });\r\n      } else {\r\n        // Validate empty strings\r\n        if (typeof propValue === 'string' \u0026\u0026 propValue.trim() === '') {\r\n          errors.push({\r\n            type: 'error',\r\n            severity: 'high',\r\n            message: `Required property \"${propName}\" is empty`,\r\n            property: propName,\r\n            expected: 'non-empty value'\r\n          });\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Check recommended properties\r\n    typeInfo.recommended.forEach(propName =\u003e {\r\n      if (!schema[propName]) {\r\n        recommendations.push({\r\n          type: 'info',\r\n          severity: 'low',\r\n          message: `Recommended property \"${propName}\" is missing`,\r\n          property: propName,\r\n          suggestion: `Consider adding \"${propName}\" to improve schema completeness`\r\n        });\r\n      }\r\n    });\r\n  }\r\n  \r\n  // 5. Data Type Validation\r\n  const urlProperties = ['url', 'image', 'logo', 'sameAs', 'thumbnailUrl', 'contentUrl'];\r\n  urlProperties.forEach(prop =\u003e {\r\n    if (schema[prop]) {\r\n      const url = typeof schema[prop] === 'string' ? schema[prop] : \r\n                  (schema[prop]['@id'] || schema[prop]['url'] || schema[prop]);\r\n      const urlError = validateDataType(url, 'url', prop);\r\n      if (urlError) {\r\n        if (urlError.type === 'error') errors.push(urlError);\r\n        else warnings.push(urlError);\r\n      }\r\n    }\r\n  });\r\n  \r\n  const dateProperties = ['datePublished', 'dateModified', 'dateCreated', 'startDate', 'endDate', 'datePosted', 'uploadDate'];\r\n  dateProperties.forEach(prop =\u003e {\r\n    if (schema[prop]) {\r\n      const dateError = validateDataType(schema[prop], 'date', prop);\r\n      if (dateError) {\r\n        if (dateError.type === 'error') errors.push(dateError);\r\n        else warnings.push(dateError);\r\n      }\r\n    }\r\n  });\r\n  \r\n  // 6. Common Property Validation\r\n  if (schema['name'] \u0026\u0026 typeof schema['name'] === 'string' \u0026\u0026 schema['name'].trim().length === 0) {\r\n    warnings.push({\r\n      type: 'warning',\r\n      severity: 'medium',\r\n      message: 'Property \"name\" is empty',\r\n      property: 'name',\r\n      suggestion: 'Provide a meaningful name'\r\n    });\r\n  }\r\n  \r\n  if (schema['description'] \u0026\u0026 typeof schema['description'] === 'string' \u0026\u0026 schema['description'].trim().length === 0) {\r\n    warnings.push({\r\n      type: 'warning',\r\n      severity: 'low',\r\n      message: 'Property \"description\" is empty',\r\n      property: 'description',\r\n      suggestion: 'Provide a description to improve SEO'\r\n    });\r\n  }\r\n  \r\n  // 7. Best Practices\r\n  if (format !== 'json-ld') {\r\n    recommendations.push({\r\n      type: 'info',\r\n      severity: 'low',\r\n      message: `Using ${format} format - JSON-LD is preferred for maintainability`,\r\n      suggestion: 'Consider migrating to JSON-LD format'\r\n    });\r\n  }\r\n  \r\n  if (!schema['@id'] \u0026\u0026 (schema['url'] || schema['name'])) {\r\n    recommendations.push({\r\n      type: 'info',\r\n      severity: 'low',\r\n      message: 'Missing @id property - consider adding for uniqueness',\r\n      property: '@id',\r\n      suggestion: 'Add \"@id\" with a canonical URL for better referencing'\r\n    });\r\n  }\r\n  \r\n  return {\r\n    schemaType: finalType,\r\n    format,\r\n    schemaIndex,\r\n    errors,\r\n    warnings,\r\n    recommendations,\r\n    isValid: errors.length === 0,\r\n    rawSchema: schema,\r\n    schemaString: typeof schema === 'string' ? schema : JSON.stringify(schema, null, 2)\r\n  };\r\n}\r\n\r\n/**\r\n * Cross-check schema values with visible page content\r\n */\r\nfunction crossCheckContentWithSchema(html: string, schema: any): ContentMatch[] {\r\n  const matches: ContentMatch[] = [];\r\n  \r\n  try {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    const bodyText = doc.body?.textContent?.toLowerCase() || '';\r\n    \r\n    // Check name/title\r\n    if (schema['name'] || schema['headline']) {\r\n      const schemaName = (schema['name'] || schema['headline']).toLowerCase().trim();\r\n      const h1Text = doc.querySelector('h1')?.textContent?.toLowerCase().trim() || '';\r\n      const titleMatch = h1Text.includes(schemaName) || schemaName.includes(h1Text);\r\n      \r\n      matches.push({\r\n        property: schema['name'] ? 'name' : 'headline',\r\n        schemaValue: schema['name'] || schema['headline'],\r\n        pageValue: h1Text || undefined,\r\n        matches: titleMatch,\r\n        confidence: titleMatch ? 0.9 : 0.1,\r\n        location: 'h1'\r\n      });\r\n    }\r\n    \r\n    // Check description\r\n    if (schema['description']) {\r\n      const schemaDesc = schema['description'].toLowerCase().trim();\r\n      const metaDesc = doc.querySelector('meta[name=\"description\"]')?.getAttribute('content')?.toLowerCase() || '';\r\n      const firstPara = doc.querySelector('p')?.textContent?.toLowerCase().trim() || '';\r\n      const descMatch = metaDesc.includes(schemaDesc) || schemaDesc.includes(metaDesc) || \r\n                       firstPara.includes(schemaDesc.substring(0, 100));\r\n      \r\n      matches.push({\r\n        property: 'description',\r\n        schemaValue: schema['description'],\r\n        pageValue: metaDesc || firstPara.substring(0, 100) || undefined,\r\n        matches: descMatch,\r\n        confidence: descMatch ? 0.8 : 0.2,\r\n        location: metaDesc ? 'meta description' : 'first paragraph'\r\n      });\r\n    }\r\n    \r\n    // Check price (for Product)\r\n    if (schema['offers'] \u0026\u0026 schema['offers']['price']) {\r\n      const schemaPrice = String(schema['offers']['price']).replace(/[^0-9.]/g, '');\r\n      const priceElements = doc.querySelectorAll('[class*=\"price\"], [id*=\"price\"], .price, #price');\r\n      let priceMatch = false;\r\n      let pagePrice = '';\r\n      \r\n      priceElements.forEach(el =\u003e {\r\n        const elText = el.textContent?.replace(/[^0-9.]/g, '') || '';\r\n        if (elText.includes(schemaPrice) || schemaPrice.includes(elText)) {\r\n          priceMatch = true;\r\n          pagePrice = el.textContent || '';\r\n        }\r\n      });\r\n      \r\n      matches.push({\r\n        property: 'price',\r\n        schemaValue: String(schema['offers']['price']),\r\n        pageValue: pagePrice || undefined,\r\n        matches: priceMatch,\r\n        confidence: priceMatch ? 0.85 : 0.1,\r\n        location: 'price element'\r\n      });\r\n    }\r\n  } catch (error) {\r\n    devWarn('Content cross-checking error:', error);\r\n  }\r\n  \r\n  return matches;\r\n}\r\n\r\n/**\r\n * Check for hidden content in schema\r\n */\r\nfunction checkForHiddenContent(html: string, schemaFormat: 'json-ld' | 'microdata' | 'rdfa'): boolean {\r\n  try {\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    \r\n    if (schemaFormat === 'microdata' || schemaFormat === 'rdfa') {\r\n      const schemaElements = schemaFormat === 'microdata' \r\n        ? doc.querySelectorAll('[itemscope], [itemprop]')\r\n        : doc.querySelectorAll('[typeof], [property]');\r\n      \r\n      for (const el of Array.from(schemaElements)) {\r\n        const style = window.getComputedStyle(el as Element);\r\n        if (style.display === 'none' || style.visibility === 'hidden' || \r\n            (el as HTMLElement).hidden || (el as HTMLElement).getAttribute('aria-hidden') === 'true') {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    devWarn('Hidden content check error:', error);\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/**\r\n * Calculate comprehensive schema score with breakdown\r\n */\r\nfunction calculateSchemaScore(\r\n  schemas: SchemaValidationIssue[],\r\n  contentMatches: ContentMatch[],\r\n  hasHiddenContent: boolean,\r\n  hasMixedFormats: boolean,\r\n  hasDuplicateTypes: boolean\r\n): { score: number; breakdown: PageSchemaData['scoreBreakdown'] } {\r\n  let syntaxScore = 100;\r\n  let completenessScore = 100;\r\n  let accuracyScore = 100;\r\n  let bestPracticesScore = 100;\r\n  \r\n  // Syntax scoring (errors are critical)\r\n  schemas.forEach(schema =\u003e {\r\n    syntaxScore -= schema.errors.filter(e =\u003e e.severity === 'critical').length * 20;\r\n    syntaxScore -= schema.errors.filter(e =\u003e e.severity === 'high').length * 15;\r\n    syntaxScore -= schema.errors.filter(e =\u003e e.severity === 'medium').length * 10;\r\n    syntaxScore -= schema.errors.filter(e =\u003e e.severity === 'low').length * 5;\r\n  });\r\n  \r\n  // Completeness scoring (missing required properties)\r\n  schemas.forEach(schema =\u003e {\r\n    completenessScore -= schema.errors.filter(e =\u003e e.code === 'MISSING_REQUIRED_PROPERTY').length * 15;\r\n    completenessScore -= schema.recommendations.length * 2;\r\n  });\r\n  \r\n  // Accuracy scoring (content mismatches)\r\n  const mismatches = contentMatches.filter(m =\u003e !m.matches);\r\n  accuracyScore -= mismatches.length * 10;\r\n  if (hasHiddenContent) accuracyScore -= 15;\r\n  \r\n  // Best practices scoring\r\n  if (hasMixedFormats) bestPracticesScore -= 10;\r\n  if (hasDuplicateTypes) bestPracticesScore -= 5;\r\n  schemas.forEach(schema =\u003e {\r\n    if (schema.format !== 'json-ld') bestPracticesScore -= 5;\r\n    bestPracticesScore -= schema.warnings.filter(w =\u003e w.severity === 'medium').length * 3;\r\n    bestPracticesScore -= schema.warnings.filter(w =\u003e w.severity === 'low').length * 1;\r\n  });\r\n  \r\n  // Normalize scores to 0-100\r\n  syntaxScore = Math.max(0, Math.min(100, syntaxScore));\r\n  completenessScore = Math.max(0, Math.min(100, completenessScore));\r\n  accuracyScore = Math.max(0, Math.min(100, accuracyScore));\r\n  bestPracticesScore = Math.max(0, Math.min(100, bestPracticesScore));\r\n  \r\n  // Weighted overall score\r\n  const overallScore = Math.round(\r\n    syntaxScore * 0.3 +\r\n    completenessScore * 0.3 +\r\n    accuracyScore * 0.25 +\r\n    bestPracticesScore * 0.15\r\n  );\r\n  \r\n  return {\r\n    score: overallScore,\r\n    breakdown: {\r\n      syntax: syntaxScore,\r\n      completeness: completenessScore,\r\n      accuracy: accuracyScore,\r\n      bestPractices: bestPracticesScore\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Fetch and validate schema for a single page (comprehensive)\r\n */\r\nasync function validatePageSchema(page: PageData): Promise\u003cPageSchemaData\u003e {\r\n  const pageUrl = `${window.location.origin}${page.relPermalink}`;\r\n  \r\n  try {\r\n    const response = await fetch(pageUrl);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n    \r\n    const html = await response.text();\r\n    const extractedSchemas = extractAllSchemasFromHTML(html);\r\n    \r\n    if (extractedSchemas.length === 0) {\r\n      return {\r\n        pageUrl,\r\n        pageTitle: page.title,\r\n        relPermalink: page.relPermalink,\r\n        hasSchema: false,\r\n        schemaCount: 0,\r\n        formatCounts: { jsonld: 0, microdata: 0, rdfa: 0 },\r\n        schemas: [],\r\n        overallValid: false,\r\n        errorCount: 0,\r\n        warningCount: 0,\r\n        recommendationCount: 0,\r\n        schemaTypes: [],\r\n        missingRequiredProperties: [],\r\n        contentMatches: [],\r\n        hasContentMismatches: false,\r\n        hasHiddenContent: false,\r\n        hasDuplicateTypes: false,\r\n        hasMixedFormats: false,\r\n        score: 0,\r\n        scoreBreakdown: { syntax: 0, completeness: 0, accuracy: 0, bestPractices: 0 },\r\n        suggestions: []\r\n      };\r\n    }\r\n    \r\n    // Count formats\r\n    const formatCounts = {\r\n      jsonld: extractedSchemas.filter(s =\u003e s.format === 'json-ld').length,\r\n      microdata: extractedSchemas.filter(s =\u003e s.format === 'microdata').length,\r\n      rdfa: extractedSchemas.filter(s =\u003e s.format === 'rdfa').length\r\n    };\r\n    const hasMixedFormats = (formatCounts.jsonld \u003e 0 ? 1 : 0) + \r\n                           (formatCounts.microdata \u003e 0 ? 1 : 0) + \r\n                           (formatCounts.rdfa \u003e 0 ? 1 : 0) \u003e 1;\r\n    \r\n    // Validate each schema\r\n    const validatedSchemas: SchemaValidationIssue[] = extractedSchemas.map(extracted =\u003e {\r\n      const validated = validateSchemaComprehensive(extracted.data, extracted.type, extracted.format, extracted.index);\r\n      // Preserve the raw string for display\r\n      validated.schemaString = extracted.raw || JSON.stringify(extracted.data, null, 2);\r\n      return validated;\r\n    });\r\n    \r\n    // Check for duplicate types\r\n    const typeCounts: Record\u003cstring, number\u003e = {};\r\n    validatedSchemas.forEach(s =\u003e {\r\n      typeCounts[s.schemaType] = (typeCounts[s.schemaType] || 0) + 1;\r\n    });\r\n    const hasDuplicateTypes = Object.values(typeCounts).some(count =\u003e count \u003e 1);\r\n    \r\n    // Cross-check content\r\n    const allContentMatches: ContentMatch[] = [];\r\n    validatedSchemas.forEach((schema, index) =\u003e {\r\n      const extractedSchema = extractedSchemas[index];\r\n      if (extractedSchema) {\r\n        const matches = crossCheckContentWithSchema(html, extractedSchema.data);\r\n        allContentMatches.push(...matches);\r\n      }\r\n    });\r\n    const hasContentMismatches = allContentMatches.some(m =\u003e !m.matches);\r\n    \r\n    // Check for hidden content (only for inline formats)\r\n    const hasHiddenContent = validatedSchemas.some(s =\u003e \r\n      (s.format === 'microdata' || s.format === 'rdfa') \u0026\u0026 checkForHiddenContent(html, s.format)\r\n    );\r\n    \r\n    // Calculate scores\r\n    const totalErrors = validatedSchemas.reduce((sum, s) =\u003e sum + s.errors.length, 0);\r\n    const totalWarnings = validatedSchemas.reduce((sum, s) =\u003e sum + s.warnings.length, 0);\r\n    const totalRecommendations = validatedSchemas.reduce((sum, s) =\u003e sum + s.recommendations.length, 0);\r\n    const overallValid = validatedSchemas.every(s =\u003e s.isValid);\r\n    \r\n    const scoreResult = calculateSchemaScore(\r\n      validatedSchemas,\r\n      allContentMatches,\r\n      hasHiddenContent,\r\n      hasMixedFormats,\r\n      hasDuplicateTypes\r\n    );\r\n    \r\n    const schemaTypes = validatedSchemas.map(s =\u003e s.schemaType);\r\n    const missingRequiredProperties: string[] = [];\r\n    validatedSchemas.forEach(schema =\u003e {\r\n      schema.errors.forEach(error =\u003e {\r\n        if (error.property \u0026\u0026 error.code === 'MISSING_REQUIRED_PROPERTY' \u0026\u0026 \r\n            !missingRequiredProperties.includes(error.property)) {\r\n          missingRequiredProperties.push(error.property);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Generate suggestions\r\n    const suggestions: string[] = [];\r\n    if (totalErrors \u003e 0) {\r\n      suggestions.push(`Fix ${totalErrors} error${totalErrors !== 1 ? 's' : ''} in schema markup`);\r\n    }\r\n    if (hasMixedFormats) {\r\n      suggestions.push('Consider using a single format (preferably JSON-LD) for consistency');\r\n    }\r\n    if (hasContentMismatches) {\r\n      suggestions.push('Ensure schema values match visible page content');\r\n    }\r\n    if (hasHiddenContent) {\r\n      suggestions.push('Remove schema markup from hidden content');\r\n    }\r\n    if (totalRecommendations \u003e 0) {\r\n      suggestions.push(`Consider adding ${totalRecommendations} recommended propert${totalRecommendations !== 1 ? 'ies' : 'y'}`);\r\n    }\r\n    \r\n    return {\r\n      pageUrl,\r\n      pageTitle: page.title,\r\n      relPermalink: page.relPermalink,\r\n      hasSchema: true,\r\n      schemaCount: validatedSchemas.length,\r\n      formatCounts,\r\n      schemas: validatedSchemas,\r\n      overallValid,\r\n      errorCount: totalErrors,\r\n      warningCount: totalWarnings,\r\n      recommendationCount: totalRecommendations,\r\n      schemaTypes,\r\n      missingRequiredProperties,\r\n      contentMatches: allContentMatches,\r\n      hasContentMismatches,\r\n      hasHiddenContent,\r\n      hasDuplicateTypes,\r\n      hasMixedFormats,\r\n      score: scoreResult.score,\r\n      scoreBreakdown: scoreResult.breakdown,\r\n      suggestions\r\n    };\r\n  } catch (error) {\r\n    devError(`Failed to validate schema for ${pageUrl}:`, error);\r\n    return {\r\n      pageUrl,\r\n      pageTitle: page.title,\r\n      relPermalink: page.relPermalink,\r\n      hasSchema: false,\r\n      schemaCount: 0,\r\n      formatCounts: { jsonld: 0, microdata: 0, rdfa: 0 },\r\n      schemas: [],\r\n      overallValid: false,\r\n      errorCount: 0,\r\n      warningCount: 0,\r\n      recommendationCount: 0,\r\n      schemaTypes: [],\r\n      missingRequiredProperties: [],\r\n      contentMatches: [],\r\n      hasContentMismatches: false,\r\n      hasHiddenContent: false,\r\n      hasDuplicateTypes: false,\r\n      hasMixedFormats: false,\r\n      score: 0,\r\n      scoreBreakdown: { syntax: 0, completeness: 0, accuracy: 0, bestPractices: 0 },\r\n      suggestions: []\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a page should be excluded from schema validation\r\n */\r\nfunction shouldExcludeFromSchemaValidation(page: PageData): boolean {\r\n  const relPermalink = page.relPermalink.toLowerCase();\r\n  \r\n  // Exclude system files and non-HTML pages\r\n  const excludePatterns = [\r\n    /\\.txt$/i,           // Text files (llms.txt, robots.txt, etc.)\r\n    /\\.xml$/i,           // XML files (sitemap.xml, etc.)\r\n    /\\.json$/i,          // JSON files\r\n    /\\.csv$/i,           // CSV files\r\n    /\\.pdf$/i,           // PDF files\r\n    /\\/llms\\.txt$/i,     // LLMs.txt file\r\n    /\\/robots\\.txt$/i,   // Robots.txt file\r\n    /\\/sitemap/i,        // Sitemap files\r\n    /\\/feed/i,           // RSS/Atom feeds\r\n    /\\/search/i,         // Search pages (usually dynamic)\r\n    /\\/404/i,            // 404 pages\r\n    /^\\/page-list\\//i    // Page list tool pages themselves\r\n  ];\r\n  \r\n  return excludePatterns.some(pattern =\u003e pattern.test(relPermalink));\r\n}\r\n\r\n/**\r\n * Validate schema for all pages (excluding system files)\r\n */\r\nasync function validateAllPageSchemas(pages: PageData[], progressCallback?: (current: number, total: number) =\u003e void): Promise\u003cPageSchemaData[]\u003e {\r\n  // Filter out pages that shouldn't have schema validation\r\n  const pagesToValidate = pages.filter(page =\u003e !shouldExcludeFromSchemaValidation(page));\r\n  const results: PageSchemaData[] = [];\r\n  const total = pagesToValidate.length;\r\n  \r\n  for (let i = 0; i \u003c pagesToValidate.length; i++) {\r\n    const page = pagesToValidate[i];\r\n    if (progressCallback) {\r\n      progressCallback(i + 1, total);\r\n    }\r\n    \r\n    const result = await validatePageSchema(page);\r\n    results.push(result);\r\n    \r\n    // Small delay to avoid overwhelming the server\r\n    if (i \u003c pagesToValidate.length - 1) {\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 100));\r\n    }\r\n  }\r\n  \r\n  return results;\r\n}\r\n\r\n/**\r\n * Render schema validation section\r\n */\r\nfunction renderSchemaSection(pages: PageData[]): string {\r\n  return `\r\n    \u003cdiv class=\"page-list-schema\"\u003e\r\n      \u003cdiv class=\"page-list-schema__header\"\u003e\r\n        \u003cdiv class=\"page-list-schema__info\"\u003e\r\n          \u003ch2 class=\"page-list-schema__title\"\u003eSchema Validation\u003c/h2\u003e\r\n          \u003cp class=\"page-list-schema__description\"\u003eValidate schema markup quality and health across all pages\u003c/p\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema__actions\"\u003e\r\n          \u003cbutton \r\n            type=\"button\" \r\n            class=\"page-list-schema__validate-button\"\r\n            id=\"page-list-schema-validate-btn\"\r\n            aria-label=\"Validate all pages\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003echeck_circle\u003c/span\u003e\r\n            Validate All Pages\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-schema__status\" id=\"page-list-schema-status\"\u003e\r\n        \u003cp class=\"page-list-schema__status-text\"\u003eClick \"Validate All Pages\" to begin schema validation.\u003c/p\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-schema__results\" id=\"page-list-schema-results\"\u003e\r\n        \u003c!-- Results will be populated here --\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Render schema validation results\r\n */\r\nfunction renderSchemaResults(results: PageSchemaData[]): string {\r\n  if (results.length === 0) {\r\n    return `\r\n      \u003cdiv class=\"page-list-schema-empty\"\u003e\r\n        \u003cdiv class=\"page-list-schema-empty__icon\"\u003e📋\u003c/div\u003e\r\n        \u003ch3 class=\"page-list-schema-empty__title\"\u003eNo validation results\u003c/h3\u003e\r\n        \u003cp class=\"page-list-schema-empty__text\"\u003eClick \"Validate All Pages\" to start validation.\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n  \r\n  // Calculate summary statistics\r\n  const totalPages = results.length;\r\n  const pagesWithSchema = results.filter(r =\u003e r.hasSchema).length;\r\n  const pagesWithoutSchema = totalPages - pagesWithSchema;\r\n  const validPages = results.filter(r =\u003e r.overallValid \u0026\u0026 r.hasSchema).length;\r\n  const invalidPages = results.filter(r =\u003e !r.overallValid \u0026\u0026 r.hasSchema).length;\r\n  const totalErrors = results.reduce((sum, r) =\u003e sum + r.errorCount, 0);\r\n  const totalWarnings = results.reduce((sum, r) =\u003e sum + r.warningCount, 0);\r\n  const totalRecommendations = results.reduce((sum, r) =\u003e sum + r.recommendationCount, 0);\r\n  const pagesWithContentMismatches = results.filter(r =\u003e r.hasContentMismatches).length;\r\n  const pagesWithMixedFormats = results.filter(r =\u003e r.hasMixedFormats).length;\r\n  const averageScore = results.length \u003e 0 \r\n    ? Math.round(results.reduce((sum, r) =\u003e sum + r.score, 0) / results.length)\r\n    : 0;\r\n  \r\n  // Sort results: invalid first, then by score ascending\r\n  const sortedResults = [...results].sort((a, b) =\u003e {\r\n    if (a.overallValid !== b.overallValid) {\r\n      return a.overallValid ? 1 : -1;\r\n    }\r\n    return a.score - b.score;\r\n  });\r\n  \r\n  let html = `\r\n    \u003cdiv class=\"page-list-schema-summary\"\u003e\r\n      \u003cdiv class=\"page-list-schema-summary__stats\"\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value\"\u003e${totalPages}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eTotal Pages\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${pagesWithSchema \u003e 0 ? 'page-list-schema-summary__stat-value--good' : 'page-list-schema-summary__stat-value--bad'}\"\u003e${pagesWithSchema}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eWith Schema\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${validPages === pagesWithSchema ? 'page-list-schema-summary__stat-value--good' : 'page-list-schema-summary__stat-value--warning'}\"\u003e${validPages}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eValid\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${totalErrors === 0 ? 'page-list-schema-summary__stat-value--good' : 'page-list-schema-summary__stat-value--bad'}\"\u003e${totalErrors}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eErrors\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${totalWarnings === 0 ? 'page-list-schema-summary__stat-value--good' : 'page-list-schema-summary__stat-value--warning'}\"\u003e${totalWarnings}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eWarnings\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${totalRecommendations === 0 ? 'page-list-schema-summary__stat-value--good' : 'page-list-schema-summary__stat-value--warning'}\"\u003e${totalRecommendations}\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eRecommendations\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-summary__stat\"\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-value ${averageScore \u003e= 80 ? 'page-list-schema-summary__stat-value--good' : averageScore \u003e= 60 ? 'page-list-schema-summary__stat-value--warning' : 'page-list-schema-summary__stat-value--bad'}\"\u003e${averageScore}%\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-schema-summary__stat-label\"\u003eAvg Score\u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n    \r\n    \u003cdiv class=\"page-list-schema-table-wrapper\"\u003e\r\n      \u003ctable class=\"page-list-schema-table\"\u003e\r\n        \u003cthead\u003e\r\n          \u003ctr\u003e\r\n            \u003cth\u003ePage\u003c/th\u003e\r\n            \u003cth\u003eStatus\u003c/th\u003e\r\n            \u003cth\u003eSchema Types\u003c/th\u003e\r\n            \u003cth\u003eFormat\u003c/th\u003e\r\n            \u003cth\u003eErrors\u003c/th\u003e\r\n            \u003cth\u003eWarnings\u003c/th\u003e\r\n            \u003cth\u003eScore\u003c/th\u003e\r\n            \u003cth\u003eActions\u003c/th\u003e\r\n          \u003c/tr\u003e\r\n        \u003c/thead\u003e\r\n        \u003ctbody\u003e\r\n  `;\r\n  \r\n  sortedResults.forEach(result =\u003e {\r\n    const statusClass = !result.hasSchema \r\n      ? 'page-list-schema-row__status--none'\r\n      : result.overallValid \r\n        ? 'page-list-schema-row__status--valid' \r\n        : 'page-list-schema-row__status--invalid';\r\n    \r\n    const statusText = !result.hasSchema \r\n      ? 'No Schema'\r\n      : result.overallValid \r\n        ? 'Valid' \r\n        : 'Invalid';\r\n    \r\n    const scoreClass = result.score \u003e= 80 \r\n      ? 'page-list-schema-row__score--good'\r\n      : result.score \u003e= 60 \r\n        ? 'page-list-schema-row__score--warning'\r\n        : 'page-list-schema-row__score--bad';\r\n    \r\n    html += `\r\n      \u003ctr class=\"page-list-schema-row\" data-page-url=\"${escapeHtml(result.relPermalink)}\"\u003e\r\n        \u003ctd class=\"page-list-schema-row__page\"\u003e\r\n          \u003ca href=\"${escapeHtml(result.relPermalink)}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"page-list-schema-row__link\"\u003e\r\n            ${escapeHtml(result.pageTitle)}\r\n          \u003c/a\u003e\r\n          \u003cdiv class=\"page-list-schema-row__url\"\u003e${escapeHtml(result.relPermalink)}\u003c/div\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__status\"\u003e\r\n          \u003cspan class=\"page-list-schema-row__status-badge ${statusClass}\"\u003e${statusText}\u003c/span\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__types\"\u003e\r\n          ${result.schemaTypes.length \u003e 0 \r\n            ? (() =\u003e {\r\n                // Count occurrences of each schema type\r\n                const typeCounts = new Map\u003cstring, number\u003e();\r\n                result.schemaTypes.forEach(type =\u003e {\r\n                  typeCounts.set(type, (typeCounts.get(type) || 0) + 1);\r\n                });\r\n                // Render unique types with counts\r\n                return Array.from(typeCounts.entries())\r\n                  .map(([type, count]) =\u003e \r\n                    count \u003e 1 \r\n                      ? `\u003cspan class=\"page-list-schema-row__type-badge\" title=\"${escapeHtml(type)}\"\u003e${escapeHtml(type)} (${count})\u003c/span\u003e`\r\n                      : `\u003cspan class=\"page-list-schema-row__type-badge\"\u003e${escapeHtml(type)}\u003c/span\u003e`\r\n                  )\r\n                  .join('');\r\n              })()\r\n            : '\u003cspan class=\"page-list-schema-row__type-badge page-list-schema-row__type-badge--none\"\u003eNone\u003c/span\u003e'\r\n          }\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__format\"\u003e\r\n          ${result.hasSchema ? `\r\n            \u003cdiv class=\"page-list-schema-row__format-badges\"\u003e\r\n              ${result.formatCounts.jsonld \u003e 0 ? `\u003cspan class=\"page-list-schema-row__format-badge\" title=\"JSON-LD\"\u003eJSON-LD (${result.formatCounts.jsonld})\u003c/span\u003e` : ''}\r\n              ${result.formatCounts.microdata \u003e 0 ? `\u003cspan class=\"page-list-schema-row__format-badge\" title=\"Microdata\"\u003eMicrodata (${result.formatCounts.microdata})\u003c/span\u003e` : ''}\r\n              ${result.formatCounts.rdfa \u003e 0 ? `\u003cspan class=\"page-list-schema-row__format-badge\" title=\"RDFa\"\u003eRDFa (${result.formatCounts.rdfa})\u003c/span\u003e` : ''}\r\n            \u003c/div\u003e\r\n            ${result.hasMixedFormats ? '\u003cspan class=\"page-list-schema-row__mixed-formats-warning\" title=\"Mixed formats detected\"\u003e⚠ Mixed\u003c/span\u003e' : ''}\r\n          ` : '\u003cspan class=\"page-list-schema-row__format-badge page-list-schema-row__format-badge--none\"\u003e-\u003c/span\u003e'}\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__errors\"\u003e\r\n          ${result.errorCount \u003e 0 \r\n            ? `\u003cspan class=\"page-list-schema-row__count page-list-schema-row__count--error\"\u003e${result.errorCount}\u003c/span\u003e`\r\n            : '\u003cspan class=\"page-list-schema-row__count page-list-schema-row__count--good\"\u003e0\u003c/span\u003e'\r\n          }\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__warnings\"\u003e\r\n          ${result.warningCount \u003e 0 \r\n            ? `\u003cspan class=\"page-list-schema-row__count page-list-schema-row__count--warning\"\u003e${result.warningCount}\u003c/span\u003e`\r\n            : '\u003cspan class=\"page-list-schema-row__count page-list-schema-row__count--good\"\u003e0\u003c/span\u003e'\r\n          }\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__score\"\u003e\r\n          \u003cspan class=\"page-list-schema-row__score-badge ${scoreClass}\"\u003e${result.score}%\u003c/span\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-schema-row__actions\"\u003e\r\n          \u003cbutton \r\n            type=\"button\"\r\n            class=\"page-list-schema-row__details-btn\"\r\n            data-page-url=\"${escapeHtml(result.relPermalink)}\"\r\n            aria-label=\"View schema details for ${escapeHtml(result.pageTitle)}\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003einfo\u003c/span\u003e\r\n            Details\r\n          \u003c/button\u003e\r\n        \u003c/td\u003e\r\n      \u003c/tr\u003e\r\n    `;\r\n  });\r\n  \r\n  html += `\r\n        \u003c/tbody\u003e\r\n      \u003c/table\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * Render schema details modal with sidebar navigation\r\n */\r\nfunction renderSchemaDetailsModal(result: PageSchemaData): string {\r\n  // Build navigation items\r\n  const navItems: string[] = [];\r\n  navItems.push(`\u003ca href=\"#schema-overview\" class=\"page-list-schema-modal__nav-link\"\u003eOverview\u003c/a\u003e`);\r\n  \r\n  if (result.suggestions.length \u003e 0) {\r\n    navItems.push(`\u003ca href=\"#schema-suggestions\" class=\"page-list-schema-modal__nav-link\"\u003eSuggestions (${result.suggestions.length})\u003c/a\u003e`);\r\n  }\r\n  \r\n  if (result.contentMatches.length \u003e 0) {\r\n    navItems.push(`\u003ca href=\"#schema-content-check\" class=\"page-list-schema-modal__nav-link\"\u003eContent Cross-Check\u003c/a\u003e`);\r\n  }\r\n  \r\n  result.schemas.forEach((schema, index) =\u003e {\r\n    navItems.push(`\u003ca href=\"#schema-${index + 1}\" class=\"page-list-schema-modal__nav-link\"\u003eSchema ${index + 1}: ${escapeHtml(schema.schemaType)}\u003c/a\u003e`);\r\n  });\r\n  \r\n  let html = `\r\n    \u003cdiv class=\"page-list-modal-overlay\" id=\"page-list-schema-modal-overlay\"\u003e\r\n      \u003cdiv class=\"page-list-modal page-list-schema-modal\" role=\"dialog\" aria-labelledby=\"page-list-schema-modal-title\" aria-modal=\"true\"\u003e\r\n        \u003cdiv class=\"page-list-modal__header\"\u003e\r\n          \u003ch2 class=\"page-list-modal__title\" id=\"page-list-schema-modal-title\"\u003eSchema Details: ${escapeHtml(result.pageTitle)}\u003c/h2\u003e\r\n          \u003cbutton class=\"page-list-modal__close\" aria-label=\"Close modal\" data-schema-modal-close\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003eclose\u003c/span\u003e\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-schema-modal__body\"\u003e\r\n          \u003cnav class=\"page-list-schema-modal__sidebar\"\u003e\r\n            ${navItems.join('')}\r\n          \u003c/nav\u003e\r\n          \u003cdiv class=\"page-list-schema-modal__content\"\u003e\r\n            \u003csection id=\"schema-overview\" class=\"page-list-schema-modal__section\"\u003e\r\n              \u003cdiv class=\"page-list-schema-modal__info\"\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003ePage URL:\u003c/strong\u003e\r\n                  \u003ca href=\"${escapeHtml(result.pageUrl)}\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e${escapeHtml(result.pageUrl)}\u003c/a\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003eSchema Count:\u003c/strong\u003e ${result.schemaCount}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003eFormats:\u003c/strong\u003e \r\n                  ${result.formatCounts.jsonld \u003e 0 ? `JSON-LD (${result.formatCounts.jsonld}) ` : ''}\r\n                  ${result.formatCounts.microdata \u003e 0 ? `Microdata (${result.formatCounts.microdata}) ` : ''}\r\n                  ${result.formatCounts.rdfa \u003e 0 ? `RDFa (${result.formatCounts.rdfa})` : ''}\r\n                  ${result.hasMixedFormats ? ' ⚠ Mixed formats' : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003eOverall Status:\u003c/strong\u003e\r\n                  \u003cspan class=\"${result.overallValid ? 'page-list-schema-modal__status--valid' : 'page-list-schema-modal__status--invalid'}\"\u003e\r\n                    ${result.overallValid ? 'Valid' : 'Invalid'}\r\n                  \u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003eOverall Score:\u003c/strong\u003e ${result.score}%\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__info-item\"\u003e\r\n                  \u003cstrong\u003eScore Breakdown:\u003c/strong\u003e\r\n                  \u003cdiv class=\"page-list-schema-modal__score-breakdown\"\u003e\r\n                    \u003cspan\u003eSyntax: ${result.scoreBreakdown.syntax}%\u003c/span\u003e\r\n                    \u003cspan\u003eCompleteness: ${result.scoreBreakdown.completeness}%\u003c/span\u003e\r\n                    \u003cspan\u003eAccuracy: ${result.scoreBreakdown.accuracy}%\u003c/span\u003e\r\n                    \u003cspan\u003eBest Practices: ${result.scoreBreakdown.bestPractices}%\u003c/span\u003e\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/section\u003e\r\n          \r\n            ${result.suggestions.length \u003e 0 ? `\r\n              \u003csection id=\"schema-suggestions\" class=\"page-list-schema-modal__section\"\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__suggestions\"\u003e\r\n                  \u003ch3 class=\"page-list-schema-modal__section-title\"\u003eSuggestions\u003c/h3\u003e\r\n                  \u003cul class=\"page-list-schema-modal__suggestions-list\"\u003e\r\n                    ${result.suggestions.map(suggestion =\u003e `\r\n                      \u003cli\u003e${escapeHtml(suggestion)}\u003c/li\u003e\r\n                    `).join('')}\r\n                  \u003c/ul\u003e\r\n                \u003c/div\u003e\r\n              \u003c/section\u003e\r\n            ` : ''}\r\n            \r\n            ${result.contentMatches.length \u003e 0 ? `\r\n              \u003csection id=\"schema-content-check\" class=\"page-list-schema-modal__section\"\u003e\r\n                \u003cdiv class=\"page-list-schema-modal__content-matches\"\u003e\r\n                  \u003ch3 class=\"page-list-schema-modal__section-title\"\u003eContent Cross-Check\u003c/h3\u003e\r\n                  \u003cdiv class=\"page-list-schema-modal__content-matches-list\"\u003e\r\n                    ${result.contentMatches.map(match =\u003e `\r\n                      \u003cdiv class=\"page-list-schema-modal__content-match ${match.matches ? 'page-list-schema-modal__content-match--match' : 'page-list-schema-modal__content-match--mismatch'}\"\u003e\r\n                        \u003cstrong\u003e${escapeHtml(match.property)}:\u003c/strong\u003e\r\n                        \u003cdiv class=\"page-list-schema-modal__content-match-values\"\u003e\r\n                          \u003cdiv\u003eSchema: ${escapeHtml(match.schemaValue)}\u003c/div\u003e\r\n                          ${match.pageValue ? `\u003cdiv\u003ePage: ${escapeHtml(match.pageValue)}\u003c/div\u003e` : '\u003cdiv\u003ePage: Not found\u003c/div\u003e'}\r\n                          \u003cdiv class=\"page-list-schema-modal__content-match-status\"\u003e\r\n                            ${match.matches ? '✓ Match' : '✗ Mismatch'} (confidence: ${Math.round(match.confidence * 100)}%)\r\n                          \u003c/div\u003e\r\n                        \u003c/div\u003e\r\n                      \u003c/div\u003e\r\n                    `).join('')}\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/section\u003e\r\n            ` : ''}\r\n  `;\r\n  \r\n  if (result.schemas.length === 0) {\r\n    html += `\r\n            \u003csection class=\"page-list-schema-modal__section\"\u003e\r\n              \u003cdiv class=\"page-list-schema-modal__no-schema\"\u003e\r\n                \u003cp\u003eNo schema markup found on this page.\u003c/p\u003e\r\n                \u003cp\u003eConsider adding JSON-LD schema markup to improve SEO and enable rich results in search engines.\u003c/p\u003e\r\n              \u003c/div\u003e\r\n            \u003c/section\u003e\r\n    `;\r\n  } else {\r\n    result.schemas.forEach((schema, index) =\u003e {\r\n      const schemaId = `schema-${index + 1}`;\r\n      html += `\r\n            \u003csection id=\"${schemaId}\" class=\"page-list-schema-modal__section\"\u003e\r\n              \u003cdiv class=\"page-list-schema-modal__schema-item\"\u003e\r\n                \u003ch3 class=\"page-list-schema-modal__schema-title\"\u003e\r\n                  Schema ${index + 1}: ${escapeHtml(schema.schemaType)}\r\n                  \u003cspan class=\"page-list-schema-modal__schema-format\"\u003e(${schema.format})\u003c/span\u003e\r\n                  \u003cspan class=\"${schema.isValid ? 'page-list-schema-modal__schema-status--valid' : 'page-list-schema-modal__schema-status--invalid'}\"\u003e\r\n                    ${schema.isValid ? '✓ Valid' : '✗ Invalid'}\r\n                  \u003c/span\u003e\r\n                \u003c/h3\u003e\r\n                \r\n                ${schema.errors.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-schema-modal__errors\"\u003e\r\n                    \u003ch4 class=\"page-list-schema-modal__errors-title\"\u003eErrors (${schema.errors.length})\u003c/h4\u003e\r\n                    \u003cul class=\"page-list-schema-modal__errors-list\"\u003e\r\n                      ${schema.errors.map(error =\u003e `\r\n                        \u003cli class=\"page-list-schema-modal__error-item\"\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__error-header\"\u003e\r\n                            \u003cstrong\u003e${error.property || 'General'}:\u003c/strong\u003e\r\n                            \u003cspan class=\"page-list-schema-modal__error-severity severity-${error.severity}\"\u003e${error.severity}\u003c/span\u003e\r\n                          \u003c/div\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__error-message\"\u003e${escapeHtml(error.message)}\u003c/div\u003e\r\n                          ${error.expected ? `\u003cdiv class=\"page-list-schema-modal__error-detail\"\u003e\u003csmall\u003eExpected: ${escapeHtml(error.expected)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                          ${error.actual ? `\u003cdiv class=\"page-list-schema-modal__error-detail\"\u003e\u003csmall\u003eActual: ${escapeHtml(error.actual)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                          ${error.suggestion ? `\u003cdiv class=\"page-list-schema-modal__error-suggestion\"\u003e\u003csmall\u003e💡 ${escapeHtml(error.suggestion)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                          ${error.code ? `\u003cdiv class=\"page-list-schema-modal__error-code\"\u003e\u003csmall\u003eCode: ${escapeHtml(error.code)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                        \u003c/li\u003e\r\n                      `).join('')}\r\n                    \u003c/ul\u003e\r\n                  \u003c/div\u003e\r\n                ` : ''}\r\n                \r\n                ${schema.warnings.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-schema-modal__warnings\"\u003e\r\n                    \u003ch4 class=\"page-list-schema-modal__warnings-title\"\u003eWarnings (${schema.warnings.length})\u003c/h4\u003e\r\n                    \u003cul class=\"page-list-schema-modal__warnings-list\"\u003e\r\n                      ${schema.warnings.map(warning =\u003e `\r\n                        \u003cli class=\"page-list-schema-modal__warning-item\"\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__warning-header\"\u003e\r\n                            \u003cstrong\u003e${warning.property || 'General'}:\u003c/strong\u003e\r\n                            \u003cspan class=\"page-list-schema-modal__warning-severity severity-${warning.severity}\"\u003e${warning.severity}\u003c/span\u003e\r\n                          \u003c/div\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__warning-message\"\u003e${escapeHtml(warning.message)}\u003c/div\u003e\r\n                          ${warning.expected ? `\u003cdiv class=\"page-list-schema-modal__warning-detail\"\u003e\u003csmall\u003eExpected: ${escapeHtml(warning.expected)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                          ${warning.actual ? `\u003cdiv class=\"page-list-schema-modal__warning-detail\"\u003e\u003csmall\u003eActual: ${escapeHtml(warning.actual)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                          ${warning.suggestion ? `\u003cdiv class=\"page-list-schema-modal__warning-suggestion\"\u003e\u003csmall\u003e💡 ${escapeHtml(warning.suggestion)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                        \u003c/li\u003e\r\n                      `).join('')}\r\n                    \u003c/ul\u003e\r\n                  \u003c/div\u003e\r\n                ` : ''}\r\n                \r\n                ${schema.recommendations.length \u003e 0 ? `\r\n                  \u003cdiv class=\"page-list-schema-modal__recommendations\"\u003e\r\n                    \u003ch4 class=\"page-list-schema-modal__recommendations-title\"\u003eRecommendations (${schema.recommendations.length})\u003c/h4\u003e\r\n                    \u003cul class=\"page-list-schema-modal__recommendations-list\"\u003e\r\n                      ${schema.recommendations.map(rec =\u003e `\r\n                        \u003cli class=\"page-list-schema-modal__recommendation-item\"\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__recommendation-header\"\u003e\r\n                            \u003cstrong\u003e${rec.property || 'General'}:\u003c/strong\u003e\r\n                            \u003cspan class=\"page-list-schema-modal__recommendation-severity severity-${rec.severity}\"\u003e${rec.severity}\u003c/span\u003e\r\n                          \u003c/div\u003e\r\n                          \u003cdiv class=\"page-list-schema-modal__recommendation-message\"\u003e${escapeHtml(rec.message)}\u003c/div\u003e\r\n                          ${rec.suggestion ? `\u003cdiv class=\"page-list-schema-modal__recommendation-suggestion\"\u003e\u003csmall\u003e💡 ${escapeHtml(rec.suggestion)}\u003c/small\u003e\u003c/div\u003e` : ''}\r\n                        \u003c/li\u003e\r\n                      `).join('')}\r\n                    \u003c/ul\u003e\r\n                  \u003c/div\u003e\r\n                ` : ''}\r\n                \r\n                \u003cdiv class=\"page-list-schema-modal__raw-schema\"\u003e\r\n                  \u003cbutton class=\"page-list-schema-modal__raw-toggle\" type=\"button\" data-raw-toggle=\"${schemaId}\"\u003e\r\n                    \u003cspan class=\"material-symbols-outlined\"\u003ecode\u003c/span\u003e\r\n                    \u003cspan\u003eRaw Schema JSON\u003c/span\u003e\r\n                    \u003cspan class=\"material-symbols-outlined page-list-schema-modal__raw-toggle-icon\"\u003eexpand_more\u003c/span\u003e\r\n                  \u003c/button\u003e\r\n                  \u003cdiv class=\"page-list-schema-modal__raw-content\" id=\"raw-${schemaId}\" style=\"display: none;\"\u003e\r\n                    \u003cpre class=\"page-list-schema-modal__raw-code\"\u003e\u003ccode\u003e${escapeHtml(schema.schemaString)}\u003c/code\u003e\u003c/pre\u003e\r\n                  \u003c/div\u003e\r\n                \u003c/div\u003e\r\n              \u003c/div\u003e\r\n            \u003c/section\u003e\r\n      `;\r\n    });\r\n  }\r\n  \r\n  html += `\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * Attach schema validation handlers\r\n */\r\nfunction attachSchemaValidationHandlers(pages: PageData[]): void {\r\n  const validateBtn = document.getElementById('page-list-schema-validate-btn');\r\n  const statusDiv = document.getElementById('page-list-schema-status');\r\n  const resultsDiv = document.getElementById('page-list-schema-results');\r\n  \r\n  if (!validateBtn || !statusDiv || !resultsDiv) return;\r\n  \r\n  let validationResults: PageSchemaData[] = [];\r\n  \r\n  // Validate button handler\r\n  validateBtn.addEventListener('click', async () =\u003e {\r\n    validateBtn.setAttribute('disabled', 'disabled');\r\n    validateBtn.innerHTML = '\u003cspan class=\"material-symbols-outlined\"\u003ehourglass_empty\u003c/span\u003e Validating...';\r\n    \r\n    // Filter pages before showing progress (to get accurate count)\r\n    const pagesToValidate = pages.filter(page =\u003e !shouldExcludeFromSchemaValidation(page));\r\n    \r\n    statusDiv.innerHTML = `\r\n      \u003cdiv class=\"page-list-schema-status__progress\"\u003e\r\n        \u003cp class=\"page-list-schema-status__text\"\u003eValidating ${pagesToValidate.length} pages...\u003c/p\u003e\r\n        \u003cdiv class=\"page-list-schema-status__progress-bar\"\u003e\r\n          \u003cdiv class=\"page-list-schema-status__progress-fill\" id=\"page-list-schema-progress-fill\"\u003e\u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cp class=\"page-list-schema-status__progress-text\" id=\"page-list-schema-progress-text\"\u003e0 / ${pagesToValidate.length}\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    const progressFill = document.getElementById('page-list-schema-progress-fill');\r\n    const progressText = document.getElementById('page-list-schema-progress-text');\r\n    \r\n    try {\r\n      validationResults = await validateAllPageSchemas(pages, (current, total) =\u003e {\r\n        const percent = Math.round((current / total) * 100);\r\n        if (progressFill) {\r\n          progressFill.style.width = `${percent}%`;\r\n        }\r\n        if (progressText) {\r\n          progressText.textContent = `${current} / ${total}`;\r\n        }\r\n      });\r\n      \r\n      statusDiv.innerHTML = `\r\n        \u003cp class=\"page-list-schema-status__text page-list-schema-status__text--success\"\u003e\r\n          Validation complete! Found ${validationResults.filter(r =\u003e !r.overallValid).length} page(s) with issues.\r\n        \u003c/p\u003e\r\n      `;\r\n      \r\n      resultsDiv.innerHTML = renderSchemaResults(validationResults);\r\n      \r\n      // Attach details button handlers\r\n      const detailsButtons = resultsDiv.querySelectorAll('.page-list-schema-row__details-btn');\r\n      detailsButtons.forEach(btn =\u003e {\r\n        btn.addEventListener('click', () =\u003e {\r\n          const pageUrl = btn.getAttribute('data-page-url');\r\n          if (!pageUrl) return;\r\n          \r\n          const result = validationResults.find(r =\u003e r.relPermalink === pageUrl);\r\n          if (!result) return;\r\n          \r\n          const modalHtml = renderSchemaDetailsModal(result);\r\n          document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n          \r\n          const modal = document.getElementById('page-list-schema-modal-overlay');\r\n          const closeBtn = modal?.querySelector('[data-schema-modal-close]');\r\n          const modalContent = modal?.querySelector('.page-list-schema-modal__content');\r\n          \r\n          const closeModal = () =\u003e {\r\n            modal?.remove();\r\n            document.removeEventListener('keydown', handleEscape);\r\n          };\r\n          \r\n          const handleEscape = (e: KeyboardEvent) =\u003e {\r\n            if (e.key === 'Escape') {\r\n              closeModal();\r\n            }\r\n          };\r\n          \r\n          // Handle sidebar navigation\r\n          const navLinks = modal?.querySelectorAll('.page-list-schema-modal__nav-link');\r\n          navLinks?.forEach(link =\u003e {\r\n            link.addEventListener('click', (e) =\u003e {\r\n              e.preventDefault();\r\n              const targetId = link.getAttribute('href')?.substring(1);\r\n              if (targetId) {\r\n                const targetSection = modal?.querySelector(`#${targetId}`);\r\n                if (targetSection \u0026\u0026 modalContent) {\r\n                  targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n                  // Update active nav link\r\n                  navLinks.forEach(l =\u003e l.classList.remove('page-list-schema-modal__nav-link--active'));\r\n                  link.classList.add('page-list-schema-modal__nav-link--active');\r\n                }\r\n              }\r\n            });\r\n          });\r\n          \r\n          // Handle collapsible raw JSON sections\r\n          const rawToggles = modal?.querySelectorAll('[data-raw-toggle]');\r\n          rawToggles?.forEach(toggle =\u003e {\r\n            toggle.addEventListener('click', () =\u003e {\r\n              const schemaId = toggle.getAttribute('data-raw-toggle');\r\n              if (schemaId) {\r\n                const content = modal?.querySelector(`#raw-${schemaId}`) as HTMLElement | null;\r\n                const icon = toggle.querySelector('.page-list-schema-modal__raw-toggle-icon');\r\n                if (content) {\r\n                  const isHidden = content.style.display === 'none';\r\n                  content.style.display = isHidden ? 'block' : 'none';\r\n                  if (icon) {\r\n                    icon.textContent = isHidden ? 'expand_less' : 'expand_more';\r\n                  }\r\n                }\r\n              }\r\n            });\r\n          });\r\n          \r\n          // Set first nav link as active\r\n          if (navLinks \u0026\u0026 navLinks.length \u003e 0) {\r\n            (navLinks[0] as HTMLElement).classList.add('page-list-schema-modal__nav-link--active');\r\n          }\r\n          \r\n          closeBtn?.addEventListener('click', closeModal);\r\n          modal?.addEventListener('click', (e) =\u003e {\r\n            if (e.target === modal) {\r\n              closeModal();\r\n            }\r\n          });\r\n          document.addEventListener('keydown', handleEscape);\r\n        });\r\n      });\r\n      \r\n    } catch (error) {\r\n      devError('Schema validation error:', error);\r\n      statusDiv.innerHTML = `\r\n        \u003cp class=\"page-list-schema-status__text page-list-schema-status__text--error\"\u003e\r\n          Error during validation: ${error instanceof Error ? error.message : 'Unknown error'}\r\n        \u003c/p\u003e\r\n      `;\r\n    } finally {\r\n      validateBtn.removeAttribute('disabled');\r\n      validateBtn.innerHTML = '\u003cspan class=\"material-symbols-outlined\"\u003echeck_circle\u003c/span\u003e Validate All Pages';\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * ============================================================================\r\n * LLMS.TXT VALIDATION SYSTEM\r\n * ============================================================================\r\n * \r\n * Validates llms.txt file according to the llms.txt standard\r\n * Reference: https://llmstxt.org/\r\n */\r\n\r\ninterface LLMSTxtError {\r\n  type: 'error' | 'warning' | 'info';\r\n  severity: 'critical' | 'high' | 'medium' | 'low';\r\n  message: string;\r\n  line?: number;\r\n  code?: string;\r\n  suggestion?: string;\r\n}\r\n\r\ninterface LLMSTxtLink {\r\n  url: string;\r\n  name?: string;\r\n  notes?: string;\r\n  accessible: boolean;\r\n  statusCode?: number;\r\n  error?: string;\r\n}\r\n\r\ninterface LLMSTxtSection {\r\n  title: string;\r\n  isOptional: boolean;\r\n  links: LLMSTxtLink[];\r\n  lineNumber: number;\r\n}\r\n\r\ninterface LLMSTxtStructure {\r\n  h1Title: string | null;\r\n  blockquote: string | null;\r\n  freeText: string;\r\n  sections: LLMSTxtSection[];\r\n  rawContent: string;\r\n}\r\n\r\ninterface LLMSTxtValidationResult {\r\n  fileExists: boolean;\r\n  fileAccessible: boolean;\r\n  structure: LLMSTxtStructure | null;\r\n  errors: LLMSTxtError[];\r\n  warnings: LLMSTxtError[];\r\n  recommendations: LLMSTxtError[];\r\n  score: number;\r\n  scoreBreakdown: {\r\n    structure: number;\r\n    syntax: number;\r\n    links: number;\r\n    content: number;\r\n    bestPractices: number;\r\n  };\r\n  estimatedTokens: number;\r\n  suggestions: string[];\r\n}\r\n\r\n/**\r\n * Parse llms.txt file structure\r\n */\r\nfunction parseLLMSTxt(content: string): LLMSTxtStructure {\r\n  const lines = content.split('\\n');\r\n  let h1Title: string | null = null;\r\n  let blockquote: string | null = null;\r\n  let freeText: string = '';\r\n  const sections: LLMSTxtSection[] = [];\r\n  \r\n  let currentSection: LLMSTxtSection | null = null;\r\n  let inBlockquote = false;\r\n  let blockquoteLines: string[] = [];\r\n  let freeTextLines: string[] = [];\r\n  let foundH1 = false;\r\n  let foundFreeText = false;\r\n  \r\n  for (let i = 0; i \u003c lines.length; i++) {\r\n    const line = lines[i];\r\n    const trimmed = line.trim();\r\n    \r\n    // Check for H1 (# Title)\r\n    if (trimmed.startsWith('# ') \u0026\u0026 !foundH1) {\r\n      h1Title = trimmed.substring(2).trim();\r\n      foundH1 = true;\r\n      inBlockquote = false;\r\n      continue;\r\n    }\r\n    \r\n    // Check for blockquote (\u003e text)\r\n    if (foundH1 \u0026\u0026 !foundFreeText \u0026\u0026 trimmed.startsWith('\u003e')) {\r\n      inBlockquote = true;\r\n      blockquoteLines.push(trimmed.substring(1).trim());\r\n      continue;\r\n    }\r\n    \r\n    // Continue collecting blockquote content (only lines starting with \u003e or blank lines)\r\n    if (inBlockquote \u0026\u0026 !foundFreeText) {\r\n      if (trimmed.startsWith('\u003e')) {\r\n        // Continuation of blockquote\r\n        blockquoteLines.push(trimmed.substring(1).trim());\r\n        continue;\r\n      } else if (trimmed.length === 0) {\r\n        // Blank line within blockquote is allowed\r\n        continue;\r\n      } else {\r\n        // Non-blockquote content encountered, finalize blockquote\r\n        if (blockquoteLines.length \u003e 0 \u0026\u0026 !blockquote) {\r\n          const blockquoteContent = blockquoteLines.join(' ').trim();\r\n          // Only set blockquote if it has actual content (not just whitespace)\r\n          if (blockquoteContent.length \u003e 0) {\r\n            blockquote = blockquoteContent;\r\n          }\r\n        }\r\n        inBlockquote = false;\r\n        // Fall through to process this line as free text or other content\r\n      }\r\n    }\r\n    \r\n    // Check for H2 (## Section)\r\n    if (trimmed.startsWith('## ')) {\r\n      // Save previous section if exists\r\n      if (currentSection) {\r\n        sections.push(currentSection);\r\n      }\r\n      \r\n      const sectionTitle = trimmed.substring(3).trim();\r\n      currentSection = {\r\n        title: sectionTitle,\r\n        isOptional: sectionTitle.toLowerCase() === 'optional',\r\n        links: [],\r\n        lineNumber: i + 1\r\n      };\r\n      inBlockquote = false;\r\n      foundFreeText = true;\r\n      // Finalize blockquote if not already done\r\n      if (blockquoteLines.length \u003e 0 \u0026\u0026 !blockquote) {\r\n        const blockquoteContent = blockquoteLines.join(' ').trim();\r\n        // Only set blockquote if it has actual content (not just whitespace)\r\n        if (blockquoteContent.length \u003e 0) {\r\n          blockquote = blockquoteContent;\r\n        }\r\n      }\r\n      continue;\r\n    }\r\n    \r\n    // Collect free text (between H1/blockquote and first H2)\r\n    if (foundH1 \u0026\u0026 !currentSection \u0026\u0026 !inBlockquote) {\r\n      if (trimmed.length \u003e 0) {\r\n        freeTextLines.push(line);\r\n      }\r\n      foundFreeText = true;\r\n      continue;\r\n    }\r\n    \r\n    // Parse links in sections (Markdown list items)\r\n    if (currentSection \u0026\u0026 trimmed.startsWith('- ')) {\r\n      const linkContent = trimmed.substring(2).trim();\r\n      // Format: \"name\" or \"name: notes\" or URL\r\n      let url = linkContent;\r\n      let name: string | undefined;\r\n      let notes: string | undefined;\r\n      \r\n      // First, check if it's a Markdown link [text](url)\r\n      const linkMatch = linkContent.match(/\\[([^\\]]+)\\]\\(([^)]+)\\)/);\r\n      if (linkMatch) {\r\n        name = linkMatch[1];\r\n        const fullLink = linkMatch[0];\r\n        const urlPart = linkMatch[2];\r\n        url = urlPart;\r\n        \r\n        // Check if there's a description after the link (format: [text](url): description)\r\n        const afterLink = linkContent.substring(linkMatch.index! + fullLink.length).trim();\r\n        if (afterLink.startsWith(':')) {\r\n          notes = afterLink.substring(1).trim();\r\n        }\r\n      } else {\r\n        // Not a markdown link, check for name: notes format\r\n        const nameNotesMatch = linkContent.match(/^(.+?):\\s*(.+)$/);\r\n        if (nameNotesMatch) {\r\n          const namePart = nameNotesMatch[1].trim();\r\n          notes = nameNotesMatch[2].trim();\r\n          url = namePart;\r\n        }\r\n      }\r\n      \r\n      currentSection.links.push({\r\n        url: url.trim(),\r\n        name,\r\n        notes,\r\n        accessible: false // Will be checked later\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Add last section\r\n  if (currentSection) {\r\n    sections.push(currentSection);\r\n  }\r\n  \r\n  // Finalize blockquote if still collecting\r\n  if (blockquoteLines.length \u003e 0 \u0026\u0026 !blockquote) {\r\n    const blockquoteContent = blockquoteLines.join(' ').trim();\r\n    // Only set blockquote if it has actual content (not just whitespace)\r\n    if (blockquoteContent.length \u003e 0) {\r\n      blockquote = blockquoteContent;\r\n    }\r\n  }\r\n  \r\n  return {\r\n    h1Title,\r\n    blockquote: blockquote || null,\r\n    freeText: freeTextLines.join('\\n').trim(),\r\n    sections,\r\n    rawContent: content\r\n  };\r\n}\r\n\r\n/**\r\n * Validate llms.txt structure\r\n */\r\nfunction validateLLMSTxtStructure(structure: LLMSTxtStructure): LLMSTxtError[] {\r\n  const errors: LLMSTxtError[] = [];\r\n  \r\n  // Check for H1\r\n  if (!structure.h1Title) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'critical',\r\n      message: 'Missing H1 header. The file must start with a single # header containing the project/site name.',\r\n      code: 'MISSING_H1',\r\n      suggestion: 'Add an H1 header at the top: # Your Site Name'\r\n    });\r\n  }\r\n  \r\n  // Check for headings in free text (only H1 and H2 allowed, no H3+)\r\n  const freeTextLines = structure.freeText.split('\\n');\r\n  for (let i = 0; i \u003c freeTextLines.length; i++) {\r\n    const line = freeTextLines[i].trim();\r\n    if (line.startsWith('###')) {\r\n      errors.push({\r\n        type: 'error',\r\n        severity: 'high',\r\n        message: `Invalid heading level in free text area: \"${line.substring(0, 50)}\". Only H1 and H2 headings are allowed per llms.txt spec.`,\r\n        line: i + 1,\r\n        code: 'INVALID_HEADING_LEVEL',\r\n        suggestion: 'Remove H3+ headings from the free text area. Use H2 sections for organization.'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Check for multiple H1s\r\n  const h1Count = (structure.rawContent.match(/^# [^#]/gm) || []).length;\r\n  if (h1Count \u003e 1) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'critical',\r\n      message: `Multiple H1 headers found (${h1Count}). Only one H1 is allowed per llms.txt spec.`,\r\n      code: 'MULTIPLE_H1',\r\n      suggestion: 'Remove extra H1 headers. The file should start with a single H1 containing the site/project name.'\r\n    });\r\n  }\r\n  \r\n  // Check structure order: H1 \u003e blockquote (optional) \u003e free text \u003e H2 sections\r\n  const lines = structure.rawContent.split('\\n');\r\n  let foundH1 = false;\r\n  let foundBlockquote = false;\r\n  let foundFreeText = false;\r\n  let foundH2 = false;\r\n  let orderViolations: number[] = [];\r\n  \r\n  for (let i = 0; i \u003c lines.length; i++) {\r\n    const line = lines[i].trim();\r\n    if (line.startsWith('# ') \u0026\u0026 !line.startsWith('##')) {\r\n      foundH1 = true;\r\n      if (foundBlockquote || foundFreeText || foundH2) {\r\n        orderViolations.push(i + 1);\r\n      }\r\n    } else if (line.startsWith('\u003e') \u0026\u0026 foundH1 \u0026\u0026 !foundFreeText \u0026\u0026 !foundH2) {\r\n      foundBlockquote = true;\r\n    } else if (foundH1 \u0026\u0026 !line.startsWith('#') \u0026\u0026 !line.startsWith('\u003e') \u0026\u0026 line.length \u003e 0 \u0026\u0026 !foundH2) {\r\n      foundFreeText = true;\r\n    } else if (line.startsWith('## ')) {\r\n      foundH2 = true;\r\n    }\r\n  }\r\n  \r\n  if (orderViolations.length \u003e 0) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'high',\r\n      message: `Structure order violation: H1 must come first, followed by optional blockquote, free text, then H2 sections.`,\r\n      code: 'STRUCTURE_ORDER_VIOLATION',\r\n      suggestion: 'Reorganize the file to follow the required order: H1 \u003e blockquote (optional) \u003e free text \u003e H2 sections.'\r\n    });\r\n  }\r\n  \r\n  // Check for blockquote (recommended but not required)\r\n  if (!structure.blockquote || structure.blockquote.trim().length === 0) {\r\n    errors.push({\r\n      type: 'warning',\r\n      severity: 'low',\r\n      message: 'Missing blockquote summary. A blockquote after H1 is recommended for a concise site description.',\r\n      code: 'MISSING_BLOCKQUOTE',\r\n      suggestion: 'Add a blockquote summary after the H1 header to help LLMs understand your site quickly.'\r\n    });\r\n  }\r\n  \r\n  // Check section structure\r\n  if (structure.sections.length === 0) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'critical',\r\n      message: 'No H2 sections found. The file must contain at least one section with file links.',\r\n      code: 'NO_SECTIONS',\r\n      suggestion: 'Add H2 sections (## Section Name) with lists of links to important content.'\r\n    });\r\n  }\r\n  \r\n  // Validate link formats\r\n  structure.sections.forEach((section, sectionIndex) =\u003e {\r\n    section.links.forEach((link, linkIndex) =\u003e {\r\n      // Skip validation for URLs containing template syntax (e.g., Hugo templates with {{ ... }})\r\n      // These will be resolved when the template is rendered\r\n      if (link.url.includes('{{') || link.url.includes('}}')) {\r\n        return; // Skip validation for template variables\r\n      }\r\n      \r\n      // Check for valid URL format\r\n      try {\r\n        new URL(link.url);\r\n      } catch {\r\n        // Not an absolute URL, check if it's a relative path\r\n        if (!link.url.startsWith('/') \u0026\u0026 !link.url.startsWith('./') \u0026\u0026 !link.url.startsWith('../')) {\r\n          errors.push({\r\n            type: 'error',\r\n            severity: 'high',\r\n            message: `Invalid URL format in section \"${section.title}\": \"${link.url}\". URLs must be absolute or valid relative paths.`,\r\n            line: section.lineNumber + linkIndex + 1,\r\n            code: 'INVALID_URL_FORMAT',\r\n            suggestion: 'Use absolute URLs (https://...) or relative paths starting with /'\r\n          });\r\n        }\r\n      }\r\n      \r\n      // Check for .md extension or markdown-friendly format\r\n      if (link.url \u0026\u0026 !link.url.match(/\\.(md|markdown)$/i) \u0026\u0026 !link.url.includes('#') \u0026\u0026 !link.url.match(/\\/$/)) {\r\n        errors.push({\r\n          type: 'warning',\r\n          severity: 'medium',\r\n          message: `Link \"${link.url}\" does not point to a .md file. Consider using .md versions for better LLM compatibility.`,\r\n          line: section.lineNumber + linkIndex + 1,\r\n          code: 'NON_MARKDOWN_LINK',\r\n          suggestion: 'Use .md versions of pages when available, or append .md to HTML URLs if your site supports it.'\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Check for too many links (best practice: 5-10)\r\n    if (!section.isOptional \u0026\u0026 section.links.length \u003e 10) {\r\n      errors.push({\r\n        type: 'warning',\r\n        severity: 'medium',\r\n        message: `Section \"${section.title}\" has ${section.links.length} links. Best practice is to limit to 5-10 high-value links.`,\r\n        code: 'TOO_MANY_LINKS',\r\n        suggestion: 'Consider curating links to focus on the most important, evergreen content for LLMs.'\r\n      });\r\n    }\r\n  });\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate Markdown syntax\r\n */\r\nfunction validateMarkdownSyntax(content: string): LLMSTxtError[] {\r\n  const errors: LLMSTxtError[] = [];\r\n  const lines = content.split('\\n');\r\n  \r\n  // Check for balanced lists\r\n  let inList = false;\r\n  let listDepth = 0;\r\n  \r\n  for (let i = 0; i \u003c lines.length; i++) {\r\n    const line = lines[i];\r\n    const trimmed = line.trim();\r\n    \r\n    if (trimmed.match(/^[-*+]\\s/)) {\r\n      if (!inList) inList = true;\r\n    } else if (inList \u0026\u0026 trimmed.length === 0) {\r\n      // Empty line might end list\r\n      continue;\r\n    } else if (inList \u0026\u0026 !trimmed.match(/^[-*+]\\s/) \u0026\u0026 trimmed.length \u003e 0) {\r\n      // Non-list item after list - list might be broken\r\n      if (!trimmed.startsWith('#') \u0026\u0026 !trimmed.startsWith('\u003e')) {\r\n        // Potential issue, but not always an error\r\n      }\r\n    }\r\n    \r\n    // Check for malformed links\r\n    const linkMatches = line.matchAll(/\\[([^\\]]*)\\]\\(([^)]*)\\)/g);\r\n    for (const match of linkMatches) {\r\n      if (!match[1] || !match[2]) {\r\n        errors.push({\r\n          type: 'error',\r\n          severity: 'high',\r\n          message: `Malformed Markdown link: \"${match[0]}\"`,\r\n          line: i + 1,\r\n          code: 'MALFORMED_LINK',\r\n          suggestion: 'Links must be in format [text](url) with both text and URL.'\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Check for unclosed code blocks (basic check)\r\n    const codeBlockCount = (line.match(/```/g) || []).length;\r\n    if (codeBlockCount % 2 !== 0) {\r\n      errors.push({\r\n        type: 'warning',\r\n        severity: 'low',\r\n        message: 'Possible unclosed code block',\r\n        line: i + 1,\r\n        code: 'UNCLOSED_CODE_BLOCK'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Check encoding (basic UTF-8 check)\r\n  try {\r\n    const encoder = new TextEncoder();\r\n    encoder.encode(content);\r\n  } catch (e) {\r\n    errors.push({\r\n      type: 'error',\r\n      severity: 'critical',\r\n      message: 'File contains invalid characters. Must be UTF-8 encoded.',\r\n      code: 'INVALID_ENCODING',\r\n      suggestion: 'Ensure the file is saved as UTF-8 encoding.'\r\n    });\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Estimate token count (rough approximation)\r\n */\r\nfunction estimateTokenCount(text: string): number {\r\n  // Rough estimate: ~4 characters per token for English text\r\n  return Math.ceil(text.length / 4);\r\n}\r\n\r\n/**\r\n * Convert production URLs to localhost URLs when running in development\r\n */\r\nfunction convertToLocalhostUrl(url: string, baseUrl: string): string {\r\n  const isLocalhost = baseUrl.includes('localhost') || baseUrl.includes('127.0.0.1') || baseUrl.includes('0.0.0.0');\r\n  if (!isLocalhost || !url.startsWith('http://') \u0026\u0026 !url.startsWith('https://')) {\r\n    return url;\r\n  }\r\n  \r\n  try {\r\n    const urlObj = new URL(url);\r\n    // Check if this is a production URL (different domain than localhost)\r\n    const productionDomains = ['appliancesrepairservice.ca', 'www.appliancesrepairservice.ca'];\r\n    const isProductionUrl = productionDomains.some(domain =\u003e urlObj.hostname === domain || urlObj.hostname.endsWith('.' + domain));\r\n    \r\n    if (isProductionUrl) {\r\n      // Convert production URL to localhost URL\r\n      return baseUrl + urlObj.pathname + urlObj.search + urlObj.hash;\r\n    }\r\n  } catch {\r\n    // If URL parsing fails, use as-is\r\n  }\r\n  \r\n  return url;\r\n}\r\n\r\n/**\r\n * Check if a URL is accessible\r\n */\r\nasync function checkLinkAccessibility(url: string, baseUrl: string = window.location.origin): Promise\u003c{ accessible: boolean; statusCode?: number; error?: string }\u003e {\r\n  try {\r\n    // Convert relative URLs to absolute\r\n    let absoluteUrl = url;\r\n    if (!url.startsWith('http://') \u0026\u0026 !url.startsWith('https://')) {\r\n      if (url.startsWith('/')) {\r\n        absoluteUrl = baseUrl + url;\r\n      } else {\r\n        absoluteUrl = baseUrl + '/' + url;\r\n      }\r\n    } else {\r\n      // Convert production URLs to localhost URLs in development\r\n      absoluteUrl = convertToLocalhostUrl(url, baseUrl);\r\n    }\r\n    \r\n    const response = await fetch(absoluteUrl, { method: 'HEAD', redirect: 'follow' });\r\n    return {\r\n      accessible: response.ok,\r\n      statusCode: response.status\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      accessible: false,\r\n      error: error instanceof Error ? error.message : 'Unknown error'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a .md version of a URL exists\r\n */\r\nasync function checkMarkdownVersion(url: string, baseUrl: string = window.location.origin): Promise\u003c{ exists: boolean; mdUrl?: string }\u003e {\r\n  // If already .md, return true\r\n  if (url.match(/\\.(md|markdown)$/i)) {\r\n    return { exists: true, mdUrl: url };\r\n  }\r\n  \r\n  // Extract pathname from URL (handles both absolute and relative URLs)\r\n  let pathname = url;\r\n  if (url.startsWith('http://') || url.startsWith('https://')) {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      pathname = urlObj.pathname;\r\n    } catch {\r\n      // If URL parsing fails, try to extract pathname manually\r\n      const match = url.match(/https?:\\/\\/[^\\/]+(\\/.*)/);\r\n      if (match) {\r\n        pathname = match[1];\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Try common .md patterns\r\n  const mdPatterns = [\r\n    pathname.replace(/\\.html?$/, '.md'),\r\n    pathname + '.md',\r\n    pathname.replace(/\\/$/, '.md'),\r\n    pathname + '/index.md'\r\n  ];\r\n  \r\n  for (const mdPath of mdPatterns) {\r\n    try {\r\n      // Always use baseUrl (localhost in dev) for checking .md files\r\n      const absoluteUrl = mdPath.startsWith('/') ? baseUrl + mdPath : baseUrl + '/' + mdPath;\r\n      const response = await fetch(absoluteUrl, { method: 'HEAD', redirect: 'follow' });\r\n      if (response.ok) {\r\n        return { exists: true, mdUrl: mdPath };\r\n      }\r\n    } catch {\r\n      // Continue to next pattern\r\n    }\r\n  }\r\n  \r\n  return { exists: false };\r\n}\r\n\r\n/**\r\n * Validate all links in llms.txt structure\r\n */\r\nasync function validateLLMSTxtLinks(structure: LLMSTxtStructure, baseUrl: string = window.location.origin): Promise\u003c{ links: LLMSTxtLink[]; errors: LLMSTxtError[] }\u003e {\r\n  const errors: LLMSTxtError[] = [];\r\n  const allLinks: LLMSTxtLink[] = [];\r\n  const seenUrls = new Set\u003cstring\u003e();\r\n  \r\n  for (const section of structure.sections) {\r\n    for (let i = 0; i \u003c section.links.length; i++) {\r\n      const link = section.links[i];\r\n      const normalizedUrl = link.url.toLowerCase().split('#')[0]; // Remove fragments for duplicate check\r\n      \r\n      // Check for duplicates\r\n      if (seenUrls.has(normalizedUrl)) {\r\n        errors.push({\r\n          type: 'warning',\r\n          severity: 'medium',\r\n          message: `Duplicate link found: \"${link.url}\"`,\r\n          code: 'DUPLICATE_LINK',\r\n          suggestion: 'Remove duplicate links to keep the file concise.'\r\n        });\r\n      } else {\r\n        seenUrls.add(normalizedUrl);\r\n      }\r\n      \r\n      // Check for .md version\r\n      const mdCheck = await checkMarkdownVersion(link.url, baseUrl);\r\n      if (!mdCheck.exists \u0026\u0026 !link.url.match(/\\.(md|markdown)$/i)) {\r\n        errors.push({\r\n          type: 'warning',\r\n          severity: 'low',\r\n          message: `Link \"${link.url}\" does not point to a .md file and no .md version found.`,\r\n          code: 'NON_MARKDOWN_LINK',\r\n          suggestion: 'Consider using .md versions of pages for better LLM compatibility, or ensure HTML pages have .md equivalents.'\r\n        });\r\n      }\r\n      \r\n      // Check accessibility\r\n      const checkResult = await checkLinkAccessibility(link.url, baseUrl);\r\n      \r\n      const validatedLink: LLMSTxtLink = {\r\n        ...link,\r\n        accessible: checkResult.accessible,\r\n        statusCode: checkResult.statusCode,\r\n        error: checkResult.error\r\n      };\r\n      \r\n      allLinks.push(validatedLink);\r\n      \r\n      if (!checkResult.accessible) {\r\n        errors.push({\r\n          type: 'error',\r\n          severity: checkResult.statusCode === 404 ? 'high' : 'medium',\r\n          message: `Link \"${link.url}\" is not accessible${checkResult.statusCode ? ` (HTTP ${checkResult.statusCode})` : ''}`,\r\n          code: 'INACCESSIBLE_LINK',\r\n          suggestion: checkResult.statusCode === 404 \r\n            ? 'Check if the URL is correct or if the page exists.'\r\n            : 'Verify the URL is correct and the server is accessible.'\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n  return { links: allLinks, errors };\r\n}\r\n\r\n/**\r\n * Calculate llms.txt quality score\r\n */\r\nfunction calculateLLMSTxtScore(\r\n  structure: LLMSTxtStructure | null,\r\n  structureErrors: LLMSTxtError[],\r\n  syntaxErrors: LLMSTxtError[],\r\n  linkErrors: LLMSTxtError[],\r\n  allLinks: LLMSTxtLink[],\r\n  estimatedTokens: number\r\n): { score: number; breakdown: LLMSTxtValidationResult['scoreBreakdown'] } {\r\n  if (!structure) {\r\n    return {\r\n      score: 0,\r\n      breakdown: { structure: 0, syntax: 0, links: 0, content: 0, bestPractices: 0 }\r\n    };\r\n  }\r\n  \r\n  let structureScore = 100;\r\n  let syntaxScore = 100;\r\n  let linksScore = 100;\r\n  let contentScore = 100;\r\n  let bestPracticesScore = 100;\r\n  \r\n  // Structure scoring (30% weight)\r\n  const criticalStructureErrors = structureErrors.filter(e =\u003e e.severity === 'critical').length;\r\n  const highStructureErrors = structureErrors.filter(e =\u003e e.severity === 'high').length;\r\n  structureScore -= criticalStructureErrors * 30;\r\n  structureScore -= highStructureErrors * 15;\r\n  structureScore = Math.max(0, structureScore);\r\n  \r\n  // Syntax scoring (20% weight)\r\n  const criticalSyntaxErrors = syntaxErrors.filter(e =\u003e e.severity === 'critical').length;\r\n  const highSyntaxErrors = syntaxErrors.filter(e =\u003e e.severity === 'high').length;\r\n  syntaxScore -= criticalSyntaxErrors * 25;\r\n  syntaxScore -= highSyntaxErrors * 10;\r\n  syntaxScore = Math.max(0, syntaxScore);\r\n  \r\n  // Links scoring (25% weight)\r\n  const accessibleLinks = allLinks.filter(l =\u003e l.accessible).length;\r\n  const totalLinks = allLinks.length;\r\n  if (totalLinks \u003e 0) {\r\n    linksScore = Math.round((accessibleLinks / totalLinks) * 100);\r\n  }\r\n  \r\n  // Content scoring (15% weight)\r\n  if (!structure.blockquote) {\r\n    contentScore -= 10;\r\n  }\r\n  if (structure.freeText.length \u003c 50) {\r\n    contentScore -= 5;\r\n  }\r\n  if (structure.sections.length === 0) {\r\n    contentScore -= 20;\r\n  }\r\n  contentScore = Math.max(0, contentScore);\r\n  \r\n  // Best practices scoring (10% weight)\r\n  const totalLinksCount = allLinks.length;\r\n  if (totalLinksCount \u003e 15) {\r\n    bestPracticesScore -= 15; // Too many links\r\n  }\r\n  if (estimatedTokens \u003e 8000) {\r\n    bestPracticesScore -= 10; // Too long\r\n  }\r\n  const optionalSections = structure.sections.filter(s =\u003e s.isOptional).length;\r\n  if (optionalSections === 0 \u0026\u0026 totalLinksCount \u003e 10) {\r\n    bestPracticesScore -= 5; // Should use Optional section\r\n  }\r\n  bestPracticesScore = Math.max(0, bestPracticesScore);\r\n  \r\n  // Weighted overall score\r\n  const overallScore = Math.round(\r\n    structureScore * 0.30 +\r\n    syntaxScore * 0.20 +\r\n    linksScore * 0.25 +\r\n    contentScore * 0.15 +\r\n    bestPracticesScore * 0.10\r\n  );\r\n  \r\n  return {\r\n    score: overallScore,\r\n    breakdown: {\r\n      structure: structureScore,\r\n      syntax: syntaxScore,\r\n      links: linksScore,\r\n      content: contentScore,\r\n      bestPractices: bestPracticesScore\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Validate llms.txt file\r\n */\r\nasync function validateLLMSTxt(): Promise\u003cLLMSTxtValidationResult\u003e {\r\n  try {\r\n    // Try to fetch llms.txt\r\n    const response = await fetch('/llms.txt');\r\n    \r\n    if (!response.ok) {\r\n      return {\r\n        fileExists: false,\r\n        fileAccessible: false,\r\n        structure: null,\r\n        errors: [{\r\n          type: 'error',\r\n          severity: 'critical',\r\n          message: `llms.txt file not found at /llms.txt (HTTP ${response.status})`,\r\n          code: 'FILE_NOT_FOUND',\r\n          suggestion: 'Create an llms.txt file at the root of your site (e.g., /public/llms.txt in Hugo)'\r\n        }],\r\n        warnings: [],\r\n        recommendations: [],\r\n        score: 0,\r\n        scoreBreakdown: { structure: 0, syntax: 0, links: 0, content: 0, bestPractices: 0 },\r\n        estimatedTokens: 0,\r\n        suggestions: ['Create an llms.txt file following the standard at https://llmstxt.org/']\r\n      };\r\n    }\r\n    \r\n    const content = await response.text();\r\n    const structure = parseLLMSTxt(content);\r\n    const structureErrors = validateLLMSTxtStructure(structure);\r\n    const syntaxErrors = validateMarkdownSyntax(content);\r\n    \r\n    // Validate links\r\n    const { links: validatedLinks, errors: linkErrors } = await validateLLMSTxtLinks(structure);\r\n    \r\n    // Update structure with validated links\r\n    let linkIndex = 0;\r\n    structure.sections.forEach(section =\u003e {\r\n      section.links = validatedLinks.slice(linkIndex, linkIndex + section.links.length);\r\n      linkIndex += section.links.length;\r\n    });\r\n    \r\n    // Separate errors, warnings, and recommendations\r\n    const allErrors = [...structureErrors, ...syntaxErrors, ...linkErrors];\r\n    const errors = allErrors.filter(e =\u003e e.type === 'error');\r\n    const warnings = allErrors.filter(e =\u003e e.type === 'warning');\r\n    \r\n    // Generate recommendations\r\n    const recommendations: LLMSTxtError[] = [];\r\n    if (!structure.blockquote) {\r\n      recommendations.push({\r\n        type: 'info',\r\n        severity: 'low',\r\n        message: 'Add a blockquote summary after H1 to help LLMs understand your site quickly.',\r\n        code: 'RECOMMEND_BLOCKQUOTE'\r\n      });\r\n    }\r\n    \r\n    const estimatedTokens = estimateTokenCount(content);\r\n    if (estimatedTokens \u003e 8000) {\r\n      recommendations.push({\r\n        type: 'info',\r\n        severity: 'medium',\r\n        message: `File is approximately ${estimatedTokens} tokens. Consider keeping under 8000 tokens for better context window efficiency.`,\r\n        code: 'TOO_LONG'\r\n      });\r\n    }\r\n    \r\n    const totalLinks = validatedLinks.length;\r\n    if (totalLinks \u003e 15) {\r\n      recommendations.push({\r\n        type: 'info',\r\n        severity: 'medium',\r\n        message: `File contains ${totalLinks} links. Consider using an \"Optional\" section for less critical links.`,\r\n        code: 'TOO_MANY_LINKS'\r\n      });\r\n    }\r\n    \r\n    const { score, breakdown } = calculateLLMSTxtScore(\r\n      structure,\r\n      structureErrors,\r\n      syntaxErrors,\r\n      linkErrors,\r\n      validatedLinks,\r\n      estimatedTokens\r\n    );\r\n    \r\n    // Generate suggestions\r\n    const suggestions: string[] = [];\r\n    if (errors.length \u003e 0) {\r\n      suggestions.push('Fix critical errors to improve llms.txt quality');\r\n    }\r\n    if (warnings.length \u003e 0) {\r\n      suggestions.push('Address warnings to enhance compliance with best practices');\r\n    }\r\n    if (score \u003c 80) {\r\n      suggestions.push('Consider reviewing the llms.txt standard at https://llmstxt.org/ for guidance');\r\n    }\r\n    \r\n    return {\r\n      fileExists: true,\r\n      fileAccessible: true,\r\n      structure,\r\n      errors,\r\n      warnings,\r\n      recommendations,\r\n      score,\r\n      scoreBreakdown: breakdown,\r\n      estimatedTokens,\r\n      suggestions\r\n    };\r\n    \r\n  } catch (error) {\r\n    return {\r\n      fileExists: false,\r\n      fileAccessible: false,\r\n      structure: null,\r\n      errors: [{\r\n        type: 'error',\r\n        severity: 'critical',\r\n        message: `Error fetching llms.txt: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        code: 'FETCH_ERROR',\r\n        suggestion: 'Ensure llms.txt is accessible at /llms.txt'\r\n      }],\r\n      warnings: [],\r\n      recommendations: [],\r\n      score: 0,\r\n      scoreBreakdown: { structure: 0, syntax: 0, links: 0, content: 0, bestPractices: 0 },\r\n      estimatedTokens: 0,\r\n      suggestions: []\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Render llms.txt validation section\r\n */\r\nfunction renderLLMSSection(): string {\r\n  return `\r\n    \u003cdiv class=\"page-list-llms\"\u003e\r\n      \u003cdiv class=\"page-list-llms__header\"\u003e\r\n        \u003cdiv class=\"page-list-llms__info\"\u003e\r\n          \u003ch2 class=\"page-list-llms__title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003edescription\u003c/span\u003e\r\n            LLMs.txt Validation\r\n          \u003c/h2\u003e\r\n          \u003cp class=\"page-list-llms__description\"\u003eValidate llms.txt file quality and compliance with the \u003ca href=\"https://llmstxt.org/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ellms.txt standard\u003c/a\u003e\u003c/p\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-llms__actions\"\u003e\r\n          \u003cbutton \r\n            type=\"button\" \r\n            class=\"page-list-llms__action-button\"\r\n            id=\"page-list-llms-generate-template\"\r\n            aria-label=\"Generate llms.txt template\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003eadd\u003c/span\u003e\r\n            Generate Template\r\n          \u003c/button\u003e\r\n          \u003ca \r\n            href=\"https://llmstxtchecker.net/?url=${encodeURIComponent(window.location.origin)}\" \r\n            target=\"_blank\" \r\n            rel=\"noopener noreferrer\"\r\n            class=\"page-list-llms__action-button page-list-llms__action-button--link\"\r\n            aria-label=\"Validate externally on llmstxtchecker.net\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003eopen_in_new\u003c/span\u003e\r\n            Validate Externally\r\n          \u003c/a\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-llms__results\" id=\"page-list-llms-results\"\u003e\r\n        \u003cdiv class=\"page-list-llms-loading\"\u003e\r\n          \u003cdiv class=\"page-list-llms-loading__spinner\"\u003e\u003c/div\u003e\r\n          \u003cp class=\"page-list-llms-loading__text\"\u003eValidating llms.txt...\u003c/p\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Generate llms.txt template\r\n */\r\nfunction generateLLMSTxtTemplate(siteName: string = 'Your Site Name'): string {\r\n  return `# ${siteName}\r\n\r\n\u003e Brief description of your site and what it offers. This helps LLMs understand your content quickly.\r\n\r\nAdditional context about your site, its purpose, and key information that LLMs should know.\r\n\r\n## Core Content\r\n\r\n- [About Us](/about-us.md): Learn more about our company and mission\r\n- [Services](/services.md): Our main service offerings\r\n- [Contact](/contact.md): How to reach us\r\n\r\n## Documentation\r\n\r\n- [Getting Started](/docs/getting-started.md): Quick start guide\r\n- [FAQ](/docs/faq.md): Frequently asked questions\r\n\r\n## Optional\r\n\r\n- [Blog](/blog.md): Latest articles and updates\r\n- [Resources](/resources.md): Additional resources and tools\r\n`;\r\n}\r\n\r\n/**\r\n * Render llms.txt validation results\r\n */\r\nfunction renderLLMSResults(result: LLMSTxtValidationResult): string {\r\n  if (!result.fileExists) {\r\n    return `\r\n      \u003cdiv class=\"page-list-llms-empty\"\u003e\r\n        \u003cdiv class=\"page-list-llms-empty__icon\"\u003e📄\u003c/div\u003e\r\n        \u003ch3 class=\"page-list-llms-empty__title\"\u003ellms.txt file not found\u003c/h3\u003e\r\n        \u003cp class=\"page-list-llms-empty__text\"\u003eThe llms.txt file was not found at /llms.txt\u003c/p\u003e\r\n        \u003cdiv class=\"page-list-llms-empty__suggestion\"\u003e\r\n          \u003cp\u003eCreate an llms.txt file at the root of your site following the \u003ca href=\"https://llmstxt.org/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ellms.txt standard\u003c/a\u003e.\u003c/p\u003e\r\n          \u003cp\u003eClick \"Generate Template\" above to create a basic template, or visit \u003ca href=\"https://llmstxt.org/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ellmstxt.org\u003c/a\u003e for the full specification.\u003c/p\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n  \r\n  const scoreClass = result.score \u003e= 80 \r\n    ? 'page-list-llms-score--good'\r\n    : result.score \u003e= 60 \r\n      ? 'page-list-llms-score--warning'\r\n      : 'page-list-llms-score--bad';\r\n  \r\n  let html = `\r\n    \u003cdiv class=\"page-list-llms-summary\"\u003e\r\n      \u003cdiv class=\"page-list-llms-summary__overview\"\u003e\r\n        \u003cdiv class=\"page-list-llms-summary__score\"\u003e\r\n          \u003cdiv class=\"page-list-llms-score ${scoreClass}\"\u003e\r\n            \u003cdiv class=\"page-list-llms-score__value\"\u003e${result.score}\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-score__label\"\u003eQuality Score\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-llms-summary__stats\"\u003e\r\n          \u003cdiv class=\"page-list-llms-summary__stat\"\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-value ${result.errors.length === 0 ? 'page-list-llms-summary__stat-value--good' : 'page-list-llms-summary__stat-value--bad'}\"\u003e${result.errors.length}\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-label\"\u003eErrors\u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-summary__stat\"\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-value ${result.warnings.length === 0 ? 'page-list-llms-summary__stat-value--good' : 'page-list-llms-summary__stat-value--warning'}\"\u003e${result.warnings.length}\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-label\"\u003eWarnings\u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-summary__stat\"\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-value\"\u003e${result.estimatedTokens}\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-label\"\u003eTokens (est.)\u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-summary__stat\"\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-value\"\u003e${result.structure?.sections.length || 0}\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-summary__stat-label\"\u003eSections\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \r\n      \u003cdiv class=\"page-list-llms-summary__breakdown\"\u003e\r\n        \u003ch3 class=\"page-list-llms-summary__breakdown-title\"\u003eScore Breakdown\u003c/h3\u003e\r\n        \u003cdiv class=\"page-list-llms-summary__breakdown-scores\"\u003e\r\n          \u003cdiv class=\"page-list-llms-breakdown-score\"\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__label\"\u003eStructure:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__value\"\u003e${result.scoreBreakdown.structure}%\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-breakdown-score\"\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__label\"\u003eSyntax:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__value\"\u003e${result.scoreBreakdown.syntax}%\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-breakdown-score\"\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__label\"\u003eLinks:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__value\"\u003e${result.scoreBreakdown.links}%\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-breakdown-score\"\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__label\"\u003eContent:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__value\"\u003e${result.scoreBreakdown.content}%\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-breakdown-score\"\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__label\"\u003eBest Practices:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-llms-breakdown-score__value\"\u003e${result.scoreBreakdown.bestPractices}%\u003c/span\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n    \r\n    \u003cdiv class=\"page-list-llms-details\"\u003e\r\n      ${result.errors.length \u003e 0 ? `\r\n        \u003cdiv class=\"page-list-llms-errors\"\u003e\r\n          \u003ch3 class=\"page-list-llms-errors__title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003eerror\u003c/span\u003e\r\n            Errors (${result.errors.length})\r\n          \u003c/h3\u003e\r\n          \u003cul class=\"page-list-llms-errors__list\"\u003e\r\n            ${result.errors.map(error =\u003e `\r\n              \u003cli class=\"page-list-llms-error-item\"\u003e\r\n                \u003cdiv class=\"page-list-llms-error-item__header\"\u003e\r\n                  \u003cspan class=\"page-list-llms-error-item__severity severity-${error.severity}\"\u003e${error.severity}\u003c/span\u003e\r\n                  ${error.line ? `\u003cspan class=\"page-list-llms-error-item__line\"\u003eLine ${error.line}\u003c/span\u003e` : ''}\r\n                  ${error.code ? `\u003cspan class=\"page-list-llms-error-item__code\"\u003e${error.code}\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-llms-error-item__message\"\u003e${escapeHtml(error.message)}\u003c/div\u003e\r\n                ${error.suggestion ? `\u003cdiv class=\"page-list-llms-error-item__suggestion\"\u003e💡 ${escapeHtml(error.suggestion)}\u003c/div\u003e` : ''}\r\n              \u003c/li\u003e\r\n            `).join('')}\r\n          \u003c/ul\u003e\r\n        \u003c/div\u003e\r\n      ` : ''}\r\n      \r\n      ${result.warnings.length \u003e 0 ? `\r\n        \u003cdiv class=\"page-list-llms-warnings\"\u003e\r\n          \u003ch3 class=\"page-list-llms-warnings__title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003ewarning\u003c/span\u003e\r\n            Warnings (${result.warnings.length})\r\n          \u003c/h3\u003e\r\n          \u003cul class=\"page-list-llms-warnings__list\"\u003e\r\n            ${result.warnings.map(warning =\u003e `\r\n              \u003cli class=\"page-list-llms-warning-item\"\u003e\r\n                \u003cdiv class=\"page-list-llms-warning-item__header\"\u003e\r\n                  \u003cspan class=\"page-list-llms-warning-item__severity severity-${warning.severity}\"\u003e${warning.severity}\u003c/span\u003e\r\n                  ${warning.line ? `\u003cspan class=\"page-list-llms-warning-item__line\"\u003eLine ${warning.line}\u003c/span\u003e` : ''}\r\n                  ${warning.code ? `\u003cspan class=\"page-list-llms-warning-item__code\"\u003e${warning.code}\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-llms-warning-item__message\"\u003e${escapeHtml(warning.message)}\u003c/div\u003e\r\n                ${warning.suggestion ? `\u003cdiv class=\"page-list-llms-warning-item__suggestion\"\u003e💡 ${escapeHtml(warning.suggestion)}\u003c/div\u003e` : ''}\r\n              \u003c/li\u003e\r\n            `).join('')}\r\n          \u003c/ul\u003e\r\n        \u003c/div\u003e\r\n      ` : ''}\r\n      \r\n      ${result.recommendations.length \u003e 0 ? `\r\n        \u003cdiv class=\"page-list-llms-recommendations\"\u003e\r\n          \u003ch3 class=\"page-list-llms-recommendations__title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003elightbulb\u003c/span\u003e\r\n            Recommendations (${result.recommendations.length})\r\n          \u003c/h3\u003e\r\n          \u003cul class=\"page-list-llms-recommendations__list\"\u003e\r\n            ${result.recommendations.map(rec =\u003e `\r\n              \u003cli class=\"page-list-llms-recommendation-item\"\u003e\r\n                \u003cdiv class=\"page-list-llms-recommendation-item__header\"\u003e\r\n                  \u003cspan class=\"page-list-llms-recommendation-item__severity severity-${rec.severity}\"\u003e${rec.severity}\u003c/span\u003e\r\n                  ${rec.code ? `\u003cspan class=\"page-list-llms-recommendation-item__code\"\u003e${rec.code}\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n                \u003cdiv class=\"page-list-llms-recommendation-item__message\"\u003e${escapeHtml(rec.message)}\u003c/div\u003e\r\n              \u003c/li\u003e\r\n            `).join('')}\r\n          \u003c/ul\u003e\r\n        \u003c/div\u003e\r\n      ` : ''}\r\n      \r\n      ${result.structure ? `\r\n        \u003cdiv class=\"page-list-llms-structure\"\u003e\r\n          \u003ch3 class=\"page-list-llms-structure__title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003earticle\u003c/span\u003e\r\n            File Structure\r\n          \u003c/h3\u003e\r\n          \u003cdiv class=\"page-list-llms-structure__content\"\u003e\r\n            \u003cdiv class=\"page-list-llms-structure-item\"\u003e\r\n              \u003cstrong\u003eH1 Title:\u003c/strong\u003e ${result.structure.h1Title ? escapeHtml(result.structure.h1Title) : '\u003cem\u003eMissing\u003c/em\u003e'}\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-structure-item\"\u003e\r\n              \u003cstrong\u003eBlockquote:\u003c/strong\u003e ${result.structure.blockquote ? escapeHtml(result.structure.blockquote.substring(0, 100)) + (result.structure.blockquote.length \u003e 100 ? '...' : '') : '\u003cem\u003eMissing\u003c/em\u003e'}\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-structure-item\"\u003e\r\n              \u003cstrong\u003eFree Text:\u003c/strong\u003e ${result.structure.freeText.length \u003e 0 ? `${result.structure.freeText.split('\\n').length} lines` : '\u003cem\u003eEmpty\u003c/em\u003e'}\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-structure-item\"\u003e\r\n              \u003cstrong\u003eSections:\u003c/strong\u003e ${result.structure.sections.length}\r\n              ${result.structure.sections.map(section =\u003e `\r\n                \u003cdiv class=\"page-list-llms-structure-section\"\u003e\r\n                  \u003cstrong\u003e${escapeHtml(section.title)}\u003c/strong\u003e ${section.isOptional ? '(Optional)' : ''} - ${section.links.length} link${section.links.length !== 1 ? 's' : ''}\r\n                  \u003cul class=\"page-list-llms-structure-section-links\"\u003e\r\n                    ${section.links.map(link =\u003e `\r\n                      \u003cli class=\"page-list-llms-structure-link ${link.accessible ? 'page-list-llms-structure-link--accessible' : 'page-list-llms-structure-link--inaccessible'}\"\u003e\r\n                        \u003ca href=\"${escapeHtml(link.url)}\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e${escapeHtml(link.name || link.url)}\u003c/a\u003e\r\n                        ${link.notes ? `\u003cspan class=\"page-list-llms-structure-link-notes\"\u003e: ${escapeHtml(link.notes)}\u003c/span\u003e` : ''}\r\n                        ${link.accessible ? `\u003cspan class=\"page-list-llms-structure-link-status\"\u003e✓\u003c/span\u003e` : `\u003cspan class=\"page-list-llms-structure-link-status\"\u003e✗\u003c/span\u003e`}\r\n                      \u003c/li\u003e\r\n                    `).join('')}\r\n                  \u003c/ul\u003e\r\n                \u003c/div\u003e\r\n              `).join('')}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \r\n        \u003cdiv class=\"page-list-llms-preview\"\u003e\r\n          \u003cdiv class=\"page-list-llms-preview__header\"\u003e\r\n            \u003ch3 class=\"page-list-llms-preview__title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\"\u003epreview\u003c/span\u003e\r\n              File Preview\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-llms-preview__toggle\"\u003e\r\n              \u003cbutton \r\n                type=\"button\" \r\n                class=\"page-list-llms-preview__toggle-button page-list-llms-preview__toggle-button--active\"\r\n                data-view=\"rendered\"\r\n                aria-label=\"Show rendered Markdown\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\"\u003earticle\u003c/span\u003e\r\n                Rendered\r\n              \u003c/button\u003e\r\n              \u003cbutton \r\n                type=\"button\" \r\n                class=\"page-list-llms-preview__toggle-button\"\r\n                data-view=\"raw\"\r\n                aria-label=\"Show raw Markdown\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\"\u003ecode\u003c/span\u003e\r\n                Raw\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-llms-preview__content\"\u003e\r\n            \u003cdiv class=\"page-list-llms-preview__rendered\" data-preview-view=\"rendered\"\u003e\r\n              \u003cdiv class=\"page-list-llms-preview__markdown\"\u003e${renderMarkdownPreview(result.structure.rawContent)}\u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-llms-preview__raw page-list-llms-preview__raw--hidden\" data-preview-view=\"raw\"\u003e\r\n              \u003cpre class=\"page-list-llms-preview__code\"\u003e\u003ccode\u003e${escapeHtml(result.structure.rawContent)}\u003c/code\u003e\u003c/pre\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      ` : ''}\r\n    \u003c/div\u003e\r\n  `;\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * Render simple Markdown preview (basic conversion without full parser)\r\n */\r\nfunction renderMarkdownPreview(content: string): string {\r\n  let html = content;\r\n  \r\n  // Convert headers\r\n  html = html.replace(/^# (.+)$/gm, '\u003ch1\u003e$1\u003c/h1\u003e');\r\n  html = html.replace(/^## (.+)$/gm, '\u003ch2\u003e$1\u003c/h2\u003e');\r\n  html = html.replace(/^### (.+)$/gm, '\u003ch3\u003e$1\u003c/h3\u003e');\r\n  \r\n  // Convert blockquotes\r\n  html = html.replace(/^\u003e (.+)$/gm, '\u003cblockquote\u003e$1\u003c/blockquote\u003e');\r\n  \r\n  // Convert links [text](url)\r\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '\u003ca href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e$1\u003c/a\u003e');\r\n  \r\n  // Convert lists\r\n  html = html.replace(/^- (.+)$/gm, '\u003cli\u003e$1\u003c/li\u003e');\r\n  html = html.replace(/(\u003cli\u003e.*\u003c\\/li\u003e\\n?)+/g, '\u003cul\u003e$\u0026\u003c/ul\u003e');\r\n  \r\n  // Convert paragraphs (lines not starting with special chars)\r\n  const lines = html.split('\\n');\r\n  const processedLines: string[] = [];\r\n  let currentParagraph: string[] = [];\r\n  \r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (!trimmed) {\r\n      if (currentParagraph.length \u003e 0) {\r\n        processedLines.push(`\u003cp\u003e${currentParagraph.join(' ')}\u003c/p\u003e`);\r\n        currentParagraph = [];\r\n      }\r\n      processedLines.push('');\r\n    } else if (trimmed.match(/^\u003c[hul]/) || trimmed.match(/^\u003c\\/[hul]/) || trimmed.match(/^\u003cblockquote\u003e/) || trimmed.match(/^\u003c\\/blockquote\u003e/)) {\r\n      if (currentParagraph.length \u003e 0) {\r\n        processedLines.push(`\u003cp\u003e${currentParagraph.join(' ')}\u003c/p\u003e`);\r\n        currentParagraph = [];\r\n      }\r\n      processedLines.push(trimmed);\r\n    } else if (!trimmed.match(/^\u003cli\u003e/)) {\r\n      currentParagraph.push(trimmed);\r\n    } else {\r\n      processedLines.push(trimmed);\r\n    }\r\n  }\r\n  \r\n  if (currentParagraph.length \u003e 0) {\r\n    processedLines.push(`\u003cp\u003e${currentParagraph.join(' ')}\u003c/p\u003e`);\r\n  }\r\n  \r\n  return processedLines.join('\\n');\r\n}\r\n\r\n/**\r\n * Attach llms.txt validation handlers and auto-run validation\r\n */\r\nfunction attachLLMSHandlers(): void {\r\n  const resultsDiv = document.getElementById('page-list-llms-results');\r\n  \r\n  if (!resultsDiv) return;\r\n  \r\n  // Attach template generator button\r\n  const generateButton = document.getElementById('page-list-llms-generate-template');\r\n  if (generateButton) {\r\n    generateButton.addEventListener('click', () =\u003e {\r\n      const siteName = document.querySelector('h1')?.textContent?.trim() || 'Your Site Name';\r\n      const template = generateLLMSTxtTemplate(siteName);\r\n      \r\n      // Create download\r\n      const blob = new Blob([template], { type: 'text/plain;charset=utf-8' });\r\n      const url = URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = 'llms.txt';\r\n      link.style.display = 'none';\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      showToast('llms.txt template downloaded. Place it in your site root (e.g., /public/llms.txt)', 'success', 5000, 'page-list');\r\n    });\r\n  }\r\n  \r\n  // Auto-run validation on page load\r\n  (async () =\u003e {\r\n    try {\r\n      const result = await validateLLMSTxt();\r\n      resultsDiv.innerHTML = renderLLMSResults(result);\r\n      \r\n      // Attach preview toggle handlers\r\n      const toggleButtons = document.querySelectorAll('.page-list-llms-preview__toggle-button');\r\n      const renderedView = document.querySelector('[data-preview-view=\"rendered\"]');\r\n      const rawView = document.querySelector('[data-preview-view=\"raw\"]');\r\n      \r\n      toggleButtons.forEach(button =\u003e {\r\n        button.addEventListener('click', () =\u003e {\r\n          const view = button.getAttribute('data-view');\r\n          \r\n          // Update button states\r\n          toggleButtons.forEach(btn =\u003e {\r\n            btn.classList.toggle('page-list-llms-preview__toggle-button--active', btn === button);\r\n          });\r\n          \r\n          // Toggle views\r\n          if (view === 'rendered') {\r\n            renderedView?.classList.remove('page-list-llms-preview__raw--hidden');\r\n            rawView?.classList.add('page-list-llms-preview__raw--hidden');\r\n          } else {\r\n            renderedView?.classList.add('page-list-llms-preview__raw--hidden');\r\n            rawView?.classList.remove('page-list-llms-preview__raw--hidden');\r\n          }\r\n        });\r\n      });\r\n    } catch (error) {\r\n      devError('LLMS.txt validation error:', error);\r\n      resultsDiv.innerHTML = `\r\n        \u003cdiv class=\"page-list-llms-empty\"\u003e\r\n          \u003cdiv class=\"page-list-llms-empty__icon\"\u003e⚠️\u003c/div\u003e\r\n          \u003ch3 class=\"page-list-llms-empty__title\"\u003eValidation Error\u003c/h3\u003e\r\n          \u003cp class=\"page-list-llms-empty__text\"\u003eError during validation: ${error instanceof Error ? error.message : 'Unknown error'}\u003c/p\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }\r\n  })();\r\n}\r\n\r\n/**\r\n * Render draft pages in a simple list format with URLs\r\n */\r\nfunction renderDraftPages(pages: PageData[]): string {\r\n  if (pages.length === 0) {\r\n    return `\r\n      \u003cdiv class=\"page-list-empty\"\u003e\r\n        \u003cdiv class=\"page-list-empty__icon\"\u003e📝\u003c/div\u003e\r\n        \u003ch3 class=\"page-list-empty__title\"\u003eNo draft pages found\u003c/h3\u003e\r\n        \u003cp class=\"page-list-empty__text\"\u003e\r\n          No draft pages were found. Make sure you're running the dev server with \u003ccode\u003enpm run dev\u003c/code\u003e (which includes drafts).\r\n        \u003c/p\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n\r\n  // Sort by title\r\n  const sortedPages = [...pages].sort((a, b) =\u003e {\r\n    return a.title.localeCompare(b.title);\r\n  });\r\n\r\n  let html = `\r\n    \u003cdiv class=\"page-list-drafts\"\u003e\r\n      \u003cdiv class=\"page-list-drafts__header\"\u003e\r\n        \u003cdiv class=\"page-list-drafts__info\"\u003e\r\n          \u003ch2 class=\"page-list-drafts__title\"\u003eDraft Pages\u003c/h2\u003e\r\n          \u003cp class=\"page-list-drafts__count\"\u003e${pages.length} ${pages.length === 1 ? 'draft' : 'drafts'}\u003c/p\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-drafts__actions\"\u003e\r\n          \u003cbutton \r\n            type=\"button\" \r\n            class=\"page-list-drafts__export-button\"\r\n            id=\"page-list-drafts-export-csv\"\r\n            aria-label=\"Export drafts to CSV\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003edownload\u003c/span\u003e\r\n            Export CSV\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-drafts__list\"\u003e\r\n        \u003ctable class=\"page-list-drafts-table\"\u003e\r\n          \u003cthead\u003e\r\n            \u003ctr\u003e\r\n              \u003cth\u003eTitle\u003c/th\u003e\r\n              \u003cth\u003eURL\u003c/th\u003e\r\n              \u003cth\u003eSection\u003c/th\u003e\r\n            \u003c/tr\u003e\r\n          \u003c/thead\u003e\r\n          \u003ctbody\u003e\r\n  `;\r\n\r\n  sortedPages.forEach(page =\u003e {\r\n    const fullUrl = `${window.location.origin}${page.relPermalink}`;\r\n    html += `\r\n      \u003ctr class=\"page-list-drafts-row\"\u003e\r\n        \u003ctd class=\"page-list-drafts-row__title\" data-label=\"Title\"\u003e\r\n          ${escapeHtml(page.title)}\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-drafts-row__url\" data-label=\"URL\"\u003e\r\n          \u003ca \r\n            href=\"${escapeHtml(page.relPermalink)}\" \r\n            target=\"_blank\" \r\n            rel=\"noopener noreferrer\"\r\n            class=\"page-list-drafts-row__link\"\r\n          \u003e\r\n            ${escapeHtml(page.relPermalink)}\r\n          \u003c/a\u003e\r\n          \u003cbutton \r\n            type=\"button\"\r\n            class=\"page-list-drafts-row__copy-button\"\r\n            data-copy-url=\"${escapeHtml(fullUrl)}\"\r\n            aria-label=\"Copy URL to clipboard\"\r\n            title=\"Copy URL to clipboard\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003econtent_copy\u003c/span\u003e\r\n          \u003c/button\u003e\r\n        \u003c/td\u003e\r\n        \u003ctd class=\"page-list-drafts-row__section\" data-label=\"Section\"\u003e\r\n          ${escapeHtml(page.section || 'Home')}\r\n        \u003c/td\u003e\r\n      \u003c/tr\u003e\r\n    `;\r\n  });\r\n\r\n  html += `\r\n          \u003c/tbody\u003e\r\n        \u003c/table\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Render grouped pages\r\n */\r\nfunction renderGroupedPages(pages: PageData[], compact: boolean = false, sortType: string = 'title', sortDirection: 'asc' | 'desc' = 'asc', filterType: string = 'all'): string {\r\n  const groups = groupPagesBySection(pages, sortType, sortDirection);\r\n  const sections = Array.from(groups.keys()).sort();\r\n\r\n  let html = '';\r\n\r\n  // Home page (if exists)\r\n  const homePage = pages.find(p =\u003e p.section === '' || p.relPermalink === '/');\r\n  if (homePage) {\r\n    const tableHeaders = getTableHeaders(filterType, compact);\r\n    \r\n    html += `\r\n      \u003cdiv class=\"page-list-group\" data-group-id=\"home\"\u003e\r\n        \u003cbutton class=\"page-list-group-header\" data-group-toggle=\"home\"\u003e\r\n          \u003ch2 class=\"page-list-group-title\"\u003eHome\u003c/h2\u003e\r\n          \u003cspan class=\"page-list-group-toggle-icon\"\u003e▼\u003c/span\u003e\r\n        \u003c/button\u003e\r\n        \u003cdiv class=\"page-list-group-content\" data-group-content=\"home\"\u003e\r\n          \u003ctable class=\"page-list-table\"\u003e\r\n            \u003cthead\u003e\r\n              ${tableHeaders}\r\n            \u003c/thead\u003e\r\n            \u003ctbody\u003e\r\n              ${renderPageRow(homePage, compact, filterType)}\r\n            \u003c/tbody\u003e\r\n          \u003c/table\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n\r\n  // Other sections\r\n  sections.forEach(section =\u003e {\r\n    if (section === '' || section === 'root') return; // Skip home, already handled\r\n\r\n    const sectionPages = groups.get(section) || [];\r\n    if (sectionPages.length === 0) return;\r\n\r\n    const sectionTitle = section.charAt(0).toUpperCase() + section.slice(1).replace(/-/g, ' ');\r\n    const tableHeaders = getTableHeaders(filterType, compact);\r\n\r\n    html += `\r\n      \u003cdiv class=\"page-list-group\" data-group-id=\"${escapeHtml(section)}\"\u003e\r\n        \u003cbutton class=\"page-list-group-header\" data-group-toggle=\"${escapeHtml(section)}\"\u003e\r\n          \u003ch2 class=\"page-list-group-title\"\u003e${escapeHtml(sectionTitle)}\u003c/h2\u003e\r\n          \u003cspan class=\"page-list-group-toggle-icon\"\u003e▼\u003c/span\u003e\r\n        \u003c/button\u003e\r\n        \u003cdiv class=\"page-list-group-content\" data-group-content=\"${escapeHtml(section)}\"\u003e\r\n          \u003ctable class=\"page-list-table\"\u003e\r\n            \u003cthead\u003e\r\n              ${tableHeaders}\r\n            \u003c/thead\u003e\r\n            \u003ctbody\u003e\r\n              ${sectionPages.map(p =\u003e renderPageRow(p, compact, filterType)).join('')}\r\n            \u003c/tbody\u003e\r\n          \u003c/table\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  });\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\n// escapeHtml is now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Truncate text to specified length\r\n */\r\nfunction truncate(text: string, maxLength: number): string {\r\n  if (text.length \u003c= maxLength) return text;\r\n  return text.substring(0, maxLength) + '...';\r\n}\r\n\r\n/**\r\n * Format issue count - show checkmark if 0, otherwise show the number\r\n */\r\nfunction formatIssueCount(count: number): string {\r\n  return count === 0 ? '✓' : count.toString();\r\n}\r\n\r\n/**\r\n * Create a tooltip element\r\n */\r\nfunction createTooltip(text: string): string {\r\n  return `\r\n    \u003cspan class=\"page-list-tooltip-trigger\"\u003e\r\n      \u003cspan class=\"page-list-tooltip-icon material-symbols-outlined\"\u003einfo\u003c/span\u003e\r\n      \u003cspan class=\"page-list-tooltip\"\u003e\r\n        \u003cspan class=\"page-list-tooltip-content\"\u003e${escapeHtml(text)}\u003c/span\u003e\r\n      \u003c/span\u003e\r\n    \u003c/span\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Filter pages based on filter type\r\n */\r\nfunction filterPages(pages: PageData[], filterType: string): PageData[] {\r\n  switch (filterType) {\r\n    case 'all':\r\n      return pages;\r\n    case 'with-issues':\r\n      return pages.filter(page =\u003e {\r\n        return !page.hasMetaTitle || \r\n               !page.hasMetaDescription || \r\n               page.titleOverLimit || \r\n               page.descriptionOverLimit ||\r\n               page.titleOverPixels ||\r\n               page.descriptionOverPixels;\r\n      });\r\n    case 'missing-title':\r\n      return pages.filter(page =\u003e !page.hasMetaTitle);\r\n    case 'missing-description':\r\n      return pages.filter(page =\u003e !page.hasMetaDescription);\r\n    case 'missing-meta':\r\n      return pages.filter(page =\u003e !page.hasMetaTitle || !page.hasMetaDescription);\r\n    case 'title-over-limit':\r\n      return pages.filter(page =\u003e page.titleOverLimit || page.titleOverPixels);\r\n    case 'description-over-limit':\r\n      return pages.filter(page =\u003e page.descriptionOverLimit || page.descriptionOverPixels);\r\n    case 'pixel-issues':\r\n      return pages.filter(page =\u003e page.titleOverPixels || page.descriptionOverPixels);\r\n    case 'meta-issues':\r\n      return pages.filter(page =\u003e page.titleOverLimit || page.titleOverPixels || page.descriptionOverLimit || page.descriptionOverPixels);\r\n    case 'good':\r\n      return pages.filter(page =\u003e {\r\n        return page.hasMetaTitle \u0026\u0026 \r\n               page.hasMetaDescription \u0026\u0026 \r\n               !page.titleOverLimit \u0026\u0026 \r\n               !page.descriptionOverLimit \u0026\u0026\r\n               !page.titleOverPixels \u0026\u0026\r\n               !page.descriptionOverPixels \u0026\u0026\r\n               !page.hasBrokenLinks \u0026\u0026\r\n               !page.hasBrokenImages \u0026\u0026\r\n               !page.hasImagesWithoutAlt \u0026\u0026\r\n               page.headingStructureGood \u0026\u0026\r\n               page.hasOneH1 \u0026\u0026\r\n               page.hasH2s \u0026\u0026\r\n               page.internalLinksGood \u0026\u0026\r\n               !page.hasGenericAnchors \u0026\u0026\r\n               !page.hasGenericAltText \u0026\u0026\r\n               page.hasSchemaMarkup \u0026\u0026\r\n               page.firstParaGood \u0026\u0026\r\n               !page.wordCountPoor \u0026\u0026\r\n               !page.isStale \u0026\u0026\r\n               page.hasCitations \u0026\u0026\r\n               page.hasAuthor \u0026\u0026\r\n               (!page.hasVideos || page.hasTranscript) \u0026\u0026\r\n               page.readabilityGood \u0026\u0026\r\n               page.hasAnalytics \u0026\u0026\r\n               !page.hasContrastRatioIssues \u0026\u0026\r\n               !page.hasMissingAriaLabels \u0026\u0026\r\n               !page.hasKeyboardNavigationIssues \u0026\u0026\r\n               page.hasFocusIndicators !== false;\r\n      });\r\n    case 'broken-links':\r\n      return pages.filter(page =\u003e page.hasBrokenLinks);\r\n    case 'broken-images':\r\n      return pages.filter(page =\u003e page.hasBrokenImages);\r\n    case 'images-no-alt':\r\n      return pages.filter(page =\u003e page.hasImagesWithoutAlt);\r\n    case 'heading-structure':\r\n      return pages.filter(page =\u003e !page.headingStructureGood);\r\n    case 'multiple-h1':\r\n      return pages.filter(page =\u003e page.hasMultipleH1);\r\n    case 'no-h1':\r\n      return pages.filter(page =\u003e page.h1Count === 0);\r\n    case 'no-h2':\r\n      return pages.filter(page =\u003e !page.hasH2s);\r\n    case 'internal-links':\r\n      return pages.filter(page =\u003e page.internalLinksTooFew || page.internalLinksTooMany);\r\n    case 'generic-anchors':\r\n      return pages.filter(page =\u003e page.hasGenericAnchors);\r\n    case 'no-schema':\r\n      return pages.filter(page =\u003e !page.hasSchemaMarkup);\r\n    case 'low-word-count':\r\n      return pages.filter(page =\u003e page.wordCountPoor);\r\n    case 'stale-content':\r\n      return pages.filter(page =\u003e page.isStale);\r\n    case 'no-citations':\r\n      return pages.filter(page =\u003e !page.hasCitations);\r\n    case 'no-author':\r\n      return pages.filter(page =\u003e !page.hasAuthor);\r\n    case 'videos-no-transcript':\r\n      return pages.filter(page =\u003e page.hasVideos \u0026\u0026 !page.hasTranscript);\r\n    case 'no-analytics':\r\n      return pages.filter(page =\u003e !page.hasAnalytics);\r\n    case 'images-not-nextgen':\r\n      return pages.filter(page =\u003e page.hasImagesNotNextGen);\r\n    case 'images-no-lazy':\r\n      return pages.filter(page =\u003e page.hasImagesWithoutLazyLoading);\r\n    case 'no-lang':\r\n      return pages.filter(page =\u003e !page.hasLangAttribute);\r\n    case 'no-canonical':\r\n      return pages.filter(page =\u003e !page.hasCanonical);\r\n    case 'mixed-content':\r\n      return pages.filter(page =\u003e page.hasMixedContent);\r\n    case 'url-length':\r\n      return pages.filter(page =\u003e page.urlLengthOver);\r\n    case 'outbound-links':\r\n      return pages.filter(page =\u003e page.outboundLinksTooFew);\r\n    case 'paragraph-length':\r\n      return pages.filter(page =\u003e !page.paragraphLengthGood);\r\n    case 'subheading-distribution':\r\n      return pages.filter(page =\u003e !page.subheadingDistributionGood);\r\n    case 'media-usage':\r\n      return pages.filter(page =\u003e page.mediaUsageTooFew);\r\n    case 'no-date-info':\r\n      return pages.filter(page =\u003e !page.hasDateInfo);\r\n    case 'no-mobile-viewport':\r\n      return pages.filter(page =\u003e !page.hasMobileViewport);\r\n    case 'social-meta':\r\n      return pages.filter(page =\u003e !page.socialMetaGood);\r\n    case 'no-excerpt':\r\n      return pages.filter(page =\u003e !page.hasSummary);\r\n    case 'excerpt-too-short':\r\n      return pages.filter(page =\u003e page.summaryTooShort);\r\n    case 'excerpt-too-long':\r\n      return pages.filter(page =\u003e page.summaryTooLong);\r\n    case 'contrast-ratio':\r\n      return pages.filter(page =\u003e page.hasContrastRatioIssues === true);\r\n    case 'missing-aria':\r\n      return pages.filter(page =\u003e page.hasMissingAriaLabels === true);\r\n    case 'keyboard-nav':\r\n      return pages.filter(page =\u003e page.hasKeyboardNavigationIssues === true);\r\n    case 'no-focus-indicators':\r\n      return pages.filter(page =\u003e page.hasFocusIndicators === false);\r\n    case 'drafts':\r\n      return pages.filter(page =\u003e page.isDraft === true);\r\n    default:\r\n      return pages;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Calculate Levenshtein distance between two strings\r\n */\r\nfunction levenshteinDistance(str1: string, str2: string): number {\r\n  const matrix: number[][] = [];\r\n  const len1 = str1.length;\r\n  const len2 = str2.length;\r\n\r\n  for (let i = 0; i \u003c= len2; i++) {\r\n    matrix[i] = [i];\r\n  }\r\n\r\n  for (let j = 0; j \u003c= len1; j++) {\r\n    matrix[0][j] = j;\r\n  }\r\n\r\n  for (let i = 1; i \u003c= len2; i++) {\r\n    for (let j = 1; j \u003c= len1; j++) {\r\n      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {\r\n        matrix[i][j] = matrix[i - 1][j - 1];\r\n      } else {\r\n        matrix[i][j] = Math.min(\r\n          matrix[i - 1][j - 1] + 1,\r\n          matrix[i][j - 1] + 1,\r\n          matrix[i - 1][j] + 1\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  return matrix[len2][len1];\r\n}\r\n\r\n/**\r\n * Common typo fixes\r\n */\r\nconst TYPO_FIXES: Record\u003cstring, string\u003e = {\r\n  'recieve': 'receive',\r\n  'optmize': 'optimize',\r\n  'seperate': 'separate',\r\n  'occured': 'occurred',\r\n  'accomodate': 'accommodate',\r\n  'definately': 'definitely',\r\n  'maintainance': 'maintenance',\r\n  'seige': 'siege',\r\n  'neccessary': 'necessary',\r\n  'existance': 'existence',\r\n};\r\n\r\n/**\r\n * Find close matches for a broken URL (for suggestions)\r\n */\r\nfunction findCloseMatches(brokenUrl: string, allPagePaths: string[], allPages?: PageData[], maxResults: number = 3): LinkSuggestion[] {\r\n  const suggestions: LinkSuggestion[] = [];\r\n  const brokenPath = brokenUrl.split('#')[0];\r\n  const brokenLower = brokenPath.toLowerCase();\r\n  const brokenNoSlash = brokenPath.replace(/\\/$/, '');\r\n  \r\n  // Create a map of paths to page data for title lookup\r\n  const pathToPage = new Map\u003cstring, PageData\u003e();\r\n  if (allPages) {\r\n    allPages.forEach(page =\u003e {\r\n      pathToPage.set(page.relPermalink, page);\r\n    });\r\n  }\r\n  \r\n  // Calculate similarity scores for all paths\r\n  const scoredPaths: Array\u003c{ path: string; score: number; reason: string }\u003e = [];\r\n  \r\n  for (const path of allPagePaths) {\r\n    const pathLower = path.toLowerCase();\r\n    const pathNoSlash = path.replace(/\\/$/, '');\r\n    \r\n    let score = 0;\r\n    let reason = '';\r\n    \r\n    // Check for substring matches (higher score for longer matches)\r\n    if (pathLower.includes(brokenLower) || brokenLower.includes(pathLower)) {\r\n      const matchLength = Math.min(pathLower.length, brokenLower.length);\r\n      score = 50 + (matchLength / Math.max(pathLower.length, brokenLower.length)) * 30;\r\n      reason = 'Similar path structure';\r\n    }\r\n    \r\n    // Check for common segments\r\n    const brokenSegments = brokenNoSlash.split('/').filter(s =\u003e s);\r\n    const pathSegments = pathNoSlash.split('/').filter(s =\u003e s);\r\n    const commonSegments = brokenSegments.filter(s =\u003e pathSegments.includes(s));\r\n    if (commonSegments.length \u003e 0) {\r\n      const segmentScore = (commonSegments.length / Math.max(brokenSegments.length, pathSegments.length)) * 40;\r\n      score = Math.max(score, segmentScore);\r\n      if (!reason) reason = `${commonSegments.length} common segment${commonSegments.length !== 1 ? 's' : ''}`;\r\n    }\r\n    \r\n    // Calculate Levenshtein distance\r\n    const distance = levenshteinDistance(brokenPath, path);\r\n    const maxLen = Math.max(brokenPath.length, path.length);\r\n    const similarity = maxLen \u003e 0 ? (1 - distance / maxLen) * 100 : 0;\r\n    \r\n    // Combine scores\r\n    const finalScore = score + similarity;\r\n    \r\n    if (finalScore \u003e 20) { // Only include reasonably similar matches\r\n      scoredPaths.push({\r\n        path,\r\n        score: finalScore,\r\n        reason: reason || `Similarity: ${Math.round(similarity)}%`\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Sort by score (highest first) and take top results\r\n  scoredPaths.sort((a, b) =\u003e b.score - a.score);\r\n  \r\n  for (let i = 0; i \u003c Math.min(maxResults, scoredPaths.length); i++) {\r\n    const item = scoredPaths[i];\r\n    const page = pathToPage.get(item.path);\r\n    suggestions.push({\r\n      url: item.path,\r\n      title: page?.title,\r\n      similarity: Math.round(item.score),\r\n      reason: item.reason\r\n    });\r\n  }\r\n  \r\n  return suggestions;\r\n}\r\n\r\n/**\r\n * Find potential match for broken URL using priority rules\r\n */\r\nfunction findUrlMatch(brokenUrl: string, allPagePaths: string[], allPages?: PageData[]): { match: string; reason: string } | null {\r\n  // Remove anchor fragments for matching\r\n  const brokenPath = brokenUrl.split('#')[0];\r\n  const brokenLower = brokenPath.toLowerCase();\r\n  const brokenNoSlash = brokenPath.replace(/\\/$/, '');\r\n  const brokenNoHtml = brokenPath.replace(/\\.html$/, '');\r\n\r\n  // Rule 1: Exact match ignoring case\r\n  for (const path of allPagePaths) {\r\n    if (path.toLowerCase() === brokenLower) {\r\n      return { match: path, reason: 'Exact match (case-insensitive)' };\r\n    }\r\n  }\r\n\r\n  // Rule 2: Missing section prefix (e.g., /why-is-my-maytag-dryer-not-drying/ → /blog/why-is-my-maytag-dryer-not-drying/)\r\n  // Get all unique sections from pages\r\n  const sections = new Set\u003cstring\u003e();\r\n  if (allPages) {\r\n    allPages.forEach(page =\u003e {\r\n      if (page.section) {\r\n        sections.add(page.section);\r\n      }\r\n    });\r\n  }\r\n  // Also check common sections as fallback\r\n  const commonSections = ['blog', 'our-services', 'service-areas', 'about-us', 'brands-we-serve'];\r\n  commonSections.forEach(s =\u003e sections.add(s));\r\n  \r\n  for (const section of sections) {\r\n    const pathWithSection = `/${section}${brokenPath}`;\r\n    const pathWithSectionNoSlash = `/${section}${brokenNoSlash}`;\r\n    \r\n    for (const path of allPagePaths) {\r\n      if (path === pathWithSection || path === pathWithSectionNoSlash) {\r\n        return { match: path, reason: `Missing section prefix: added /${section}/` };\r\n      }\r\n    }\r\n  }\r\n\r\n  // Rule 3: Exact match ignoring trailing slash\r\n  for (const path of allPagePaths) {\r\n    const pathNoSlash = path.replace(/\\/$/, '');\r\n    if (pathNoSlash === brokenNoSlash || path === brokenNoSlash || pathNoSlash === brokenPath) {\r\n      return { match: path, reason: 'Exact match (trailing slash difference)' };\r\n    }\r\n  }\r\n\r\n  // Rule 4: Exact match ignoring .html extension\r\n  for (const path of allPagePaths) {\r\n    const pathNoHtml = path.replace(/\\.html$/, '');\r\n    if (pathNoHtml === brokenNoHtml || path === brokenNoHtml || pathNoHtml === brokenPath) {\r\n      return { match: path, reason: 'Exact match (.html extension difference)' };\r\n    }\r\n  }\r\n\r\n  // Rule 5: Missing/extra hyphen or underscore\r\n  for (const path of allPagePaths) {\r\n    const pathNormalized = path.replace(/[-_]/g, '');\r\n    const brokenNormalized = brokenPath.replace(/[-_]/g, '');\r\n    if (pathNormalized === brokenNormalized \u0026\u0026 pathNormalized.length \u003e 0) {\r\n      return { match: path, reason: 'Hyphen/underscore difference' };\r\n    }\r\n  }\r\n\r\n  // Rule 6: Common Hugo patterns\r\n  for (const path of allPagePaths) {\r\n    // /blog/post/ → /blog/post\r\n    if (brokenPath.endsWith('/') \u0026\u0026 path === brokenPath.slice(0, -1)) {\r\n      return { match: path, reason: 'Hugo pattern: trailing slash' };\r\n    }\r\n    // /about-us → /about\r\n    if (brokenPath.includes('-us') \u0026\u0026 path === brokenPath.replace('-us', '')) {\r\n      return { match: path, reason: 'Hugo pattern: -us suffix' };\r\n    }\r\n    // /tags/tag-name → /tag/tag-name\r\n    if (brokenPath.startsWith('/tags/') \u0026\u0026 path === brokenPath.replace('/tags/', '/tag/')) {\r\n      return { match: path, reason: 'Hugo pattern: tags → tag' };\r\n    }\r\n  }\r\n\r\n  // Rule 7: Levenshtein distance ≤ 2 + length-based threshold\r\n  const brokenLen = brokenPath.length;\r\n  let bestMatch: { path: string; distance: number } | null = null;\r\n  \r\n  for (const path of allPagePaths) {\r\n    const distance = levenshteinDistance(brokenPath, path);\r\n    const maxDistance = Math.min(2, Math.floor(brokenLen / 10)); // Conservative: max 2 or 10% of length\r\n    \r\n    if (distance \u003c= maxDistance \u0026\u0026 distance \u003e 0) {\r\n      if (!bestMatch || distance \u003c bestMatch.distance) {\r\n        bestMatch = { path, distance };\r\n      }\r\n    }\r\n  }\r\n  \r\n  if (bestMatch) {\r\n    return { match: bestMatch.path, reason: `Levenshtein distance ${bestMatch.distance}` };\r\n  }\r\n\r\n  // Rule 8: Known typo fixes\r\n  for (const [typo, correct] of Object.entries(TYPO_FIXES)) {\r\n    if (brokenPath.toLowerCase().includes(typo)) {\r\n      const corrected = brokenPath.toLowerCase().replace(typo, correct);\r\n      for (const path of allPagePaths) {\r\n        if (path.toLowerCase() === corrected || path.toLowerCase().includes(corrected)) {\r\n          return { match: path, reason: `Typo fix: ${typo} → ${correct}` };\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// relPermalinkToContentFile is now imported from utils/file-system.ts\r\n// File System Access API support is now managed by utils/file-system.ts\r\n\r\n// File system functions are now imported from utils/file-system.ts\r\n\r\n/**\r\n * Fix broken links in a file\r\n */\r\nasync function fixBrokenLinksInFile(\r\n  filePath: string,\r\n  brokenLinks: Array\u003c{ url: string; fixedUrl: string | null; action: 'fix' | 'remove' }\u003e\r\n): Promise\u003c{ success: boolean; backupPath?: string; error?: string; changes: Array\u003c{ oldUrl: string; newUrl: string; lineNumber: number; text?: string }\u003e }\u003e {\r\n  try {\r\n    devLog(`📄 Reading file: ${filePath}`);\r\n    const fileData = await readFileContent(filePath, true); // Enable verbose logging\r\n    if (!fileData) {\r\n      devError(`❌ Could not read file: ${filePath}`);\r\n      return { success: false, error: 'Could not read file', changes: [] };\r\n    }\r\n\r\n    devLog(`✅ File read successfully (${fileData.content.length} characters)`);\r\n\r\n    const originalContent = fileData.content;\r\n    let content = originalContent;\r\n    let modified = false;\r\n    const changes: Array\u003c{ oldUrl: string; newUrl: string; lineNumber: number; text?: string }\u003e = [];\r\n\r\n    // Process each broken link\r\n    for (const { url, fixedUrl, action } of brokenLinks) {\r\n      devLog(`   Processing: ${url} → ${action === 'remove' ? '(remove)' : fixedUrl}`);\r\n      \r\n      if (action === 'remove') {\r\n        // Remove the link and keep only text\r\n        const removalResult = removeLinkFromContent(content, url);\r\n        if (removalResult.changes.length \u003e 0) {\r\n          content = removalResult.content;\r\n          changes.push(...removalResult.changes);\r\n          modified = true;\r\n          devLog(`   ✅ Removed ${removalResult.changes.length} occurrence(s) of link`);\r\n        } else {\r\n          devLog(`   ⚠️  Link not found in content (may have already been removed or format differs)`);\r\n        }\r\n      } else if (fixedUrl) {\r\n        // Fix the URL\r\n        // Normalize URL for matching - handle trailing slashes and fragments\r\n        const urlNoFragment = url.split('#')[0];\r\n        const urlNoSlash = urlNoFragment.replace(/\\/$/, '');\r\n        const urlWithSlash = urlNoSlash + '/';\r\n        \r\n        // Try multiple URL variations\r\n        const urlVariations = [\r\n          url, // Original\r\n          urlNoFragment, // Without fragment\r\n          urlNoSlash, // Without trailing slash\r\n          urlWithSlash, // With trailing slash\r\n        ];\r\n        \r\n        let foundAny = false;\r\n        \r\n        // Escape URL for regex (handle special characters)\r\n        const escapedUrl = escapeRegex(url);\r\n        const escapedUrlNoFragment = escapeRegex(urlNoFragment);\r\n        const escapedUrlNoSlash = escapeRegex(urlNoSlash);\r\n        const escapedUrlWithSlash = escapeRegex(urlWithSlash);\r\n        \r\n        // Markdown links: [text](broken-url) or [text](broken-url \"title\")\r\n        // Try all URL variations\r\n        const markdownPatterns = [\r\n          new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrl}([^)]*\\\\))`, 'g'),\r\n          new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrlNoFragment}([^)]*\\\\))`, 'g'),\r\n          new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrlNoSlash}([^)]*\\\\))`, 'g'),\r\n          new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrlWithSlash}([^)]*\\\\))`, 'g'),\r\n        ];\r\n        \r\n        const markdownMatches: Array\u003c{ index: number; match: string; replacement: string }\u003e = [];\r\n        \r\n        for (const pattern of markdownPatterns) {\r\n          let match;\r\n          // Reset regex lastIndex to avoid issues with global regex\r\n          pattern.lastIndex = 0;\r\n          while ((match = pattern.exec(content)) !== null) {\r\n            const replacement = `${match[1]}${fixedUrl}${match[2]}`;\r\n            markdownMatches.push({\r\n              index: match.index,\r\n              match: match[0],\r\n              replacement\r\n            });\r\n            foundAny = true;\r\n          }\r\n        }\r\n        \r\n        // Apply replacements in reverse order to maintain indices\r\n        for (let i = markdownMatches.length - 1; i \u003e= 0; i--) {\r\n          const m = markdownMatches[i];\r\n          const beforeMatch = content.substring(0, m.index);\r\n          const lineNumber = beforeMatch.split('\\n').length;\r\n          \r\n          content = beforeMatch + m.replacement + content.substring(m.index + m.match.length);\r\n          changes.push({ oldUrl: url, newUrl: fixedUrl, lineNumber });\r\n          modified = true;\r\n        }\r\n\r\n        // HTML href: href=\"broken-url\" or href='broken-url'\r\n        // Try all URL variations\r\n        const htmlPatterns = [\r\n          new RegExp(`(href=[\"'])${escapedUrl}([\"'])`, 'gi'),\r\n          new RegExp(`(href=[\"'])${escapedUrlNoFragment}([\"'])`, 'gi'),\r\n          new RegExp(`(href=[\"'])${escapedUrlNoSlash}([\"'])`, 'gi'),\r\n          new RegExp(`(href=[\"'])${escapedUrlWithSlash}([\"'])`, 'gi'),\r\n        ];\r\n        \r\n        const htmlMatches: Array\u003c{ index: number; match: string; replacement: string }\u003e = [];\r\n        \r\n        for (const pattern of htmlPatterns) {\r\n          let htmlMatch;\r\n          // Reset regex lastIndex to avoid issues with global regex\r\n          pattern.lastIndex = 0;\r\n          while ((htmlMatch = pattern.exec(content)) !== null) {\r\n            const replacement = `${htmlMatch[1]}${fixedUrl}${htmlMatch[2]}`;\r\n            htmlMatches.push({\r\n              index: htmlMatch.index,\r\n              match: htmlMatch[0],\r\n              replacement\r\n            });\r\n            foundAny = true;\r\n          }\r\n        }\r\n        \r\n        // Apply HTML replacements in reverse order\r\n        for (let i = htmlMatches.length - 1; i \u003e= 0; i--) {\r\n          const m = htmlMatches[i];\r\n          const beforeMatch = content.substring(0, m.index);\r\n          const lineNumber = beforeMatch.split('\\n').length;\r\n          \r\n          content = beforeMatch + m.replacement + content.substring(m.index + m.match.length);\r\n          changes.push({ oldUrl: url, newUrl: fixedUrl, lineNumber });\r\n          modified = true;\r\n        }\r\n        \r\n        if (!foundAny) {\r\n          devLog(`   ⚠️  Link not found in content (may have already been fixed or format differs)`);\r\n        } else {\r\n          devLog(`   ✅ Found and fixed link`);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!modified) {\r\n      devWarn(`⚠️  No matches found in file for any of the ${brokenLinks.length} link(s)`);\r\n      return { success: false, error: 'No matches found in file', changes: [] };\r\n    }\r\n\r\n    devLog(`📝 File modified: ${changes.length} change(s) made`);\r\n\r\n    // Create backup\r\n    const backupPath = createBackupFilename(filePath);\r\n    devLog(`💾 Creating backup: ${backupPath}`);\r\n    const backupCreated = await writeFileContent(backupPath, originalContent);\r\n    \r\n    if (!backupCreated) {\r\n      devWarn(`⚠️  Could not create backup: ${backupPath}`);\r\n      // Continue anyway, but warn user\r\n    } else {\r\n      devLog(`✅ Backup created: ${backupPath}`);\r\n    }\r\n    \r\n    // Write modified content\r\n    devLog(`💾 Writing modified content to: ${filePath}`);\r\n    const writeSuccess = await writeFileContent(filePath, content);\r\n    \r\n    if (!writeSuccess) {\r\n      devError(`❌ Could not write file: ${filePath}`);\r\n      return { success: false, error: 'Could not write file', changes };\r\n    }\r\n\r\n    devLog(`✅ Successfully fixed ${changes.length} link(s) in ${filePath}`);\r\n    return { success: true, backupPath: backupCreated ? backupPath : undefined, changes };\r\n  } catch (error) {\r\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error', changes: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Escape special regex characters\r\n */\r\n// escapeRegex is now imported from utils/file-system.ts\r\n\r\n/**\r\n * Collect all broken links from pages\r\n */\r\nfunction collectBrokenLinks(pages: PageData[]): BrokenLinkInfo[] {\r\n  const brokenLinks: BrokenLinkInfo[] = [];\r\n\r\n  for (const page of pages) {\r\n    if (page.hasBrokenLinks \u0026\u0026 page.brokenLinkUrls \u0026\u0026 Array.isArray(page.brokenLinkUrls)) {\r\n      for (const brokenUrl of page.brokenLinkUrls) {\r\n        // Only process internal links\r\n        if (brokenUrl.startsWith('/') \u0026\u0026 !brokenUrl.startsWith('//') \u0026\u0026 !brokenUrl.startsWith('http')) {\r\n          brokenLinks.push({\r\n            brokenUrl,\r\n            sourcePage: page.relPermalink,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return brokenLinks;\r\n}\r\n\r\n/**\r\n * Fix obvious internal broken links\r\n */\r\nasync function fixObviousBrokenLinks(pages: PageData[]): Promise\u003cFixResult\u003e {\r\n  const result: FixResult = {\r\n    attempted: 0,\r\n    fixed: 0,\r\n    skipped: 0,\r\n    fixes: [],\r\n    skippedLinks: [],\r\n    modifiedFiles: [],\r\n    backups: [],\r\n  };\r\n\r\n  // Safety check: only run in dev mode\r\n  if (!isLocalhost()) {\r\n    devError('Fix broken links feature is only available in development mode');\r\n    return result;\r\n  }\r\n\r\n  devLog('🔍 Starting broken link fix process...');\r\n\r\n  // Check if File System Access API is available\r\n  const hasDirectoryAccess = getSiteRootDirectoryHandle() !== null;\r\n  if (!hasDirectoryAccess) {\r\n    devError('❌ File System Access API not available. Cannot fix links without directory access.');\r\n    devError('💡 Please grant directory access when prompted to enable file operations.');\r\n    return result;\r\n  }\r\n\r\n  // Collect all broken links\r\n  const brokenLinks = collectBrokenLinks(pages);\r\n  devLog(`Found ${brokenLinks.length} broken internal links`);\r\n\r\n  if (brokenLinks.length === 0) {\r\n    devLog('No broken links to fix.');\r\n    return result;\r\n  }\r\n\r\n  // Get all valid page paths for matching\r\n  const allPagePaths = pages.map(p =\u003e p.relPermalink);\r\n  devLog(`Checking against ${allPagePaths.length} valid page paths`);\r\n\r\n  // Group broken links by source file\r\n  const linksByFile = new Map\u003cstring, Array\u003c{ url: string; fixedUrl: string; reason: string; action: 'fix' | 'remove' }\u003e\u003e();\r\n\r\n  for (const brokenLink of brokenLinks) {\r\n    result.attempted++;\r\n\r\n    devLog(`\\n🔗 Processing broken link: ${brokenLink.brokenUrl} (from ${brokenLink.sourcePage})`);\r\n\r\n    // Find potential match\r\n    const match = findUrlMatch(brokenLink.brokenUrl, allPagePaths, pages);\r\n    \r\n    if (!match) {\r\n      devLog(`⏭️  Skipped: ${brokenLink.brokenUrl} (no obvious match found)`);\r\n      result.skipped++;\r\n      \r\n      // Find close matches for suggestions\r\n      const suggestions = findCloseMatches(brokenLink.brokenUrl, allPagePaths, pages, 3);\r\n      if (suggestions.length \u003e 0) {\r\n        devLog(`   💡 Found ${suggestions.length} suggestion(s): ${suggestions.map(s =\u003e s.url).join(', ')}`);\r\n      }\r\n      \r\n      // Determine source file for skipped links (for removal option)\r\n      const possiblePaths = relPermalinkToContentFile(brokenLink.sourcePage);\r\n      devLog(`   Trying to find source file for skipped link...`);\r\n      const sourceFile = await findActualFilePath(possiblePaths, true); // Enable verbose logging\r\n      \r\n      if (sourceFile) {\r\n        result.skippedLinks.push({\r\n          brokenUrl: brokenLink.brokenUrl,\r\n          sourceFile,\r\n          sourcePage: brokenLink.sourcePage,\r\n          suggestions: suggestions.length \u003e 0 ? suggestions : undefined,\r\n        });\r\n        devLog(`   ✅ Source file found: ${sourceFile}`);\r\n      } else {\r\n        devLog(`   ⚠️  Could not find source file. Tried: ${possiblePaths.join(', ')}`);\r\n        // Still add to skipped links even if source file not found, so user can see the broken link\r\n        result.skippedLinks.push({\r\n          brokenUrl: brokenLink.brokenUrl,\r\n          sourceFile: possiblePaths[0] || 'unknown',\r\n          sourcePage: brokenLink.sourcePage,\r\n          suggestions: suggestions.length \u003e 0 ? suggestions : undefined,\r\n        });\r\n      }\r\n      continue;\r\n    }\r\n\r\n    devLog(`   ✅ Found match: ${brokenLink.brokenUrl} → ${match.match} (${match.reason})`);\r\n\r\n    // Determine source file (try multiple possible paths)\r\n    const possiblePaths = relPermalinkToContentFile(brokenLink.sourcePage);\r\n    devLog(`   Looking for source file: ${brokenLink.sourcePage}`);\r\n    const sourceFile = await findActualFilePath(possiblePaths, true); // Enable verbose logging\r\n    \r\n    if (!sourceFile) {\r\n      devError(`⏭️  Skipped: ${brokenLink.brokenUrl} (could not find source file)`);\r\n      devError(`   Tried paths: ${possiblePaths.join(', ')}`);\r\n      devError(`   Make sure File System Access API has access to the site root directory.`);\r\n      result.skipped++;\r\n      continue;\r\n    }\r\n\r\n    devLog(`   ✅ Source file found: ${sourceFile}`);\r\n\r\n    // Add to fixes\r\n    if (!linksByFile.has(sourceFile)) {\r\n      linksByFile.set(sourceFile, []);\r\n    }\r\n    linksByFile.get(sourceFile)!.push({\r\n      url: brokenLink.brokenUrl,\r\n      fixedUrl: match.match,\r\n      reason: match.reason,\r\n      action: 'fix' as const,\r\n    });\r\n\r\n    result.fixes.push({\r\n      brokenUrl: brokenLink.brokenUrl,\r\n      fixedUrl: match.match,\r\n      sourceFile,\r\n      lineNumber: 0, // Will be determined when reading file\r\n      matchReason: match.reason,\r\n      action: 'fix',\r\n    });\r\n  }\r\n\r\n  // Fix links in each file\r\n  for (const [filePath, fixes] of linksByFile.entries()) {\r\n    devLog(`📝 Fixing ${fixes.length} link(s) in ${filePath}...`);\r\n    \r\n    const fixResult = await fixBrokenLinksInFile(filePath, fixes.map(f =\u003e ({\r\n      url: f.url,\r\n      fixedUrl: f.fixedUrl,\r\n      action: f.action || 'fix' as const\r\n    })));\r\n    \r\n    if (fixResult.success) {\r\n      result.modifiedFiles.push(filePath);\r\n      if (fixResult.backupPath) {\r\n        result.backups.push(fixResult.backupPath);\r\n      }\r\n      \r\n      // Update fixes with actual line numbers from changes\r\n      for (const change of fixResult.changes) {\r\n        const existingFix = result.fixes.find(f =\u003e f.brokenUrl === change.oldUrl \u0026\u0026 f.sourceFile === filePath);\r\n        if (existingFix) {\r\n          existingFix.lineNumber = change.lineNumber;\r\n        }\r\n      }\r\n      \r\n      result.fixed += fixResult.changes.length;\r\n      devLog(`✅ Fixed ${fixResult.changes.length} link(s) in ${filePath}`);\r\n    } else {\r\n      devError(`❌ Failed to fix links in ${filePath}:`, fixResult.error);\r\n      result.skipped += fixes.length;\r\n    }\r\n  }\r\n\r\n  devLog(`✨ Fix process complete: ${result.fixed} fixed, ${result.skipped} skipped`);\r\n  return result;\r\n}\r\n\r\n/**\r\n * Show toast notification\r\n */\r\n// showToast is now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Close loading modal safely\r\n */\r\nfunction closeLoadingModal(): void {\r\n  const loadingModal = document.getElementById('page-list-fix-loading-modal');\r\n  if (loadingModal) {\r\n    // Force removal from DOM\r\n    loadingModal.style.display = 'none';\r\n    loadingModal.remove();\r\n  }\r\n}\r\n\r\n/**\r\n * Show loading modal (removes any existing one first)\r\n */\r\nfunction showLoadingModal(message: string, progress?: number): void {\r\n  // Remove any existing loading modal first\r\n  closeLoadingModal();\r\n  \r\n  const loadingModalHtml = renderLoadingModal(message, progress);\r\n  document.body.insertAdjacentHTML('beforeend', loadingModalHtml);\r\n}\r\n\r\n/**\r\n * Render loading modal\r\n */\r\nfunction renderLoadingModal(message: string, progress?: number): string {\r\n  return `\r\n    \u003cdiv class=\"page-list-modal\" id=\"page-list-fix-loading-modal\" role=\"dialog\" aria-labelledby=\"page-list-fix-loading-title\" aria-busy=\"true\"\u003e\r\n      \u003cdiv class=\"page-list-modal__overlay\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"page-list-modal__content page-list-modal__content--centered\"\u003e\r\n        \u003cdiv class=\"page-list-modal__body\"\u003e\r\n          \u003cdiv class=\"page-list-fix-loading\"\u003e\r\n            \u003cdiv class=\"page-list-fix-loading__spinner\" aria-hidden=\"true\"\u003e\r\n              \u003cdiv class=\"page-list-fix-loading__spinner-circle\"\u003e\u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003ch3 class=\"page-list-fix-loading__title\" id=\"page-list-fix-loading-title\"\u003e${escapeHtml(message)}\u003c/h3\u003e\r\n            ${progress !== undefined ? `\r\n              \u003cdiv class=\"page-list-fix-loading__progress\"\u003e\r\n                \u003cdiv class=\"page-list-fix-loading__progress-bar\" style=\"width: ${progress}%\"\u003e\u003c/div\u003e\r\n              \u003c/div\u003e\r\n              \u003cdiv class=\"page-list-fix-loading__progress-text\"\u003e${progress}% complete\u003c/div\u003e\r\n            ` : ''}\r\n            \u003cp class=\"page-list-fix-loading__subtitle\"\u003ePlease wait while we process your request...\u003c/p\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Render fix results modal\r\n */\r\nfunction renderFixResultsModal(result: FixResult): string {\r\n  const fixesHtml = result.fixes.length \u003e 0\r\n    ? result.fixes.map((fix, index) =\u003e `\r\n      \u003cdiv class=\"page-list-fix-result-item\" role=\"listitem\"\u003e\r\n        \u003cdiv class=\"page-list-fix-result-item__header\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__file\"\u003e\r\n            \u003cspan class=\"page-list-fix-result-item__file-icon material-symbols-outlined\" aria-hidden=\"true\"\u003edescription\u003c/span\u003e\r\n            \u003ccode class=\"page-list-fix-result-item__file-path\"\u003e${escapeHtml(fix.sourceFile)}\u003c/code\u003e\r\n            ${fix.lineNumber \u003e 0 ? `\u003cspan class=\"page-list-fix-result-item__line\" aria-label=\"Line number\"\u003eL${fix.lineNumber}\u003c/span\u003e` : ''}\r\n          \u003c/div\u003e\r\n          \u003cspan class=\"page-list-fix-result-item__badge page-list-fix-result-item__badge--success\" aria-label=\"Fixed successfully\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e\r\n            Fixed\r\n          \u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-fix-result-item__change\" aria-label=\"URL change\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__change-old\"\u003e\r\n            \u003cspan class=\"page-list-fix-result-item__change-label\"\u003eFrom:\u003c/span\u003e\r\n            \u003ccode class=\"page-list-fix-result-item__change-url\"\u003e${escapeHtml(fix.brokenUrl)}\u003c/code\u003e\r\n          \u003c/div\u003e\r\n          \u003cspan class=\"page-list-fix-result-item__arrow material-symbols-outlined\" aria-hidden=\"true\"\u003earrow_forward\u003c/span\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__change-new\"\u003e\r\n            \u003cspan class=\"page-list-fix-result-item__change-label\"\u003eTo:\u003c/span\u003e\r\n            \u003ccode class=\"page-list-fix-result-item__change-url\"\u003e${escapeHtml(fix.fixedUrl || '(removed)')}\u003c/code\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-fix-result-item__reason\"\u003e\r\n          \u003cspan class=\"page-list-fix-result-item__reason-icon material-symbols-outlined\" aria-hidden=\"true\"\u003elightbulb\u003c/span\u003e\r\n          \u003cspan class=\"page-list-fix-result-item__reason-text\"\u003e${escapeHtml(fix.matchReason)}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `).join('')\r\n    : '\u003cdiv class=\"page-list-fix-result-empty\" role=\"status\"\u003e\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003einfo\u003c/span\u003e\u003cp\u003eNo fixes were applied.\u003c/p\u003e\u003c/div\u003e';\r\n\r\n  const modifiedFilesHtml = result.modifiedFiles.length \u003e 0\r\n    ? `\u003cul class=\"page-list-fix-result-files\" role=\"list\"\u003e\r\n        ${result.modifiedFiles.map((file, index) =\u003e `\r\n          \u003cli class=\"page-list-fix-result-files__item\" role=\"listitem\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eedit\u003c/span\u003e\r\n            \u003ccode\u003e${escapeHtml(file)}\u003c/code\u003e\r\n          \u003c/li\u003e\r\n        `).join('')}\r\n      \u003c/ul\u003e`\r\n    : '\u003cdiv class=\"page-list-fix-result-empty\" role=\"status\"\u003e\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003einfo\u003c/span\u003e\u003cp\u003eNo files were modified.\u003c/p\u003e\u003c/div\u003e';\r\n\r\n  const backupsHtml = result.backups.length \u003e 0\r\n    ? `\u003cul class=\"page-list-fix-result-files\" role=\"list\"\u003e\r\n        ${result.backups.map((backup, index) =\u003e `\r\n          \u003cli class=\"page-list-fix-result-files__item\" role=\"listitem\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ebackup\u003c/span\u003e\r\n            \u003ccode\u003e${escapeHtml(backup)}\u003c/code\u003e\r\n          \u003c/li\u003e\r\n        `).join('')}\r\n      \u003c/ul\u003e`\r\n    : '';\r\n\r\n  const successRate = result.attempted \u003e 0 ? Math.round((result.fixed / result.attempted) * 100) : 0;\r\n\r\n  // Render skipped links with suggestions and actions\r\n  const skippedLinksHtml = result.skippedLinks.length \u003e 0\r\n    ? result.skippedLinks.map((skipped, index) =\u003e {\r\n        const suggestions = skipped.suggestions || [];\r\n        return `\r\n      \u003cdiv class=\"page-list-fix-result-item page-list-fix-result-item--skipped\" role=\"listitem\" data-skipped-index=\"${index}\"\u003e\r\n        \u003cdiv class=\"page-list-fix-result-item__header\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__file\"\u003e\r\n            \u003cspan class=\"page-list-fix-result-item__file-icon material-symbols-outlined\" aria-hidden=\"true\"\u003edescription\u003c/span\u003e\r\n            \u003ccode class=\"page-list-fix-result-item__file-path\"\u003e${escapeHtml(skipped.sourceFile)}\u003c/code\u003e\r\n          \u003c/div\u003e\r\n          \u003cspan class=\"page-list-fix-result-item__badge page-list-fix-result-item__badge--warning\" aria-label=\"Could not auto-fix\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ewarning\u003c/span\u003e\r\n            No Match Found\r\n          \u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-fix-result-item__change\" aria-label=\"Broken URL\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__change-old\"\u003e\r\n            \u003cspan class=\"page-list-fix-result-item__change-label\"\u003eBroken Link:\u003c/span\u003e\r\n            \u003ccode class=\"page-list-fix-result-item__change-url\"\u003e${escapeHtml(skipped.brokenUrl)}\u003c/code\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        ${suggestions.length \u003e 0 ? `\r\n        \u003cdiv class=\"page-list-fix-result-item__suggestions\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__suggestions-label\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elightbulb\u003c/span\u003e\r\n            Suggested matches:\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-fix-result-item__suggestions-list\"\u003e\r\n            ${suggestions.map((suggestion, sugIndex) =\u003e `\r\n              \u003cdiv class=\"page-list-fix-result-item__suggestion\" data-suggestion-index=\"${sugIndex}\"\u003e\r\n                \u003cdiv class=\"page-list-fix-result-item__suggestion-content\"\u003e\r\n                  \u003ccode class=\"page-list-fix-result-item__suggestion-url\"\u003e${escapeHtml(suggestion.url)}\u003c/code\u003e\r\n                  ${suggestion.title ? `\u003cspan class=\"page-list-fix-result-item__suggestion-title\"\u003e${escapeHtml(suggestion.title)}\u003c/span\u003e` : ''}\r\n                  \u003cspan class=\"page-list-fix-result-item__suggestion-reason\"\u003e${escapeHtml(suggestion.reason)}\u003c/span\u003e\r\n                \u003c/div\u003e\r\n                \u003cbutton \r\n                  class=\"page-list-fix-result-item__suggestion-btn\" \r\n                  type=\"button\"\r\n                  data-edit-broken-url=\"${escapeHtml(skipped.brokenUrl)}\"\r\n                  data-edit-fixed-url=\"${escapeHtml(suggestion.url)}\"\r\n                  data-edit-file=\"${escapeHtml(skipped.sourceFile)}\"\r\n                  aria-label=\"Fix broken link to ${escapeHtml(suggestion.url)}\"\r\n                \u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e\r\n                  Use This\r\n                \u003c/button\u003e\r\n              \u003c/div\u003e\r\n            `).join('')}\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        ` : ''}\r\n        \u003cdiv class=\"page-list-fix-result-item__actions\"\u003e\r\n          \u003cbutton \r\n            class=\"page-list-fix-result-item__edit-btn\" \r\n            type=\"button\"\r\n            data-edit-broken-url=\"${escapeHtml(skipped.brokenUrl)}\"\r\n            data-edit-file=\"${escapeHtml(skipped.sourceFile)}\"\r\n            aria-label=\"Manually edit this broken link\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eedit\u003c/span\u003e\r\n            Edit Manually\r\n          \u003c/button\u003e\r\n          \u003cbutton \r\n            class=\"page-list-fix-result-item__remove-btn\" \r\n            type=\"button\"\r\n            data-remove-url=\"${escapeHtml(skipped.brokenUrl)}\"\r\n            data-remove-file=\"${escapeHtml(skipped.sourceFile)}\"\r\n            aria-label=\"Remove this broken link and keep only the text\"\r\n          \u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elink_off\u003c/span\u003e\r\n            Remove Link\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n      }).join('')\r\n    : '';\r\n\r\n  return `\r\n    \u003cdiv class=\"page-list-modal\" id=\"page-list-fix-results-modal\" role=\"dialog\" aria-labelledby=\"page-list-fix-results-title\" aria-modal=\"true\"\u003e\r\n      \u003cdiv class=\"page-list-modal__overlay\" aria-hidden=\"true\"\u003e\u003c/div\u003e\r\n      \u003cdiv class=\"page-list-modal__content page-list-modal__content--large\"\u003e\r\n        \u003cbutton \r\n          class=\"page-list-modal__close\" \r\n          id=\"page-list-fix-results-close\" \r\n          type=\"button\"\r\n          aria-label=\"Close dialog\"\r\n        \u003e\r\n          \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n        \u003c/button\u003e\r\n        \u003cdiv class=\"page-list-modal__header\"\u003e\r\n          \u003cdiv class=\"page-list-modal__header-icon\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003e${result.fixed \u003e 0 ? 'check_circle' : 'info'}\u003c/span\u003e\r\n          \u003c/div\u003e\r\n          \u003ch2 class=\"page-list-modal__title\" id=\"page-list-fix-results-title\"\u003eBroken Link Fix Results\u003c/h2\u003e\r\n          \u003cp class=\"page-list-modal__subtitle\"\u003e${result.fixed \u003e 0 ? `${result.fixed} link${result.fixed !== 1 ? 's' : ''} fixed successfully` : 'No fixes were applied'}\u003c/p\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-modal__body\"\u003e\r\n          \u003cdiv class=\"page-list-fix-result-summary\" role=\"status\" aria-live=\"polite\"\u003e\r\n            \u003cdiv class=\"page-list-fix-result-summary__stat\"\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__value\" aria-label=\"${result.attempted} attempted\"\u003e${result.attempted}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__label\"\u003eAttempted\u003c/div\u003e\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-fix-result-summary__stat page-list-fix-result-summary__stat--success\"\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__value\" aria-label=\"${result.fixed} fixed\"\u003e${result.fixed}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__label\"\u003eFixed\u003c/div\u003e\r\n              ${successRate \u003e 0 ? `\u003cdiv class=\"page-list-fix-result-summary__rate\"\u003e${successRate}%\u003c/div\u003e` : ''}\r\n            \u003c/div\u003e\r\n            \u003cdiv class=\"page-list-fix-result-summary__stat page-list-fix-result-summary__stat--warning\"\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__value\" aria-label=\"${result.skipped} skipped\"\u003e${result.skipped}\u003c/div\u003e\r\n              \u003cdiv class=\"page-list-fix-result-summary__label\"\u003eSkipped\u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \r\n          ${result.fixes.length \u003e 0 ? `\r\n          \u003cdiv class=\"page-list-modal__section\"\u003e\r\n            \u003ch3 class=\"page-list-modal__section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck_circle\u003c/span\u003e\r\n              Links Fixed\r\n              \u003cspan class=\"page-list-modal__section-count\"\u003e${result.fixes.length}\u003c/span\u003e\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n              \u003cdiv class=\"page-list-fix-result-changes\" role=\"list\"\u003e\r\n                ${fixesHtml}\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n\r\n          ${result.skippedLinks.length \u003e 0 ? `\r\n          \u003cdiv class=\"page-list-modal__section\"\u003e\r\n            \u003ch3 class=\"page-list-modal__section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elink_off\u003c/span\u003e\r\n              Links That Couldn't Be Auto-Fixed\r\n              \u003cspan class=\"page-list-modal__section-count\"\u003e${result.skippedLinks.length}\u003c/span\u003e\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n              \u003cp class=\"page-list-fix-result-note\"\u003e\r\n                These broken links couldn't be automatically matched. Suggested matches are shown below each link. You can use a suggestion, edit manually, or remove the link to keep only the text.\r\n              \u003c/p\u003e\r\n              \u003cdiv class=\"page-list-fix-result-changes\" role=\"list\"\u003e\r\n                ${skippedLinksHtml}\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n\r\n          \u003cdiv class=\"page-list-modal__section\"\u003e\r\n            \u003ch3 class=\"page-list-modal__section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003efolder\u003c/span\u003e\r\n              Modified Files\r\n              \u003cspan class=\"page-list-modal__section-count\"\u003e${result.modifiedFiles.length}\u003c/span\u003e\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n              ${modifiedFilesHtml}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n\r\n          ${result.backups.length \u003e 0 ? `\r\n          \u003cdiv class=\"page-list-modal__section\"\u003e\r\n            \u003ch3 class=\"page-list-modal__section-title\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ebackup\u003c/span\u003e\r\n              Backups Created\r\n              \u003cspan class=\"page-list-modal__section-count\"\u003e${result.backups.length}\u003c/span\u003e\r\n            \u003c/h3\u003e\r\n            \u003cdiv class=\"page-list-modal__section-content\"\u003e\r\n              ${backupsHtml}\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          ` : ''}\r\n\r\n          \u003cdiv class=\"page-list-modal__actions\" role=\"group\" aria-label=\"Modal actions\"\u003e\r\n            ${result.backups.length \u003e 0 ? `\r\n              \u003cbutton \r\n                class=\"page-list-modal__button page-list-modal__button--secondary\" \r\n                id=\"page-list-fix-undo\"\r\n                type=\"button\"\r\n                aria-label=\"Undo all fixes and restore from backups\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eundo\u003c/span\u003e\r\n                Undo All Fixes\r\n              \u003c/button\u003e\r\n            ` : ''}\r\n            \u003cbutton \r\n              class=\"page-list-modal__button page-list-modal__button--primary\" \r\n              id=\"page-list-fix-close\"\r\n              type=\"button\"\r\n              aria-label=\"Close dialog\"\r\n            \u003e\r\n              \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e\r\n              Close\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Attach tooltip hover handlers\r\n */\r\nfunction attachTooltipHandlers(container: HTMLElement | null): void {\r\n  if (!container) return;\r\n  \r\n  const tooltipTriggers = container.querySelectorAll('.page-list-tooltip-trigger');\r\n  \r\n  tooltipTriggers.forEach(trigger =\u003e {\r\n    const tooltip = trigger.querySelector('.page-list-tooltip') as HTMLElement;\r\n    if (!tooltip) return;\r\n    \r\n    trigger.addEventListener('mouseenter', (e: Event) =\u003e {\r\n      const mouseEvent = e as MouseEvent;\r\n      tooltip.style.display = 'block';\r\n      updateTooltipPosition(tooltip, mouseEvent);\r\n    });\r\n    \r\n    trigger.addEventListener('mousemove', (e: Event) =\u003e {\r\n      const mouseEvent = e as MouseEvent;\r\n      updateTooltipPosition(tooltip, mouseEvent);\r\n    });\r\n    \r\n    trigger.addEventListener('mouseleave', () =\u003e {\r\n      tooltip.style.display = 'none';\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update tooltip position to follow cursor\r\n */\r\nfunction updateTooltipPosition(tooltip: HTMLElement, e: MouseEvent): void {\r\n  const offset = 10;\r\n  const tooltipRect = tooltip.getBoundingClientRect();\r\n  const viewportWidth = window.innerWidth;\r\n  \r\n  let left = e.clientX;\r\n  let top = e.clientY - tooltipRect.height - offset;\r\n  \r\n  // Adjust if tooltip would go off screen\r\n  if (left + tooltipRect.width \u003e viewportWidth) {\r\n    left = viewportWidth - tooltipRect.width - offset;\r\n  }\r\n  if (left \u003c 0) {\r\n    left = offset;\r\n  }\r\n  \r\n  // If tooltip would go above viewport, show below cursor instead\r\n  if (top \u003c 0) {\r\n    top = e.clientY + offset;\r\n  }\r\n  \r\n  tooltip.style.left = `${left}px`;\r\n  tooltip.style.top = `${top}px`;\r\n}\r\n\r\n// createConfirmationDialog is now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Attach fix button handler\r\n */\r\nfunction attachFixButtonHandler(pages: PageData[]): void {\r\n  const fixButton = document.getElementById('page-list-fix-broken-links');\r\n  if (!fixButton) return;\r\n\r\n  fixButton.addEventListener('click', async () =\u003e {\r\n    // Safety check\r\n    if (!isLocalhost()) {\r\n      showToast('This feature is only available in development mode.', 'error', 5000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    // Request directory access if File System Access API is available\r\n    if ('showDirectoryPicker' in window \u0026\u0026 !getSiteRootDirectoryHandle()) {\r\n      const accessGranted = await createConfirmationDialog(\r\n        'Directory Access Required',\r\n        'To fix broken links, we need access to your site files.\\n\\n' +\r\n        'Please select the ROOT directory of your Hugo site (the folder containing the \"content\" folder).\\n\\n' +\r\n        'This permission is only requested once per browser session.',\r\n        'Select Site Root',\r\n        'Cancel',\r\n        'page-list'\r\n      );\r\n      \r\n      if (accessGranted) {\r\n        const dirHandle = await requestSiteRootAccess(\r\n          (msg) =\u003e showToast(msg, 'success', 5000, 'page-list'),\r\n          (msg) =\u003e showToast(msg, 'error', 5000, 'page-list')\r\n        );\r\n        if (!dirHandle) {\r\n          showToast('Directory access is required to fix broken links. Please grant access to continue.', 'error', 6000, 'page-list');\r\n          return;\r\n        }\r\n      } else {\r\n        // User cancelled directory access request\r\n        showToast('Directory access is required to fix broken links.', 'info', 5000, 'page-list');\r\n        return;\r\n      }\r\n    } else if (!('showDirectoryPicker' in window)) {\r\n      // File System Access API not supported\r\n      showToast('File System Access API is not supported in this browser. Cannot fix broken links.', 'error', 6000, 'page-list');\r\n      return;\r\n    } else if (!getSiteRootDirectoryHandle()) {\r\n      // File System Access API is available but directory handle is not set\r\n      showToast('Directory access is required. Please grant access when prompted.', 'error', 6000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    // Count broken links\r\n    const brokenLinks = collectBrokenLinks(pages);\r\n    if (brokenLinks.length === 0) {\r\n      showToast('No broken links found to fix.', 'info', 5000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    // Show confirmation dialog\r\n    const confirmed = await createConfirmationDialog(\r\n      'Fix Broken Links',\r\n      `This will attempt to fix ${brokenLinks.length} broken internal link${brokenLinks.length !== 1 ? 's' : ''}.\\n\\n` +\r\n      '• Only internal links will be modified\\n' +\r\n      '• Backups will be created for all modified files\\n' +\r\n      '• Only obvious matches will be fixed\\n' +\r\n      '• Links without clear matches will be skipped\\n\\n' +\r\n      'Do you want to continue?',\r\n      'Fix Links',\r\n      'Cancel',\r\n      'page-list'\r\n    );\r\n\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    // Update button state\r\n    fixButton.setAttribute('disabled', 'true');\r\n    fixButton.setAttribute('aria-busy', 'true');\r\n    fixButton.classList.add('page-list-fix-button--loading');\r\n    const originalContent = fixButton.innerHTML;\r\n    fixButton.innerHTML = `\r\n      \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined page-list-fix-button__icon--spinning\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e\r\n      \u003cspan class=\"page-list-fix-button__text\"\u003eProcessing...\u003c/span\u003e\r\n    `;\r\n\r\n    // Show loading modal\r\n    showLoadingModal('Analyzing broken links...', 0);\r\n    \r\n    // Update progress\r\n    const updateProgress = (progress: number, message: string) =\u003e {\r\n      const modal = document.getElementById('page-list-fix-loading-modal');\r\n      if (modal) {\r\n        const title = modal.querySelector('.page-list-fix-loading__title');\r\n        const progressBar = modal.querySelector('.page-list-fix-loading__progress-bar') as HTMLElement;\r\n        const progressText = modal.querySelector('.page-list-fix-loading__progress-text');\r\n        if (title) title.textContent = message;\r\n        if (progressBar) progressBar.style.width = `${progress}%`;\r\n        if (progressText) progressText.textContent = `${progress}% complete`;\r\n      }\r\n    };\r\n\r\n    try {\r\n      // Simulate progress updates\r\n      updateProgress(10, 'Collecting broken links...');\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 300));\r\n      \r\n      updateProgress(30, 'Finding potential matches...');\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 300));\r\n      \r\n      updateProgress(60, 'Applying fixes...');\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 300));\r\n      \r\n      // Run fix process\r\n      const result = await fixObviousBrokenLinks(pages);\r\n      \r\n      updateProgress(100, 'Complete!');\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 300));\r\n      \r\n      // Remove loading modal\r\n      closeLoadingModal();\r\n\r\n      // Show success toast\r\n      if (result.fixed \u003e 0) {\r\n        showToast(`Successfully fixed ${result.fixed} broken link${result.fixed !== 1 ? 's' : ''}!`, 'success', 4000, 'page-list');\r\n      } else {\r\n        showToast('No links could be automatically fixed.', 'info', 4000, 'page-list');\r\n      }\r\n\r\n      // Show results modal\r\n      const modalHtml = renderFixResultsModal(result);\r\n      document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n      const modal = document.getElementById('page-list-fix-results-modal');\r\n      const closeBtn = document.getElementById('page-list-fix-results-close');\r\n      const closeBtn2 = document.getElementById('page-list-fix-close');\r\n      const undoBtn = document.getElementById('page-list-fix-undo');\r\n      const overlay = modal?.querySelector('.page-list-modal__overlay');\r\n\r\n      // Focus management\r\n      if (modal) {\r\n        const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])') as HTMLElement;\r\n        if (firstFocusable) {\r\n          firstFocusable.focus();\r\n        }\r\n      }\r\n\r\n      const closeModal = () =\u003e {\r\n        if (modal) {\r\n          modal.classList.add('page-list-modal--closing');\r\n          setTimeout(() =\u003e {\r\n            modal.remove();\r\n            // Return focus to fix button\r\n            fixButton.focus();\r\n          }, 300);\r\n        }\r\n      };\r\n\r\n      if (closeBtn) closeBtn.addEventListener('click', closeModal);\r\n      if (closeBtn2) closeBtn2.addEventListener('click', closeModal);\r\n      if (overlay) overlay.addEventListener('click', closeModal);\r\n\r\n      // Undo functionality\r\n      if (undoBtn) {\r\n        undoBtn.addEventListener('click', async () =\u003e {\r\n          const undoConfirmed = await createConfirmationDialog(\r\n            'Undo All Fixes',\r\n            `This will restore ${result.modifiedFiles.length} file${result.modifiedFiles.length !== 1 ? 's' : ''} from backups.\\n\\n` +\r\n            'All fixes will be reverted. Continue?',\r\n            'Undo',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (undoConfirmed) {\r\n            // In real implementation, would restore files from backups\r\n            devLog('Undo functionality would restore from:', result.backups);\r\n            showToast('Undo functionality requires backend API implementation.', 'info', 5000, 'page-list');\r\n            closeModal();\r\n          }\r\n        });\r\n      }\r\n\r\n      // Helper function to fix a link in a file\r\n      const fixLinkInFile = async (brokenUrl: string, fixedUrl: string, filePath: string, button: HTMLElement, originalText: string): Promise\u003cboolean\u003e =\u003e {\r\n        try {\r\n          // Read file\r\n          const fileData = await readFileContent(filePath, true);\r\n          if (!fileData) {\r\n            showToast(`Could not read file: ${filePath}`, 'error', 5000, 'page-list');\r\n            return false;\r\n          }\r\n          \r\n          // Fix the link\r\n          const escapedUrl = escapeRegex(brokenUrl);\r\n          let modifiedContent = fileData.content;\r\n          let modified = false;\r\n          \r\n          // Replace markdown links\r\n          const markdownPattern = new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrl}([^)]*\\\\))`, 'g');\r\n          modifiedContent = modifiedContent.replace(markdownPattern, (match, prefix, suffix) =\u003e {\r\n            modified = true;\r\n            return `${prefix}${fixedUrl}${suffix}`;\r\n          });\r\n          \r\n          // Replace HTML links\r\n          const htmlPattern = new RegExp(`(href=[\"'])${escapedUrl}([\"'])`, 'gi');\r\n          modifiedContent = modifiedContent.replace(htmlPattern, (match, prefix, suffix) =\u003e {\r\n            modified = true;\r\n            return `${prefix}${fixedUrl}${suffix}`;\r\n          });\r\n          \r\n          if (!modified) {\r\n            showToast('Link not found in file content.', 'info', 5000, 'page-list');\r\n            return false;\r\n          }\r\n          \r\n          // Create backup\r\n          const backupPath = createBackupFilename(filePath);\r\n          const backupCreated = await writeFileContent(backupPath, fileData.content);\r\n          \r\n          if (!backupCreated) {\r\n            devWarn(`Could not create backup: ${backupPath}`);\r\n          }\r\n          \r\n          // Write modified content\r\n          const writeSuccess = await writeFileContent(filePath, modifiedContent);\r\n          \r\n          if (!writeSuccess) {\r\n            showToast(`Could not write file: ${filePath}`, 'error', 5000, 'page-list');\r\n            return false;\r\n          }\r\n          \r\n          // Success!\r\n          showToast(`Link fixed: ${brokenUrl} → ${fixedUrl}`, 'success', 5000, 'page-list');\r\n          \r\n          // Update UI - mark as fixed\r\n          const item = button.closest('.page-list-fix-result-item');\r\n          if (item) {\r\n            item.classList.remove('page-list-fix-result-item--skipped');\r\n            item.classList.add('page-list-fix-result-item--fixed');\r\n            const badge = item.querySelector('.page-list-fix-result-item__badge');\r\n            if (badge) {\r\n              badge.className = 'page-list-fix-result-item__badge page-list-fix-result-item__badge--success';\r\n              badge.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e Fixed';\r\n            }\r\n            \r\n            // Update the change display\r\n            const changeOld = item.querySelector('.page-list-fix-result-item__change-old .page-list-fix-result-item__change-url');\r\n            const changeNew = item.querySelector('.page-list-fix-result-item__change-new');\r\n            if (changeOld \u0026\u0026 changeNew) {\r\n              const arrow = item.querySelector('.page-list-fix-result-item__arrow');\r\n              if (!arrow) {\r\n                const changeContainer = item.querySelector('.page-list-fix-result-item__change');\r\n                if (changeContainer) {\r\n                  changeContainer.innerHTML = `\r\n                    \u003cdiv class=\"page-list-fix-result-item__change-old\"\u003e\r\n                      \u003cspan class=\"page-list-fix-result-item__change-label\"\u003eFrom:\u003c/span\u003e\r\n                      \u003ccode class=\"page-list-fix-result-item__change-url\"\u003e${escapeHtml(brokenUrl)}\u003c/code\u003e\r\n                    \u003c/div\u003e\r\n                    \u003cspan class=\"page-list-fix-result-item__arrow material-symbols-outlined\" aria-hidden=\"true\"\u003earrow_forward\u003c/span\u003e\r\n                    \u003cdiv class=\"page-list-fix-result-item__change-new\"\u003e\r\n                      \u003cspan class=\"page-list-fix-result-item__change-label\"\u003eTo:\u003c/span\u003e\r\n                      \u003ccode class=\"page-list-fix-result-item__change-url\"\u003e${escapeHtml(fixedUrl)}\u003c/code\u003e\r\n                    \u003c/div\u003e\r\n                  `;\r\n                }\r\n              } else {\r\n                const newUrlElement = changeNew.querySelector('.page-list-fix-result-item__change-url');\r\n                if (newUrlElement) {\r\n                  newUrlElement.textContent = fixedUrl;\r\n                }\r\n              }\r\n            }\r\n            \r\n            // Remove suggestions and action buttons\r\n            const suggestions = item.querySelector('.page-list-fix-result-item__suggestions');\r\n            if (suggestions) suggestions.remove();\r\n            const actions = item.querySelector('.page-list-fix-result-item__actions');\r\n            if (actions) actions.remove();\r\n          }\r\n          \r\n          devLog(`✅ Fixed link \"${brokenUrl}\" → \"${fixedUrl}\" in ${filePath}`);\r\n          return true;\r\n        } catch (error) {\r\n          devError('Error fixing link:', error);\r\n          showToast(`Error fixing link: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error', 5000, 'page-list');\r\n          return false;\r\n        }\r\n      };\r\n\r\n      // Suggestion button functionality (Use This button)\r\n      const suggestionButtons = modal?.querySelectorAll('.page-list-fix-result-item__suggestion-btn');\r\n      suggestionButtons?.forEach((btn) =\u003e {\r\n        btn.addEventListener('click', async () =\u003e {\r\n          const button = btn as HTMLElement;\r\n          const brokenUrl = button.getAttribute('data-edit-broken-url');\r\n          const fixedUrl = button.getAttribute('data-edit-fixed-url');\r\n          const filePath = button.getAttribute('data-edit-file');\r\n          \r\n          if (!brokenUrl || !fixedUrl || !filePath) return;\r\n          \r\n          const confirmed = await createConfirmationDialog(\r\n            'Fix Broken Link',\r\n            `This will fix the broken link \"${brokenUrl}\" to \"${fixedUrl}\" in \"${filePath}\".\\n\\n` +\r\n            'A backup will be created before making changes. Continue?',\r\n            'Fix Link',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (!confirmed) return;\r\n          \r\n          // Disable button during processing\r\n          button.setAttribute('disabled', 'true');\r\n          button.classList.add('page-list-fix-button--loading');\r\n          const originalText = button.innerHTML;\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Fixing...';\r\n          \r\n          const success = await fixLinkInFile(brokenUrl, fixedUrl, filePath, button, originalText);\r\n          \r\n          if (!success) {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('page-list-fix-button--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        });\r\n      });\r\n\r\n      // Edit button functionality (Edit Manually)\r\n      const editButtons = modal?.querySelectorAll('.page-list-fix-result-item__edit-btn');\r\n      editButtons?.forEach((btn) =\u003e {\r\n        btn.addEventListener('click', async () =\u003e {\r\n          const button = btn as HTMLElement;\r\n          const brokenUrl = button.getAttribute('data-edit-broken-url');\r\n          const filePath = button.getAttribute('data-edit-file');\r\n          \r\n          if (!brokenUrl || !filePath) return;\r\n          \r\n          // Prompt for new URL\r\n          const newUrl = await createUrlInputDialog('Enter new URL:', brokenUrl, 'page-list');\r\n          \r\n          if (!newUrl || newUrl === brokenUrl) {\r\n            return;\r\n          }\r\n          \r\n          const confirmed = await createConfirmationDialog(\r\n            'Fix Broken Link',\r\n            `This will fix the broken link \"${brokenUrl}\" to \"${newUrl}\" in \"${filePath}\".\\n\\n` +\r\n            'A backup will be created before making changes. Continue?',\r\n            'Fix Link',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (!confirmed) return;\r\n          \r\n          // Disable button during processing\r\n          button.setAttribute('disabled', 'true');\r\n          button.classList.add('page-list-fix-button--loading');\r\n          const originalText = button.innerHTML;\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Fixing...';\r\n          \r\n          const success = await fixLinkInFile(brokenUrl, newUrl, filePath, button, originalText);\r\n          \r\n          if (!success) {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('page-list-fix-button--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        });\r\n      });\r\n\r\n      // Remove link functionality\r\n      const removeButtons = modal?.querySelectorAll('.page-list-fix-result-item__remove-btn');\r\n      removeButtons?.forEach((btn) =\u003e {\r\n        btn.addEventListener('click', async () =\u003e {\r\n          const button = btn as HTMLElement;\r\n          const url = button.getAttribute('data-remove-url');\r\n          const filePath = button.getAttribute('data-remove-file');\r\n          \r\n          if (!url || !filePath) return;\r\n          \r\n          const confirmed = await createConfirmationDialog(\r\n            'Remove Broken Link',\r\n            `This will remove the broken link \"${url}\" from \"${filePath}\" and keep only the text.\\n\\n` +\r\n            'A backup will be created before making changes. Continue?',\r\n            'Remove Link',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (!confirmed) return;\r\n          \r\n          // Disable button during processing\r\n          button.setAttribute('disabled', 'true');\r\n          button.classList.add('page-list-fix-button--loading');\r\n          const originalText = button.innerHTML;\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Removing...';\r\n          \r\n          try {\r\n            // Read file\r\n            const fileData = await readFileContent(filePath);\r\n            if (!fileData) {\r\n              showToast(`Could not read file: ${filePath}`, 'error', 5000, 'page-list');\r\n              button.removeAttribute('disabled');\r\n              button.classList.remove('page-list-fix-button--loading');\r\n              button.innerHTML = originalText;\r\n              return;\r\n            }\r\n            \r\n            // Remove the link\r\n            const removalResult = removeLinkFromContent(fileData.content, url);\r\n            \r\n            if (removalResult.changes.length === 0) {\r\n              showToast('Link not found in file content.', 'info', 5000, 'page-list');\r\n              button.removeAttribute('disabled');\r\n              button.classList.remove('page-list-fix-button--loading');\r\n              button.innerHTML = originalText;\r\n              return;\r\n            }\r\n            \r\n            // Create backup\r\n            const backupPath = createBackupFilename(filePath);\r\n            const backupCreated = await writeFileContent(backupPath, fileData.content);\r\n            \r\n            if (!backupCreated) {\r\n              devWarn(`Could not create backup: ${backupPath}`);\r\n            }\r\n            \r\n            // Write modified content\r\n            const writeSuccess = await writeFileContent(filePath, removalResult.content);\r\n            \r\n            if (!writeSuccess) {\r\n              showToast(`Could not write file: ${filePath}`, 'error', 5000, 'page-list');\r\n              button.removeAttribute('disabled');\r\n              button.classList.remove('page-list-fix-button--loading');\r\n              button.innerHTML = originalText;\r\n              return;\r\n            }\r\n            \r\n            // Success!\r\n            showToast(`Link removed successfully from ${filePath}`, 'success', 5000, 'page-list');\r\n            \r\n            // Update UI - mark as removed\r\n            const item = button.closest('.page-list-fix-result-item');\r\n            if (item) {\r\n              item.classList.add('page-list-fix-result-item--removed');\r\n              const badge = item.querySelector('.page-list-fix-result-item__badge');\r\n              if (badge) {\r\n                badge.className = 'page-list-fix-result-item__badge page-list-fix-result-item__badge--success';\r\n                badge.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck\u003c/span\u003e Removed';\r\n              }\r\n              button.remove();\r\n            }\r\n            \r\n            devLog(`✅ Removed link \"${url}\" from ${filePath}`);\r\n          } catch (error) {\r\n            devError('Error removing link:', error);\r\n            showToast(`Error removing link: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error', 5000, 'page-list');\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        });\r\n      });\r\n\r\n      // Close on Escape key\r\n      const handleEscape = (e: KeyboardEvent) =\u003e {\r\n        if (e.key === 'Escape' \u0026\u0026 modal \u0026\u0026 document.body.contains(modal)) {\r\n          closeModal();\r\n          document.removeEventListener('keydown', handleEscape);\r\n        }\r\n      };\r\n      document.addEventListener('keydown', handleEscape);\r\n\r\n      // Trap focus within modal\r\n      const trapFocus = (e: KeyboardEvent) =\u003e {\r\n        if (e.key !== 'Tab' || !modal) return;\r\n        \r\n        const focusableElements = modal.querySelectorAll(\r\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n        );\r\n        const firstElement = focusableElements[0] as HTMLElement;\r\n        const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;\r\n        \r\n        if (e.shiftKey \u0026\u0026 document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement?.focus();\r\n        } else if (!e.shiftKey \u0026\u0026 document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement?.focus();\r\n        }\r\n      };\r\n      \r\n      modal?.addEventListener('keydown', trapFocus);\r\n\r\n    } catch (error) {\r\n      devError('Error fixing broken links:', error);\r\n      \r\n      // Remove loading modal if still present\r\n      closeLoadingModal();\r\n      \r\n      // Show error toast\r\n      showToast(\r\n        `Error fixing broken links: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n        'error',\r\n        6000,\r\n        'page-list'\r\n      );\r\n    } finally {\r\n      // Ensure loading modal is closed\r\n      closeLoadingModal();\r\n      \r\n      // Re-enable button\r\n      fixButton.removeAttribute('disabled');\r\n      fixButton.removeAttribute('aria-busy');\r\n      fixButton.classList.remove('page-list-fix-button--loading');\r\n      fixButton.innerHTML = originalContent;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Export page list data to CSV format\r\n * @param pages - Array of page data to export\r\n * @param filename - Name for the downloaded file\r\n */\r\nfunction exportPagesToCSV(pages: PageData[], filename: string): void {\r\n  if (pages.length === 0) {\r\n    showToast('No pages to export', 'info', 3000, 'page-list');\r\n    return;\r\n  }\r\n\r\n  // CSV header\r\n  const headers = [\r\n    'Page Title',\r\n    'Page Title (Character Count)',\r\n    'Meta Title',\r\n    'Meta Title (Character Count)',\r\n    'Meta Description',\r\n    'Meta Description (Character Count)',\r\n    'Link (URL)',\r\n    'URL (Character Count)'\r\n  ];\r\n  const rows = [headers.join(',')];\r\n\r\n  // CSV rows\r\n  pages.forEach(page =\u003e {\r\n    const pageTitle = page.title || '';\r\n    const metaTitle = page.metaTitle || '';\r\n    const metaDescription = page.metaDescription || '';\r\n    const url = page.relPermalink || '';\r\n    \r\n    const row = [\r\n      `\"${pageTitle.replace(/\"/g, '\"\"')}\"`, // Escape quotes\r\n      pageTitle.length.toString(),\r\n      `\"${metaTitle.replace(/\"/g, '\"\"')}\"`,\r\n      (page.metaTitleLength || metaTitle.length).toString(),\r\n      `\"${metaDescription.replace(/\"/g, '\"\"')}\"`,\r\n      (page.metaDescriptionLength || metaDescription.length).toString(),\r\n      `\"${url.replace(/\"/g, '\"\"')}\"`,\r\n      url.length.toString()\r\n    ];\r\n    rows.push(row.join(','));\r\n  });\r\n\r\n  // Create blob and download\r\n  const csvContent = rows.join('\\n');\r\n  // Add BOM for Excel UTF-8 support\r\n  const BOM = '\\uFEFF';\r\n  const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.style.display = 'none';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n\r\n  showToast(`Exported ${pages.length} pages to ${filename}`, 'success', 3000, 'page-list');\r\n}\r\n\r\n/**\r\n * Export page list data to Excel format (Excel 2003 XML format)\r\n * @param pages - Array of page data to export\r\n * @param filename - Name for the downloaded file\r\n */\r\nfunction exportPagesToExcel(pages: PageData[], filename: string): void {\r\n  if (pages.length === 0) {\r\n    showToast('No pages to export', 'info', 3000, 'page-list');\r\n    return;\r\n  }\r\n\r\n  // Excel XML header\r\n  let xml = '\u003c?xml version=\"1.0\"?\u003e\\n';\r\n  xml += '\u003c?mso-application progid=\"Excel.Sheet\"?\u003e\\n';\r\n  xml += '\u003cWorkbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\\n';\r\n  xml += ' xmlns:o=\"urn:schemas-microsoft-com:office:office\"\\n';\r\n  xml += ' xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\\n';\r\n  xml += ' xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\"\\n';\r\n  xml += ' xmlns:html=\"http://www.w3.org/TR/REC-html40\"\u003e\\n';\r\n  xml += '\u003cWorksheet ss:Name=\"SEO Analysis\"\u003e\\n';\r\n  xml += '\u003cTable\u003e\\n';\r\n\r\n  // Header row\r\n  xml += '\u003cRow\u003e\\n';\r\n  const headers = [\r\n    'Page Title',\r\n    'Page Title (Character Count)',\r\n    'Meta Title',\r\n    'Meta Title (Character Count)',\r\n    'Meta Description',\r\n    'Meta Description (Character Count)',\r\n    'Link (URL)',\r\n    'URL (Character Count)'\r\n  ];\r\n  headers.forEach(header =\u003e {\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"String\"\u003e${escapeHtml(header)}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n  });\r\n  xml += '\u003c/Row\u003e\\n';\r\n\r\n  // Data rows\r\n  pages.forEach(page =\u003e {\r\n    const pageTitle = page.title || '';\r\n    const metaTitle = page.metaTitle || '';\r\n    const metaDescription = page.metaDescription || '';\r\n    const url = page.relPermalink || '';\r\n    \r\n    xml += '\u003cRow\u003e\\n';\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"String\"\u003e${escapeHtml(pageTitle)}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"Number\"\u003e${pageTitle.length}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"String\"\u003e${escapeHtml(metaTitle)}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"Number\"\u003e${page.metaTitleLength || metaTitle.length}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"String\"\u003e${escapeHtml(metaDescription)}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"Number\"\u003e${page.metaDescriptionLength || metaDescription.length}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"String\"\u003e${escapeHtml(url)}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += `\u003cCell\u003e\u003cData ss:Type=\"Number\"\u003e${url.length}\u003c/Data\u003e\u003c/Cell\u003e\\n`;\r\n    xml += '\u003c/Row\u003e\\n';\r\n  });\r\n\r\n  xml += '\u003c/Table\u003e\\n';\r\n  xml += '\u003c/Worksheet\u003e\\n';\r\n  xml += '\u003c/Workbook\u003e';\r\n\r\n  // Create blob and download\r\n  const blob = new Blob([xml], { type: 'application/vnd.ms-excel' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.style.display = 'none';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n\r\n  showToast(`Exported ${pages.length} pages to ${filename}`, 'success', 3000, 'page-list');\r\n}\r\n\r\n// Store export toggle handlers to prevent duplicates\r\nlet exportToggleHandlers: {\r\n  toggleHandler?: (e: Event) =\u003e void;\r\n  outsideClickHandler?: (e: Event) =\u003e void;\r\n  escapeHandler?: (e: KeyboardEvent) =\u003e void;\r\n} = {};\r\n\r\n/**\r\n * Attach export toggle menu handler\r\n * Note: This should be called after the DOM elements are created\r\n */\r\nfunction attachExportToggle(): void {\r\n  const toggle = document.getElementById('page-list-export-toggle');\r\n  const menu = document.getElementById('page-list-export-menu');\r\n  \r\n  if (!toggle || !menu) {\r\n    devWarn('Export toggle or menu not found');\r\n    return;\r\n  }\r\n\r\n  // Remove existing listeners if they exist\r\n  if (exportToggleHandlers.toggleHandler) {\r\n    toggle.removeEventListener('click', exportToggleHandlers.toggleHandler);\r\n  }\r\n  if (exportToggleHandlers.outsideClickHandler) {\r\n    document.removeEventListener('click', exportToggleHandlers.outsideClickHandler);\r\n  }\r\n  if (exportToggleHandlers.escapeHandler) {\r\n    document.removeEventListener('keydown', exportToggleHandlers.escapeHandler);\r\n  }\r\n\r\n  const toggleHandler = (e: Event) =\u003e {\r\n    e.stopPropagation();\r\n    const isOpen = menu.classList.contains('page-list-export-menu--open');\r\n    \r\n    // Close all other menus first\r\n    document.querySelectorAll('.page-list-export-menu--open').forEach(openMenu =\u003e {\r\n      if (openMenu !== menu) {\r\n        openMenu.classList.remove('page-list-export-menu--open');\r\n        const otherToggle = document.getElementById('page-list-export-toggle');\r\n        if (otherToggle) {\r\n          otherToggle.classList.remove('page-list-export-toggle--open');\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Toggle this menu\r\n    menu.classList.toggle('page-list-export-menu--open', !isOpen);\r\n    toggle.classList.toggle('page-list-export-toggle--open', !isOpen);\r\n  };\r\n\r\n  const outsideClickHandler = (e: Event) =\u003e {\r\n    const target = e.target as Node;\r\n    if (!menu.contains(target) \u0026\u0026 !toggle.contains(target)) {\r\n      menu.classList.remove('page-list-export-menu--open');\r\n      toggle.classList.remove('page-list-export-toggle--open');\r\n    }\r\n  };\r\n\r\n  const escapeHandler = (e: KeyboardEvent) =\u003e {\r\n    if (e.key === 'Escape') {\r\n      menu.classList.remove('page-list-export-menu--open');\r\n      toggle.classList.remove('page-list-export-toggle--open');\r\n    }\r\n  };\r\n\r\n  // Store handlers for cleanup\r\n  exportToggleHandlers = {\r\n    toggleHandler,\r\n    outsideClickHandler,\r\n    escapeHandler\r\n  };\r\n\r\n  toggle.addEventListener('click', toggleHandler);\r\n  document.addEventListener('click', outsideClickHandler);\r\n  document.addEventListener('keydown', escapeHandler);\r\n}\r\n\r\n// Store current filtered pages for export\r\nlet currentFilteredPagesForExport: PageData[] = [];\r\n// Store all pages for export\r\nlet allPagesForExport: PageData[] = [];\r\n\r\n/**\r\n * Update the current filtered pages for export\r\n * @param pages - Array of currently filtered page data\r\n */\r\nfunction updateFilteredPagesForExport(pages: PageData[]): void {\r\n  currentFilteredPagesForExport = pages;\r\n}\r\n\r\n/**\r\n * Update all pages for export\r\n * @param pages - Array of all page data\r\n */\r\nfunction updateAllPagesForExport(pages: PageData[]): void {\r\n  allPagesForExport = pages;\r\n}\r\n\r\n// Store export button handlers to prevent duplicates\r\nlet exportButtonHandlers: {\r\n  csvHandler?: () =\u003e void;\r\n  excelHandler?: () =\u003e void;\r\n  csvAllHandler?: () =\u003e void;\r\n  excelAllHandler?: () =\u003e void;\r\n} = {};\r\n\r\n/**\r\n * Attach page list export button handlers\r\n */\r\nfunction attachPageListExportHandlers(): void {\r\n  const exportCsvBtn = document.getElementById('page-list-export-csv');\r\n  const exportExcelBtn = document.getElementById('page-list-export-excel');\r\n  const exportCsvAllBtn = document.getElementById('page-list-export-csv-all');\r\n  const exportExcelAllBtn = document.getElementById('page-list-export-excel-all');\r\n\r\n  // Remove existing handlers if they exist\r\n  if (exportButtonHandlers.csvHandler \u0026\u0026 exportCsvBtn) {\r\n    exportCsvBtn.removeEventListener('click', exportButtonHandlers.csvHandler);\r\n  }\r\n  if (exportButtonHandlers.excelHandler \u0026\u0026 exportExcelBtn) {\r\n    exportExcelBtn.removeEventListener('click', exportButtonHandlers.excelHandler);\r\n  }\r\n  if (exportButtonHandlers.csvAllHandler \u0026\u0026 exportCsvAllBtn) {\r\n    exportCsvAllBtn.removeEventListener('click', exportButtonHandlers.csvAllHandler);\r\n  }\r\n  if (exportButtonHandlers.excelAllHandler \u0026\u0026 exportExcelAllBtn) {\r\n    exportExcelAllBtn.removeEventListener('click', exportButtonHandlers.excelAllHandler);\r\n  }\r\n\r\n  const closeMenu = () =\u003e {\r\n    const menu = document.getElementById('page-list-export-menu');\r\n    const toggle = document.getElementById('page-list-export-toggle');\r\n    if (menu) {\r\n      menu.classList.remove('page-list-export-menu--open');\r\n    }\r\n    if (toggle) {\r\n      toggle.classList.remove('page-list-export-toggle--open');\r\n    }\r\n  };\r\n\r\n  const csvHandler = () =\u003e {\r\n    if (currentFilteredPagesForExport.length === 0) {\r\n      showToast('No pages to export', 'info', 3000, 'page-list');\r\n      return;\r\n    }\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n    exportPagesToCSV(currentFilteredPagesForExport, `seo-analysis-${timestamp}.csv`);\r\n    closeMenu();\r\n  };\r\n\r\n  const excelHandler = () =\u003e {\r\n    if (currentFilteredPagesForExport.length === 0) {\r\n      showToast('No pages to export', 'info', 3000, 'page-list');\r\n      return;\r\n    }\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n    exportPagesToExcel(currentFilteredPagesForExport, `seo-analysis-${timestamp}.xls`);\r\n    closeMenu();\r\n  };\r\n\r\n  const csvAllHandler = () =\u003e {\r\n    if (allPagesForExport.length === 0) {\r\n      showToast('No pages to export', 'info', 3000, 'page-list');\r\n      return;\r\n    }\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n    exportPagesToCSV(allPagesForExport, `seo-analysis-all-${timestamp}.csv`);\r\n    closeMenu();\r\n  };\r\n\r\n  const excelAllHandler = () =\u003e {\r\n    if (allPagesForExport.length === 0) {\r\n      showToast('No pages to export', 'info', 3000, 'page-list');\r\n      return;\r\n    }\r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\r\n    exportPagesToExcel(allPagesForExport, `seo-analysis-all-${timestamp}.xls`);\r\n    closeMenu();\r\n  };\r\n\r\n  // Store handlers for cleanup\r\n  exportButtonHandlers = {\r\n    csvHandler,\r\n    excelHandler,\r\n    csvAllHandler,\r\n    excelAllHandler\r\n  };\r\n\r\n  if (exportCsvBtn) {\r\n    exportCsvBtn.addEventListener('click', csvHandler);\r\n  }\r\n\r\n  if (exportExcelBtn) {\r\n    exportExcelBtn.addEventListener('click', excelHandler);\r\n  }\r\n\r\n  if (exportCsvAllBtn) {\r\n    exportCsvAllBtn.addEventListener('click', csvAllHandler);\r\n  }\r\n\r\n  if (exportExcelAllBtn) {\r\n    exportExcelAllBtn.addEventListener('click', excelAllHandler);\r\n  }\r\n}\r\n\r\n/**\r\n * Attach rescan button handler - reloads page data\r\n */\r\nfunction attachRescanHandler(): void {\r\n  const rescanButton = document.getElementById('page-list-rescan-button');\r\n  if (!rescanButton) {\r\n    return;\r\n  }\r\n\r\n  rescanButton.addEventListener('click', async () =\u003e {\r\n    const button = rescanButton as HTMLButtonElement;\r\n    const originalText = button.innerHTML;\r\n    \r\n    // Disable button and show loading state\r\n    button.disabled = true;\r\n    button.innerHTML = `\r\n      \u003cspan class=\"page-list-rescan-button__icon material-symbols-outlined page-list-rescan-button__icon--spinning\" aria-hidden=\"true\"\u003erefresh\u003c/span\u003e\r\n      \u003cspan class=\"page-list-rescan-button__text\"\u003eRescanning...\u003c/span\u003e\r\n    `;\r\n\r\n    try {\r\n      showLoading();\r\n      \r\n      // Fetch with cache-busting parameter\r\n      const timestamp = new Date().getTime();\r\n      const response = await fetch(`/page-list/index.json?t=${timestamp}`, {\r\n        cache: 'no-store',\r\n        headers: {\r\n          'Cache-Control': 'no-cache',\r\n          'Pragma': 'no-cache'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      if (!response.headers.get('content-type')?.includes('application/json')) {\r\n        throw new Error('Invalid content type: expected JSON');\r\n      }\r\n\r\n      const data: PageListData = await response.json();\r\n      hideLoading();\r\n\r\n      // Validate data structure\r\n      if (!data || !Array.isArray(data.pages)) {\r\n        throw new Error('Invalid data format: expected pages array');\r\n      }\r\n\r\n      // Reload the page to refresh all data\r\n      window.location.reload();\r\n    } catch (error) {\r\n      hideLoading();\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\r\n      devError('Error rescanning site:', error);\r\n      \r\n      // Show error toast\r\n      showToast(`Failed to rescan site: ${errorMessage}`, 'error', 5000, 'page-list');\r\n      \r\n      // Restore button\r\n      button.disabled = false;\r\n      button.innerHTML = originalText;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Attach bulk excerpt generation handler\r\n * Currently dev-only helper scoped to the content-quality page\r\n */\r\nfunction attachBulkGenerateExcerptsHandler(pages: PageData[]): void {\r\n  const bulkExcerptBtn = document.getElementById('page-list-bulk-generate-excerpts');\r\n  if (!bulkExcerptBtn) return;\r\n\r\n  const needsExcerpts = pages.filter(page =\u003e !page.hasSummary || page.summaryTooShort || page.summaryTooLong);\r\n\r\n  const handleBulkGenerate = () =\u003e {\r\n    if (needsExcerpts.length === 0) {\r\n      showToast('No pages need excerpt generation.', 'info', 4000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    // Stubbed behavior: real generation requires content pipeline\r\n    showToast(`Found ${needsExcerpts.length} page${needsExcerpts.length !== 1 ? 's' : ''} needing excerpts. Implement generation pipeline to proceed.`, 'info', 5000, 'page-list');\r\n    devLog('Bulk excerpt generation requested for pages:', needsExcerpts.map(p =\u003e p.title));\r\n  };\r\n\r\n  bulkExcerptBtn.addEventListener('click', handleBulkGenerate);\r\n}\r\n\r\n/**\r\n * Initialize page list (dev-only)\r\n */\r\n/**\r\n * Attach tab navigation handlers to page detail modal\r\n */\r\nfunction attachTabHandlers(modal: HTMLElement | null): void {\r\n  if (!modal) return;\r\n  \r\n  const tabs = modal.querySelectorAll('.page-list-modal__tab');\r\n  const sections = modal.querySelectorAll('.page-list-modal__section[data-section]');\r\n  \r\n  tabs.forEach(tab =\u003e {\r\n    tab.addEventListener('click', () =\u003e {\r\n      const tabName = tab.getAttribute('data-tab');\r\n      if (!tabName) return;\r\n      \r\n      // Update tab states\r\n      tabs.forEach(t =\u003e {\r\n        t.classList.remove('page-list-modal__tab--active');\r\n        t.setAttribute('aria-selected', 'false');\r\n      });\r\n      tab.classList.add('page-list-modal__tab--active');\r\n      tab.setAttribute('aria-selected', 'true');\r\n      \r\n      // Update section visibility\r\n      sections.forEach(section =\u003e {\r\n        const sectionName = section.getAttribute('data-section');\r\n        if (sectionName === tabName) {\r\n          section.classList.add('page-list-modal__section--active');\r\n        } else {\r\n          section.classList.remove('page-list-modal__section--active');\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Handle keyboard navigation\r\n    tab.addEventListener('keydown', (e) =\u003e {\r\n      const keyEvent = e as KeyboardEvent;\r\n      if (keyEvent.key === 'Enter' || keyEvent.key === ' ') {\r\n        keyEvent.preventDefault();\r\n        (tab as HTMLElement).click();\r\n      } else if (keyEvent.key === 'ArrowRight' || keyEvent.key === 'ArrowLeft') {\r\n        keyEvent.preventDefault();\r\n        const currentIndex = Array.from(tabs).indexOf(tab);\r\n        const direction = keyEvent.key === 'ArrowRight' ? 1 : -1;\r\n        const nextIndex = (currentIndex + direction + tabs.length) % tabs.length;\r\n        (tabs[nextIndex] as HTMLElement).focus();\r\n        (tabs[nextIndex] as HTMLElement).click();\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Attach keyword research handler to page detail modal\r\n */\r\nfunction attachKeywordResearchHandler(modal: HTMLElement | null, page: PageData, allPages: PageData[]): void {\r\n  if (!modal || !isLocalhost()) return;\r\n  \r\n  const keywordBtn = modal.querySelector('#page-list-keyword-research-btn') as HTMLElement;\r\n  if (!keywordBtn) return;\r\n  \r\n  keywordBtn.addEventListener('click', async () =\u003e {\r\n    // Show loading modal with progress\r\n    showLoadingModal('Analyzing keywords...', 0);\r\n    \r\n    // Update progress function\r\n    const updateProgress = (progress: number, message: string) =\u003e {\r\n      const modal = document.getElementById('page-list-fix-loading-modal');\r\n      if (modal) {\r\n        const title = modal.querySelector('.page-list-fix-loading__title');\r\n        const progressBar = modal.querySelector('.page-list-fix-loading__progress-bar') as HTMLElement;\r\n        const progressText = modal.querySelector('.page-list-fix-loading__progress-text');\r\n        if (title) title.textContent = message;\r\n        if (progressBar) progressBar.style.width = `${progress}%`;\r\n        if (progressText) progressText.textContent = `${progress}% complete`;\r\n      }\r\n    };\r\n    \r\n    try {\r\n      updateProgress(10, 'Fetching current page content...');\r\n      \r\n      // Fetch page content\r\n      const response = await fetch(page.relPermalink);\r\n      if (!response.ok) {\r\n        closeLoadingModal();\r\n        showToast('Could not fetch page content for keyword analysis', 'error', 5000, 'page-list');\r\n        return;\r\n      }\r\n      \r\n      updateProgress(20, 'Parsing page content...');\r\n      const html = await response.text();\r\n      const parser = new DOMParser();\r\n      const doc = parser.parseFromString(html, 'text/html');\r\n      \r\n      // Extract text content\r\n      const title = doc.querySelector('title')?.textContent || page.title;\r\n      const metaDescription = doc.querySelector('meta[name=\"description\"]')?.getAttribute('content') || page.metaDescription || '';\r\n      const bodyText = doc.body?.textContent || '';\r\n      \r\n      // Remove script and style content\r\n      const scripts = doc.querySelectorAll('script, style, nav, header, footer');\r\n      scripts.forEach(el =\u003e el.remove());\r\n      const cleanText = doc.body?.textContent || bodyText;\r\n      \r\n      updateProgress(30, 'Analyzing current page keywords...');\r\n      // Analyze keywords for current page\r\n      const analysis = analyzeKeywords(cleanText, title, metaDescription);\r\n      \r\n      // Create current page keyword data\r\n      const currentPageKeywords: PageKeywordData = {\r\n        pageUrl: page.relPermalink,\r\n        pageTitle: page.title,\r\n        keywords: analysis.primaryKeywords,\r\n        topKeywords: analysis.primaryKeywords.map(k =\u003e k.keyword)\r\n      };\r\n      \r\n      updateProgress(40, `Fetching content from ${allPages.length - 1} other pages...`);\r\n      \r\n      // Analyze keywords for all other pages - fetch rendered HTML for each\r\n      const otherPages = allPages.filter(p =\u003e p.relPermalink !== page.relPermalink);\r\n      const totalPages = otherPages.length;\r\n      let processedPages = 0;\r\n      \r\n      const allPageKeywordsPromises = otherPages\r\n        .map(async (p): Promise\u003cPageKeywordData\u003e =\u003e {\r\n          try {\r\n            // Fetch rendered page HTML\r\n            const pageResponse = await fetch(p.relPermalink);\r\n            if (!pageResponse.ok) {\r\n              // Fallback to metadata if fetch fails\r\n              const pageText = `${p.title} ${p.metaDescription ?? ''} ${p.summary ?? ''}`;\r\n              const pageAnalysis = analyzeKeywords(pageText, p.title, p.metaDescription ?? '');\r\n              return {\r\n                pageUrl: p.relPermalink,\r\n                pageTitle: p.title,\r\n                keywords: pageAnalysis.primaryKeywords,\r\n                topKeywords: pageAnalysis.primaryKeywords.map(k =\u003e k.keyword)\r\n              };\r\n            }\r\n            \r\n            const pageHtml = await pageResponse.text();\r\n            const pageParser = new DOMParser();\r\n            const pageDoc = pageParser.parseFromString(pageHtml, 'text/html');\r\n            \r\n            // Extract text content from rendered page\r\n            const pageTitle = pageDoc.querySelector('title')?.textContent || p.title;\r\n            const pageMetaDesc = pageDoc.querySelector('meta[name=\"description\"]')?.getAttribute('content') || p.metaDescription || '';\r\n            const pageBodyText = pageDoc.body?.textContent || '';\r\n            \r\n            // Remove script and style content\r\n            const pageScripts = pageDoc.querySelectorAll('script, style, nav, header, footer');\r\n            pageScripts.forEach(el =\u003e el.remove());\r\n            const pageCleanText = pageDoc.body?.textContent || pageBodyText;\r\n            \r\n            // Analyze keywords from rendered content\r\n            const pageAnalysis = analyzeKeywords(pageCleanText, pageTitle, pageMetaDesc);\r\n            \r\n            // Update progress\r\n            processedPages++;\r\n            const progress = 40 + Math.round((processedPages / totalPages) * 50);\r\n            updateProgress(progress, `Analyzing page ${processedPages} of ${totalPages}...`);\r\n            \r\n            return {\r\n              pageUrl: p.relPermalink,\r\n              pageTitle: p.title,\r\n              keywords: pageAnalysis.primaryKeywords,\r\n              topKeywords: pageAnalysis.primaryKeywords.map(k =\u003e k.keyword)\r\n            };\r\n          } catch (error) {\r\n            devWarn(`Failed to fetch rendered content for ${p.relPermalink}, using metadata:`, error);\r\n            // Fallback to metadata if fetch fails\r\n            const pageText = `${p.title} ${p.metaDescription ?? ''} ${p.summary ?? ''}`;\r\n            const pageAnalysis = analyzeKeywords(pageText, p.title, p.metaDescription ?? '');\r\n            return {\r\n              pageUrl: p.relPermalink,\r\n              pageTitle: p.title,\r\n              keywords: pageAnalysis.primaryKeywords,\r\n              topKeywords: pageAnalysis.primaryKeywords.map(k =\u003e k.keyword)\r\n            };\r\n          }\r\n        });\r\n      \r\n      // Wait for all pages to be analyzed\r\n      const allPageKeywords = await Promise.all(allPageKeywordsPromises);\r\n      \r\n      // Generate comprehensive gap analysis\r\n      const gapAnalysis = analyzeKeywordGaps(currentPageKeywords, allPageKeywords);\r\n      \r\n      // Render and show keyword research modal\r\n      updateProgress(95, 'Preparing results...');\r\n      const modalHtml = renderKeywordResearchModal(analysis, page.title, page.relPermalink, gapAnalysis);\r\n      document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n      \r\n      // Close loading modal immediately\r\n      closeLoadingModal();\r\n      \r\n      const keywordModal = document.getElementById('dev-keyword-research-modal');\r\n      if (!keywordModal) {\r\n        return;\r\n      }\r\n      \r\n      // Attach close handlers\r\n      const closeBtn = keywordModal.querySelector('#dev-keyword-research-close');\r\n      const overlay = keywordModal.querySelector('.dev-score-bubble-modal-overlay');\r\n      const modalClose = keywordModal.querySelector('.dev-score-bubble-modal-close');\r\n      \r\n      const closeModal = () =\u003e {\r\n        keywordModal.remove();\r\n      };\r\n      \r\n      if (closeBtn) closeBtn.addEventListener('click', closeModal);\r\n      if (overlay) overlay.addEventListener('click', closeModal);\r\n      if (modalClose) modalClose.addEventListener('click', closeModal);\r\n      \r\n      // Close on Escape key\r\n      const handleEscape = (e: KeyboardEvent) =\u003e {\r\n        if (e.key === 'Escape' \u0026\u0026 keywordModal) {\r\n          closeModal();\r\n          document.removeEventListener('keydown', handleEscape);\r\n        }\r\n      };\r\n      document.addEventListener('keydown', handleEscape);\r\n      \r\n      // Attach seed keyword search functionality\r\n      attachSeedKeywordSearch(keywordModal);\r\n      \r\n      // Attach competitor keyword removal functionality\r\n      attachCompetitorKeywordRemoval(keywordModal);\r\n      \r\n      // Attach export handlers with all page keywords for site-wide export\r\n      const allPageKeywordsForExport = [currentPageKeywords, ...allPageKeywords];\r\n      attachExportHandlers(keywordModal, analysis, allPageKeywordsForExport);\r\n      \r\n    } catch (error) {\r\n      devError('Error analyzing keywords:', error);\r\n      closeLoadingModal();\r\n      showToast('Error analyzing keywords. Please try again.', 'error', 5000, 'page-list');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Select file using traditional HTML file input (fallback for browsers without File Picker API)\r\n */\r\nfunction selectFileWithInput(): Promise\u003cFile | null\u003e {\r\n  return new Promise((resolve) =\u003e {\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    input.accept = '.md,text/markdown';\r\n    input.style.display = 'none';\r\n    \r\n    const cleanup = () =\u003e {\r\n      if (input.parentNode) {\r\n        input.parentNode.removeChild(input);\r\n      }\r\n    };\r\n    \r\n    const changeHandler = (e: Event) =\u003e {\r\n      const target = e.target as HTMLInputElement;\r\n      const file = target.files?.[0] || null;\r\n      cleanup();\r\n      resolve(file);\r\n    };\r\n    \r\n    const cancelHandler = () =\u003e {\r\n      cleanup();\r\n      resolve(null);\r\n    };\r\n    \r\n    input.addEventListener('change', changeHandler, { once: true });\r\n    input.addEventListener('cancel', cancelHandler, { once: true });\r\n    \r\n    // Cleanup on unmount or if input is removed\r\n    const observer = new MutationObserver(() =\u003e {\r\n      if (!document.body.contains(input)) {\r\n        cleanup();\r\n        observer.disconnect();\r\n        resolve(null);\r\n      }\r\n    });\r\n    observer.observe(document.body, { childList: true, subtree: true });\r\n    \r\n    document.body.appendChild(input);\r\n    input.click();\r\n    \r\n    // Timeout fallback to prevent hanging promises\r\n    setTimeout(() =\u003e {\r\n      if (document.body.contains(input)) {\r\n        cleanup();\r\n        observer.disconnect();\r\n        resolve(null);\r\n      }\r\n    }, 60000); // 60 second timeout\r\n  });\r\n}\r\n\r\n/**\r\n * Attach handlers for broken link actions (fix, edit, remove) in page detail modal\r\n */\r\nfunction attachBrokenLinkHandlers(modal: HTMLElement | null, page: PageData, allPages: PageData[]): void {\r\n  if (!modal || !isLocalhost()) return;\r\n  \r\n  const actionButtons = modal.querySelectorAll('[data-action=\"fix\"], [data-action=\"edit\"], [data-action=\"remove\"]');\r\n  \r\n  actionButtons.forEach(btn =\u003e {\r\n    btn.addEventListener('click', async (e) =\u003e {\r\n      e.stopPropagation();\r\n      const button = btn as HTMLElement;\r\n      const action = button.getAttribute('data-action');\r\n      const brokenUrl = button.getAttribute('data-broken-url');\r\n      const sourcePage = button.getAttribute('data-source-page');\r\n      \r\n      if (!action || !brokenUrl || !sourcePage) return;\r\n      \r\n      // Request directory access if needed\r\n      if ('showDirectoryPicker' in window \u0026\u0026 !getSiteRootDirectoryHandle()) {\r\n        const accessGranted = await createConfirmationDialog(\r\n          'Select Site Root Folder',\r\n          'To update source files, you need to select your Hugo site root folder.\\n\\n' +\r\n          'Click \"Select Folder\" below, then navigate to and select the folder that contains your \"content\" folder.\\n\\n' +\r\n          'Example: If your site is at /Users/you/my-site/, select that folder.\\n\\n' +\r\n          'This permission is only requested once per browser session.',\r\n          'Select Folder',\r\n          'Skip (Use Manual File Selection)',\r\n          'page-list'\r\n        );\r\n        \r\n        if (accessGranted) {\r\n          const dirHandle = await requestSiteRootAccess(\r\n            (msg) =\u003e showToast(msg, 'success', 5000, 'page-list'),\r\n            (msg) =\u003e showToast(msg, 'error', 5000, 'page-list')\r\n          );\r\n          if (!dirHandle) {\r\n            showToast('You can still manually select the file when prompted.', 'info', 5000, 'page-list');\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Disable button during processing\r\n      button.setAttribute('disabled', 'true');\r\n      button.classList.add('dev-score-bubble__broken-link-menu-action--loading');\r\n      const originalText = button.innerHTML;\r\n      \r\n      try {\r\n        // Check if File System Access API is available for automatic file finding\r\n        const hasDirectoryAccess = getSiteRootDirectoryHandle() !== null;\r\n        const possiblePaths = relPermalinkToContentFile(sourcePage);\r\n        let filePath: string | null = null;\r\n        let manualFileHandle: FileSystemFileHandle | null = null;\r\n        \r\n        // Try automatic file finding only if File System Access API is available\r\n        if (hasDirectoryAccess) {\r\n          filePath = await findActualFilePath(possiblePaths, true);\r\n        }\r\n        \r\n        // If automatic finding failed or isn't available, offer manual file selection\r\n        if (!filePath) {\r\n          const message = hasDirectoryAccess\r\n            ? `Could not automatically find the source file.\\n\\n` +\r\n              `Expected paths:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n              `The file may not exist at these locations, or the directory structure may be different.\\n\\n` +\r\n              `Please manually select the markdown file to continue.`\r\n            : `To update source files, please select the markdown file manually.\\n\\n` +\r\n              `Expected file location:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n              `This works on both Windows and macOS.`;\r\n          \r\n          const tryManual = await createConfirmationDialog(\r\n            'Select Source File',\r\n            message,\r\n            'Select File',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (tryManual) {\r\n            // Try modern File Picker API first (works in Chrome, Edge, Brave, Safari)\r\n            if ('showOpenFilePicker' in window) {\r\n              try {\r\n                const fileHandles = await (window as any).showOpenFilePicker({\r\n                  types: [{\r\n                    description: 'Markdown files',\r\n                    accept: { 'text/markdown': ['.md'] }\r\n                  }],\r\n                  excludeAcceptAllOption: false,\r\n                  multiple: false\r\n                });\r\n                \r\n                if (fileHandles \u0026\u0026 fileHandles.length \u003e 0) {\r\n                  const handle = fileHandles[0];\r\n                  if (handle) {\r\n                    manualFileHandle = handle;\r\n                    const file = await handle.getFile();\r\n                    // Use file name as identifier (we'll work with the handle directly)\r\n                    filePath = file.name;\r\n                  }\r\n                }\r\n              } catch (pickerError) {\r\n                if ((pickerError as Error).name !== 'AbortError') {\r\n                  devError('File picker error:', pickerError);\r\n                  // Fall through to traditional file input\r\n                } else {\r\n                  // User cancelled\r\n                  button.removeAttribute('disabled');\r\n                  button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n                  button.innerHTML = originalText;\r\n                  return;\r\n                }\r\n              }\r\n            }\r\n            \r\n            // Fallback to traditional file input (works in all browsers including Brave)\r\n            if (!manualFileHandle \u0026\u0026 !filePath) {\r\n              try {\r\n                const file = await selectFileWithInput();\r\n                if (file) {\r\n                  // Create a file handle-like object that works with traditional file input\r\n                  // We'll download the modified file since we can't write directly\r\n                  manualFileHandle = {\r\n                    getFile: async () =\u003e file,\r\n                    kind: 'file' as const,\r\n                    __isFallback: true, // Mark as fallback for detection\r\n                    createWritable: async () =\u003e {\r\n                      let writtenContent = '';\r\n                      return {\r\n                        write: async (content: string) =\u003e {\r\n                          writtenContent = content;\r\n                        },\r\n                        close: async () =\u003e {\r\n                          // Download the modified file\r\n                          const blob = new Blob([writtenContent], { type: 'text/markdown' });\r\n                          const url = URL.createObjectURL(blob);\r\n                          const a = document.createElement('a');\r\n                          a.href = url;\r\n                          a.download = file.name;\r\n                          document.body.appendChild(a);\r\n                          a.click();\r\n                          document.body.removeChild(a);\r\n                          URL.revokeObjectURL(url);\r\n                        }\r\n                      };\r\n                    }\r\n                  } as any;\r\n                  filePath = file.name;\r\n                }\r\n              } catch (inputError) {\r\n                devError('File input error:', inputError);\r\n                showToast('Error selecting file. Please try again.', 'error', 5000, 'page-list');\r\n              }\r\n            }\r\n          }\r\n          \r\n          if (!filePath \u0026\u0026 !manualFileHandle) {\r\n            showToast('File selection cancelled or failed. Please try again.', 'info', 5000, 'page-list');\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n            return;\r\n          }\r\n        }\r\n        \r\n        // Helper function to handle file operations (works with both filePath and fileHandle)\r\n        const handleFileOperation = async (\r\n          operation: (content: string) =\u003e { content: string; modified: boolean },\r\n          successMessage: string\r\n        ): Promise\u003cboolean\u003e =\u003e {\r\n          let content: string;\r\n          let fileName: string;\r\n          \r\n          if (manualFileHandle) {\r\n            // Work with manually selected file handle\r\n            const file = await manualFileHandle.getFile();\r\n            content = await file.text();\r\n            fileName = file.name;\r\n          } else if (filePath) {\r\n            // Work with file path\r\n            const fileData = await readFileContent(filePath, true);\r\n            if (!fileData) {\r\n              showToast('Could not read file', 'error', 5000, 'page-list');\r\n              return false;\r\n            }\r\n            content = fileData.content;\r\n            fileName = filePath;\r\n          } else {\r\n            showToast('No file available', 'error', 5000, 'page-list');\r\n            return false;\r\n          }\r\n          \r\n          const result = operation(content);\r\n          if (!result.modified) {\r\n            showToast('Link not found in file content', 'info', 5000, 'page-list');\r\n            return false;\r\n          }\r\n          \r\n          // Create backup (only if we have directory access)\r\n          if (manualFileHandle) {\r\n            // For manual file handle, we can't easily create backup in same directory\r\n            // The user should have their own backup system (git, etc.)\r\n            devLog('Note: Backup not created for manually selected file. Consider using version control.');\r\n          } else if (filePath \u0026\u0026 hasDirectoryAccess) {\r\n            // Create backup using file path (only if we have directory access)\r\n            const backupPath = createBackupFilename(filePath);\r\n            const backupCreated = await writeFileContent(backupPath, content);\r\n            if (backupCreated) {\r\n              devLog(`✅ Backup created: ${backupPath}`);\r\n            } else {\r\n              devWarn('Could not create backup. Continuing anyway...');\r\n            }\r\n          } else if (filePath) {\r\n            // No directory access - skip backup\r\n            devLog('Note: Backup not created (File System Access API not available). Consider using version control.');\r\n          }\r\n          \r\n          // Write modified content\r\n          if (manualFileHandle) {\r\n            // Write using file handle (modern API) or download (fallback for traditional file input)\r\n            try {\r\n              const writable = await manualFileHandle.createWritable();\r\n              await writable.write(result.content);\r\n              await writable.close();\r\n              \r\n              // Check if we used the fallback (traditional file input)\r\n              // Real FileSystemFileHandle writes directly, fallback downloads the file\r\n              const isFallback = (manualFileHandle as any).__isFallback === true;\r\n              \r\n              if (isFallback) {\r\n                showToast(\r\n                  `${successMessage} Modified file downloaded. Please replace the original file with the downloaded file.`,\r\n                  'success',\r\n                  10000,\r\n                  'page-list'\r\n                );\r\n              } else {\r\n                showToast(successMessage, 'success', 5000, 'page-list');\r\n              }\r\n              return true;\r\n            } catch (writeError) {\r\n              devError('Error writing to file:', writeError);\r\n              showToast(`Error writing file: ${writeError instanceof Error ? writeError.message : 'Unknown error'}`, 'error', 5000, 'page-list');\r\n              return false;\r\n            }\r\n          } else if (filePath) {\r\n            // Write using file path\r\n            const writeSuccess = await writeFileContent(filePath, result.content);\r\n            if (writeSuccess) {\r\n              showToast(successMessage, 'success', 5000, 'page-list');\r\n              return true;\r\n            } else {\r\n              showToast('Error writing file', 'error', 5000, 'page-list');\r\n              return false;\r\n            }\r\n          }\r\n          \r\n          return false;\r\n        };\r\n        \r\n        if (action === 'fix') {\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Fixing...';\r\n          \r\n          // Get all page paths for matching\r\n          const allPagePaths = allPages.map(p =\u003e p.relPermalink);\r\n          const match = findUrlMatch(brokenUrl, allPagePaths, allPages);\r\n          \r\n          if (!match) {\r\n            showToast(`No match found for: ${brokenUrl}`, 'error', 5000, 'page-list');\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n            return;\r\n          }\r\n          \r\n          // Fix the link\r\n          const fixedUrl = match.match;\r\n          const success = await handleFileOperation((content) =\u003e {\r\n            const escapedUrl = escapeRegex(brokenUrl);\r\n            let modifiedContent = content;\r\n            let modified = false;\r\n            \r\n            // Replace markdown links\r\n            const markdownPattern = new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrl}([^)]*\\\\))`, 'g');\r\n            modifiedContent = modifiedContent.replace(markdownPattern, (match, prefix, suffix) =\u003e {\r\n              modified = true;\r\n              return `${prefix}${fixedUrl}${suffix}`;\r\n            });\r\n            \r\n            // Replace HTML links\r\n            const htmlPattern = new RegExp(`(href=[\"'])${escapedUrl}([\"'])`, 'gi');\r\n            modifiedContent = modifiedContent.replace(htmlPattern, (match, prefix, suffix) =\u003e {\r\n              modified = true;\r\n              return `${prefix}${fixedUrl}${suffix}`;\r\n            });\r\n            \r\n            return { content: modifiedContent, modified };\r\n          }, `Link fixed: ${brokenUrl} → ${fixedUrl}`);\r\n          \r\n          if (success) {\r\n            // Update UI - mark as fixed\r\n            const item = button.closest('.page-list-modal__broken-link-item');\r\n            if (item) {\r\n              item.classList.add('page-list-modal__broken-link-item--fixed');\r\n              const urlCode = item.querySelector('.page-list-modal__broken-link-url');\r\n              if (urlCode) {\r\n                urlCode.textContent = fixedUrl;\r\n                urlCode.setAttribute('title', `Fixed: ${fixedUrl}`);\r\n              }\r\n              button.remove();\r\n            }\r\n          } else {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        } else if (action === 'edit') {\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Editing...';\r\n          \r\n          // Prompt for new URL\r\n          const newUrl = await createUrlInputDialog('Enter new URL:', brokenUrl, 'page-list');\r\n          \r\n          if (!newUrl || newUrl === brokenUrl) {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n            return;\r\n          }\r\n          \r\n          // Update the link\r\n          const success = await handleFileOperation((content) =\u003e {\r\n            const escapedUrl = escapeRegex(brokenUrl);\r\n            let modifiedContent = content;\r\n            let modified = false;\r\n            \r\n            // Replace markdown links\r\n            const markdownPattern = new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedUrl}([^)]*\\\\))`, 'g');\r\n            modifiedContent = modifiedContent.replace(markdownPattern, (match, prefix, suffix) =\u003e {\r\n              modified = true;\r\n              return `${prefix}${newUrl}${suffix}`;\r\n            });\r\n            \r\n            // Replace HTML links\r\n            const htmlPattern = new RegExp(`(href=[\"'])${escapedUrl}([\"'])`, 'gi');\r\n            modifiedContent = modifiedContent.replace(htmlPattern, (match, prefix, suffix) =\u003e {\r\n              modified = true;\r\n              return `${prefix}${newUrl}${suffix}`;\r\n            });\r\n            \r\n            return { content: modifiedContent, modified };\r\n          }, `Link updated: ${brokenUrl} → ${newUrl}`);\r\n          \r\n          if (success) {\r\n            // Update UI\r\n            const item = button.closest('.page-list-modal__broken-link-item');\r\n            if (item) {\r\n              item.classList.remove('page-list-modal__broken-link-item--broken');\r\n              item.classList.add('page-list-modal__broken-link-item--fixed');\r\n              const urlCode = item.querySelector('.page-list-modal__broken-link-url');\r\n              if (urlCode) {\r\n                urlCode.textContent = newUrl;\r\n                urlCode.setAttribute('title', `Updated: ${newUrl}`);\r\n              }\r\n              // Remove all action buttons\r\n              const actions = item.querySelector('.page-list-modal__broken-link-actions');\r\n              if (actions) actions.remove();\r\n            }\r\n          } else {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        } else if (action === 'remove') {\r\n          button.innerHTML = '\u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e Removing...';\r\n          \r\n          // Confirm removal\r\n          const fileName = manualFileHandle ? (await manualFileHandle.getFile()).name : filePath || 'file';\r\n          const confirmed = await createConfirmationDialog(\r\n            'Remove Broken Link',\r\n            `This will remove the broken link \"${brokenUrl}\" from \"${fileName}\" and keep only the text.\\n\\n` +\r\n            'A backup will be created before making changes. Continue?',\r\n            'Remove Link',\r\n            'Cancel',\r\n            'page-list'\r\n          );\r\n          \r\n          if (!confirmed) {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n            return;\r\n          }\r\n          \r\n          // Remove the link\r\n          const success = await handleFileOperation((content) =\u003e {\r\n            const removalResult = removeLinkFromContent(content, brokenUrl);\r\n            return {\r\n              content: removalResult.content,\r\n              modified: removalResult.changes.length \u003e 0\r\n            };\r\n          }, `Link removed successfully`);\r\n          \r\n          if (success) {\r\n            // Update UI - mark as removed\r\n            const item = button.closest('.page-list-modal__broken-link-item');\r\n            if (item) {\r\n              item.classList.add('page-list-modal__broken-link-item--removed');\r\n              const urlCode = item.querySelector('.page-list-modal__broken-link-url');\r\n              if (urlCode \u0026\u0026 urlCode instanceof HTMLElement) {\r\n                urlCode.style.textDecoration = 'line-through';\r\n                urlCode.style.opacity = '0.6';\r\n              }\r\n              // Remove all action buttons\r\n              const actions = item.querySelector('.page-list-modal__broken-link-actions');\r\n              if (actions) actions.remove();\r\n            }\r\n          } else {\r\n            button.removeAttribute('disabled');\r\n            button.classList.remove('dev-score-bubble__broken-link-menu-action--loading');\r\n            button.innerHTML = originalText;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        devError('Error handling broken link action:', error);\r\n        showToast(`Error: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error', 5000, 'page-list');\r\n        button.removeAttribute('disabled');\r\n        button.classList.remove('page-list-fix-button--loading');\r\n        button.innerHTML = originalText;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Attach handlers for draft pages view (export CSV and copy URL buttons)\r\n */\r\nfunction attachDraftHandlers(draftPages: PageData[]): void {\r\n  // Export CSV button\r\n  const exportButton = document.getElementById('page-list-drafts-export-csv');\r\n  if (exportButton) {\r\n    const handler = () =\u003e {\r\n      exportDraftPagesToCSV(draftPages);\r\n    };\r\n    exportButton.addEventListener('click', handler);\r\n  }\r\n\r\n  // Copy URL buttons\r\n  const copyButtons = document.querySelectorAll('[data-copy-url]');\r\n  copyButtons.forEach(button =\u003e {\r\n    const handler = async (e: Event) =\u003e {\r\n      e.stopPropagation();\r\n      const url = button.getAttribute('data-copy-url');\r\n      if (!url) return;\r\n\r\n      try {\r\n        await navigator.clipboard.writeText(url);\r\n        // Show visual feedback\r\n        const icon = button.querySelector('.material-symbols-outlined');\r\n        if (icon) {\r\n          const originalText = icon.textContent;\r\n          icon.textContent = 'check';\r\n          setTimeout(() =\u003e {\r\n            if (icon.textContent === 'check') {\r\n              icon.textContent = originalText || 'content_copy';\r\n            }\r\n          }, 2000);\r\n        }\r\n        showToast('URL copied to clipboard', 'success', 2000, 'page-list');\r\n      } catch (err) {\r\n        devError('Failed to copy URL:', err);\r\n        showToast('Failed to copy URL', 'error', 3000, 'page-list');\r\n      }\r\n    };\r\n    button.addEventListener('click', handler);\r\n  });\r\n}\r\n\r\n/**\r\n * Export draft pages to CSV\r\n */\r\nfunction exportDraftPagesToCSV(pages: PageData[]): void {\r\n  if (pages.length === 0) {\r\n    showToast('No draft pages to export', 'info', 3000, 'page-list');\r\n    return;\r\n  }\r\n\r\n  // CSV header\r\n  const headers = ['Title', 'URL', 'Section'];\r\n  const rows = [headers.join(',')];\r\n\r\n  // CSV rows\r\n  pages.forEach(page =\u003e {\r\n    const title = page.title || '';\r\n    const url = page.relPermalink || '';\r\n    const section = page.section || 'Home';\r\n    \r\n    const row = [\r\n      `\"${title.replace(/\"/g, '\"\"')}\"`, // Escape quotes\r\n      `\"${url.replace(/\"/g, '\"\"')}\"`,\r\n      `\"${section.replace(/\"/g, '\"\"')}\"`\r\n    ];\r\n    rows.push(row.join(','));\r\n  });\r\n\r\n  // Create blob and download\r\n  const csvContent = rows.join('\\n');\r\n  // Add BOM for Excel UTF-8 support\r\n  const BOM = '\\uFEFF';\r\n  const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = 'draft-pages.csv';\r\n  link.style.display = 'none';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n\r\n  showToast(`Exported ${pages.length} draft ${pages.length === 1 ? 'page' : 'pages'} to CSV`, 'success', 3000, 'page-list');\r\n}\r\n\r\n/**\r\n * Attach handlers for fix buttons in table rows\r\n * This function should be called within initPageList context where cleanupFunctions is available\r\n */\r\nfunction createTableFixButtonHandlers(allPages: PageData[], cleanupFunctions: Array\u003c() =\u003e void\u003e): () =\u003e void {\r\n  if (!isLocalhost()) {\r\n    return () =\u003e {}; // Return empty cleanup function\r\n  }\r\n  \r\n  const fixButtons = document.querySelectorAll('[data-action=\"fix-links\"], [data-action=\"fix-images\"]');\r\n  const listeners: Array\u003c{ element: Element; type: string; handler: (event: Event) =\u003e void }\u003e = [];\r\n  \r\n  fixButtons.forEach(button =\u003e {\r\n    const handler = (e: Event) =\u003e {\r\n      e.stopPropagation(); // Prevent row click\r\n      \r\n      const pageUrl = button.getAttribute('data-page-url');\r\n      if (!pageUrl) {\r\n        devWarn('Fix button missing data-page-url attribute');\r\n        return;\r\n      }\r\n      \r\n      // Open the page modal to show full details and fix options\r\n      // Find the row and trigger its click handler to open modal\r\n      const row = button.closest('.page-list-row') as HTMLElement | null;\r\n      if (row) {\r\n        const rowPageUrl = row.getAttribute('data-page-url');\r\n        if (rowPageUrl \u0026\u0026 rowPageUrl === pageUrl) {\r\n          // Use click event to trigger the row's click handler\r\n          const clickEvent = new MouseEvent('click', { bubbles: true, cancelable: true });\r\n          row.dispatchEvent(clickEvent);\r\n        } else {\r\n          devWarn('Page URL mismatch between button and row');\r\n        }\r\n      } else {\r\n        devWarn('Could not find page list row for fix button');\r\n      }\r\n    };\r\n    \r\n    button.addEventListener('click', handler);\r\n    listeners.push({ element: button, type: 'click', handler });\r\n  });\r\n  \r\n  // Return cleanup function\r\n  return () =\u003e {\r\n    listeners.forEach(({ element, type, handler }) =\u003e {\r\n      element.removeEventListener(type, handler);\r\n    });\r\n  };\r\n}\r\n\r\nexport function initPageList(): void {\r\n  // Only run in dev/localhost\r\n  if (!isLocalhost()) {\r\n    return;\r\n  }\r\n\r\n  const container = document.querySelector('.page-list-container');\r\n  if (!container) {\r\n    devWarn('Page list container not found');\r\n    return;\r\n  }\r\n\r\n  // Get current section from data attribute\r\n  const currentSection = (container as HTMLElement).getAttribute('data-page-list-section') || 'overview';\r\n\r\n  try {\r\n    showLoading();\r\n\r\n    fetch('/page-list/index.json')\r\n      .then(response =\u003e {\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const contentType = response.headers.get('content-type');\r\n        if (!contentType?.includes('application/json')) {\r\n          throw new Error(`Invalid content type: expected JSON, got ${contentType}`);\r\n        }\r\n        return response.json();\r\n      })\r\n      .then((data: unknown) =\u003e {\r\n        // Validate data structure\r\n        if (!data || typeof data !== 'object') {\r\n          throw new Error('Invalid data format: expected object');\r\n        }\r\n        const pageListData = data as PageListData;\r\n        if (!Array.isArray(pageListData.pages)) {\r\n          throw new Error('Invalid data format: expected pages array');\r\n        }\r\n        return pageListData;\r\n      })\r\n      .then((data: PageListData) =\u003e {\r\n        hideLoading();\r\n\r\n        // Determine initial filter based on section\r\n      let initialFilter = 'all';\r\n      switch (currentSection) {\r\n        case 'seo-analysis':\r\n          initialFilter = 'with-issues'; // Show pages with SEO issues by default\r\n          break;\r\n        case 'schema':\r\n          initialFilter = 'all'; // Show all pages for schema validation\r\n          break;\r\n        case 'content-quality':\r\n          initialFilter = 'low-word-count'; // Show content quality issues\r\n          break;\r\n        case 'technical-issues':\r\n          initialFilter = 'broken-links'; // Show technical issues\r\n          break;\r\n        case 'keyword-research':\r\n          initialFilter = 'all'; // Show all for keyword research\r\n          break;\r\n        case 'link-map':\r\n          initialFilter = 'all'; // Show all for link map\r\n          break;\r\n        case 'drafts':\r\n          initialFilter = 'drafts'; // Show drafts\r\n          break;\r\n        case 'llms':\r\n          initialFilter = 'all'; // Show all for llms validation\r\n          break;\r\n        case 'overview':\r\n        default:\r\n          initialFilter = 'all';\r\n          break;\r\n      }\r\n\r\n      let currentFilter = initialFilter;\r\n      let currentLayout: 'normal' | 'compact' = 'compact';\r\n      let currentGrouping: 'grouped' | 'ungrouped' = 'ungrouped' as 'grouped' | 'ungrouped';\r\n      let currentSort: string = 'title';\r\n      let currentSortDirection: 'asc' | 'desc' = 'asc';\r\n      let allPages = data.pages || [];\r\n      \r\n      // Store all pages for export\r\n      updateAllPagesForExport(allPages);\r\n\r\n      // Store event listener cleanup functions to prevent memory leaks\r\n      const cleanupFunctions: Array\u003c() =\u003e void\u003e = [];\r\n      \r\n      const cleanupEventListeners = () =\u003e {\r\n        cleanupFunctions.forEach(cleanup =\u003e cleanup());\r\n        cleanupFunctions.length = 0;\r\n      };\r\n\r\n      const setActiveFilterState = (filterId: string) =\u003e {\r\n        const filterableElements = container.querySelectorAll('[data-filter]');\r\n        filterableElements.forEach(el =\u003e {\r\n          const elementFilter = el.getAttribute('data-filter');\r\n          const isActive = elementFilter === filterId;\r\n          if (el.classList.contains('page-list-summary__stat')) {\r\n            el.classList.toggle('page-list-summary__stat--active', isActive);\r\n          }\r\n          if (el.classList.contains('page-list-overview-stat')) {\r\n            el.classList.toggle('page-list-overview-stat--active', isActive);\r\n          }\r\n          if (el instanceof HTMLElement) {\r\n            if (isActive) {\r\n              el.classList.add('is-active-filter');\r\n            } else {\r\n              el.classList.remove('is-active-filter');\r\n            }\r\n            el.setAttribute('aria-pressed', isActive ? 'true' : 'false');\r\n          }\r\n        });\r\n      };\r\n\r\n      const updateView = (filterType: string, layout: 'normal' | 'compact' = currentLayout, grouping: 'grouped' | 'ungrouped' = currentGrouping, sortType: string = currentSort, sortDirection: 'asc' | 'desc' = currentSortDirection) =\u003e {\r\n        // Clean up previous event listeners to prevent memory leaks\r\n        cleanupEventListeners();\r\n\r\n        // Handle drafts section specially - render draft pages list\r\n        if (currentSection === 'drafts') {\r\n          const draftPages = filterPages(allPages, 'drafts');\r\n          updateFilteredPagesForExport(draftPages);\r\n          const draftsHtml = renderDraftPages(draftPages);\r\n          \r\n          // Replace entire container content for drafts view\r\n          container.innerHTML = draftsHtml;\r\n          \r\n          // Attach draft-specific handlers\r\n          attachDraftHandlers(draftPages);\r\n          return;\r\n        }\r\n\r\n        // Handle schema section specially - render schema validation\r\n        if (currentSection === 'schema') {\r\n          const schemaHtml = renderSchemaSection(allPages);\r\n          \r\n          // Replace entire container content for schema view\r\n          container.innerHTML = schemaHtml;\r\n          \r\n          // Attach schema-specific handlers\r\n          attachSchemaValidationHandlers(allPages);\r\n          return;\r\n        }\r\n\r\n        const filteredPages = filterPages(allPages, filterType);\r\n        // Update filtered pages for export\r\n        updateFilteredPagesForExport(filteredPages);\r\n        // Always use all pages stats for the summary, but show filtered pages in the list\r\n        const allStats = calculateStats(allPages);\r\n        const statsHtml = renderStats(allStats, filterType, data.siteTechnicalSEO, data.siteAICrawlability, true, currentSection);\r\n        const pagesHtml = filteredPages.length \u003e 0 \r\n          ? (grouping === 'grouped' ? renderGroupedPages(filteredPages, layout === 'compact', sortType, sortDirection, filterType) : renderUngroupedPages(filteredPages, layout === 'compact', sortType, sortDirection, filterType))\r\n          : `\r\n          \u003cdiv class=\"page-list-empty\"\u003e\r\n            \u003cdiv class=\"page-list-empty__icon\"\u003e🔍\u003c/div\u003e\r\n            \u003ch3 class=\"page-list-empty__title\"\u003eNo pages match this filter\u003c/h3\u003e\r\n            \u003cp class=\"page-list-empty__text\"\u003eTry selecting a different filter option.\u003c/p\u003e\r\n          \u003c/div\u003e\r\n        `;\r\n\r\n        const summarySection = container.querySelector('.page-list-summary');\r\n        const pagesContainer = document.getElementById('page-list-pages');\r\n        \r\n        if (summarySection) {\r\n          // Update the grid section\r\n          const tempDiv = document.createElement('div');\r\n          tempDiv.innerHTML = statsHtml;\r\n          const newGrid = tempDiv.querySelector('.page-list-summary__grid');\r\n          const oldGrid = summarySection.querySelector('.page-list-summary__grid');\r\n          if (newGrid \u0026\u0026 oldGrid \u0026\u0026 oldGrid.parentNode) {\r\n            oldGrid.parentNode.replaceChild(newGrid, oldGrid);\r\n          }\r\n          \r\n          // Update the overview section to reflect active filter\r\n          const newOverview = tempDiv.querySelector('.page-list-summary__hero-overview');\r\n          const oldOverview = summarySection.querySelector('.page-list-summary__hero-overview');\r\n          if (newOverview \u0026\u0026 oldOverview \u0026\u0026 oldOverview.parentNode) {\r\n            oldOverview.parentNode.replaceChild(newOverview, oldOverview);\r\n          }\r\n        }\r\n        \r\n        if (pagesContainer) {\r\n          pagesContainer.innerHTML = pagesHtml;\r\n          if (layout === 'compact') {\r\n            pagesContainer.classList.add('page-list-pages--compact');\r\n          } else {\r\n            pagesContainer.classList.remove('page-list-pages--compact');\r\n          }\r\n        }\r\n\r\n        setActiveFilterState(filterType);\r\n\r\n        // Update filtered pages for export\r\n        updateFilteredPagesForExport(filteredPages);\r\n\r\n        // Re-attach event listeners (cleanup will be handled on next updateView call)\r\n        attachFilterListeners();\r\n        attachRowClickListeners();\r\n        attachGroupToggleListeners();\r\n        attachTooltipHandlers(container as HTMLElement);\r\n        const fixButtonCleanup = createTableFixButtonHandlers(allPages, cleanupFunctions);\r\n        cleanupFunctions.push(fixButtonCleanup);\r\n        // Re-attach export handlers if controls are shown\r\n        if (showControls) {\r\n          attachPageListExportHandlers();\r\n          attachExportToggle();\r\n        }\r\n        if (isLocalhost() \u0026\u0026 currentSection === 'keyword-research') {\r\n          attachCompetitorAnalysisHandlers(allPages);\r\n          // Extract and display site keywords\r\n          extractAndDisplaySiteKeywords(allPages);\r\n        }\r\n      };\r\n\r\n      const attachFilterListeners = () =\u003e {\r\n        const statButtons = container.querySelectorAll('.page-list-summary__stat--clickable, .page-list-overview-stat--clickable');\r\n        const listeners: Array\u003c{ element: Element; type: string; handler: (event: Event) =\u003e void }\u003e = [];\r\n\r\n        const activateFilter = (button: Element) =\u003e {\r\n          const filterId = button.getAttribute('data-filter');\r\n          if (!filterId || filterId === currentFilter || button.hasAttribute('disabled')) return;\r\n          currentFilter = filterId;\r\n          updateView(filterId, currentLayout, currentGrouping, currentSort, currentSortDirection);\r\n          const pagesContainer = document.getElementById('page-list-pages');\r\n          if (pagesContainer) {\r\n            pagesContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n          }\r\n        };\r\n        \r\n        statButtons.forEach(button =\u003e {\r\n          const clickHandler = () =\u003e activateFilter(button);\r\n          const keyHandler = (event: Event) =\u003e {\r\n            const keyboardEvent = event as KeyboardEvent;\r\n            if (keyboardEvent.key === 'Enter' || keyboardEvent.key === ' ') {\r\n              keyboardEvent.preventDefault();\r\n              activateFilter(button);\r\n            }\r\n          };\r\n          button.addEventListener('click', clickHandler);\r\n          button.addEventListener('keydown', keyHandler);\r\n          listeners.push({ element: button, type: 'click', handler: clickHandler });\r\n          listeners.push({ element: button, type: 'keydown', handler: keyHandler });\r\n        });\r\n\r\n        // Tab switching\r\n        const tabButtons = container.querySelectorAll('.page-list-filter-tab');\r\n        tabButtons.forEach(tab =\u003e {\r\n          const handler = () =\u003e {\r\n            const tabId = tab.getAttribute('data-tab');\r\n            if (!tabId) return;\r\n\r\n            // Remove active class from all tabs and content\r\n            tabButtons.forEach(t =\u003e t.classList.remove('page-list-filter-tab--active'));\r\n            const allTabContents = container.querySelectorAll('.page-list-filter-tab-content');\r\n            allTabContents.forEach(content =\u003e content.classList.remove('page-list-filter-tab-content--active'));\r\n\r\n            // Add active class to clicked tab and corresponding content\r\n            tab.classList.add('page-list-filter-tab--active');\r\n            const tabContent = container.querySelector(`[data-tab-content=\"${tabId}\"]`);\r\n            if (tabContent) {\r\n              tabContent.classList.add('page-list-filter-tab-content--active');\r\n            }\r\n          };\r\n          tab.addEventListener('click', handler);\r\n          listeners.push({ element: tab, type: 'click', handler });\r\n        });\r\n        \r\n        // Store cleanup function\r\n        cleanupFunctions.push(() =\u003e {\r\n          listeners.forEach(({ element, type, handler }) =\u003e {\r\n            element.removeEventListener(type, handler);\r\n          });\r\n        });\r\n      };\r\n\r\n      const openPageModal = (pageUrl: string) =\u003e {\r\n        const page = allPages.find(p =\u003e p.relPermalink === pageUrl);\r\n        if (!page) return;\r\n        \r\n        // Remove existing modal\r\n        const existingModal = document.getElementById('page-list-modal');\r\n        if (existingModal) {\r\n          existingModal.remove();\r\n        }\r\n        \r\n        // Add modal to body\r\n        const modalHtml = renderPageDetailModal(page);\r\n        document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n        \r\n        // Attach close listeners\r\n        const modal = document.getElementById('page-list-modal');\r\n        const closeBtn = document.getElementById('page-list-modal-close');\r\n        const overlay = modal?.querySelector('.page-list-modal__overlay');\r\n        \r\n        const closeModal = () =\u003e {\r\n          if (modal) modal.remove();\r\n          // Return focus to the row that opened the modal\r\n          const row = container.querySelector(`[data-page-url=\"${pageUrl}\"]`);\r\n          if (row instanceof HTMLElement) {\r\n            row.focus();\r\n          }\r\n        };\r\n        \r\n        if (closeBtn) closeBtn.addEventListener('click', closeModal);\r\n        if (overlay) overlay.addEventListener('click', closeModal);\r\n        \r\n        // Close on Escape key\r\n        const handleEscape = (e: KeyboardEvent) =\u003e {\r\n          if (e.key === 'Escape') {\r\n            closeModal();\r\n            document.removeEventListener('keydown', handleEscape);\r\n          }\r\n        };\r\n        document.addEventListener('keydown', handleEscape);\r\n        \r\n        // Focus management - focus first focusable element in modal\r\n        const firstFocusable = modal?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])') as HTMLElement;\r\n        if (firstFocusable) {\r\n          setTimeout(() =\u003e firstFocusable.focus(), 100);\r\n        }\r\n        \r\n        // Attach tooltip handlers\r\n        attachTooltipHandlers(modal);\r\n        \r\n        // Attach broken link action handlers\r\n        attachBrokenLinkHandlers(modal, page, allPages);\r\n        attachKeywordResearchHandler(modal, page, allPages);\r\n        attachTabHandlers(modal);\r\n      };\r\n\r\n      const attachRowClickListeners = () =\u003e {\r\n        const rows = container.querySelectorAll('.page-list-row');\r\n        const clickHandlers: Array\u003c{ element: Element; handler: (e: Event) =\u003e void }\u003e = [];\r\n        const keyHandlers: Array\u003c{ element: Element; handler: (e: Event) =\u003e void }\u003e = [];\r\n        \r\n        rows.forEach(row =\u003e {\r\n          // Make rows keyboard accessible\r\n          if (row instanceof HTMLElement) {\r\n            row.setAttribute('tabindex', '0');\r\n            row.setAttribute('role', 'button');\r\n            row.setAttribute('aria-label', `View details for ${row.querySelector('strong')?.textContent || 'page'}`);\r\n          }\r\n          \r\n          const clickHandler = (e: Event) =\u003e {\r\n            // Don't open modal if clicking on a link or action button\r\n            if ((e.target as HTMLElement).closest('a, button[data-action]')) return;\r\n            \r\n            const pageUrl = row.getAttribute('data-page-url');\r\n            if (!pageUrl) return;\r\n            \r\n            openPageModal(pageUrl);\r\n          };\r\n          \r\n          const keyHandler = (e: Event) =\u003e {\r\n            // Support Enter and Space keys for keyboard navigation\r\n            const keyEvent = e as KeyboardEvent;\r\n            if (keyEvent.key === 'Enter' || keyEvent.key === ' ') {\r\n              keyEvent.preventDefault();\r\n              const pageUrl = row.getAttribute('data-page-url');\r\n              if (!pageUrl) return;\r\n              openPageModal(pageUrl);\r\n            }\r\n          };\r\n          \r\n          row.addEventListener('click', clickHandler);\r\n          row.addEventListener('keydown', keyHandler);\r\n          clickHandlers.push({ element: row, handler: clickHandler });\r\n          keyHandlers.push({ element: row, handler: keyHandler });\r\n        });\r\n        \r\n        // Store cleanup function\r\n        cleanupFunctions.push(() =\u003e {\r\n          clickHandlers.forEach(({ element, handler }) =\u003e {\r\n            element.removeEventListener('click', handler);\r\n          });\r\n          keyHandlers.forEach(({ element, handler }) =\u003e {\r\n            element.removeEventListener('keydown', handler);\r\n          });\r\n        });\r\n      };\r\n\r\n      const attachLayoutToggle = () =\u003e {\r\n        const toggle = document.getElementById('page-list-layout-toggle');\r\n        if (toggle) {\r\n          const handler = () =\u003e {\r\n            currentLayout = currentLayout === 'normal' ? 'compact' : 'normal';\r\n            const icon = toggle.querySelector('.page-list-layout-toggle__icon');\r\n            const label = toggle.querySelector('.page-list-layout-toggle__label');\r\n            if (icon \u0026\u0026 label) {\r\n              icon.textContent = currentLayout === 'compact' ? 'view_compact' : 'view_list';\r\n              label.textContent = currentLayout === 'compact' ? 'Compact' : 'Normal';\r\n            }\r\n            toggle.setAttribute('data-layout', currentLayout);\r\n            updateView(currentFilter, currentLayout, currentGrouping, currentSort, currentSortDirection);\r\n          };\r\n          toggle.addEventListener('click', handler);\r\n          cleanupFunctions.push(() =\u003e toggle.removeEventListener('click', handler));\r\n        }\r\n      };\r\n\r\n      const attachGroupingToggle = () =\u003e {\r\n        const toggle = document.getElementById('page-list-grouping-toggle');\r\n        if (toggle) {\r\n          const handler = () =\u003e {\r\n            currentGrouping = currentGrouping === 'grouped' ? 'ungrouped' : 'grouped';\r\n            const icon = toggle.querySelector('.page-list-grouping-toggle__icon');\r\n            const label = toggle.querySelector('.page-list-grouping-toggle__label');\r\n            if (icon \u0026\u0026 label) {\r\n              icon.textContent = currentGrouping === 'ungrouped' ? 'list' : 'folder';\r\n              label.textContent = currentGrouping === 'ungrouped' ? 'Ungrouped' : 'Grouped';\r\n            }\r\n            toggle.setAttribute('data-grouping', currentGrouping);\r\n            updateView(currentFilter, currentLayout, currentGrouping, currentSort, currentSortDirection);\r\n          };\r\n          toggle.addEventListener('click', handler);\r\n          cleanupFunctions.push(() =\u003e toggle.removeEventListener('click', handler));\r\n        }\r\n      };\r\n\r\n      const attachSortToggle = () =\u003e {\r\n        const toggle = document.getElementById('page-list-sort-toggle');\r\n        const menu = document.getElementById('page-list-sort-menu');\r\n        \r\n        if (toggle \u0026\u0026 menu) {\r\n          // Toggle menu visibility\r\n          const toggleHandler = (e: Event) =\u003e {\r\n            e.stopPropagation();\r\n            menu.classList.toggle('page-list-sort-menu--open');\r\n          };\r\n          toggle.addEventListener('click', toggleHandler);\r\n\r\n          // Close menu when clicking outside\r\n          const outsideClickHandler = (e: Event) =\u003e {\r\n            const target = e.target as Node;\r\n            if (!toggle.contains(target) \u0026\u0026 !menu.contains(target)) {\r\n              menu.classList.remove('page-list-sort-menu--open');\r\n            }\r\n          };\r\n          document.addEventListener('click', outsideClickHandler);\r\n\r\n          // Handle sort option clicks\r\n          const sortItems = menu.querySelectorAll('.page-list-sort-menu__item');\r\n          const itemClickHandlers: Array\u003c{ element: Element; handler: () =\u003e void }\u003e = [];\r\n          \r\n          sortItems.forEach(item =\u003e {\r\n            const handler = () =\u003e {\r\n              const sortType = item.getAttribute('data-sort');\r\n              const direction = item.getAttribute('data-direction') as 'asc' | 'desc';\r\n              \r\n              if (sortType \u0026\u0026 direction) {\r\n                currentSort = sortType;\r\n                currentSortDirection = direction;\r\n\r\n                const icon = toggle.querySelector('.page-list-sort-toggle__icon');\r\n                const label = toggle.querySelector('.page-list-sort-toggle__label');\r\n                const directionIcon = toggle.querySelector('.page-list-sort-toggle__direction');\r\n                \r\n                if (icon) icon.textContent = getSortIcon(currentSort, currentSortDirection);\r\n                if (label) label.textContent = getSortLabel(currentSort, currentSortDirection);\r\n                if (directionIcon) directionIcon.textContent = currentSortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward';\r\n                \r\n                toggle.setAttribute('data-sort', currentSort);\r\n                toggle.setAttribute('data-direction', currentSortDirection);\r\n                \r\n                // Update active state in menu\r\n                sortItems.forEach(i =\u003e i.classList.remove('page-list-sort-menu__item--active'));\r\n                item.classList.add('page-list-sort-menu__item--active');\r\n                \r\n                // Close menu\r\n                menu.classList.remove('page-list-sort-menu--open');\r\n                \r\n                // Update view\r\n                updateView(currentFilter, currentLayout, currentGrouping, currentSort, currentSortDirection);\r\n              }\r\n            };\r\n            item.addEventListener('click', handler);\r\n            itemClickHandlers.push({ element: item, handler });\r\n          });\r\n          \r\n          // Store cleanup functions\r\n          cleanupFunctions.push(() =\u003e {\r\n            toggle.removeEventListener('click', toggleHandler);\r\n            document.removeEventListener('click', outsideClickHandler);\r\n            itemClickHandlers.forEach(({ element, handler }) =\u003e {\r\n              element.removeEventListener('click', handler);\r\n            });\r\n          });\r\n        }\r\n      };\r\n\r\n      const attachGroupToggleListeners = () =\u003e {\r\n        const groupHeaders = container.querySelectorAll('.page-list-group-header');\r\n        const clickHandlers: Array\u003c{ element: Element; handler: () =\u003e void }\u003e = [];\r\n        \r\n        groupHeaders.forEach(header =\u003e {\r\n          const handler = () =\u003e {\r\n            const groupId = header.getAttribute('data-group-toggle');\r\n            if (!groupId) return;\r\n            \r\n            const group = container.querySelector(`[data-group-id=\"${groupId}\"]`);\r\n            const content = container.querySelector(`[data-group-content=\"${groupId}\"]`);\r\n            const icon = header.querySelector('.page-list-group-toggle-icon');\r\n            \r\n            if (content \u0026\u0026 icon) {\r\n              const isCollapsed = content.classList.contains('page-list-group-content--collapsed');\r\n              if (isCollapsed) {\r\n                content.classList.remove('page-list-group-content--collapsed');\r\n                icon.textContent = '▼';\r\n              } else {\r\n                content.classList.add('page-list-group-content--collapsed');\r\n                icon.textContent = '▶';\r\n              }\r\n            }\r\n          };\r\n          header.addEventListener('click', handler);\r\n          clickHandlers.push({ element: header, handler });\r\n        });\r\n        \r\n        // Store cleanup function\r\n        cleanupFunctions.push(() =\u003e {\r\n          clickHandlers.forEach(({ element, handler }) =\u003e {\r\n            element.removeEventListener('click', handler);\r\n          });\r\n        });\r\n      };\r\n\r\n      // Helper functions for sort labels and icons (defined once, reused)\r\n      const getSortLabel = (sortType: string, direction: 'asc' | 'desc'): string =\u003e {\r\n        const labels: Record\u003cstring, string\u003e = {\r\n          'seo': 'SEO Score',\r\n          'ai': 'AI Score',\r\n          'title': 'Title',\r\n          'accessibility': 'Accessibility'\r\n        };\r\n        return labels[sortType] || 'Title';\r\n      };\r\n\r\n      const getSortIcon = (sortType: string, direction: 'asc' | 'desc'): string =\u003e {\r\n        const icons: Record\u003cstring, string\u003e = {\r\n          'seo': 'trending_up',\r\n          'ai': 'psychology',\r\n          'title': 'title',\r\n          'accessibility': 'accessibility_new'\r\n        };\r\n        return icons[sortType] || 'title';\r\n      };\r\n\r\n      const isSortActive = (sortType: string, direction: 'asc' | 'desc'): boolean =\u003e {\r\n        return currentSort === sortType \u0026\u0026 currentSortDirection === direction;\r\n      };\r\n\r\n      const stats = calculateStats(allPages);\r\n      \r\n      // Customize display based on section\r\n      const showStats = currentSection === 'overview'; // Only show full stats on overview page\r\n      const showControls = currentSection !== 'overview' \u0026\u0026 currentSection !== 'keyword-research' \u0026\u0026 currentSection !== 'link-map' \u0026\u0026 currentSection !== 'drafts' \u0026\u0026 currentSection !== 'schema' \u0026\u0026 currentSection !== 'llms'; // Hide controls on overview, keyword-research, link-map, drafts, schema, and llms\r\n      const showPages = currentSection !== 'overview' \u0026\u0026 currentSection !== 'keyword-research' \u0026\u0026 currentSection !== 'link-map' \u0026\u0026 currentSection !== 'drafts' \u0026\u0026 currentSection !== 'schema' \u0026\u0026 currentSection !== 'llms'; // Hide page list on overview, keyword-research, link-map, drafts, schema, and llms\r\n      const showFilters = currentSection !== 'overview' \u0026\u0026 currentSection !== 'keyword-research' \u0026\u0026 currentSection !== 'link-map' \u0026\u0026 currentSection !== 'drafts' \u0026\u0026 currentSection !== 'schema' \u0026\u0026 currentSection !== 'llms'; // Hide filters on overview, keyword-research, link-map, drafts, schema, and llms\r\n      \r\n      // Render summary section: hero + stats for overview, hero only for other pages\r\n      const summaryHtml = renderStats(stats, currentFilter, data.siteTechnicalSEO, data.siteAICrawlability, showFilters, currentSection, !showStats);\r\n\r\n      const controlsHtml = showControls ? `\r\n        \u003cdiv class=\"page-list-controls\"\u003e\r\n          ${isLocalhost() \u0026\u0026 currentSection === 'technical-issues' \u0026\u0026 stats.technicalSEO.brokenLinks \u003e 0 ? `\r\n            \u003cdiv class=\"page-list-controls__fix\"\u003e\r\n              \u003cbutton \r\n                class=\"page-list-fix-button\" \r\n                id=\"page-list-fix-broken-links\" \r\n                type=\"button\"\r\n                aria-label=\"Fix obvious internal broken links (development mode only)\"\r\n                title=\"Fix obvious internal broken links (dev-only)\"\r\n                data-tooltip=\"Automatically fix internal broken links with obvious matches. Only available in development mode.\"\r\n              \u003e\r\n                \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n                \u003cspan class=\"page-list-fix-button__text\"\u003eFix Broken Links\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          ${isLocalhost() \u0026\u0026 currentSection === 'content-quality' \u0026\u0026 (stats.contentQuality.noExcerpt \u003e 0 || stats.contentQuality.excerptTooShort \u003e 0 || stats.contentQuality.excerptTooLong \u003e 0) ? `\r\n            \u003cdiv class=\"page-list-controls__fix\"\u003e\r\n              \u003cbutton \r\n                class=\"page-list-fix-button\" \r\n                id=\"page-list-bulk-generate-excerpts\" \r\n                type=\"button\"\r\n                aria-label=\"Bulk generate page excerpts (development mode only)\"\r\n                title=\"Generate excerpts (dev-only)\"\r\n                data-tooltip=\"Automatically generate excerpts for pages missing or with bad length. Only available in development mode.\"\r\n              \u003e\r\n                \u003cspan class=\"page-list-fix-button__icon material-symbols-outlined\" aria-hidden=\"true\"\u003edescription\u003c/span\u003e\r\n                \u003cspan class=\"page-list-fix-button__text\"\u003eGenerate Excerpts\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          ` : ''}\r\n          \u003cdiv class=\"page-list-controls__sort\"\u003e\r\n            \u003cdiv class=\"page-list-sort\"\u003e\r\n              \u003cbutton class=\"page-list-sort-toggle\" id=\"page-list-sort-toggle\" data-sort=\"${currentSort}\" data-direction=\"${currentSortDirection}\"\u003e\r\n                \u003cspan class=\"page-list-sort-toggle__icon material-symbols-outlined\"\u003e${getSortIcon(currentSort, currentSortDirection)}\u003c/span\u003e\r\n                \u003cspan class=\"page-list-sort-toggle__label\"\u003e${getSortLabel(currentSort, currentSortDirection)}\u003c/span\u003e\r\n                \u003cspan class=\"page-list-sort-toggle__direction material-symbols-outlined\"\u003e${currentSortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward'}\u003c/span\u003e\r\n              \u003c/button\u003e\r\n              \u003cdiv class=\"page-list-sort-menu\" id=\"page-list-sort-menu\"\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('seo', 'asc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"seo\" data-direction=\"asc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003etrending_up\u003c/span\u003e\r\n                  \u003cspan\u003eSEO Score (Low to High)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_upward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('seo', 'desc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"seo\" data-direction=\"desc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003etrending_up\u003c/span\u003e\r\n                  \u003cspan\u003eSEO Score (High to Low)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_downward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('ai', 'asc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"ai\" data-direction=\"asc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003epsychology\u003c/span\u003e\r\n                  \u003cspan\u003eAI Score (Low to High)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_upward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('ai', 'desc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"ai\" data-direction=\"desc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003epsychology\u003c/span\u003e\r\n                  \u003cspan\u003eAI Score (High to Low)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_downward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('title', 'asc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"title\" data-direction=\"asc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003etitle\u003c/span\u003e\r\n                  \u003cspan\u003eTitle (A-Z)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_upward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-sort-menu__item ${isSortActive('title', 'desc') ? 'page-list-sort-menu__item--active' : ''}\" data-sort=\"title\" data-direction=\"desc\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003etitle\u003c/span\u003e\r\n                  \u003cspan\u003eTitle (Z-A)\u003c/span\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\"\u003earrow_downward\u003c/span\u003e\r\n                \u003c/button\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-controls__layout\"\u003e\r\n            \u003cbutton class=\"page-list-layout-toggle\" id=\"page-list-layout-toggle\" data-layout=\"${currentLayout}\"\u003e\r\n              \u003cspan class=\"page-list-layout-toggle__icon material-symbols-outlined\"\u003e${currentLayout === 'compact' ? 'view_compact' : 'view_list'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-layout-toggle__label\"\u003e${currentLayout === 'compact' ? 'Compact' : 'Normal'}\u003c/span\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-controls__grouping\"\u003e\r\n            \u003cbutton class=\"page-list-grouping-toggle\" id=\"page-list-grouping-toggle\" data-grouping=\"${currentGrouping}\"\u003e\r\n              \u003cspan class=\"page-list-grouping-toggle__icon material-symbols-outlined\"\u003e${currentGrouping === 'ungrouped' ? 'list' : 'folder'}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-grouping-toggle__label\"\u003e${currentGrouping === 'ungrouped' ? 'Ungrouped' : 'Grouped'}\u003c/span\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-controls__export\"\u003e\r\n            \u003cdiv class=\"page-list-export\"\u003e\r\n              \u003cbutton class=\"page-list-export-toggle\" id=\"page-list-export-toggle\" type=\"button\" aria-label=\"Export page list\"\u003e\r\n                \u003cspan class=\"page-list-export-toggle__icon material-symbols-outlined\" aria-hidden=\"true\"\u003edownload\u003c/span\u003e\r\n                \u003cspan class=\"page-list-export-toggle__label\"\u003eExport\u003c/span\u003e\r\n                \u003cspan class=\"page-list-export-toggle__arrow material-symbols-outlined\" aria-hidden=\"true\"\u003earrow_drop_down\u003c/span\u003e\r\n              \u003c/button\u003e\r\n              \u003cdiv class=\"page-list-export-menu\" id=\"page-list-export-menu\"\u003e\r\n                \u003cbutton class=\"page-list-export-menu__item\" id=\"page-list-export-csv\" type=\"button\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edescription\u003c/span\u003e\r\n                  \u003cspan\u003eExport Filtered as CSV\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-export-menu__item\" id=\"page-list-export-excel\" type=\"button\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003etable_chart\u003c/span\u003e\r\n                  \u003cspan\u003eExport Filtered as Excel\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cdiv class=\"page-list-export-menu__divider\" role=\"separator\"\u003e\u003c/div\u003e\r\n                \u003cbutton class=\"page-list-export-menu__item\" id=\"page-list-export-csv-all\" type=\"button\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003edescription\u003c/span\u003e\r\n                  \u003cspan\u003eExport All as CSV\u003c/span\u003e\r\n                \u003c/button\u003e\r\n                \u003cbutton class=\"page-list-export-menu__item\" id=\"page-list-export-excel-all\" type=\"button\"\u003e\r\n                  \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003etable_chart\u003c/span\u003e\r\n                  \u003cspan\u003eExport All as Excel\u003c/span\u003e\r\n                \u003c/button\u003e\r\n              \u003c/div\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      ` : '';\r\n      \r\n      // Handle drafts section specially\r\n      if (currentSection === 'drafts') {\r\n        const draftPages = filterPages(allPages, 'drafts');\r\n        const draftsHtml = renderDraftPages(draftPages);\r\n        container.innerHTML = draftsHtml;\r\n        attachDraftHandlers(draftPages);\r\n        return; // Early return for drafts section\r\n      }\r\n\r\n      // Handle schema section specially\r\n      if (currentSection === 'schema') {\r\n        const schemaHtml = renderSchemaSection(allPages);\r\n        container.innerHTML = schemaHtml;\r\n        attachSchemaValidationHandlers(allPages);\r\n        return; // Early return for schema section\r\n      }\r\n\r\n      // Handle llms section specially\r\n      if (currentSection === 'llms') {\r\n        const llmsHtml = renderLLMSSection();\r\n        container.innerHTML = llmsHtml;\r\n        attachLLMSHandlers();\r\n        return; // Early return for llms section\r\n      }\r\n\r\n      const filteredPages = filterPages(allPages, currentFilter);\r\n      const pagesHtml = showPages ? ((currentGrouping === 'grouped')\r\n        ? renderGroupedPages(filteredPages, currentLayout === 'compact', currentSort, currentSortDirection, currentFilter)\r\n        : renderUngroupedPages(filteredPages, currentLayout === 'compact', currentSort, currentSortDirection, currentFilter)) : '';\r\n\r\n      container.innerHTML = `\r\n        ${summaryHtml}\r\n        ${controlsHtml}\r\n        ${showPages ? `\u003cdiv class=\"page-list-pages ${currentLayout === 'compact' ? 'page-list-pages--compact' : ''}\" id=\"page-list-pages\"\u003e\r\n          ${pagesHtml}\r\n        \u003c/div\u003e` : ''}\r\n      `;\r\n\r\n      // Apply initial active state for filters/overview stats\r\n      setActiveFilterState(currentFilter);\r\n\r\n      // Attach listeners (filters should work even when stats grid is hidden but hero overview is present)\r\n      attachFilterListeners();\r\n      // Attach rescan handler on all pages\r\n      attachRescanHandler();\r\n      if (showControls) {\r\n        attachLayoutToggle();\r\n        attachGroupingToggle();\r\n        attachSortToggle();\r\n        // Update and attach export handlers\r\n        updateFilteredPagesForExport(filteredPages);\r\n        attachPageListExportHandlers();\r\n        attachExportToggle();\r\n      }\r\n      if (showPages) {\r\n        attachRowClickListeners();\r\n        attachGroupToggleListeners();\r\n        attachTooltipHandlers(container as HTMLElement);\r\n        // Only attach fix button handler on technical-issues page\r\n        if (currentSection === 'technical-issues') {\r\n          attachFixButtonHandler(allPages);\r\n        }\r\n        if (currentSection === 'content-quality') {\r\n          attachBulkGenerateExcerptsHandler(allPages);\r\n        }\r\n      }\r\n      if (isLocalhost() \u0026\u0026 currentSection === 'keyword-research') {\r\n        attachCompetitorAnalysisHandlers(allPages);\r\n        // Extract and display site keywords\r\n        extractAndDisplaySiteKeywords(allPages);\r\n      }\r\n      if (isLocalhost() \u0026\u0026 currentSection === 'link-map') {\r\n        // Render link map visualization\r\n        const linkMapContainer = document.getElementById('page-list-link-map-container');\r\n        if (linkMapContainer) {\r\n          renderLinkMap(linkMapContainer, allPages);\r\n        }\r\n      }\r\n    })\r\n    .catch(error =\u003e {\r\n      hideLoading();\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\r\n      container.innerHTML = `\r\n        \u003cdiv class=\"page-list-error\"\u003e\r\n          \u003ch2\u003eError Loading Page List\u003c/h2\u003e\r\n          \u003cp\u003e${escapeHtml(errorMessage)}\u003c/p\u003e\r\n          \u003cp\u003ePlease refresh the page to try again.\u003c/p\u003e\r\n          \u003cbutton \r\n            type=\"button\" \r\n            class=\"page-list-modal__button page-list-modal__button--primary\"\r\n            onclick=\"window.location.reload()\"\r\n            style=\"margin-top: 1rem;\"\r\n          \u003e\r\n            Refresh Page\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n      devError('Error loading page list:', error);\r\n    });\r\n  } catch (error) {\r\n    devError('Error initializing page list:', error);\r\n    // Don't let page-list errors break the entire page\r\n  }\r\n}\r\n\r\n/**\r\n * Extract and aggregate keywords from all site pages using full KeywordAnalysis\r\n */\r\ninterface KeywordEntry {\r\n  keyword: string;\r\n  frequency: number;\r\n  pages: string[];\r\n  density?: number;\r\n  volume?: number;\r\n  competition?: number;\r\n  type: 'primary' | 'secondary' | 'long-tail' | 'other';\r\n}\r\n\r\nasync function extractSiteKeywords(pages: PageData[]): Promise\u003c{\r\n  keywords: KeywordEntry[];\r\n  siteAnalysis: {\r\n    totalKeywordDensity: number;\r\n    totalKeywordRichness: number;\r\n    totalPrimaryKeywords: number;\r\n    totalSecondaryKeywords: number;\r\n    totalLongTailKeywords: number;\r\n    recommendations: Array\u003c{ text: string; type: string }\u003e;\r\n  };\r\n}\u003e {\r\n  const keywordMap = new Map\u003cstring, KeywordEntry\u003e();\r\n  const primaryKeywords = new Set\u003cstring\u003e();\r\n  const secondaryKeywords = new Set\u003cstring\u003e();\r\n  const longTailKeywords = new Set\u003cstring\u003e();\r\n  let totalDensity = 0;\r\n  let totalRichness = 0;\r\n  let totalPrimary = 0;\r\n  let totalSecondary = 0;\r\n  let totalLongTail = 0;\r\n  const allRecommendations: Array\u003c{ text: string; type: string }\u003e = [];\r\n  let pagesAnalyzed = 0;\r\n  \r\n  try {\r\n    const { analyzeKeywords } = await import('./keyword-research');\r\n    \r\n    for (const page of pages) {\r\n      // Combine page text for analysis\r\n      const pageText = `${page.title} ${page.metaDescription ?? ''} ${page.summary ?? ''}`;\r\n      \r\n      // Use full analyzeKeywords to get KeywordAnalysis with all fields\r\n      const analysis = analyzeKeywords(pageText, page.title, page.metaDescription ?? '');\r\n      \r\n      // Track primary keywords\r\n      analysis.primaryKeywords.forEach(kw =\u003e {\r\n        const key = kw.keyword.toLowerCase();\r\n        primaryKeywords.add(key);\r\n        if (!keywordMap.has(key)) {\r\n          keywordMap.set(key, {\r\n            keyword: kw.keyword,\r\n            frequency: 0,\r\n            pages: [],\r\n            density: kw.density,\r\n            volume: kw.volume,\r\n            competition: kw.competition,\r\n            type: 'primary'\r\n          });\r\n        }\r\n        const entry = keywordMap.get(key)!;\r\n        entry.frequency += kw.frequency;\r\n        if (!entry.pages.includes(page.relPermalink)) {\r\n          entry.pages.push(page.relPermalink);\r\n        }\r\n        // Update density to average if multiple pages\r\n        if (entry.density !== undefined \u0026\u0026 kw.density !== undefined) {\r\n          entry.density = (entry.density + kw.density) / 2;\r\n        }\r\n      });\r\n      \r\n      // Track secondary keywords\r\n      analysis.secondaryKeywords.forEach(kw =\u003e {\r\n        const key = kw.keyword.toLowerCase();\r\n        if (!primaryKeywords.has(key)) {\r\n          secondaryKeywords.add(key);\r\n          if (!keywordMap.has(key)) {\r\n            keywordMap.set(key, {\r\n              keyword: kw.keyword,\r\n              frequency: 0,\r\n              pages: [],\r\n              density: kw.density,\r\n              volume: kw.volume,\r\n              competition: kw.competition,\r\n              type: 'secondary'\r\n            });\r\n          }\r\n          const entry = keywordMap.get(key)!;\r\n          entry.frequency += kw.frequency;\r\n          if (!entry.pages.includes(page.relPermalink)) {\r\n            entry.pages.push(page.relPermalink);\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Track long-tail keywords (3+ words)\r\n      analysis.longTailKeywords.forEach(keyword =\u003e {\r\n        const key = keyword.toLowerCase();\r\n        longTailKeywords.add(key);\r\n        if (!keywordMap.has(key)) {\r\n          keywordMap.set(key, {\r\n            keyword: keyword,\r\n            frequency: 0,\r\n            pages: [],\r\n            type: 'long-tail'\r\n          });\r\n        }\r\n        const entry = keywordMap.get(key)!;\r\n        if (!entry.pages.includes(page.relPermalink)) {\r\n          entry.pages.push(page.relPermalink);\r\n        }\r\n        // Mark as long-tail if not already primary or secondary\r\n        if (entry.type === 'other' || (!primaryKeywords.has(key) \u0026\u0026 !secondaryKeywords.has(key))) {\r\n          entry.type = 'long-tail';\r\n        }\r\n      });\r\n      \r\n      // Aggregate metrics\r\n      totalDensity += analysis.keywordDensity;\r\n      totalRichness += analysis.keywordRichness;\r\n      totalPrimary += analysis.primaryKeywords.length;\r\n      totalSecondary += analysis.secondaryKeywords.length;\r\n      totalLongTail += analysis.longTailKeywords.length;\r\n      \r\n      // Collect recommendations\r\n      analysis.recommendations.forEach(rec =\u003e {\r\n        allRecommendations.push({ text: rec.text, type: rec.type });\r\n      });\r\n      \r\n      pagesAnalyzed++;\r\n    }\r\n    \r\n    // Mark remaining keywords as 'other'\r\n    keywordMap.forEach((entry, key) =\u003e {\r\n      if (entry.type === 'primary' || entry.type === 'secondary' || entry.type === 'long-tail') {\r\n        return; // Already categorized\r\n      }\r\n      // Check if it's long-tail by word count\r\n      const wordCount = entry.keyword.split(/\\s+/).length;\r\n      if (wordCount \u003e= 3) {\r\n        entry.type = 'long-tail';\r\n      } else {\r\n        entry.type = 'other';\r\n      }\r\n    });\r\n  } catch (error) {\r\n    devError('Error extracting site keywords:', error);\r\n  }\r\n  \r\n  return {\r\n    keywords: Array.from(keywordMap.values()),\r\n    siteAnalysis: {\r\n      totalKeywordDensity: pagesAnalyzed \u003e 0 ? totalDensity / pagesAnalyzed : 0,\r\n      totalKeywordRichness: pagesAnalyzed \u003e 0 ? totalRichness / pagesAnalyzed : 0,\r\n      totalPrimaryKeywords: totalPrimary,\r\n      totalSecondaryKeywords: totalSecondary,\r\n      totalLongTailKeywords: totalLongTail,\r\n      recommendations: allRecommendations.slice(0, 10) // Top 10 recommendations\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Extract and display site keywords in the keyword-research section\r\n * Uses full KeywordAnalysis interface with all fields (primaryKeywords, secondaryKeywords, longTailKeywords, keywordDensity, keywordRichness, recommendations)\r\n */\r\nasync function extractAndDisplaySiteKeywords(pages: PageData[]): Promise\u003cvoid\u003e {\r\n  const keywordsList = document.getElementById('page-list-site-keywords-list');\r\n  const totalStat = document.getElementById('page-list-keyword-stat-total');\r\n  const uniqueStat = document.getElementById('page-list-keyword-stat-unique');\r\n  \r\n  if (!keywordsList) return;\r\n  \r\n  try {\r\n    const result = await extractSiteKeywords(pages);\r\n    const allKeywords = result.keywords;\r\n    const siteAnalysis = result.siteAnalysis;\r\n    \r\n    // Update stats\r\n    const totalKeywords = allKeywords.reduce((sum, entry) =\u003e sum + entry.frequency, 0);\r\n    const uniqueKeywords = allKeywords.length;\r\n    \r\n    if (totalStat) {\r\n      totalStat.textContent = totalKeywords.toLocaleString();\r\n    }\r\n    if (uniqueStat) {\r\n      uniqueStat.textContent = uniqueKeywords.toLocaleString();\r\n    }\r\n    \r\n    // Render keywords list with enhanced data from KeywordAnalysis\r\n    if (allKeywords.length === 0) {\r\n      keywordsList.innerHTML = '\u003cp class=\"page-list-keyword-research__empty\"\u003eNo keywords found.\u003c/p\u003e';\r\n      return;\r\n    }\r\n    \r\n    // Get CSS class helper for density\r\n    const getDensityClass = (density?: number): string =\u003e {\r\n      if (!density) return '';\r\n      if (density \u003c 0.8) return 'page-list-keyword-research__keyword-density--low';\r\n      if (density \u003e= 1.1 \u0026\u0026 density \u003c= 1.9) return 'page-list-keyword-research__keyword-density--optimal';\r\n      if (density \u003e 2.2) return 'page-list-keyword-research__keyword-density--high';\r\n      return 'page-list-keyword-research__keyword-density--ok';\r\n    };\r\n    \r\n    // Group keywords by type\r\n    const keywordsByType = {\r\n      primary: allKeywords.filter(k =\u003e k.type === 'primary'),\r\n      secondary: allKeywords.filter(k =\u003e k.type === 'secondary'),\r\n      'long-tail': allKeywords.filter(k =\u003e k.type === 'long-tail'),\r\n      other: allKeywords.filter(k =\u003e k.type === 'other')\r\n    };\r\n    \r\n    keywordsList.innerHTML = `\r\n      \u003cdiv class=\"page-list-keyword-research__site-metrics\"\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__metric\"\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-label\"\u003eAvg Keyword Density\u003c/span\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-value\"\u003e${siteAnalysis.totalKeywordDensity.toFixed(2)}%\u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__metric\"\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-label\"\u003eKeyword Richness\u003c/span\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-value\"\u003e${siteAnalysis.totalKeywordRichness.toFixed(1)}%\u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__metric\"\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-label\"\u003ePrimary Keywords\u003c/span\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-value\"\u003e${siteAnalysis.totalPrimaryKeywords}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__metric\"\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-label\"\u003eLong-Tail Keywords\u003c/span\u003e\r\n          \u003cspan class=\"page-list-keyword-research__metric-value\"\u003e${siteAnalysis.totalLongTailKeywords}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      ${siteAnalysis.recommendations.length \u003e 0 ? `\r\n      \u003cdiv class=\"page-list-keyword-research__recommendations\"\u003e\r\n        \u003ch4 class=\"page-list-keyword-research__recommendations-title\"\u003eSite-Wide Recommendations\u003c/h4\u003e\r\n        \u003cul class=\"page-list-keyword-research__recommendations-list\"\u003e\r\n          ${siteAnalysis.recommendations.map(rec =\u003e `\r\n            \u003cli class=\"page-list-keyword-research__recommendation page-list-keyword-research__recommendation--${rec.type}\"\u003e\r\n              ${escapeHtml(rec.text)}\r\n            \u003c/li\u003e\r\n          `).join('')}\r\n        \u003c/ul\u003e\r\n      \u003c/div\u003e\r\n      ` : ''}\r\n      \u003cdiv class=\"page-list-keyword-research__keywords-controls\"\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__filter-group\"\u003e\r\n          \u003clabel class=\"page-list-keyword-research__filter-label\"\u003eFilter:\u003c/label\u003e\r\n          \u003cselect class=\"page-list-keyword-research__filter-select\" id=\"page-list-keyword-filter\"\u003e\r\n            \u003coption value=\"all\"\u003eAll Keywords\u003c/option\u003e\r\n            \u003coption value=\"primary\"\u003ePrimary Keywords\u003c/option\u003e\r\n            \u003coption value=\"secondary\"\u003eSecondary Keywords\u003c/option\u003e\r\n            \u003coption value=\"long-tail\"\u003eLong-Tail Keywords\u003c/option\u003e\r\n            \u003coption value=\"other\"\u003eOther Keywords\u003c/option\u003e\r\n          \u003c/select\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__sort-group\"\u003e\r\n          \u003clabel class=\"page-list-keyword-research__sort-label\"\u003eSort:\u003c/label\u003e\r\n          \u003cselect class=\"page-list-keyword-research__sort-select\" id=\"page-list-keyword-sort\"\u003e\r\n            \u003coption value=\"frequency-desc\"\u003eFrequency (High to Low)\u003c/option\u003e\r\n            \u003coption value=\"frequency-asc\"\u003eFrequency (Low to High)\u003c/option\u003e\r\n            \u003coption value=\"density-desc\"\u003eDensity (High to Low)\u003c/option\u003e\r\n            \u003coption value=\"density-asc\"\u003eDensity (Low to High)\u003c/option\u003e\r\n            \u003coption value=\"volume-desc\"\u003eVolume (High to Low)\u003c/option\u003e\r\n            \u003coption value=\"volume-asc\"\u003eVolume (Low to High)\u003c/option\u003e\r\n            \u003coption value=\"pages-desc\"\u003ePages (High to Low)\u003c/option\u003e\r\n            \u003coption value=\"pages-asc\"\u003ePages (Low to High)\u003c/option\u003e\r\n            \u003coption value=\"alphabetical\"\u003eAlphabetical (A-Z)\u003c/option\u003e\r\n          \u003c/select\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-keyword-research__keywords-columns\" id=\"page-list-keywords-list-container\"\u003e\r\n        ${Object.entries(keywordsByType).map(([type, keywords]) =\u003e {\r\n          if (keywords.length === 0) return '';\r\n          const typeLabel = type === 'long-tail' ? 'Long-Tail' : type.charAt(0).toUpperCase() + type.slice(1);\r\n          return `\r\n            \u003cdiv class=\"page-list-keyword-research__keyword-column\" data-keyword-type=\"${type}\"\u003e\r\n              \u003ch4 class=\"page-list-keyword-research__keyword-column-title\"\u003e\r\n                \u003cspan class=\"material-symbols-outlined\"\u003e${type === 'primary' ? 'star' : type === 'secondary' ? 'label' : type === 'long-tail' ? 'auto_awesome' : 'tag'}\u003c/span\u003e\r\n                ${typeLabel} (${keywords.length})\r\n              \u003c/h4\u003e\r\n              \u003cul class=\"page-list-keyword-research__keywords-list\"\u003e\r\n                ${keywords.map(kw =\u003e `\r\n                  \u003cli class=\"page-list-keyword-research__keyword-item\"\u003e\r\n                    \u003cspan class=\"page-list-keyword-research__keyword-text\"\u003e${escapeHtml(kw.keyword)}\u003c/span\u003e\r\n                    \u003cdiv class=\"page-list-keyword-research__keyword-meta\"\u003e\r\n                      \u003cspan class=\"page-list-keyword-research__keyword-frequency\"\u003e${kw.frequency}x\u003c/span\u003e\r\n                      ${kw.pages.length \u003e 0 ? `\u003cspan class=\"page-list-keyword-research__keyword-pages\"\u003e${kw.pages.length}p\u003c/span\u003e` : ''}\r\n                    \u003c/div\u003e\r\n                  \u003c/li\u003e\r\n                `).join('')}\r\n              \u003c/ul\u003e\r\n            \u003c/div\u003e\r\n          `;\r\n        }).join('')}\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    // Attach filter and sort handlers\r\n    attachKeywordListHandlers(allKeywords);\r\n  } catch (error) {\r\n    devError('Error displaying site keywords:', error);\r\n    keywordsList.innerHTML = '\u003cp class=\"page-list-keyword-research__empty\"\u003eError loading keywords. Please refresh the page.\u003c/p\u003e';\r\n  }\r\n}\r\n\r\n/**\r\n * Attach filter and sort handlers for keyword list\r\n */\r\nfunction attachKeywordListHandlers(allKeywords: KeywordEntry[]): void {\r\n  const filterSelect = document.getElementById('page-list-keyword-filter') as HTMLSelectElement;\r\n  const sortSelect = document.getElementById('page-list-keyword-sort') as HTMLSelectElement;\r\n  const container = document.getElementById('page-list-keywords-list-container');\r\n  \r\n  if (!filterSelect || !sortSelect || !container) return;\r\n  \r\n  const renderKeywords = (filterType: string, sortType: string) =\u003e {\r\n    // Filter keywords\r\n    let filtered = allKeywords;\r\n    if (filterType !== 'all') {\r\n      filtered = allKeywords.filter(k =\u003e k.type === filterType);\r\n    }\r\n    \r\n    // Sort keywords\r\n    const [sortField, sortDirection] = sortType.split('-');\r\n    filtered = [...filtered].sort((a, b) =\u003e {\r\n      let aVal: number | string = 0;\r\n      let bVal: number | string = 0;\r\n      \r\n      switch (sortField) {\r\n        case 'frequency':\r\n          aVal = a.frequency;\r\n          bVal = b.frequency;\r\n          break;\r\n        case 'density':\r\n          aVal = a.density ?? 0;\r\n          bVal = b.density ?? 0;\r\n          break;\r\n        case 'volume':\r\n          aVal = a.volume ?? 0;\r\n          bVal = b.volume ?? 0;\r\n          break;\r\n        case 'pages':\r\n          aVal = a.pages.length;\r\n          bVal = b.pages.length;\r\n          break;\r\n        case 'alphabetical':\r\n          aVal = a.keyword.toLowerCase();\r\n          bVal = b.keyword.toLowerCase();\r\n          break;\r\n        default:\r\n          return 0;\r\n      }\r\n      \r\n      if (sortField === 'alphabetical') {\r\n        return sortDirection === 'asc' \r\n          ? (aVal as string).localeCompare(bVal as string)\r\n          : (bVal as string).localeCompare(aVal as string);\r\n      }\r\n      \r\n      return sortDirection === 'desc' \r\n        ? (bVal as number) - (aVal as number)\r\n        : (aVal as number) - (bVal as number);\r\n    });\r\n    \r\n    // Group filtered keywords by type\r\n    const keywordsByType = {\r\n      primary: filtered.filter(k =\u003e k.type === 'primary'),\r\n      secondary: filtered.filter(k =\u003e k.type === 'secondary'),\r\n      'long-tail': filtered.filter(k =\u003e k.type === 'long-tail'),\r\n      other: filtered.filter(k =\u003e k.type === 'other')\r\n    };\r\n    \r\n    // Get CSS class helper for density\r\n    const getDensityClass = (density?: number): string =\u003e {\r\n      if (!density) return '';\r\n      if (density \u003c 0.8) return 'page-list-keyword-research__keyword-density--low';\r\n      if (density \u003e= 1.1 \u0026\u0026 density \u003c= 1.9) return 'page-list-keyword-research__keyword-density--optimal';\r\n      if (density \u003e 2.2) return 'page-list-keyword-research__keyword-density--high';\r\n      return 'page-list-keyword-research__keyword-density--ok';\r\n    };\r\n    \r\n    // Render grouped keywords in columns\r\n    container.innerHTML = Object.entries(keywordsByType).map(([type, keywords]) =\u003e {\r\n      if (keywords.length === 0) return '';\r\n      const typeLabel = type === 'long-tail' ? 'Long-Tail' : type.charAt(0).toUpperCase() + type.slice(1);\r\n      return `\r\n        \u003cdiv class=\"page-list-keyword-research__keyword-column\" data-keyword-type=\"${type}\"\u003e\r\n          \u003ch4 class=\"page-list-keyword-research__keyword-column-title\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003e${type === 'primary' ? 'star' : type === 'secondary' ? 'label' : type === 'long-tail' ? 'auto_awesome' : 'tag'}\u003c/span\u003e\r\n            ${typeLabel} (${keywords.length})\r\n          \u003c/h4\u003e\r\n          \u003cul class=\"page-list-keyword-research__keywords-list\"\u003e\r\n            ${keywords.map(kw =\u003e `\r\n              \u003cli class=\"page-list-keyword-research__keyword-item\"\u003e\r\n                \u003cspan class=\"page-list-keyword-research__keyword-text\"\u003e${escapeHtml(kw.keyword)}\u003c/span\u003e\r\n                \u003cdiv class=\"page-list-keyword-research__keyword-meta\"\u003e\r\n                  \u003cspan class=\"page-list-keyword-research__keyword-frequency\"\u003e${kw.frequency}x\u003c/span\u003e\r\n                  ${kw.pages.length \u003e 0 ? `\u003cspan class=\"page-list-keyword-research__keyword-pages\"\u003e${kw.pages.length}p\u003c/span\u003e` : ''}\r\n                \u003c/div\u003e\r\n              \u003c/li\u003e\r\n            `).join('')}\r\n          \u003c/ul\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }).filter(html =\u003e html !== '').join('');\r\n  };\r\n  \r\n  // Initial render\r\n  renderKeywords(filterSelect.value, sortSelect.value);\r\n  \r\n  // Attach event listeners\r\n  filterSelect.addEventListener('change', () =\u003e {\r\n    renderKeywords(filterSelect.value, sortSelect.value);\r\n  });\r\n  \r\n  sortSelect.addEventListener('change', () =\u003e {\r\n    renderKeywords(filterSelect.value, sortSelect.value);\r\n  });\r\n}\r\n\r\n/**\r\n * Attach competitor analysis handlers\r\n */\r\nfunction attachCompetitorAnalysisHandlers(pages: PageData[]): void {\r\n  const urlInput = document.getElementById('page-list-competitor-url-input') as HTMLInputElement;\r\n  const addBtn = document.getElementById('page-list-add-competitor-btn');\r\n  const competitorList = document.getElementById('page-list-competitor-list');\r\n  const resultsSection = document.getElementById('page-list-keyword-research-results');\r\n  const comparisonDiv = document.getElementById('page-list-keyword-comparison');\r\n\r\n  if (!urlInput || !addBtn || !competitorList || !resultsSection || !comparisonDiv) return;\r\n\r\n  const STORAGE_KEY = 'page-list-competitors';\r\n  const REMOVED_KEYWORDS_KEY = 'page-list-removed-opportunity-keywords';\r\n  \r\n  // Load removed keywords from localStorage\r\n  const loadRemovedKeywords = (): Set\u003cstring\u003e =\u003e {\r\n    try {\r\n      const stored = localStorage.getItem(REMOVED_KEYWORDS_KEY);\r\n      if (stored) {\r\n        return new Set(JSON.parse(stored));\r\n      }\r\n    } catch (error) {\r\n      devError('Error loading removed keywords from storage:', error);\r\n    }\r\n    return new Set\u003cstring\u003e();\r\n  };\r\n  \r\n  // Save removed keywords to localStorage\r\n  const saveRemovedKeywords = (removedKeywords: Set\u003cstring\u003e) =\u003e {\r\n    try {\r\n      localStorage.setItem(REMOVED_KEYWORDS_KEY, JSON.stringify(Array.from(removedKeywords)));\r\n    } catch (error) {\r\n      devError('Error saving removed keywords to storage:', error);\r\n    }\r\n  };\r\n  \r\n  // Track removed keywords\r\n  const removedKeywords = loadRemovedKeywords();\r\n  \r\n  // Load competitors from localStorage\r\n  const loadCompetitors = (): Array\u003c{ url: string; keywords: KeywordAnalysis | null; loading: boolean }\u003e =\u003e {\r\n    try {\r\n      const stored = localStorage.getItem(STORAGE_KEY);\r\n      if (stored) {\r\n        const parsed = JSON.parse(stored) as Array\u003c{ url: string; keywords: KeywordAnalysis }\u003e;\r\n        return parsed.map((comp) =\u003e ({\r\n          url: comp.url,\r\n          keywords: comp.keywords,\r\n          loading: false\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      devError('Error loading competitors from storage:', error);\r\n    }\r\n    return [];\r\n  };\r\n\r\n  // Save competitors to localStorage\r\n  const saveCompetitors = () =\u003e {\r\n    try {\r\n      const toSave = competitors\r\n        .filter(c =\u003e !c.loading \u0026\u0026 c.keywords) // Only save analyzed competitors\r\n        .map(c =\u003e ({\r\n          url: c.url,\r\n          keywords: c.keywords\r\n        }));\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));\r\n    } catch (error) {\r\n      devError('Error saving competitors to storage:', error);\r\n    }\r\n  };\r\n\r\n  const competitors: Array\u003c{ url: string; keywords: KeywordAnalysis | null; loading: boolean }\u003e = loadCompetitors();\r\n\r\n  const renderCompetitorList = () =\u003e {\r\n    if (competitors.length === 0) {\r\n      competitorList.innerHTML = '\u003cp class=\"page-list-keyword-research__empty\"\u003eNo competitors added yet.\u003c/p\u003e';\r\n      return;\r\n    }\r\n\r\n    competitorList.innerHTML = competitors.map((comp, index) =\u003e `\r\n      \u003cdiv class=\"page-list-keyword-research__competitor-item ${comp.loading ? 'page-list-keyword-research__competitor-item--loading' : ''}\"\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__competitor-url\"\u003e${escapeHtml(comp.url)}\u003c/div\u003e\r\n        ${comp.loading ? `\r\n          \u003cdiv class=\"page-list-keyword-research__competitor-status\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e\r\n            Analyzing...\r\n          \u003c/div\u003e\r\n        ` : comp.keywords ? `\r\n          \u003cdiv class=\"page-list-keyword-research__competitor-status page-list-keyword-research__competitor-status--success\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003echeck_circle\u003c/span\u003e\r\n            ${comp.keywords.primaryKeywords?.length || 0} keywords found\r\n          \u003c/div\u003e\r\n          \u003cbutton class=\"page-list-keyword-research__competitor-remove\" data-index=\"${index}\" type=\"button\" aria-label=\"Remove competitor\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n          \u003c/button\u003e\r\n        ` : `\r\n          \u003cdiv class=\"page-list-keyword-research__competitor-status page-list-keyword-research__competitor-status--error\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eerror\u003c/span\u003e\r\n            Failed to analyze\r\n          \u003c/div\u003e\r\n          \u003cbutton class=\"page-list-keyword-research__competitor-remove\" data-index=\"${index}\" type=\"button\" aria-label=\"Remove competitor\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n          \u003c/button\u003e\r\n        `}\r\n      \u003c/div\u003e\r\n    `).join('');\r\n\r\n    // Attach remove handlers\r\n    competitorList.querySelectorAll('.page-list-keyword-research__competitor-remove').forEach(btn =\u003e {\r\n      btn.addEventListener('click', (e) =\u003e {\r\n        const index = parseInt((e.currentTarget as HTMLElement).getAttribute('data-index') || '0');\r\n        competitors.splice(index, 1);\r\n        saveCompetitors();\r\n        renderCompetitorList();\r\n        updateComparison(pages);\r\n      });\r\n    });\r\n  };\r\n\r\n  const analyzeCompetitor = async (url: string): Promise\u003cany\u003e =\u003e {\r\n    try {\r\n      // Use CORS proxy to fetch competitor page\r\n      // Since this is localhost-only dev tool, we use a public CORS proxy\r\n      // Alternative: Set up a local Node.js server or Netlify Function for production\r\n      let html: string;\r\n      let lastError: Error | null = null;\r\n      \r\n      // Try direct fetch first (may work for same-origin or CORS-enabled sites)\r\n      try {\r\n        const response = await fetch(url, {\r\n          mode: 'cors',\r\n          headers: {\r\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'\r\n          }\r\n        });\r\n        if (response.ok) {\r\n          html = await response.text();\r\n          if (html \u0026\u0026 html.length \u003e 0) {\r\n            // Success with direct fetch\r\n            return await parseAndAnalyze(html);\r\n          }\r\n        } else {\r\n          throw new Error(`HTTP ${response.status}`);\r\n        }\r\n      } catch (fetchError) {\r\n        lastError = fetchError instanceof Error ? fetchError : new Error(String(fetchError));\r\n        // Continue to proxy fallback\r\n      }\r\n      \r\n      // Fallback to CORS proxy services (try multiple)\r\n      const proxyServices = [\r\n        `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,\r\n        `https://corsproxy.io/?${encodeURIComponent(url)}`,\r\n        `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`\r\n      ];\r\n      \r\n      for (const proxyUrl of proxyServices) {\r\n        try {\r\n          const proxyResponse = await fetch(proxyUrl, {\r\n            method: 'GET',\r\n            headers: {\r\n              'Accept': 'application/json'\r\n            }\r\n          });\r\n          \r\n          if (!proxyResponse.ok) {\r\n            continue; // Try next proxy\r\n          }\r\n          \r\n          const contentType = proxyResponse.headers.get('content-type') || '';\r\n          \r\n          if (contentType.includes('application/json')) {\r\n            const proxyData = await proxyResponse.json();\r\n            \r\n            // Handle different proxy response formats\r\n            if (proxyData.contents) {\r\n              // allorigins.win format\r\n              html = proxyData.contents;\r\n            } else if (proxyData.data) {\r\n              // Some proxies use 'data'\r\n              html = proxyData.data;\r\n            } else if (typeof proxyData === 'string') {\r\n              // Direct HTML string in JSON\r\n              html = proxyData;\r\n            } else {\r\n              continue; // Try next proxy\r\n            }\r\n          } else {\r\n            // Direct HTML response (some proxies return HTML directly)\r\n            html = await proxyResponse.text();\r\n          }\r\n          \r\n          if (html \u0026\u0026 html.length \u003e 100) { // Ensure we have meaningful content\r\n            return await parseAndAnalyze(html);\r\n          }\r\n        } catch (proxyError) {\r\n          // Try next proxy service\r\n          continue;\r\n        }\r\n      }\r\n      \r\n      // All proxies failed\r\n      throw new Error(\r\n        `Failed to fetch competitor page. CORS restrictions prevent direct access. ` +\r\n        `All proxy services failed. ` +\r\n        `To fix: Set up a local proxy server or use a browser extension that disables CORS. ` +\r\n        `Original error: ${lastError?.message || 'Unknown error'}`\r\n      );\r\n    } catch (error) {\r\n      devError('Error analyzing competitor:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const parseAndAnalyze = async (html: string): Promise\u003cany\u003e =\u003e {\r\n    // Parse HTML and extract content\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    \r\n    // Extract text content\r\n    const title = doc.querySelector('title')?.textContent || '';\r\n    const metaDescription = doc.querySelector('meta[name=\"description\"]')?.getAttribute('content') || '';\r\n    \r\n    // Get body text (remove scripts, styles, etc.)\r\n    const bodyClone = doc.body.cloneNode(true) as HTMLElement;\r\n    if (!bodyClone) {\r\n      throw new Error('No body content found in HTML');\r\n    }\r\n    \r\n    bodyClone.querySelectorAll('script, style, nav, header, footer, aside').forEach(el =\u003e el.remove());\r\n    const bodyText = bodyClone.textContent || '';\r\n\r\n    if (!bodyText || bodyText.trim().length \u003c 50) {\r\n      throw new Error('Insufficient content extracted from page (less than 50 characters)');\r\n    }\r\n\r\n    // Use keyword research module to analyze\r\n    const { analyzeKeywords } = await import('./keyword-research');\r\n    return analyzeKeywords(bodyText, title, metaDescription);\r\n  };\r\n\r\n  const updateComparison = (sitePages: PageData[]) =\u003e {\r\n    const analyzedCompetitors = competitors.filter(c =\u003e c.keywords \u0026\u0026 !c.loading);\r\n    \r\n    // Update competitor count in overview\r\n    const competitorStat = document.getElementById('page-list-keyword-stat-competitors');\r\n    if (competitorStat) {\r\n      competitorStat.textContent = analyzedCompetitors.length.toString();\r\n    }\r\n    \r\n    if (analyzedCompetitors.length === 0) {\r\n      resultsSection.style.display = 'none';\r\n      const opportunitiesStat = document.getElementById('page-list-keyword-stat-opportunities');\r\n      if (opportunitiesStat) {\r\n        opportunitiesStat.textContent = '-';\r\n      }\r\n      return;\r\n    }\r\n\r\n    resultsSection.style.display = 'block';\r\n\r\n    // Collect all competitor keywords\r\n    const competitorKeywords = new Map\u003cstring, { count: number; competitors: string[] }\u003e();\r\n    analyzedCompetitors.forEach(comp =\u003e {\r\n      if (!comp.keywords) {\r\n        return;\r\n      }\r\n      const allKeywords = [\r\n        ...(comp.keywords.primaryKeywords || []),\r\n        ...(comp.keywords.secondaryKeywords || [])\r\n      ];\r\n      allKeywords.forEach((kw) =\u003e {\r\n        if (!kw || typeof kw !== 'object' || !('keyword' in kw) || !('frequency' in kw)) {\r\n          return;\r\n        }\r\n        const keyword = kw as { keyword: string; frequency: number };\r\n        const key = keyword.keyword.toLowerCase();\r\n        if (!competitorKeywords.has(key)) {\r\n          competitorKeywords.set(key, { count: 0, competitors: [] });\r\n        }\r\n        const entry = competitorKeywords.get(key)!;\r\n        entry.count += keyword.frequency;\r\n        if (!entry.competitors.includes(comp.url)) {\r\n          entry.competitors.push(comp.url);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Collect site keywords from all pages\r\n    const siteKeywords = new Map\u003cstring, number\u003e();\r\n    sitePages.forEach(page =\u003e {\r\n      const pageKeywords = [\r\n        ...(page.title ? page.title.toLowerCase().split(/\\s+/) : []),\r\n        ...(page.metaDescription ? page.metaDescription.toLowerCase().split(/\\s+/) : [])\r\n      ];\r\n      pageKeywords.forEach(kw =\u003e {\r\n        if (kw.length \u003e= 3) {\r\n          siteKeywords.set(kw, (siteKeywords.get(kw) || 0) + 1);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Find keywords competitors use but site doesn't\r\n    const opportunities: Array\u003c{ keyword: string; competitorCount: number; competitors: string[] }\u003e = [];\r\n    competitorKeywords.forEach((data, keyword) =\u003e {\r\n      // Filter out removed keywords\r\n      if (!siteKeywords.has(keyword) \u0026\u0026 keyword.length \u003e= 3 \u0026\u0026 !removedKeywords.has(keyword.toLowerCase())) {\r\n        opportunities.push({\r\n          keyword,\r\n          competitorCount: data.count,\r\n          competitors: data.competitors\r\n        });\r\n      }\r\n    });\r\n\r\n    // Sort by frequency\r\n    opportunities.sort((a, b) =\u003e b.competitorCount - a.competitorCount);\r\n    \r\n    // Update opportunities stat in overview\r\n    const opportunitiesStat = document.getElementById('page-list-keyword-stat-opportunities');\r\n    if (opportunitiesStat) {\r\n      opportunitiesStat.textContent = opportunities.length.toString();\r\n    }\r\n\r\n    comparisonDiv.innerHTML = `\r\n      \u003cdiv class=\"page-list-keyword-research__opportunities\"\u003e\r\n        \u003ch5 class=\"page-list-keyword-research__opportunities-title\"\u003e\r\n          Keywords Used by Competitors (Not on Your Site)\r\n        \u003c/h5\u003e\r\n        \u003cp class=\"page-list-keyword-research__opportunities-count\"\u003e\r\n          Found ${opportunities.length} potential keyword opportunity${opportunities.length !== 1 ? 'ies' : ''}\r\n          ${removedKeywords.size \u003e 0 ? ` (${removedKeywords.size} removed)` : ''}\r\n        \u003c/p\u003e\r\n        \u003cdiv class=\"page-list-keyword-research__opportunities-list\"\u003e\r\n          ${opportunities.slice(0, 50).map(opp =\u003e {\r\n            const keywordId = opp.keyword.toLowerCase().replace(/[^a-zA-Z0-9]/g, '_');\r\n            return `\r\n            \u003cdiv class=\"page-list-keyword-research__opportunity-item\" data-opportunity-keyword-id=\"${keywordId}\"\u003e\r\n              \u003cspan class=\"page-list-keyword-research__opportunity-keyword\"\u003e${escapeHtml(opp.keyword)}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-keyword-research__opportunity-count\"\u003eUsed ${opp.competitorCount}x by ${opp.competitors.length} competitor${opp.competitors.length !== 1 ? 's' : ''}\u003c/span\u003e\r\n              \u003cbutton \r\n                class=\"page-list-keyword-research__opportunity-remove\" \r\n                data-opportunity-keyword=\"${escapeHtml(opp.keyword)}\"\r\n                type=\"button\"\r\n                aria-label=\"Remove keyword\"\r\n                title=\"Remove this keyword\"\r\n              \u003e\r\n                \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eclose\u003c/span\u003e\r\n              \u003c/button\u003e\r\n            \u003c/div\u003e\r\n          `;\r\n          }).join('')}\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    // Attach remove button handlers\r\n    const removeButtons = comparisonDiv.querySelectorAll('.page-list-keyword-research__opportunity-remove');\r\n    removeButtons.forEach(button =\u003e {\r\n      button.addEventListener('click', (e) =\u003e {\r\n        const keyword = (e.currentTarget as HTMLElement).getAttribute('data-opportunity-keyword');\r\n        if (!keyword) return;\r\n        \r\n        const keywordLower = keyword.toLowerCase();\r\n        const keywordId = keywordLower.replace(/[^a-zA-Z0-9]/g, '_');\r\n        \r\n        // Find the opportunity item element\r\n        const opportunityItem = comparisonDiv.querySelector(`[data-opportunity-keyword-id=\"${keywordId}\"]`);\r\n        if (opportunityItem) {\r\n          // Add fade-out animation\r\n          (opportunityItem as HTMLElement).style.transition = 'opacity 0.3s ease, transform 0.3s ease';\r\n          (opportunityItem as HTMLElement).style.opacity = '0';\r\n          (opportunityItem as HTMLElement).style.transform = 'scale(0.9)';\r\n          \r\n          // Remove after animation\r\n          setTimeout(() =\u003e {\r\n            // Add to removed keywords set\r\n            removedKeywords.add(keywordLower);\r\n            saveRemovedKeywords(removedKeywords);\r\n            \r\n            // Re-render the comparison to update the list\r\n            updateComparison(sitePages);\r\n            \r\n            showToast(`Removed \"${keyword}\"`, 'success', 2000, 'page-list');\r\n          }, 300);\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  addBtn.addEventListener('click', async () =\u003e {\r\n    const url = urlInput.value.trim();\r\n    if (!url) {\r\n      showToast('Please enter a valid URL', 'error', 3000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      new URL(url); // Validate URL\r\n    } catch {\r\n      showToast('Invalid URL format', 'error', 3000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    if (competitors.some(c =\u003e c.url === url)) {\r\n      showToast('This competitor URL is already added', 'info', 3000, 'page-list');\r\n      return;\r\n    }\r\n\r\n    const competitor = { url, keywords: null, loading: true };\r\n    competitors.push(competitor);\r\n    urlInput.value = '';\r\n    renderCompetitorList();\r\n\r\n    try {\r\n      showToast(`Analyzing ${url}...`, 'info', 2000, 'page-list');\r\n      competitor.keywords = await analyzeCompetitor(url);\r\n      competitor.loading = false;\r\n      saveCompetitors();\r\n      renderCompetitorList();\r\n      updateComparison(pages);\r\n      showToast('Competitor analysis complete', 'success', 3000, 'page-list');\r\n    } catch (error) {\r\n      competitor.loading = false;\r\n      // Remove failed competitor from array\r\n      const index = competitors.indexOf(competitor);\r\n      if (index \u003e -1) {\r\n        competitors.splice(index, 1);\r\n      }\r\n      saveCompetitors();\r\n      renderCompetitorList();\r\n      showToast(`Failed to analyze competitor: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error', 5000, 'page-list');\r\n    }\r\n  });\r\n\r\n  urlInput.addEventListener('keypress', (e) =\u003e {\r\n    if (e.key === 'Enter') {\r\n      addBtn.click();\r\n    }\r\n  });\r\n\r\n  // Initial render and comparison update\r\n  renderCompetitorList();\r\n  if (competitors.length \u003e 0) {\r\n    updateComparison(pages);\r\n  }\r\n}\r\n\r\n","/**\r\n * File System Utilities (DEV-ONLY)\r\n * ============================================================================\r\n * Shared file system operations for dev tools (page-list, dev-score-bubble).\r\n * Uses File System Access API with fallbacks to HTTP fetch and backend API.\r\n * ============================================================================\r\n */\r\n\r\n// Shared directory handle (shared across all dev modules)\r\nlet siteRootDirectoryHandle: FileSystemDirectoryHandle | null = null;\r\n\r\n/**\r\n * Request access to site root directory (contains content folder)\r\n */\r\nexport async function requestSiteRootAccess(\r\n  onSuccess?: (message: string) =\u003e void,\r\n  onError?: (message: string) =\u003e void\r\n): Promise\u003cFileSystemDirectoryHandle | null\u003e {\r\n  if (!('showDirectoryPicker' in window)) {\r\n    const msg = 'File System Access API not supported. Falling back to backend API.';\r\n    console.warn(msg);\r\n    onError?.(msg);\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    console.log('Requesting directory access...');\r\n    const handle = await (window as any).showDirectoryPicker({\r\n      startIn: 'documents',\r\n      mode: 'readwrite'\r\n    });\r\n    \r\n    console.log('Directory selected, verifying content folder...');\r\n    try {\r\n      await handle.getDirectoryHandle('content', { create: false });\r\n      console.log('✅ Content directory found!');\r\n      siteRootDirectoryHandle = handle;\r\n      const msg = 'Directory access granted! You can now update source files.';\r\n      onSuccess?.(msg);\r\n      return handle;\r\n    } catch (contentError) {\r\n      console.error('❌ Selected directory does not contain a \"content\" folder');\r\n      const msg = 'Selected directory does not contain a \"content\" folder. Please select your Hugo site root directory.';\r\n      onError?.(msg);\r\n      return null;\r\n    }\r\n  } catch (error) {\r\n    if ((error as Error).name === 'AbortError') {\r\n      console.log('User cancelled directory selection');\r\n      onError?.('Directory selection cancelled.');\r\n    } else {\r\n      console.error('Error accessing directory:', error);\r\n      const msg = `Error accessing directory: ${error instanceof Error ? error.message : 'Unknown error'}`;\r\n      onError?.(msg);\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the current site root directory handle\r\n */\r\nexport function getSiteRootDirectoryHandle(): FileSystemDirectoryHandle | null {\r\n  return siteRootDirectoryHandle;\r\n}\r\n\r\n/**\r\n * Set the site root directory handle (for testing or manual setup)\r\n */\r\nexport function setSiteRootDirectoryHandle(handle: FileSystemDirectoryHandle | null): void {\r\n  siteRootDirectoryHandle = handle;\r\n}\r\n\r\n/**\r\n * Read file content using File System Access API or fetch\r\n */\r\nexport async function readFileContent(\r\n  filePath: string,\r\n  verbose: boolean = false\r\n): Promise\u003c{ content: string; lineNumber: number; actualPath: string } | null\u003e {\r\n  try {\r\n    // Method 1: File System Access API\r\n    if (siteRootDirectoryHandle) {\r\n      try {\r\n        const pathParts = filePath.replace(/^content\\//, '').split('/');\r\n        let currentHandle: FileSystemDirectoryHandle | FileSystemFileHandle = siteRootDirectoryHandle;\r\n        \r\n        if (verbose) {\r\n          console.log(`Attempting to read via File System Access API: ${filePath}`);\r\n          console.log(`Path parts:`, pathParts);\r\n        }\r\n        \r\n        // Navigate to content directory\r\n        try {\r\n          currentHandle = await (currentHandle as FileSystemDirectoryHandle).getDirectoryHandle('content');\r\n          if (verbose) console.log('✅ Found content directory');\r\n        } catch (contentError) {\r\n          if (verbose) {\r\n            console.error('❌ Could not access content directory:', contentError);\r\n            console.error('   Make sure you selected the correct site root folder (the one containing the \"content\" folder)');\r\n          }\r\n          throw contentError;\r\n        }\r\n        \r\n        // Navigate through subdirectories\r\n        for (let i = 0; i \u003c pathParts.length - 1; i++) {\r\n          if (pathParts[i]) {\r\n            try {\r\n              currentHandle = await (currentHandle as FileSystemDirectoryHandle).getDirectoryHandle(pathParts[i]);\r\n              if (verbose) console.log(`✅ Navigated to: ${pathParts[i]}`);\r\n            } catch (dirError) {\r\n              if (verbose) {\r\n                console.error(`❌ Could not access directory: ${pathParts[i]}`, dirError);\r\n                console.error(`   Path so far: content/${pathParts.slice(0, i).join('/')}`);\r\n                console.error(`   The directory \"${pathParts[i]}\" may not exist or you may not have access to it.`);\r\n              }\r\n              throw dirError;\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Get the file\r\n        const fileName = pathParts[pathParts.length - 1];\r\n        if (fileName) {\r\n          try {\r\n            const fileHandle = await (currentHandle as FileSystemDirectoryHandle).getFileHandle(fileName);\r\n            const file = await fileHandle.getFile();\r\n            const content = await file.text();\r\n            if (verbose) console.log(`✅ Successfully read file via File System Access API: ${filePath}`);\r\n            return { content, lineNumber: 0, actualPath: filePath };\r\n          } catch (fileError) {\r\n            if (verbose) {\r\n              console.error(`❌ Could not access file: ${fileName}`, fileError);\r\n              const fullPath = `content/${pathParts.join('/')}`;\r\n              console.error(`   Full path attempted: ${fullPath}`);\r\n              console.error(`   The file may not exist, or there may be a case sensitivity issue.`);\r\n            }\r\n            throw fileError;\r\n          }\r\n        }\r\n      } catch (fsError) {\r\n        // Only log if verbose, and only as a debug message, not an error\r\n        if (verbose) console.debug(`File System Access API not available for ${filePath}, trying fallback methods`);\r\n        // Continue to fallback methods\r\n      }\r\n    } else {\r\n      if (verbose) console.debug(`File System Access API not available (siteRootDirectoryHandle is null)`);\r\n    }\r\n    \r\n    // Method 2: Skip HTTP fetch for content files - Hugo doesn't serve them directly\r\n    // Only try HTTP fetch for files that might be served (e.g., static assets)\r\n    if (!filePath.startsWith('content/')) {\r\n      try {\r\n        if (verbose) console.debug(`Trying HTTP fetch for: ${filePath}`);\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() =\u003e controller.abort(), 1000); // 1 second timeout\r\n        \r\n        const response = await fetch(`/${filePath}`, {\r\n          signal: controller.signal\r\n        });\r\n        clearTimeout(timeoutId);\r\n        \r\n        if (response.ok) {\r\n          const content = await response.text();\r\n          if (verbose) console.log(`✅ Read file via HTTP fetch: ${filePath}`);\r\n          return { content, lineNumber: 0, actualPath: filePath };\r\n        }\r\n      } catch (fetchError) {\r\n        // Silently ignore fetch errors for non-content files\r\n        if (verbose \u0026\u0026 \r\n            (fetchError as Error).name !== 'AbortError' \u0026\u0026 \r\n            (fetchError as Error).name !== 'TypeError' \u0026\u0026\r\n            !(fetchError as Error).message?.includes('fetch')) {\r\n          console.debug(`Could not fetch ${filePath} from server:`, fetchError);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Method 3: Skip backend API - it doesn't exist in this setup\r\n    // The backend API endpoint /api/read-file is not implemented, so we skip it\r\n    // to avoid 404 errors in the console. File System Access API is the primary method.\r\n    \r\n    // Only log error if verbose and we've exhausted all methods\r\n    if (verbose) {\r\n      console.debug(`Could not read file ${filePath} using any method (this is expected when trying multiple paths)`);\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    // Only log unexpected errors\r\n    if (verbose) {\r\n      console.error(`Unexpected error reading file ${filePath}:`, error);\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Write file content using File System Access API or backend API\r\n */\r\nexport async function writeFileContent(filePath: string, content: string): Promise\u003cboolean\u003e {\r\n  try {\r\n    if (siteRootDirectoryHandle) {\r\n      const pathParts = filePath.replace(/^content\\//, '').split('/');\r\n      let currentHandle: FileSystemDirectoryHandle | FileSystemFileHandle = siteRootDirectoryHandle;\r\n      \r\n      currentHandle = await (currentHandle as FileSystemDirectoryHandle).getDirectoryHandle('content');\r\n      \r\n      for (let i = 0; i \u003c pathParts.length - 1; i++) {\r\n        try {\r\n          currentHandle = await (currentHandle as FileSystemDirectoryHandle).getDirectoryHandle(pathParts[i]);\r\n        } catch {\r\n          currentHandle = await (currentHandle as FileSystemDirectoryHandle).getDirectoryHandle(pathParts[i], { create: true });\r\n        }\r\n      }\r\n      \r\n      const fileName = pathParts[pathParts.length - 1];\r\n      const fileHandle = await (currentHandle as FileSystemDirectoryHandle).getFileHandle(fileName, { create: true });\r\n      const writable = await fileHandle.createWritable();\r\n      await writable.write(content);\r\n      await writable.close();\r\n      \r\n      return true;\r\n    }\r\n    \r\n    // File System Access API not available\r\n    // Note: For file writing, use manual file selection via File Picker API instead\r\n    // This function is only called when we have a file path, which requires directory access\r\n    return false;\r\n  } catch (error) {\r\n    console.error(`Error writing file ${filePath}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Find the actual file path by trying multiple possibilities\r\n */\r\nexport async function findActualFilePath(possiblePaths: string[], verbose: boolean = false): Promise\u003cstring | null\u003e {\r\n  // Check if File System Access API is available\r\n  const hasDirectoryAccess = getSiteRootDirectoryHandle() !== null;\r\n  \r\n  if (verbose \u0026\u0026 !hasDirectoryAccess) {\r\n    console.warn('⚠️ File System Access API not available. Cannot read files without directory access.');\r\n    console.info('💡 Tip: Grant directory access when prompted to enable file operations.');\r\n  }\r\n  \r\n  for (let i = 0; i \u003c possiblePaths.length; i++) {\r\n    const path = possiblePaths[i];\r\n    if (verbose) {\r\n      console.log(`[${i + 1}/${possiblePaths.length}] Trying to find file at: ${path}`);\r\n    }\r\n    // Use verbose logging only for the first path attempt to reduce console noise\r\n    // Subsequent paths will only log if they succeed\r\n    const fileData = await readFileContent(path, verbose \u0026\u0026 i === 0);\r\n    if (fileData) {\r\n      if (verbose) {\r\n        console.log(`✅ Found file at: ${fileData.actualPath} (attempt ${i + 1}/${possiblePaths.length})`);\r\n      }\r\n      return fileData.actualPath;\r\n    } else {\r\n      // Only log if verbose and it's the first attempt, or if we're on the last attempt\r\n      if (verbose \u0026\u0026 (i === 0 || i === possiblePaths.length - 1)) {\r\n        console.debug(`File not found at: ${path}${i \u003c possiblePaths.length - 1 ? ', trying next path...' : ''}`);\r\n      }\r\n    }\r\n  }\r\n  // Only log warning if we couldn't find the file in any path\r\n  if (verbose) {\r\n    if (!hasDirectoryAccess) {\r\n      console.warn(`❌ Could not find file in any of the ${possiblePaths.length} possible paths.`);\r\n      console.warn(`   File System Access API is not available. Please grant directory access to enable file operations.`);\r\n      console.info(`   Tried paths:`, possiblePaths);\r\n    } else {\r\n      console.warn(`❌ Could not find file in any of the ${possiblePaths.length} possible paths:`, possiblePaths);\r\n      console.info(`   The file may not exist at these locations, or the directory structure may be different.`);\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Create timestamped backup filename\r\n */\r\nexport function createBackupFilename(originalPath: string): string {\r\n  const now = new Date();\r\n  const timestamp = now.toISOString()\r\n    .replace(/[:.]/g, '-')\r\n    .replace('T', '-')\r\n    .slice(0, -5);\r\n  return `${originalPath}.backup-${timestamp}`;\r\n}\r\n\r\n/**\r\n * Map relPermalink to content file path\r\n */\r\nexport function relPermalinkToContentFile(relPermalink: string): string[] {\r\n  let path = relPermalink.replace(/^\\/|\\/$/g, '');\r\n  \r\n  if (!path) {\r\n    return ['content/_index.md'];\r\n  }\r\n\r\n  const possiblePaths: string[] = [];\r\n  \r\n  // Direct file: /blog/post-name -\u003e content/blog/post-name.md\r\n  possiblePaths.push(`content/${path}.md`);\r\n  \r\n  // Section index: /blog -\u003e content/blog/_index.md\r\n  possiblePaths.push(`content/${path}/_index.md`);\r\n  \r\n  // Regular index: /blog/post-name -\u003e content/blog/post-name/index.md\r\n  possiblePaths.push(`content/${path}/index.md`);\r\n\r\n  // Handle nested paths\r\n  const parts = path.split('/');\r\n  if (parts.length \u003e 1) {\r\n    const section = parts[0];\r\n    const name = parts.slice(1).join('/');\r\n    \r\n    // Section/name.md (most common for blog posts)\r\n    possiblePaths.push(`content/${section}/${name}.md`);\r\n    \r\n    // Section/name/_index.md\r\n    possiblePaths.push(`content/${section}/${name}/_index.md`);\r\n  }\r\n\r\n  // Remove duplicates and return\r\n  return [...new Set(possiblePaths)];\r\n}\r\n\r\n/**\r\n * Escape special regex characters\r\n */\r\nexport function escapeRegex(str: string): string {\r\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$\u0026');\r\n}\r\n\r\n/**\r\n * Remove link and keep only text\r\n * Handles: [text](url) -\u003e text and \u003ca href=\"url\"\u003etext\u003c/a\u003e -\u003e text\r\n */\r\nexport function removeLinkFromContent(\r\n  content: string,\r\n  url: string\r\n): { content: string; changes: Array\u003c{ oldUrl: string; newUrl: string; lineNumber: number; text: string }\u003e } {\r\n  let modifiedContent = content;\r\n  const changes: Array\u003c{ oldUrl: string; newUrl: string; lineNumber: number; text: string }\u003e = [];\r\n  \r\n  // Normalize URL for matching - handle trailing slashes and fragments\r\n  const urlNoFragment = url.split('#')[0];\r\n  const urlNoSlash = urlNoFragment.replace(/\\/$/, '');\r\n  const urlWithSlash = urlNoSlash + '/';\r\n  \r\n  // Try multiple URL variations\r\n  const urlVariations = [\r\n    url, // Original\r\n    urlNoFragment, // Without fragment\r\n    urlNoSlash, // Without trailing slash\r\n    urlWithSlash, // With trailing slash\r\n  ];\r\n  \r\n  const escapedUrl = escapeRegex(url);\r\n  \r\n  // Markdown links: [text](url) -\u003e text\r\n  const markdownPattern = new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(${escapedUrl}[^)]*\\\\)`, 'g');\r\n  const markdownMatches: Array\u003c{ index: number; match: string; text: string }\u003e = [];\r\n  \r\n  let match;\r\n  while ((match = markdownPattern.exec(content)) !== null) {\r\n    markdownMatches.push({\r\n      index: match.index,\r\n      match: match[0],\r\n      text: match[1]\r\n    });\r\n  }\r\n  \r\n  // Apply removals in reverse order\r\n  for (let i = markdownMatches.length - 1; i \u003e= 0; i--) {\r\n    const m = markdownMatches[i];\r\n    const beforeMatch = modifiedContent.substring(0, m.index);\r\n    const lineNumber = beforeMatch.split('\\n').length;\r\n    \r\n    modifiedContent = beforeMatch + m.text + modifiedContent.substring(m.index + m.match.length);\r\n    changes.push({ oldUrl: url, newUrl: '(removed)', lineNumber, text: m.text });\r\n  }\r\n  \r\n  // HTML links: \u003ca href=\"url\"\u003etext\u003c/a\u003e -\u003e text\r\n  const htmlPattern = new RegExp(`\u003ca[^\u003e]+href=[\"']${escapedUrl}[\"'][^\u003e]*\u003e([^\u003c]+)\u003c/a\u003e`, 'gi');\r\n  const htmlMatches: Array\u003c{ index: number; match: string; text: string }\u003e = [];\r\n  \r\n  while ((match = htmlPattern.exec(modifiedContent)) !== null) {\r\n    htmlMatches.push({\r\n      index: match.index,\r\n      match: match[0],\r\n      text: match[1]\r\n    });\r\n  }\r\n  \r\n  // Apply HTML removals in reverse order\r\n  for (let i = htmlMatches.length - 1; i \u003e= 0; i--) {\r\n    const m = htmlMatches[i];\r\n    const beforeMatch = modifiedContent.substring(0, m.index);\r\n    const lineNumber = beforeMatch.split('\\n').length;\r\n    \r\n    modifiedContent = beforeMatch + m.text + modifiedContent.substring(m.index + m.match.length);\r\n    changes.push({ oldUrl: url, newUrl: '(removed)', lineNumber, text: m.text });\r\n  }\r\n  \r\n  return { content: modifiedContent, changes };\r\n}\r\n\r\n","/**\r\n * Link Map Visualization Module\r\n * \r\n * Creates an interactive force-directed graph visualization of internal page links\r\n * using D3.js for graph layout and rendering.\r\n */\r\n\r\nimport { escapeHtml } from \"../utils/dev-ui\";\r\n\r\ninterface LinkMapNode {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  section: string;\r\n  parentPath: string;\r\n  inboundLinks: number;\r\n  outboundLinks: number;\r\n  isExternal?: boolean;\r\n  x?: number;\r\n  y?: number;\r\n  fx?: number | null;\r\n  fy?: number | null;\r\n}\r\n\r\ninterface LinkMapLink {\r\n  source: string | LinkMapNode;\r\n  target: string | LinkMapNode;\r\n}\r\n\r\ninterface PageData {\r\n  title: string;\r\n  relPermalink: string;\r\n  section: string;\r\n  topics?: string[];\r\n  brokenLinkUrls?: string[];\r\n  totalInternalLinks: number;\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * Extract internal links from page content\r\n * This parses the page data to find internal links\r\n */\r\nfunction extractInternalLinks(pages: PageData[]): Map\u003cstring, string[]\u003e {\r\n  const linkMap = new Map\u003cstring, string[]\u003e();\r\n  \r\n  // Initialize all pages\r\n  pages.forEach(page =\u003e {\r\n    linkMap.set(page.relPermalink, []);\r\n  });\r\n  \r\n  // Extract links from brokenLinkUrls and other sources\r\n  // For now, we'll need to parse the actual content or use a different approach\r\n  // Since we don't have direct access to the HTML content, we'll use a placeholder\r\n  // In a real implementation, you'd fetch the page content and parse it\r\n  \r\n  return linkMap;\r\n}\r\n\r\n/**\r\n * Get parent path from URL\r\n */\r\nfunction getParentPath(url: string): string {\r\n  if (url === '/') return '/';\r\n  const parts = url.split('/').filter(p =\u003e p);\r\n  if (parts.length === 0) return '/';\r\n  return '/' + parts[0] + '/';\r\n}\r\n\r\n// Color cache to avoid recalculating colors\r\nconst colorCache = new Map\u003cstring, string\u003e();\r\n\r\n/**\r\n * Generate color for section/parent path\r\n * Memoized for performance\r\n */\r\nfunction getColorForSection(section: string, parentPath: string, index: number): string {\r\n  // Use a color palette that's visually distinct\r\n  const colors = [\r\n    '#4A90E2', // Blue\r\n    '#50C878', // Green\r\n    '#FF6B6B', // Red\r\n    '#FFA500', // Orange\r\n    '#9B59B6', // Purple\r\n    '#1ABC9C', // Teal\r\n    '#E74C3C', // Dark Red\r\n    '#3498DB', // Light Blue\r\n    '#2ECC71', // Light Green\r\n    '#F39C12', // Dark Orange\r\n    '#E67E22', // Brown\r\n    '#16A085', // Dark Teal\r\n    '#8E44AD', // Dark Purple\r\n    '#34495E', // Dark Blue-Gray\r\n    '#95A5A6', // Gray\r\n    '#D35400', // Dark Orange\r\n  ];\r\n  \r\n  // Try to use section first, then parent path\r\n  const key = section || parentPath || '/';\r\n  \r\n  // Check cache first\r\n  if (colorCache.has(key)) {\r\n    return colorCache.get(key)!;\r\n  }\r\n  \r\n  // Create a simple hash from the key\r\n  let hash = 0;\r\n  for (let i = 0; i \u003c key.length; i++) {\r\n    hash = key.charCodeAt(i) + ((hash \u003c\u003c 5) - hash);\r\n  }\r\n  \r\n  // Use absolute value and modulo to get color index\r\n  const colorIndex = Math.abs(hash) % colors.length;\r\n  const color = colors[colorIndex];\r\n  \r\n  // Cache the result\r\n  colorCache.set(key, color);\r\n  return color;\r\n}\r\n\r\n/**\r\n * Build topics-based graph data structure\r\n */\r\nfunction buildTopicsGraphData(pages: PageData[], links: Map\u003cstring, string[]\u003e): { nodes: LinkMapNode[]; links: LinkMapLink[]; colorMap: Map\u003cstring, string\u003e } {\r\n  const nodes: LinkMapNode[] = [];\r\n  const linkList: LinkMapLink[] = [];\r\n  const nodeMap = new Map\u003cstring, LinkMapNode\u003e();\r\n  const colorMap = new Map\u003cstring, string\u003e();\r\n  const topicPages = new Map\u003cstring, PageData[]\u003e();\r\n  \r\n  // Group pages by topic\r\n  pages.forEach(page =\u003e {\r\n    const topics = page.topics || [];\r\n    if (topics.length === 0) {\r\n      // Pages without topics go to \"Untagged\" topic\r\n      const untaggedKey = 'untagged';\r\n      if (!topicPages.has(untaggedKey)) {\r\n        topicPages.set(untaggedKey, []);\r\n      }\r\n      topicPages.get(untaggedKey)!.push(page);\r\n    } else {\r\n      topics.forEach(topic =\u003e {\r\n        if (!topicPages.has(topic)) {\r\n          topicPages.set(topic, []);\r\n        }\r\n        topicPages.get(topic)!.push(page);\r\n      });\r\n    }\r\n  });\r\n  \r\n  // Assign colors to topics\r\n  let colorIndex = 0;\r\n  topicPages.forEach((_, topicKey) =\u003e {\r\n    if (!colorMap.has(topicKey)) {\r\n      colorMap.set(topicKey, getColorForSection(topicKey, '', colorIndex++));\r\n    }\r\n  });\r\n  \r\n  // Create topic nodes\r\n  topicPages.forEach((pagesInTopic, topicKey) =\u003e {\r\n    const topicNode: LinkMapNode = {\r\n      id: `topic:${topicKey}`,\r\n      title: topicKey === 'untagged' ? 'Untagged' : topicKey,\r\n      url: `#topic:${topicKey}`,\r\n      section: topicKey,\r\n      parentPath: topicKey,\r\n      inboundLinks: 0,\r\n      outboundLinks: 0\r\n    };\r\n    nodes.push(topicNode);\r\n    nodeMap.set(`topic:${topicKey}`, topicNode);\r\n  });\r\n  \r\n  // Build topic-to-topic links based on page links\r\n  const topicLinks = new Map\u003cstring, Set\u003cstring\u003e\u003e();\r\n  \r\n  links.forEach((targetUrls, sourceUrl) =\u003e {\r\n    const sourcePage = pages.find(p =\u003e p.relPermalink === sourceUrl);\r\n    if (!sourcePage) return;\r\n    \r\n    const sourceTopics = sourcePage.topics || [];\r\n    const sourceTopicKeys = sourceTopics.length \u003e 0 ? sourceTopics : ['untagged'];\r\n    \r\n    targetUrls.forEach(targetUrl =\u003e {\r\n      const targetPath = targetUrl.split('#')[0];\r\n      const targetPage = pages.find(p =\u003e p.relPermalink === targetPath);\r\n      if (!targetPage) return;\r\n      \r\n      const targetTopics = targetPage.topics || [];\r\n      const targetTopicKeys = targetTopics.length \u003e 0 ? targetTopics : ['untagged'];\r\n      \r\n      // Create links between all source topics and all target topics\r\n      sourceTopicKeys.forEach(sourceTopic =\u003e {\r\n        targetTopicKeys.forEach(targetTopic =\u003e {\r\n          // Only create link if topics are different\r\n          if (sourceTopic !== targetTopic) {\r\n            const sourceKey = `topic:${sourceTopic}`;\r\n            const targetKey = `topic:${targetTopic}`;\r\n            \r\n            if (!topicLinks.has(sourceKey)) {\r\n              topicLinks.set(sourceKey, new Set());\r\n            }\r\n            topicLinks.get(sourceKey)!.add(targetKey);\r\n          }\r\n        });\r\n      });\r\n    });\r\n  });\r\n  \r\n  // Create link objects and count links\r\n  topicLinks.forEach((targetTopics, sourceTopic) =\u003e {\r\n    const sourceNode = nodeMap.get(sourceTopic);\r\n    if (!sourceNode) return;\r\n    \r\n    sourceNode.outboundLinks = targetTopics.size;\r\n    \r\n    targetTopics.forEach(targetTopic =\u003e {\r\n      const targetNode = nodeMap.get(targetTopic);\r\n      if (targetNode) {\r\n        targetNode.inboundLinks++;\r\n        linkList.push({\r\n          source: sourceNode,\r\n          target: targetNode\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return { nodes, links: linkList, colorMap };\r\n}\r\n\r\n/**\r\n * Build section-based graph data structure\r\n */\r\nfunction buildSectionGraphData(pages: PageData[], links: Map\u003cstring, string[]\u003e): { nodes: LinkMapNode[]; links: LinkMapLink[]; colorMap: Map\u003cstring, string\u003e } {\r\n  const nodes: LinkMapNode[] = [];\r\n  const linkList: LinkMapLink[] = [];\r\n  const nodeMap = new Map\u003cstring, LinkMapNode\u003e();\r\n  const colorMap = new Map\u003cstring, string\u003e();\r\n  const sectionPages = new Map\u003cstring, PageData[]\u003e();\r\n  \r\n  // Group pages by section\r\n  pages.forEach(page =\u003e {\r\n    const section = page.section || '';\r\n    const parentPath = getParentPath(page.relPermalink);\r\n    const sectionKey = section || parentPath;\r\n    \r\n    if (!sectionPages.has(sectionKey)) {\r\n      sectionPages.set(sectionKey, []);\r\n    }\r\n    sectionPages.get(sectionKey)!.push(page);\r\n  });\r\n  \r\n  // Assign colors to sections\r\n  let colorIndex = 0;\r\n  sectionPages.forEach((_, sectionKey) =\u003e {\r\n    if (!colorMap.has(sectionKey)) {\r\n      const parentPath = sectionKey.startsWith('/') ? sectionKey : getParentPath('/' + sectionKey + '/');\r\n      colorMap.set(sectionKey, getColorForSection(sectionKey, parentPath, colorIndex++));\r\n    }\r\n  });\r\n  \r\n  // Create section nodes\r\n  sectionPages.forEach((pagesInSection, sectionKey) =\u003e {\r\n    const sectionNode: LinkMapNode = {\r\n      id: sectionKey,\r\n      title: sectionKey === '/' ? 'Home' : (sectionKey || 'Other'),\r\n      url: sectionKey,\r\n      section: sectionKey,\r\n      parentPath: sectionKey,\r\n      inboundLinks: 0,\r\n      outboundLinks: 0\r\n    };\r\n    nodes.push(sectionNode);\r\n    nodeMap.set(sectionKey, sectionNode);\r\n  });\r\n  \r\n  // Build section-to-section links\r\n  const sectionLinks = new Map\u003cstring, Set\u003cstring\u003e\u003e();\r\n  \r\n  links.forEach((targetUrls, sourceUrl) =\u003e {\r\n    const sourcePage = pages.find(p =\u003e p.relPermalink === sourceUrl);\r\n    if (!sourcePage) return;\r\n    \r\n    const sourceSection = sourcePage.section || getParentPath(sourcePage.relPermalink);\r\n    \r\n    targetUrls.forEach(targetUrl =\u003e {\r\n      const targetPath = targetUrl.split('#')[0];\r\n      const targetPage = pages.find(p =\u003e p.relPermalink === targetPath);\r\n      if (!targetPage) return;\r\n      \r\n      const targetSection = targetPage.section || getParentPath(targetPage.relPermalink);\r\n      \r\n      // Only create link if sections are different\r\n      if (sourceSection !== targetSection) {\r\n        if (!sectionLinks.has(sourceSection)) {\r\n          sectionLinks.set(sourceSection, new Set());\r\n        }\r\n        sectionLinks.get(sourceSection)!.add(targetSection);\r\n      }\r\n    });\r\n  });\r\n  \r\n  // Create link objects and count links\r\n  sectionLinks.forEach((targetSections, sourceSection) =\u003e {\r\n    const sourceNode = nodeMap.get(sourceSection);\r\n    if (!sourceNode) return;\r\n    \r\n    sourceNode.outboundLinks = targetSections.size;\r\n    \r\n    targetSections.forEach(targetSection =\u003e {\r\n      const targetNode = nodeMap.get(targetSection);\r\n      if (targetNode) {\r\n        targetNode.inboundLinks++;\r\n        linkList.push({\r\n          source: sourceNode,\r\n          target: targetNode\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return { nodes, links: linkList, colorMap };\r\n}\r\n\r\n/**\r\n * Extract external links from pages\r\n * This function attempts to extract external link URLs from page data\r\n */\r\nfunction extractExternalLinks(pages: PageData[]): Map\u003cstring, string[]\u003e {\r\n  const externalLinksMap = new Map\u003cstring, string[]\u003e();\r\n  const pageUrls = new Set(pages.map(p =\u003e p.relPermalink));\r\n  \r\n  pages.forEach(page =\u003e {\r\n    const externalLinks: string[] = [];\r\n    \r\n    // Try to get external links from page data if available\r\n    // This would need to be populated from page content parsing\r\n    // For now, we'll create a placeholder that can be enhanced\r\n    \r\n    // If page has external link data, use it\r\n    // Otherwise, we'll need to parse content or use a different approach\r\n    \r\n    externalLinksMap.set(page.relPermalink, externalLinks);\r\n  });\r\n  \r\n  return externalLinksMap;\r\n}\r\n\r\n/**\r\n * Build graph data structure from pages and links\r\n */\r\nfunction buildGraphData(pages: PageData[], links: Map\u003cstring, string[]\u003e): { nodes: LinkMapNode[]; links: LinkMapLink[]; colorMap: Map\u003cstring, string\u003e } {\r\n  const nodes: LinkMapNode[] = [];\r\n  const linkList: LinkMapLink[] = [];\r\n  const nodeMap = new Map\u003cstring, LinkMapNode\u003e();\r\n  const externalNodeMap = new Map\u003cstring, LinkMapNode\u003e();\r\n  const colorMap = new Map\u003cstring, string\u003e();\r\n  \r\n  // First pass: collect all unique sections/parent paths\r\n  const sections = new Set\u003cstring\u003e();\r\n  pages.forEach(page =\u003e {\r\n    const section = page.section || '';\r\n    const parentPath = getParentPath(page.relPermalink);\r\n    sections.add(section || parentPath);\r\n  });\r\n  \r\n  // Assign colors to sections\r\n  let colorIndex = 0;\r\n  sections.forEach(section =\u003e {\r\n    if (!colorMap.has(section)) {\r\n      const parentPath = section.startsWith('/') ? section : getParentPath('/' + section + '/');\r\n      colorMap.set(section, getColorForSection(section, parentPath, colorIndex++));\r\n    }\r\n  });\r\n  \r\n  // Create internal page nodes\r\n  pages.forEach(page =\u003e {\r\n    const section = page.section || '';\r\n    const parentPath = getParentPath(page.relPermalink);\r\n    const sectionKey = section || parentPath;\r\n    \r\n    const node: LinkMapNode = {\r\n      id: page.relPermalink,\r\n      title: page.title,\r\n      url: page.relPermalink,\r\n      section: section,\r\n      parentPath: parentPath,\r\n      inboundLinks: 0,\r\n      outboundLinks: 0,\r\n      isExternal: false\r\n    };\r\n    nodes.push(node);\r\n    nodeMap.set(page.relPermalink, node);\r\n    \r\n    // Ensure color is assigned\r\n    if (!colorMap.has(sectionKey)) {\r\n      colorMap.set(sectionKey, getColorForSection(section, parentPath, colorIndex++));\r\n    }\r\n  });\r\n  \r\n  // Extract and create external link nodes\r\n  const externalLinksMap = extractExternalLinksFromPages(pages);\r\n  externalLinksMap.forEach((externalUrls, sourceUrl) =\u003e {\r\n    const sourceNode = nodeMap.get(sourceUrl);\r\n    if (!sourceNode) return;\r\n    \r\n    externalUrls.forEach(externalUrl =\u003e {\r\n      // Create or get external node\r\n      let externalNode = externalNodeMap.get(externalUrl);\r\n      if (!externalNode) {\r\n        // Extract domain name for title\r\n        try {\r\n          const urlObj = new URL(externalUrl);\r\n          const domain = urlObj.hostname.replace('www.', '');\r\n          externalNode = {\r\n            id: `external:${externalUrl}`,\r\n            title: domain,\r\n            url: externalUrl,\r\n            section: 'external',\r\n            parentPath: 'external',\r\n            inboundLinks: 0,\r\n            outboundLinks: 0,\r\n            isExternal: true\r\n          };\r\n          nodes.push(externalNode);\r\n          externalNodeMap.set(externalUrl, externalNode);\r\n        } catch (e) {\r\n          // Invalid URL, skip\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // Create link from source to external node\r\n      externalNode.inboundLinks++;\r\n      sourceNode.outboundLinks++;\r\n      linkList.push({\r\n        source: sourceNode,\r\n        target: externalNode\r\n      });\r\n    });\r\n  });\r\n  \r\n  // Count internal outbound links and create link objects\r\n  links.forEach((targetUrls, sourceUrl) =\u003e {\r\n    const sourceNode = nodeMap.get(sourceUrl);\r\n    if (!sourceNode) return;\r\n    \r\n    // Count only internal links (external links already counted above)\r\n    const internalTargetUrls = targetUrls.filter(url =\u003e {\r\n      const path = url.split('#')[0];\r\n      return nodeMap.has(path);\r\n    });\r\n    \r\n    sourceNode.outboundLinks += internalTargetUrls.length;\r\n    \r\n    targetUrls.forEach(targetUrl =\u003e {\r\n      // Remove anchor fragments for matching\r\n      const targetPath = targetUrl.split('#')[0];\r\n      const targetNode = nodeMap.get(targetPath);\r\n      \r\n      if (targetNode) {\r\n        targetNode.inboundLinks++;\r\n        linkList.push({\r\n          source: sourceNode,\r\n          target: targetNode\r\n        });\r\n      }\r\n    });\r\n  });\r\n  \r\n  return { nodes, links: linkList, colorMap };\r\n}\r\n\r\n/**\r\n * Render the link map visualization\r\n */\r\nexport function renderLinkMap(container: HTMLElement, pages: PageData[]): void {\r\n  // Check if D3.js is available\r\n  if (typeof (window as any).d3 === 'undefined') {\r\n    // Load D3.js from CDN\r\n    const script = document.createElement('script');\r\n    script.src = 'https://d3js.org/d3.v7.min.js';\r\n    script.onload = () =\u003e {\r\n      initializeLinkMap(container, pages);\r\n    };\r\n    script.onerror = () =\u003e {\r\n      container.innerHTML = `\r\n        \u003cdiv class=\"page-list-link-map__error\"\u003e\r\n          \u003cp\u003eFailed to load D3.js library. Please check your internet connection.\u003c/p\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    };\r\n    document.head.appendChild(script);\r\n  } else {\r\n    initializeLinkMap(container, pages);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize the link map visualization\r\n */\r\nfunction initializeLinkMap(container: HTMLElement, pages: PageData[]): void {\r\n  const d3 = (window as any).d3;\r\n  \r\n  if (!pages || pages.length === 0) {\r\n    container.innerHTML = `\r\n      \u003cdiv class=\"page-list-link-map__empty\"\u003e\r\n        \u003cp\u003eNo pages yet—add some!\u003c/p\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    return;\r\n  }\r\n  \r\n  // Extract internal links from pages\r\n  // For now, we'll create a basic structure\r\n  // In production, you'd parse the actual HTML content\r\n  const links = extractInternalLinksFromPages(pages);\r\n  \r\n  // Build all three graph data structures\r\n  const pagesGraphData = buildGraphData(pages, links);\r\n  const sectionsGraphData = buildSectionGraphData(pages, links);\r\n  const topicsGraphData = buildTopicsGraphData(pages, links);\r\n  \r\n  // Track current view mode\r\n  type ViewMode = 'pages' | 'sections' | 'topics';\r\n  let currentViewMode: ViewMode = 'pages';\r\n  let currentGraphData = pagesGraphData;\r\n  \r\n  // Track link direction mode\r\n  type LinkDirectionMode = 'outbound' | 'inbound';\r\n  let linkDirectionMode: LinkDirectionMode = 'outbound';\r\n  \r\n  // Update overview stats (always use pages data for stats)\r\n  const totalLinks = pagesGraphData.links.length;\r\n  const avgLinks = pages.length \u003e 0 ? Math.round((totalLinks / pages.length) * 10) / 10 : 0;\r\n  const totalLinksEl = document.getElementById('page-list-link-map-total-links');\r\n  const avgLinksEl = document.getElementById('page-list-link-map-avg-links');\r\n  if (totalLinksEl) totalLinksEl.textContent = totalLinks.toString();\r\n  if (avgLinksEl) avgLinksEl.textContent = avgLinks.toString();\r\n  \r\n  // Function to build legend data based on current view mode\r\n  const buildLegendData = (viewMode: ViewMode): Array\u003c{ label: string; color: string; count: number; sectionKey: string }\u003e =\u003e {\r\n    const legendData: Array\u003c{ label: string; color: string; count: number; sectionKey: string }\u003e = [];\r\n    \r\n    if (viewMode === 'topics') {\r\n      // For topics view, count pages per topic\r\n      const topicCounts = new Map\u003cstring, number\u003e();\r\n      pages.forEach(page =\u003e {\r\n        const topics = page.topics || [];\r\n        if (topics.length === 0) {\r\n          topicCounts.set('untagged', (topicCounts.get('untagged') || 0) + 1);\r\n        } else {\r\n          topics.forEach(topic =\u003e {\r\n            topicCounts.set(topic, (topicCounts.get(topic) || 0) + 1);\r\n          });\r\n        }\r\n      });\r\n      \r\n      topicCounts.forEach((count, topic) =\u003e {\r\n        const topicKey = `topic:${topic}`;\r\n        const color = topicsGraphData.colorMap.get(topic) || '#f0f0f0';\r\n        const label = topic === 'untagged' ? 'Untagged' : topic;\r\n        legendData.push({ label, color, count, sectionKey: topicKey });\r\n      });\r\n    } else {\r\n      // For pages and sections view, use section-based legend\r\n      const sectionCounts = new Map\u003cstring, number\u003e();\r\n      pagesGraphData.nodes.forEach(node =\u003e {\r\n        const sectionKey = node.section || node.parentPath;\r\n        sectionCounts.set(sectionKey, (sectionCounts.get(sectionKey) || 0) + 1);\r\n      });\r\n      \r\n      sectionCounts.forEach((count, sectionKey) =\u003e {\r\n        const color = pagesGraphData.colorMap.get(sectionKey) || '#f0f0f0';\r\n        const label = sectionKey === '/' ? 'Home' : (sectionKey || 'Other');\r\n        legendData.push({ label, color, count, sectionKey });\r\n      });\r\n    }\r\n    \r\n    // Sort legend by count (descending)\r\n    legendData.sort((a, b) =\u003e b.count - a.count);\r\n    return legendData;\r\n  };\r\n  \r\n  // Build initial legend data\r\n  let legendData = buildLegendData(currentViewMode);\r\n  \r\n  // Clear container\r\n  container.innerHTML = `\r\n    \u003cdiv class=\"page-list-link-map\"\u003e\r\n      \u003cdiv class=\"page-list-link-map__controls\"\u003e\r\n        \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-reset\" aria-label=\"Reset zoom and pan\"\u003e\r\n          \u003cspan class=\"material-symbols-outlined\"\u003erefresh\u003c/span\u003e\r\n          Reset View\r\n        \u003c/button\u003e\r\n        \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-center\" aria-label=\"Center graph\"\u003e\r\n          \u003cspan class=\"material-symbols-outlined\"\u003ecenter_focus_strong\u003c/span\u003e\r\n          Center\r\n        \u003c/button\u003e\r\n        \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-fit\" aria-label=\"Fit to screen\"\u003e\r\n          \u003cspan class=\"material-symbols-outlined\"\u003efit_screen\u003c/span\u003e\r\n          Fit to Screen\r\n        \u003c/button\u003e\r\n        \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-heatmap-toggle\" aria-label=\"Toggle heatmap overlay\"\u003e\r\n          \u003cspan class=\"material-symbols-outlined\"\u003elayers\u003c/span\u003e\r\n          Heatmap\r\n        \u003c/button\u003e\r\n        \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-clear-focus\" aria-label=\"Clear focus\" style=\"display: none;\"\u003e\r\n          \u003cspan class=\"material-symbols-outlined\"\u003eclose\u003c/span\u003e\r\n          Clear Focus\r\n        \u003c/button\u003e\r\n        \u003cdiv class=\"page-list-link-map__link-direction-group\"\u003e\r\n          \u003cbutton class=\"page-list-link-map__control-btn page-list-link-map__control-btn--active\" id=\"link-map-link-direction-outbound\" aria-label=\"Show outbound links only\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003earrow_forward\u003c/span\u003e\r\n            Outbound\r\n          \u003c/button\u003e\r\n          \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-link-direction-inbound\" aria-label=\"Show inbound links only\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003earrow_back\u003c/span\u003e\r\n            Inbound\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-link-map__view-group\"\u003e\r\n          \u003cbutton class=\"page-list-link-map__control-btn page-list-link-map__control-btn--active\" id=\"link-map-view-pages\" aria-label=\"View pages\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003earticle\u003c/span\u003e\r\n            Pages\r\n          \u003c/button\u003e\r\n          \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-view-sections\" aria-label=\"View sections\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003eaccount_tree\u003c/span\u003e\r\n            Sections\r\n          \u003c/button\u003e\r\n          \u003cbutton class=\"page-list-link-map__control-btn\" id=\"link-map-view-topics\" aria-label=\"View topics\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\"\u003elabel\u003c/span\u003e\r\n            Topics\r\n          \u003c/button\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-link-map__search\"\u003e\r\n          \u003cinput \r\n            type=\"text\" \r\n            class=\"page-list-link-map__search-input\" \r\n            id=\"link-map-search\" \r\n            placeholder=\"Search pages...\"\r\n            aria-label=\"Search pages in link map\"\r\n          /\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-link-map__canvas-wrapper\"\u003e\r\n        \u003csvg class=\"page-list-link-map__svg\" id=\"link-map-svg\"\u003e\u003c/svg\u003e\r\n        \u003cdiv class=\"page-list-link-map__tooltip\" id=\"link-map-tooltip\"\u003e\u003c/div\u003e\r\n        \u003cdiv class=\"page-list-link-map__heatmap-legend\" id=\"link-map-heatmap-legend\" style=\"display: none;\"\u003e\r\n          \u003cdiv class=\"page-list-link-map__heatmap-legend-title\"\u003eConnectivity\u003c/div\u003e\r\n          \u003cdiv class=\"page-list-link-map__heatmap-legend-scale\"\u003e\r\n            \u003cdiv class=\"page-list-link-map__heatmap-legend-gradient\"\u003e\u003c/div\u003e\r\n            \u003cdiv class=\"page-list-link-map__heatmap-legend-labels\"\u003e\r\n              \u003cspan\u003eLow\u003c/span\u003e\r\n              \u003cspan\u003eHigh\u003c/span\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-link-map__focused-panel\" id=\"link-map-focused-panel\" style=\"display: none;\"\u003e\r\n          \u003cdiv class=\"page-list-link-map__focused-panel-header\"\u003e\r\n            \u003ch4 class=\"page-list-link-map__focused-panel-title\" id=\"link-map-focused-title\"\u003e\u003c/h4\u003e\r\n            \u003cbutton class=\"page-list-link-map__focused-panel-close\" id=\"link-map-focused-close\" aria-label=\"Close panel\"\u003e\r\n              \u003cspan class=\"material-symbols-outlined\"\u003eclose\u003c/span\u003e\r\n            \u003c/button\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"page-list-link-map__focused-panel-content\" id=\"link-map-focused-content\"\u003e\u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-link-map__legend\"\u003e\r\n        \u003ch4 class=\"page-list-link-map__legend-title\" id=\"link-map-legend-title\"\u003eSections (click to toggle)\u003c/h4\u003e\r\n        \u003cdiv class=\"page-list-link-map__legend-items\" id=\"link-map-legend-items\"\u003e\r\n          ${legendData.map(item =\u003e `\r\n            \u003clabel class=\"page-list-link-map__legend-item\" data-section-key=\"${escapeHtml(item.sectionKey)}\"\u003e\r\n              \u003cinput type=\"checkbox\" class=\"page-list-link-map__legend-checkbox\" checked aria-label=\"Toggle ${escapeHtml(item.label)}\"\u003e\r\n              \u003cspan class=\"page-list-link-map__legend-color\" style=\"background-color: ${item.color};\"\u003e\u003c/span\u003e\r\n              \u003cspan class=\"page-list-link-map__legend-label\"\u003e${escapeHtml(item.label)}\u003c/span\u003e\r\n              \u003cspan class=\"page-list-link-map__legend-count\"\u003e(${item.count})\u003c/span\u003e\r\n            \u003c/label\u003e\r\n          `).join('')}\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"page-list-link-map__stats\"\u003e\r\n        \u003cdiv class=\"page-list-link-map__stat\"\u003e\r\n          \u003cspan class=\"page-list-link-map__stat-label\" id=\"link-map-nodes-label\"\u003ePages:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__stat-value\" id=\"link-map-nodes-count\"\u003e${currentGraphData.nodes.length}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"page-list-link-map__stat\"\u003e\r\n          \u003cspan class=\"page-list-link-map__stat-label\"\u003eLinks:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__stat-value\" id=\"link-map-links-count\"\u003e${currentGraphData.links.length}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n  \r\n  const svg = d3.select('#link-map-svg');\r\n  const tooltip = d3.select('#link-map-tooltip');\r\n  const width = container.offsetWidth || 1200;\r\n  const height = Math.max(600, window.innerHeight - 300);\r\n  \r\n  svg.attr('width', width).attr('height', height);\r\n  \r\n  // Set up zoom behavior\r\n  const zoom = d3.zoom()\r\n    .scaleExtent([0.1, 4])\r\n    .on('zoom', (event: any) =\u003e {\r\n      g.attr('transform', event.transform);\r\n    });\r\n  \r\n  svg.call(zoom as any);\r\n  \r\n  // Create main group for zoom/pan\r\n  const g = svg.append('g');\r\n  \r\n  // Create arrow marker for links\r\n  g.append('defs').append('marker')\r\n    .attr('id', 'arrowhead')\r\n    .attr('viewBox', '0 -5 10 10')\r\n    .attr('refX', 30)\r\n    .attr('refY', 0)\r\n    .attr('markerWidth', 6)\r\n    .attr('markerHeight', 6)\r\n    .attr('orient', 'auto')\r\n    .append('path')\r\n    .attr('d', 'M0,-5L10,0L0,5')\r\n    .attr('fill', '#999');\r\n  \r\n  // Create force simulation with optimized settings\r\n  // Note: Collision radius will be updated dynamically when nodes are focused\r\n  let simulation = d3.forceSimulation(currentGraphData.nodes as any)\r\n    .force('link', d3.forceLink(currentGraphData.links).id((d: any) =\u003e d.id).distance(25)) // Reduced to 25 to bring clusters closer together\r\n    .force('charge', d3.forceManyBody().strength(-60)) // Reduced to -60 to bring nodes closer together\r\n    .force('center', d3.forceCenter(width / 2, height / 2))\r\n    .force('collision', d3.forceCollide().radius(35))\r\n    .alphaDecay(0.0228) // Slower decay for smoother animation\r\n    .velocityDecay(0.4); // Add friction to reduce jitter\r\n  \r\n  // Track simulation state to stop when stable\r\n  let lastAlpha = 1;\r\n  let stableTicks = 0;\r\n  \r\n  // Helper function to get node color\r\n  const getNodeColor = (node: LinkMapNode): string =\u003e {\r\n    // External nodes get a distinct color\r\n    if (node.isExternal) {\r\n      return '#FF6B6B'; // Red color for external links\r\n    }\r\n    \r\n    if (currentViewMode === 'topics') {\r\n      // For topics view, use the topic as the key\r\n      return currentGraphData.colorMap.get(node.section) || '#f0f0f0';\r\n    } else {\r\n      const sectionKey = node.section || node.parentPath;\r\n      return currentGraphData.colorMap.get(sectionKey) || '#f0f0f0';\r\n    }\r\n  };\r\n  \r\n  // Track focused node\r\n  let focusedNode: LinkMapNode | null = null;\r\n  const connectedNodeIds = new Set\u003cstring\u003e();\r\n  \r\n  // Function to rebuild connection maps (bidirectional, outbound, and inbound)\r\n  const rebuildConnectionMap = () =\u003e {\r\n    const connectionMap = new Map\u003cstring, Set\u003cstring\u003e\u003e();\r\n    const outboundMap = new Map\u003cstring, Set\u003cstring\u003e\u003e();\r\n    const inboundMap = new Map\u003cstring, Set\u003cstring\u003e\u003e();\r\n    \r\n    currentGraphData.nodes.forEach(node =\u003e {\r\n      connectionMap.set(node.id, new Set());\r\n      outboundMap.set(node.id, new Set());\r\n      inboundMap.set(node.id, new Set());\r\n    });\r\n    \r\n    currentGraphData.links.forEach((link: any) =\u003e {\r\n      const sourceId = typeof link.source === 'string' ? link.source : link.source.id;\r\n      const targetId = typeof link.target === 'string' ? link.target : link.target.id;\r\n      \r\n      // Bidirectional map (for path finding)\r\n      connectionMap.get(sourceId)?.add(targetId);\r\n      connectionMap.get(targetId)?.add(sourceId);\r\n      \r\n      // Outbound map (source -\u003e target)\r\n      outboundMap.get(sourceId)?.add(targetId);\r\n      \r\n      // Inbound map (target -\u003e source, i.e., who links to this node)\r\n      inboundMap.get(targetId)?.add(sourceId);\r\n    });\r\n    \r\n    return { connectionMap, outboundMap, inboundMap };\r\n  };\r\n  \r\n  // Pre-build connection maps for faster lookups\r\n  let { connectionMap, outboundMap, inboundMap } = rebuildConnectionMap();\r\n  \r\n  // Function to find original page data from node\r\n  const findPageData = (nodeId: string): PageData | null =\u003e {\r\n    return pages.find(p =\u003e p.relPermalink === nodeId) || null;\r\n  };\r\n\r\n  // Function to update focused panel with page details\r\n  const updateFocusedPanel = (node: LinkMapNode) =\u003e {\r\n    const panel = document.getElementById('link-map-focused-panel');\r\n    const titleEl = document.getElementById('link-map-focused-title');\r\n    const contentEl = document.getElementById('link-map-focused-content');\r\n    const heatmapLegend = document.getElementById('link-map-heatmap-legend');\r\n    \r\n    if (!panel || !titleEl || !contentEl) return;\r\n    \r\n    const pageData = findPageData(node.id);\r\n    \r\n    // Set title\r\n    titleEl.textContent = node.title;\r\n    \r\n    // Build content\r\n    let content = '';\r\n    \r\n    // URL\r\n    content += `\r\n      \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n        \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eURL:\u003c/span\u003e\r\n        \u003ca href=\"${escapeHtml(node.url)}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"page-list-link-map__focused-detail-value\"\u003e\r\n          ${escapeHtml(node.url)}\r\n        \u003c/a\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n    \r\n    // External link indicator\r\n    if (node.isExternal) {\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eType:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\" style=\"color: #FF6B6B; font-weight: 600;\"\u003eExternal Link\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }\r\n    \r\n    // Section (only for internal pages)\r\n    if (!node.isExternal \u0026\u0026 node.section) {\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eSection:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e${escapeHtml(node.section)}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }\r\n    \r\n    // Topics (if available, only for internal pages)\r\n    if (!node.isExternal \u0026\u0026 pageData \u0026\u0026 pageData.topics \u0026\u0026 pageData.topics.length \u003e 0) {\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eTopics:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e\r\n            ${pageData.topics.map(t =\u003e `\u003cspan class=\"page-list-link-map__focused-topic\"\u003e${escapeHtml(t)}\u003c/span\u003e`).join('')}\r\n          \u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }\r\n    \r\n    // Link information (only for internal pages)\r\n    if (!node.isExternal) {\r\n      // Internal link counts (from graph)\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eInternal Links (Graph):\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e\r\n            ${node.inboundLinks} inbound, ${node.outboundLinks} outbound\r\n          \u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n      \r\n      // External links (from page data)\r\n      const totalOutboundLinks = pageData?.outboundLinks || 0;\r\n      const totalInternalLinks = pageData?.totalInternalLinks || pageData?.internalLinkCount || node.outboundLinks;\r\n      const externalLinks = Math.max(0, totalOutboundLinks - totalInternalLinks);\r\n      \r\n      if (totalOutboundLinks \u003e 0) {\r\n        const dofollowExternal = pageData?.dofollowOutboundLinks || 0;\r\n        content += `\r\n          \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n            \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eExternal Links:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e\r\n              ${externalLinks}${dofollowExternal \u003e 0 ? ` (${dofollowExternal} dofollow)` : ''}\r\n            \u003c/span\u003e\r\n          \u003c/div\u003e\r\n        `;\r\n      }\r\n      \r\n      // Total outbound links summary\r\n      if (totalOutboundLinks \u003e 0) {\r\n        content += `\r\n          \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n            \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eTotal Outbound Links:\u003c/span\u003e\r\n            \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e\r\n              ${totalOutboundLinks} (${totalInternalLinks} internal, ${externalLinks} external)\r\n            \u003c/span\u003e\r\n          \u003c/div\u003e\r\n        `;\r\n      }\r\n      \r\n      // Total connections (internal)\r\n      const totalConnections = node.inboundLinks + node.outboundLinks;\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eTotal Internal Connections:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e${totalConnections}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n      \r\n      // Connected nodes count\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eConnected Nodes:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e${connectedNodeIds.size}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n      \r\n      // Link direction mode indicator\r\n      const linkDirectionLabel = linkDirectionMode === 'outbound' \r\n        ? 'Outbound links only' \r\n        : 'Inbound links only';\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eView Mode:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e${escapeHtml(linkDirectionLabel)}\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    } else {\r\n      // For external nodes, show how many pages link to it\r\n      content += `\r\n        \u003cdiv class=\"page-list-link-map__focused-detail\"\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-label\"\u003eLinked From:\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__focused-detail-value\"\u003e${node.inboundLinks} page(s)\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      `;\r\n    }\r\n    \r\n    contentEl.innerHTML = content;\r\n    panel.style.display = 'block';\r\n    \r\n    // Adjust heatmap legend position after panel is rendered\r\n    requestAnimationFrame(() =\u003e {\r\n      if (heatmapLegend \u0026\u0026 heatmapEnabled) {\r\n        const panelHeight = panel.offsetHeight || 200;\r\n        heatmapLegend.style.top = `${panelHeight + 1.5}rem`;\r\n      }\r\n    });\r\n  };\r\n\r\n  // Function to focus on a node\r\n  const focusNode = (targetNode: LinkMapNode) =\u003e {\r\n    // Clear previous focus\r\n    if (focusedNode) {\r\n      clearFocus();\r\n    }\r\n    \r\n    focusedNode = targetNode;\r\n    connectedNodeIds.clear();\r\n    \r\n    // Find connected nodes based on link direction mode\r\n    let connections: Set\u003cstring\u003e | undefined;\r\n    if (linkDirectionMode === 'outbound') {\r\n      connections = outboundMap.get(targetNode.id);\r\n    } else {\r\n      // 'inbound' mode\r\n      connections = inboundMap.get(targetNode.id);\r\n    }\r\n    \r\n    if (connections) {\r\n      connections.forEach(id =\u003e connectedNodeIds.add(id));\r\n    }\r\n    \r\n    // Show clear focus button\r\n    const clearFocusBtn = document.getElementById('link-map-clear-focus');\r\n    if (clearFocusBtn) {\r\n      clearFocusBtn.style.display = 'flex';\r\n    }\r\n    \r\n    // Update focused panel\r\n    updateFocusedPanel(targetNode);\r\n    \r\n    // Get connected node objects\r\n    const connectedNodes: LinkMapNode[] = [];\r\n    connectedNodeIds.forEach(id =\u003e {\r\n      const node = currentGraphData.nodes.find(n =\u003e n.id === id);\r\n      if (node) connectedNodes.push(node);\r\n    });\r\n    \r\n    // Get current position of the focused node (or use a default if not positioned yet)\r\n    const targetNodeData = targetNode as any;\r\n    const currentX = targetNodeData.x !== undefined \u0026\u0026 targetNodeData.x !== null \r\n      ? targetNodeData.x \r\n      : (width / 2);\r\n    const currentY = targetNodeData.y !== undefined \u0026\u0026 targetNodeData.y !== null \r\n      ? targetNodeData.y \r\n      : (height / 2);\r\n    \r\n    // Fix the focused node at its current position\r\n    targetNodeData.fx = currentX;\r\n    targetNodeData.fy = currentY;\r\n    \r\n    // Arrange connected nodes in concentric rings around the focused node\r\n    // This prevents overlapping when there are many connected nodes\r\n    if (connectedNodes.length \u003e 0) {\r\n      const nodeRadius = 30; // Radius of connected nodes\r\n      const minSpacing = 80; // Minimum distance between nodes (center to center)\r\n      const ringSpacing = 100; // Distance between rings\r\n      \r\n      // Calculate how many nodes can fit in each ring\r\n      // Circumference = 2 * π * radius, nodes needed = circumference / minSpacing\r\n      const calculateNodesPerRing = (ringRadius: number): number =\u003e {\r\n        const circumference = 2 * Math.PI * ringRadius;\r\n        return Math.max(1, Math.floor(circumference / minSpacing));\r\n      };\r\n      \r\n      // Arrange nodes in rings\r\n      let nodeIndex = 0;\r\n      let ringNumber = 0;\r\n      \r\n      while (nodeIndex \u003c connectedNodes.length) {\r\n        const ringRadius = ringSpacing * (ringNumber + 1); // First ring at ringSpacing, second at 2*ringSpacing, etc.\r\n        const nodesInRing = calculateNodesPerRing(ringRadius);\r\n        const nodesToPlace = Math.min(nodesInRing, connectedNodes.length - nodeIndex);\r\n        \r\n        if (nodesToPlace === 0) break;\r\n        \r\n        const angleStep = (2 * Math.PI) / nodesToPlace;\r\n        \r\n        for (let i = 0; i \u003c nodesToPlace \u0026\u0026 nodeIndex \u003c connectedNodes.length; i++) {\r\n          const angle = i * angleStep;\r\n          const connectedNode = connectedNodes[nodeIndex];\r\n          const connectedNodeData = connectedNode as any;\r\n          connectedNodeData.fx = currentX + Math.cos(angle) * ringRadius;\r\n          connectedNodeData.fy = currentY + Math.sin(angle) * ringRadius;\r\n          nodeIndex++;\r\n        }\r\n        \r\n        ringNumber++;\r\n      }\r\n    }\r\n    \r\n    // Freeze all background nodes (nodes that are not focused and not connected)\r\n    currentGraphData.nodes.forEach(node =\u003e {\r\n      const nodeData = node as any;\r\n      // Only freeze if it's not the focused node and not a connected node\r\n      if (node.id !== targetNode.id \u0026\u0026 !connectedNodeIds.has(node.id)) {\r\n        // Fix at current position if it has one, otherwise leave it\r\n        if (nodeData.x !== undefined \u0026\u0026 nodeData.x !== null \u0026\u0026 \r\n            nodeData.y !== undefined \u0026\u0026 nodeData.y !== null) {\r\n          nodeData.fx = nodeData.x;\r\n          nodeData.fy = nodeData.y;\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Restart simulation to apply fixed positions\r\n    simulation.alpha(1).restart();\r\n    \r\n    // Wait for simulation to position nodes, then fit to viewport\r\n    setTimeout(() =\u003e {\r\n      fitEntireGraphToViewport([targetNode, ...connectedNodes]);\r\n    }, 100);\r\n    \r\n    // Update node and link styles\r\n    updateFocusStyles();\r\n  };\r\n  \r\n  // Function to clear focus\r\n  const clearFocus = () =\u003e {\r\n    // Unfix all node positions (focused, connected, and background)\r\n    if (focusedNode) {\r\n      const focusedNodeData = focusedNode as any;\r\n      focusedNodeData.fx = null;\r\n      focusedNodeData.fy = null;\r\n    }\r\n    \r\n    connectedNodeIds.forEach(id =\u003e {\r\n      const node = currentGraphData.nodes.find(n =\u003e n.id === id);\r\n      if (node) {\r\n        const nodeData = node as any;\r\n        nodeData.fx = null;\r\n        nodeData.fy = null;\r\n      }\r\n    });\r\n    \r\n    // Unfreeze all background nodes\r\n    currentGraphData.nodes.forEach(node =\u003e {\r\n      const nodeData = node as any;\r\n      if (nodeData.fx !== null \u0026\u0026 nodeData.fx !== undefined) {\r\n        // Only unfix if it was a background node (not focused, not connected)\r\n        if (focusedNode \u0026\u0026 node.id !== focusedNode.id \u0026\u0026 !connectedNodeIds.has(node.id)) {\r\n          nodeData.fx = null;\r\n          nodeData.fy = null;\r\n        }\r\n      }\r\n    });\r\n    \r\n    focusedNode = null;\r\n    connectedNodeIds.clear();\r\n    \r\n    // Hide clear focus button\r\n    const clearFocusBtn = document.getElementById('link-map-clear-focus');\r\n    if (clearFocusBtn) {\r\n      clearFocusBtn.style.display = 'none';\r\n    }\r\n    \r\n    // Hide focused panel\r\n    const focusedPanel = document.getElementById('link-map-focused-panel');\r\n    if (focusedPanel) {\r\n      focusedPanel.style.display = 'none';\r\n    }\r\n    \r\n    // Reset heatmap legend position\r\n    const heatmapLegend = document.getElementById('link-map-heatmap-legend');\r\n    if (heatmapLegend \u0026\u0026 heatmapEnabled) {\r\n      heatmapLegend.style.top = '1rem';\r\n    }\r\n    \r\n    // Restart simulation to let nodes move freely again\r\n    simulation.alpha(1).restart();\r\n    \r\n    updateFocusStyles();\r\n  };\r\n  \r\n  // Cache for computed colors to avoid repeated calculations\r\n  const nodeColorCache = new Map\u003cstring, string\u003e();\r\n  const getCachedNodeColor = (node: LinkMapNode): string =\u003e {\r\n    if (!nodeColorCache.has(node.id)) {\r\n      nodeColorCache.set(node.id, getNodeColor(node));\r\n    }\r\n    return nodeColorCache.get(node.id)!;\r\n  };\r\n  \r\n  // Cache for brighter colors\r\n  const brighterColorCache = new Map\u003cstring, string\u003e();\r\n  const getBrighterColor = (baseColor: string, amount: number): string =\u003e {\r\n    const cacheKey = `${baseColor}-${amount}`;\r\n    if (!brighterColorCache.has(cacheKey)) {\r\n      brighterColorCache.set(cacheKey, d3.rgb(baseColor).brighter(amount).toString());\r\n    }\r\n    return brighterColorCache.get(cacheKey)!;\r\n  };\r\n  \r\n  // Function to update styles based on focus\r\n  // Optimized to batch DOM updates and use cached values\r\n  const updateFocusStyles = () =\u003e {\r\n    const focusedId = focusedNode?.id;\r\n    const hasFocus = !!focusedNode;\r\n    \r\n    // Batch node updates - handle both circles and rectangles\r\n    node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n      const isFocused = hasFocus \u0026\u0026 d.id === focusedId;\r\n      const isConnected = hasFocus \u0026\u0026 connectedNodeIds.has(d.id);\r\n      const el = d3.select(this);\r\n      const isExternal = d.isExternal || false;\r\n      \r\n      if (isFocused) {\r\n        // Focused node: bigger and fully opaque\r\n        if (isExternal) {\r\n          el.attr('width', 100)\r\n            .attr('height', 100)\r\n            .attr('x', -50)\r\n            .attr('y', -50);\r\n        } else {\r\n          el.attr('r', 50);\r\n        }\r\n        el.attr('fill', getBrighterColor(getCachedNodeColor(d), 0.5))\r\n          .attr('stroke-width', 4)\r\n          .attr('opacity', 1)\r\n          .classed('page-list-link-map__node--focused', true)\r\n          .classed('page-list-link-map__node--connected', false)\r\n          .classed('page-list-link-map__node--unconnected', false);\r\n      } else if (isConnected) {\r\n        // Connected nodes: more opaque\r\n        if (isExternal) {\r\n          el.attr('width', 60)\r\n            .attr('height', 60)\r\n            .attr('x', -30)\r\n            .attr('y', -30);\r\n        } else {\r\n          el.attr('r', 30);\r\n        }\r\n        el.attr('fill', getBrighterColor(getCachedNodeColor(d), 0.3))\r\n          .attr('stroke-width', 3)\r\n          .attr('opacity', 1)\r\n          .classed('page-list-link-map__node--focused', false)\r\n          .classed('page-list-link-map__node--connected', true)\r\n          .classed('page-list-link-map__node--unconnected', false);\r\n      } else {\r\n        // Background nodes: dimmed and frozen\r\n        if (isExternal) {\r\n          el.attr('width', 50)\r\n            .attr('height', 50)\r\n            .attr('x', -25)\r\n            .attr('y', -25);\r\n        } else {\r\n          el.attr('r', 25);\r\n        }\r\n        el.attr('fill', getCachedNodeColor(d))\r\n          .attr('stroke-width', 2)\r\n          .attr('opacity', hasFocus ? 0.2 : 1)\r\n          .classed('page-list-link-map__node--focused', false)\r\n          .classed('page-list-link-map__node--connected', false)\r\n          .classed('page-list-link-map__node--unconnected', hasFocus);\r\n      }\r\n    });\r\n    \r\n    // Batch link updates with different colors for outbound vs inbound\r\n    link.each(function(this: SVGLineElement, d: any) {\r\n      const sourceId = typeof d.source === 'string' ? d.source : d.source.id;\r\n      const targetId = typeof d.target === 'string' ? d.target : d.target.id;\r\n      const el = d3.select(this);\r\n      \r\n      // Define colors for outbound and inbound links\r\n      const outboundColor = '#4A90E2'; // Blue for outbound (forward)\r\n      const inboundColor = '#FF6B6B';  // Red/Orange for inbound (backward)\r\n      const neutralColor = '#999';     // Gray for neutral/unfocused links\r\n      \r\n      if (hasFocus \u0026\u0026 focusedId) {\r\n        // Determine if this link should be shown based on link direction mode\r\n        let isConnected = false;\r\n        let isOutbound = false;\r\n        let isInbound = false;\r\n        \r\n        if (linkDirectionMode === 'outbound') {\r\n          // Only show links where focused node is the source\r\n          isConnected = sourceId === focusedId \u0026\u0026 connectedNodeIds.has(targetId);\r\n          isOutbound = isConnected;\r\n        } else {\r\n          // 'inbound' mode - only show links where focused node is the target\r\n          isConnected = targetId === focusedId \u0026\u0026 connectedNodeIds.has(sourceId);\r\n          isInbound = isConnected;\r\n        }\r\n        \r\n        if (isConnected) {\r\n          // Use different colors for outbound vs inbound\r\n          const linkColor = isOutbound ? outboundColor : inboundColor;\r\n          el.attr('stroke', linkColor)\r\n            .attr('stroke-width', 2)\r\n            .attr('opacity', 1);\r\n        } else {\r\n          el.attr('stroke', '#ccc')\r\n            .attr('stroke-width', 0.5)\r\n            .attr('opacity', 0); // Hide unconnected links when focused\r\n        }\r\n      } else {\r\n        // No focus - show all links with direction-based colors\r\n        // Use lighter versions of outbound/inbound colors for general view\r\n        const outboundColorLight = '#7BB3F0'; // Lighter blue for outbound\r\n        const inboundColorLight = '#FF9999';  // Lighter red for inbound\r\n        \r\n        // For general view, we can show direction by using different colors\r\n        // Since we don't have a reference node, we'll use a subtle color difference\r\n        // or we can use the neutral color for all\r\n        // Actually, let's use a subtle gradient: lighter blue for all links\r\n        // Or better: use the outbound color (blue) as default since arrows show direction\r\n        el.attr('stroke', outboundColorLight)\r\n          .attr('stroke-width', 1)\r\n          .attr('opacity', 1);\r\n      }\r\n    });\r\n    \r\n    // Batch label updates\r\n    label.each(function(this: SVGTextElement, d: LinkMapNode) {\r\n      const isFocused = hasFocus \u0026\u0026 d.id === focusedId;\r\n      const isConnected = hasFocus \u0026\u0026 connectedNodeIds.has(d.id);\r\n      const el = d3.select(this);\r\n      \r\n      if (isFocused) {\r\n        el.attr('font-size', '14px')\r\n          .attr('font-weight', 'bold')\r\n          .attr('opacity', 1);\r\n      } else if (isConnected) {\r\n        el.attr('font-size', '13px')\r\n          .attr('font-weight', '600')\r\n          .attr('opacity', 1);\r\n      } else {\r\n        el.attr('font-size', '12px')\r\n          .attr('font-weight', 'bold')\r\n          .attr('opacity', hasFocus ? 0 : 1); // Hide unconnected labels when focused\r\n      }\r\n    });\r\n  };\r\n  \r\n  // Draw links\r\n  let link = g.append('g')\r\n    .attr('class', 'page-list-link-map__links')\r\n    .selectAll('line')\r\n    .data(currentGraphData.links)\r\n    .enter()\r\n    .append('line')\r\n    .attr('class', 'page-list-link-map__link')\r\n    .attr('stroke', '#7BB3F0') // Lighter blue for outbound links (default)\r\n    .attr('stroke-width', 1)\r\n    .attr('marker-end', 'url(#arrowhead)');\r\n  \r\n  // Draw nodes - use circles for internal, squares for external\r\n  const nodeGroup = g.append('g').attr('class', 'page-list-link-map__nodes');\r\n  \r\n  // Create circles for internal nodes\r\n  const internalNodes = nodeGroup\r\n    .selectAll('circle.page-list-link-map__node--internal')\r\n    .data(currentGraphData.nodes.filter(d =\u003e !d.isExternal))\r\n    .enter()\r\n    .append('circle')\r\n    .attr('class', 'page-list-link-map__node page-list-link-map__node--internal')\r\n    .attr('r', 25)\r\n    .attr('fill', (d: LinkMapNode) =\u003e getNodeColor(d))\r\n    .attr('stroke', '#333')\r\n    .attr('stroke-width', 2);\r\n  \r\n  // Create squares for external nodes\r\n  const externalNodes = nodeGroup\r\n    .selectAll('rect.page-list-link-map__node--external')\r\n    .data(currentGraphData.nodes.filter(d =\u003e d.isExternal))\r\n    .enter()\r\n    .append('rect')\r\n    .attr('class', 'page-list-link-map__node page-list-link-map__node--external')\r\n    .attr('width', 50)\r\n    .attr('height', 50)\r\n    .attr('x', -25)\r\n    .attr('y', -25)\r\n    .attr('fill', (d: LinkMapNode) =\u003e getNodeColor(d))\r\n    .attr('stroke', '#333')\r\n    .attr('stroke-width', 2);\r\n  \r\n  // Combine both selections for event handlers\r\n  let node = internalNodes.merge(externalNodes)\r\n    .attr('tabindex', 0)\r\n    .attr('role', 'button')\r\n    .attr('aria-label', (d: LinkMapNode) =\u003e `Page: ${d.title}. Click to focus.`)\r\n    .call(drag(simulation, d3) as any)\r\n    .on('mouseover', function(this: SVGCircleElement | SVGRectElement, event: MouseEvent, d: LinkMapNode) {\r\n      // Show hover effect only if not focused or if hovering over unconnected node\r\n      const isFocused = focusedNode \u0026\u0026 d.id === focusedNode.id;\r\n      const isConnected = focusedNode \u0026\u0026 connectedNodeIds.has(d.id);\r\n      const el = d3.select(this);\r\n      const isExternal = d.isExternal || false;\r\n      \r\n      if (!focusedNode) {\r\n        // No focus - normal hover (brighten section color)\r\n        const baseColor = getNodeColor(d);\r\n        if (isExternal) {\r\n          el.attr('width', 70)\r\n            .attr('height', 70)\r\n            .attr('x', -35)\r\n            .attr('y', -35);\r\n        } else {\r\n          el.attr('r', 35);\r\n        }\r\n        el.attr('fill', d3.rgb(baseColor).brighter(0.5).toString());\r\n      } else if (!isFocused \u0026\u0026 !isConnected) {\r\n        // Hovering over unconnected node - show it slightly\r\n        if (isExternal) {\r\n          el.attr('width', 56)\r\n            .attr('height', 56)\r\n            .attr('x', -28)\r\n            .attr('y', -28);\r\n        } else {\r\n          el.attr('r', 28);\r\n        }\r\n        el.attr('opacity', 0.6);\r\n      }\r\n      \r\n      // Build tooltip content based on view mode\r\n      let tooltipContent = `\r\n        \u003cdiv class=\"page-list-link-map__tooltip-content\"\u003e\r\n          \u003cstrong\u003e${escapeHtml(d.title)}\u003c/strong\u003e${d.isExternal ? ' \u003cspan style=\"color: #FF6B6B;\"\u003e(External)\u003c/span\u003e' : ''}\u003cbr/\u003e\r\n      `;\r\n      \r\n      if (d.isExternal) {\r\n        tooltipContent += `\r\n          \u003cspan class=\"page-list-link-map__tooltip-url\"\u003e${escapeHtml(d.url)}\u003c/span\u003e\u003cbr/\u003e\r\n          \u003cspan class=\"page-list-link-map__tooltip-stats\"\u003e\r\n            External Link\r\n          \u003c/span\u003e\r\n        `;\r\n      } else if (currentViewMode === 'topics') {\r\n        // For topics view, show page count\r\n        const topicKey = d.section;\r\n        const pageCount = pages.filter(p =\u003e {\r\n          const pageTopics = p.topics || [];\r\n          return topicKey === 'untagged' \r\n            ? pageTopics.length === 0 \r\n            : pageTopics.includes(topicKey);\r\n        }).length;\r\n        tooltipContent += `\r\n          \u003cspan class=\"page-list-link-map__tooltip-url\"\u003eTopic: ${escapeHtml(d.section === 'untagged' ? 'Untagged' : d.section)}\u003c/span\u003e\u003cbr/\u003e\r\n          \u003cspan class=\"page-list-link-map__tooltip-stats\"\u003e\r\n            Pages: ${pageCount} | Inbound: ${d.inboundLinks} | Outbound: ${d.outboundLinks}\r\n          \u003c/span\u003e\r\n        `;\r\n      } else {\r\n        tooltipContent += `\r\n          \u003cspan class=\"page-list-link-map__tooltip-url\"\u003e${escapeHtml(d.url)}\u003c/span\u003e\u003cbr/\u003e\r\n          \u003cspan class=\"page-list-link-map__tooltip-stats\"\u003e\r\n            Inbound: ${d.inboundLinks} | Outbound: ${d.outboundLinks}\r\n          \u003c/span\u003e\r\n        `;\r\n      }\r\n      \r\n      tooltipContent += `\r\n            ${isFocused ? '\u003cbr/\u003e\u003cspan style=\"color: #4A90E2; font-weight: 600;\"\u003eFocused - Click again to clear\u003c/span\u003e' : ''}\r\n            ${isConnected ? '\u003cbr/\u003e\u003cspan style=\"color: #7BB3F0;\"\u003eConnected to focused node\u003c/span\u003e' : ''}\r\n          \u003c/div\u003e\r\n        `;\r\n      \r\n      tooltip\r\n        .style('opacity', 1)\r\n        .html(tooltipContent)\r\n        .style('left', (event.pageX + 10) + 'px')\r\n        .style('top', (event.pageY - 10) + 'px');\r\n    })\r\n    .on('mouseout', function(event: MouseEvent, d: LinkMapNode) {\r\n      // Reset hover effect - updateFocusStyles will restore correct state\r\n      updateFocusStyles();\r\n      tooltip.style('opacity', 0);\r\n    })\r\n    .on('click', (event: MouseEvent, d: LinkMapNode) =\u003e {\r\n      event.stopPropagation();\r\n      \r\n      // Path finding mode (Ctrl/Cmd + click)\r\n      if (event.ctrlKey || event.metaKey) {\r\n        if (selectedNodesForPath.length === 0 || selectedNodesForPath.length === 1) {\r\n          if (selectedNodesForPath.length === 0 || selectedNodesForPath[0].id !== d.id) {\r\n            selectedNodesForPath.push(d);\r\n            // Check length after push (use type assertion to avoid type narrowing issue)\r\n            if ((selectedNodesForPath.length as number) === 2) {\r\n              // Find shortest path\r\n              const path = findShortestPath(selectedNodesForPath[0].id, selectedNodesForPath[1].id);\r\n              highlightPath(path);\r\n              selectedNodesForPath = []; // Reset after showing path\r\n            }\r\n          }\r\n        }\r\n        return;\r\n      }\r\n      \r\n      // Normal focus behavior\r\n      clearPathHighlight();\r\n      if (focusedNode \u0026\u0026 d.id === focusedNode.id) {\r\n        // Double-click to clear focus\r\n        clearFocus();\r\n        // Reset zoom\r\n        svg.transition()\r\n          .duration(750)\r\n          .call(zoom.transform as any, d3.zoomIdentity);\r\n      } else {\r\n        focusNode(d);\r\n      }\r\n    })\r\n    .on('keydown', (event: KeyboardEvent, d: LinkMapNode) =\u003e {\r\n      if (event.key === 'Enter' || event.key === ' ') {\r\n        event.preventDefault();\r\n        if (focusedNode \u0026\u0026 d.id === focusedNode.id) {\r\n          clearFocus();\r\n        } else {\r\n          focusNode(d);\r\n        }\r\n      }\r\n    });\r\n  \r\n  // Clear focus button\r\n  const clearFocusBtn = document.getElementById('link-map-clear-focus');\r\n  if (clearFocusBtn) {\r\n    clearFocusBtn.addEventListener('click', () =\u003e {\r\n      clearFocus();\r\n      svg.transition()\r\n        .duration(750)\r\n        .call(zoom.transform as any, d3.zoomIdentity);\r\n    });\r\n  }\r\n  \r\n  // Focused panel close button\r\n  const focusedPanelCloseBtn = document.getElementById('link-map-focused-close');\r\n  if (focusedPanelCloseBtn) {\r\n    focusedPanelCloseBtn.addEventListener('click', () =\u003e {\r\n      clearFocus();\r\n      svg.transition()\r\n        .duration(750)\r\n        .call(zoom.transform as any, d3.zoomIdentity);\r\n    });\r\n  }\r\n  \r\n  // Clear focus when clicking on background\r\n  svg.on('click', function(event: MouseEvent) {\r\n    if ((event.target as any).tagName === 'svg' || (event.target as any).classList.contains('page-list-link-map__svg')) {\r\n      clearFocus();\r\n      svg.transition()\r\n        .duration(750)\r\n        .call(zoom.transform as any, d3.zoomIdentity);\r\n    }\r\n  });\r\n  \r\n  // Add labels\r\n  let label = g.append('g')\r\n    .attr('class', 'page-list-link-map__labels')\r\n    .selectAll('text')\r\n    .data(currentGraphData.nodes)\r\n    .enter()\r\n    .append('text')\r\n    .attr('class', 'page-list-link-map__label')\r\n    .attr('text-anchor', 'middle')\r\n    .attr('dy', 40)\r\n    .attr('font-size', '12px')\r\n    .attr('font-weight', 'bold')\r\n    .attr('fill', '#333')\r\n    .text((d: LinkMapNode) =\u003e {\r\n      const text = d.title.length \u003e 20 ? d.title.substring(0, 20) + '...' : d.title;\r\n      return text;\r\n    });\r\n  \r\n  // Function to switch between pages, sections, and topics view\r\n  const switchView = (targetMode: ViewMode) =\u003e {\r\n    // Don't switch if already in target mode\r\n    if (currentViewMode === targetMode) {\r\n      return;\r\n    }\r\n    \r\n    // Clear focus\r\n    if (focusedNode) {\r\n      clearFocus();\r\n    }\r\n    \r\n    // Set view mode and graph data\r\n    currentViewMode = targetMode;\r\n    if (currentViewMode === 'pages') {\r\n      currentGraphData = pagesGraphData;\r\n    } else if (currentViewMode === 'sections') {\r\n      currentGraphData = sectionsGraphData;\r\n    } else {\r\n      currentGraphData = topicsGraphData;\r\n    }\r\n    \r\n    // Update button active states\r\n    const pagesBtn = document.getElementById('link-map-view-pages');\r\n    const sectionsBtn = document.getElementById('link-map-view-sections');\r\n    const topicsBtn = document.getElementById('link-map-view-topics');\r\n    \r\n    if (pagesBtn) {\r\n      pagesBtn.classList.toggle('page-list-link-map__control-btn--active', currentViewMode === 'pages');\r\n    }\r\n    if (sectionsBtn) {\r\n      sectionsBtn.classList.toggle('page-list-link-map__control-btn--active', currentViewMode === 'sections');\r\n    }\r\n    if (topicsBtn) {\r\n      topicsBtn.classList.toggle('page-list-link-map__control-btn--active', currentViewMode === 'topics');\r\n    }\r\n    \r\n    // Update stats\r\n    const nodesLabelEl = document.getElementById('link-map-nodes-label');\r\n    const nodesCountEl = document.getElementById('link-map-nodes-count');\r\n    const linksCountEl = document.getElementById('link-map-links-count');\r\n    if (nodesLabelEl) {\r\n      if (currentViewMode === 'pages') {\r\n        nodesLabelEl.textContent = 'Pages:';\r\n      } else if (currentViewMode === 'sections') {\r\n        nodesLabelEl.textContent = 'Sections:';\r\n      } else {\r\n        nodesLabelEl.textContent = 'Topics:';\r\n      }\r\n    }\r\n    if (nodesCountEl) nodesCountEl.textContent = currentGraphData.nodes.length.toString();\r\n    if (linksCountEl) linksCountEl.textContent = currentGraphData.links.length.toString();\r\n    \r\n    // Update legend\r\n    legendData = buildLegendData(currentViewMode);\r\n    const legendTitleEl = document.getElementById('link-map-legend-title');\r\n    const legendItemsEl = document.getElementById('link-map-legend-items');\r\n    if (legendTitleEl) {\r\n      if (currentViewMode === 'topics') {\r\n        legendTitleEl.textContent = 'Topics (click to toggle)';\r\n      } else {\r\n        legendTitleEl.textContent = 'Sections (click to toggle)';\r\n      }\r\n    }\r\n    if (legendItemsEl) {\r\n      legendItemsEl.innerHTML = legendData.map(item =\u003e `\r\n        \u003clabel class=\"page-list-link-map__legend-item\" data-section-key=\"${escapeHtml(item.sectionKey)}\"\u003e\r\n          \u003cinput type=\"checkbox\" class=\"page-list-link-map__legend-checkbox\" checked aria-label=\"Toggle ${escapeHtml(item.label)}\"\u003e\r\n          \u003cspan class=\"page-list-link-map__legend-color\" style=\"background-color: ${item.color};\"\u003e\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__legend-label\"\u003e${escapeHtml(item.label)}\u003c/span\u003e\r\n          \u003cspan class=\"page-list-link-map__legend-count\"\u003e(${item.count})\u003c/span\u003e\r\n        \u003c/label\u003e\r\n      `).join('');\r\n    }\r\n    \r\n    // Update selected sections set\r\n    selectedSections.clear();\r\n    legendData.forEach(item =\u003e {\r\n      selectedSections.add(item.sectionKey);\r\n    });\r\n    \r\n    // Re-attach event listeners to new legend items\r\n    const newLegendItems = container.querySelectorAll('.page-list-link-map__legend-item');\r\n    newLegendItems.forEach(item =\u003e {\r\n      const checkbox = item.querySelector('.page-list-link-map__legend-checkbox') as HTMLInputElement;\r\n      const sectionKey = item.getAttribute('data-section-key');\r\n      \r\n      if (checkbox \u0026\u0026 sectionKey) {\r\n        checkbox.addEventListener('change', () =\u003e {\r\n          if (checkbox.checked) {\r\n            selectedSections.add(sectionKey);\r\n          } else {\r\n            selectedSections.delete(sectionKey);\r\n          }\r\n          updateSectionVisibility();\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Update search data and placeholder\r\n    nodeSearchData = buildSearchData();\r\n    const searchInputEl = document.getElementById('link-map-search') as HTMLInputElement;\r\n    if (searchInputEl) {\r\n      if (currentViewMode === 'topics') {\r\n        searchInputEl.placeholder = 'Search topics...';\r\n      } else if (currentViewMode === 'sections') {\r\n        searchInputEl.placeholder = 'Search sections...';\r\n      } else {\r\n        searchInputEl.placeholder = 'Search pages...';\r\n      }\r\n      // Clear search input when switching views\r\n      searchInputEl.value = '';\r\n      updateFocusStyles();\r\n    }\r\n    \r\n    // Clear path highlighting when switching views\r\n    clearPathHighlight();\r\n    \r\n    // Update heatmap if enabled\r\n    if (heatmapEnabled) {\r\n      updateHeatmap();\r\n    }\r\n    \r\n    // Stop current simulation\r\n    simulation.stop();\r\n    \r\n    // Remove existing elements\r\n    link.remove();\r\n    node.remove();\r\n    label.remove();\r\n    \r\n    // Rebuild connection maps\r\n    const connectionMaps = rebuildConnectionMap();\r\n    connectionMap = connectionMaps.connectionMap;\r\n    outboundMap = connectionMaps.outboundMap;\r\n    inboundMap = connectionMaps.inboundMap;\r\n    \r\n    // Recreate links\r\n    link = g.append('g')\r\n      .attr('class', 'page-list-link-map__links')\r\n      .selectAll('line')\r\n      .data(currentGraphData.links)\r\n      .enter()\r\n      .append('line')\r\n      .attr('class', 'page-list-link-map__link')\r\n      .attr('stroke', '#7BB3F0') // Lighter blue for outbound links (default)\r\n      .attr('stroke-width', 1)\r\n      .attr('marker-end', 'url(#arrowhead)');\r\n    \r\n    // Recreate nodes - use circles for internal, squares for external\r\n    const newNodeGroup = g.append('g').attr('class', 'page-list-link-map__nodes');\r\n    \r\n    // Create circles for internal nodes\r\n    const newInternalNodes = newNodeGroup\r\n      .selectAll('circle.page-list-link-map__node--internal')\r\n      .data(currentGraphData.nodes.filter(d =\u003e !d.isExternal))\r\n      .enter()\r\n      .append('circle')\r\n      .attr('class', 'page-list-link-map__node page-list-link-map__node--internal')\r\n      .attr('r', 25)\r\n      .attr('fill', (d: LinkMapNode) =\u003e getNodeColor(d))\r\n      .attr('stroke', '#333')\r\n      .attr('stroke-width', 2);\r\n    \r\n    // Create squares for external nodes\r\n    const newExternalNodes = newNodeGroup\r\n      .selectAll('rect.page-list-link-map__node--external')\r\n      .data(currentGraphData.nodes.filter(d =\u003e d.isExternal))\r\n      .enter()\r\n      .append('rect')\r\n      .attr('class', 'page-list-link-map__node page-list-link-map__node--external')\r\n      .attr('width', 50)\r\n      .attr('height', 50)\r\n      .attr('x', -25)\r\n      .attr('y', -25)\r\n      .attr('fill', (d: LinkMapNode) =\u003e getNodeColor(d))\r\n      .attr('stroke', '#333')\r\n      .attr('stroke-width', 2);\r\n    \r\n    // Combine both selections for event handlers\r\n    node = newInternalNodes.merge(newExternalNodes)\r\n      .attr('tabindex', 0)\r\n      .attr('role', 'button')\r\n      .attr('aria-label', (d: LinkMapNode) =\u003e {\r\n        if (currentViewMode === 'topics') {\r\n          return `Topic: ${d.title}. Click to focus.`;\r\n        } else if (currentViewMode === 'sections') {\r\n          return `Section: ${d.title}. Click to focus.`;\r\n        } else {\r\n          return `Page: ${d.title}. Click to focus.`;\r\n        }\r\n      })\r\n      .call(drag(simulation, d3) as any)\r\n      .on('mouseover', function(this: SVGCircleElement | SVGRectElement, event: MouseEvent, d: LinkMapNode) {\r\n        const isFocused = focusedNode \u0026\u0026 d.id === focusedNode.id;\r\n        const isConnected = focusedNode \u0026\u0026 connectedNodeIds.has(d.id);\r\n        const el = d3.select(this);\r\n        const isExternal = d.isExternal || false;\r\n        \r\n        if (!focusedNode) {\r\n          const baseColor = getNodeColor(d);\r\n          if (isExternal) {\r\n            el.attr('width', 70)\r\n              .attr('height', 70)\r\n              .attr('x', -35)\r\n              .attr('y', -35);\r\n          } else {\r\n            el.attr('r', 35);\r\n          }\r\n          el.attr('fill', d3.rgb(baseColor).brighter(0.5).toString());\r\n        } else if (!isFocused \u0026\u0026 !isConnected) {\r\n          if (isExternal) {\r\n            el.attr('width', 56)\r\n              .attr('height', 56)\r\n              .attr('x', -28)\r\n              .attr('y', -28);\r\n          } else {\r\n            el.attr('r', 28);\r\n          }\r\n          el.attr('opacity', 0.6);\r\n        }\r\n        \r\n        // Build tooltip content based on view mode\r\n        let tooltipContent = `\r\n          \u003cdiv class=\"page-list-link-map__tooltip-content\"\u003e\r\n            \u003cstrong\u003e${escapeHtml(d.title)}\u003c/strong\u003e\u003cbr/\u003e\r\n        `;\r\n        \r\n        if (currentViewMode === 'topics') {\r\n          // For topics view, show page count\r\n          const topicKey = d.section;\r\n          const pageCount = pages.filter(p =\u003e {\r\n            const pageTopics = p.topics || [];\r\n            return topicKey === 'untagged' \r\n              ? pageTopics.length === 0 \r\n              : pageTopics.includes(topicKey);\r\n          }).length;\r\n          tooltipContent += `\r\n            \u003cspan class=\"page-list-link-map__tooltip-url\"\u003eTopic: ${escapeHtml(d.section === 'untagged' ? 'Untagged' : d.section)}\u003c/span\u003e\u003cbr/\u003e\r\n            \u003cspan class=\"page-list-link-map__tooltip-stats\"\u003e\r\n              Pages: ${pageCount} | Inbound: ${d.inboundLinks} | Outbound: ${d.outboundLinks}\r\n            \u003c/span\u003e\r\n          `;\r\n        } else {\r\n          tooltipContent += `\r\n            \u003cspan class=\"page-list-link-map__tooltip-url\"\u003e${escapeHtml(d.url)}\u003c/span\u003e\u003cbr/\u003e\r\n            \u003cspan class=\"page-list-link-map__tooltip-stats\"\u003e\r\n              Inbound: ${d.inboundLinks} | Outbound: ${d.outboundLinks}\r\n            \u003c/span\u003e\r\n          `;\r\n        }\r\n        \r\n        tooltipContent += `\r\n          \u003c/div\u003e\r\n        `;\r\n        \r\n        tooltip\r\n          .style('opacity', 1)\r\n          .html(tooltipContent)\r\n          .style('left', (event.pageX + 10) + 'px')\r\n          .style('top', (event.pageY - 10) + 'px');\r\n      })\r\n      .on('mouseout', function(event: MouseEvent, d: LinkMapNode) {\r\n        updateFocusStyles();\r\n        tooltip.style('opacity', 0);\r\n      })\r\n      .on('click', (event: MouseEvent, d: LinkMapNode) =\u003e {\r\n        event.stopPropagation();\r\n        \r\n        // Path finding mode (Ctrl/Cmd + click)\r\n        if (event.ctrlKey || event.metaKey) {\r\n          if (selectedNodesForPath.length === 0 || selectedNodesForPath.length === 1) {\r\n            if (selectedNodesForPath.length === 0 || selectedNodesForPath[0].id !== d.id) {\r\n              selectedNodesForPath.push(d);\r\n              // Check length after push (use type assertion to avoid type narrowing issue)\r\n              if ((selectedNodesForPath.length as number) === 2) {\r\n                // Find shortest path\r\n                const path = findShortestPath(selectedNodesForPath[0].id, selectedNodesForPath[1].id);\r\n                highlightPath(path);\r\n                selectedNodesForPath = []; // Reset after showing path\r\n              }\r\n            }\r\n          }\r\n          return;\r\n        }\r\n        \r\n        // Normal focus behavior\r\n        clearPathHighlight();\r\n        if (focusedNode \u0026\u0026 d.id === focusedNode.id) {\r\n          clearFocus();\r\n          svg.transition()\r\n            .duration(750)\r\n            .call(zoom.transform as any, d3.zoomIdentity);\r\n        } else {\r\n          focusNode(d);\r\n        }\r\n      })\r\n      .on('keydown', (event: KeyboardEvent, d: LinkMapNode) =\u003e {\r\n        if (event.key === 'Enter' || event.key === ' ') {\r\n          event.preventDefault();\r\n          if (focusedNode \u0026\u0026 d.id === focusedNode.id) {\r\n            clearFocus();\r\n          } else {\r\n            focusNode(d);\r\n          }\r\n        }\r\n      });\r\n    \r\n    // Recreate labels\r\n    label = g.append('g')\r\n      .attr('class', 'page-list-link-map__labels')\r\n      .selectAll('text')\r\n      .data(currentGraphData.nodes)\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'page-list-link-map__label')\r\n      .attr('text-anchor', 'middle')\r\n      .attr('dy', 40)\r\n      .attr('font-size', '12px')\r\n      .attr('font-weight', 'bold')\r\n      .attr('fill', '#333')\r\n      .text((d: LinkMapNode) =\u003e {\r\n        const text = d.title.length \u003e 20 ? d.title.substring(0, 20) + '...' : d.title;\r\n        return text;\r\n      });\r\n    \r\n    // Create new simulation\r\n    simulation = d3.forceSimulation(currentGraphData.nodes as any)\r\n      .force('link', d3.forceLink(currentGraphData.links).id((d: any) =\u003e d.id).distance(25))\r\n      .force('charge', d3.forceManyBody().strength(-60))\r\n      .force('center', d3.forceCenter(width / 2, height / 2))\r\n      .force('collision', d3.forceCollide().radius(35))\r\n      .alphaDecay(0.0228)\r\n      .velocityDecay(0.4);\r\n    \r\n    // Update positions on simulation tick\r\n    simulation.on('tick', () =\u003e {\r\n      const currentAlpha = simulation.alpha();\r\n      \r\n      if (currentAlpha \u003c 0.01 \u0026\u0026 Math.abs(currentAlpha - lastAlpha) \u003c 0.001) {\r\n        stableTicks++;\r\n        \r\n        if (!initialFitDone \u0026\u0026 stableTicks \u003e 5) {\r\n          initialFitDone = true;\r\n          fitEntireGraphToViewport();\r\n        }\r\n        \r\n        if (stableTicks \u003e 10) {\r\n          simulation.stop();\r\n          return;\r\n        }\r\n      } else {\r\n        stableTicks = 0;\r\n      }\r\n      lastAlpha = currentAlpha;\r\n      \r\n      scheduleUpdate();\r\n    });\r\n    \r\n    // Reset zoom and fit to viewport after a delay\r\n    initialFitDone = false;\r\n    setTimeout(() =\u003e {\r\n      fitEntireGraphToViewport();\r\n    }, 200);\r\n    \r\n    // Update section visibility\r\n    updateSectionVisibility();\r\n    \r\n    // Restart simulation\r\n    simulation.alpha(1).restart();\r\n  };\r\n  \r\n  // Track selected sections (default: all selected)\r\n  const selectedSections = new Set\u003cstring\u003e();\r\n  legendData.forEach(item =\u003e {\r\n    selectedSections.add(item.sectionKey);\r\n  });\r\n  \r\n  // Function to get section key for a node (works for sections and topics)\r\n  const getNodeSectionKey = (node: LinkMapNode): string =\u003e {\r\n    if (currentViewMode === 'topics') {\r\n      // For topics view, use the topic ID format\r\n      return node.id.startsWith('topic:') ? node.id : `topic:${node.section}`;\r\n    } else {\r\n      return node.section || node.parentPath;\r\n    }\r\n  };\r\n  \r\n  // Function to update visibility based on selected sections\r\n  const updateSectionVisibility = () =\u003e {\r\n    // Clear focus if focused node's section is now hidden\r\n    if (focusedNode) {\r\n      const focusedSectionKey = getNodeSectionKey(focusedNode);\r\n      if (!selectedSections.has(focusedSectionKey)) {\r\n        clearFocus();\r\n      }\r\n    }\r\n    \r\n    // External nodes are always visible (they don't have sections)\r\n    node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n      if (d.isExternal) {\r\n        // External nodes are always visible\r\n        d3.select(this).style('display', 'block');\r\n      } else {\r\n        const sectionKey = getNodeSectionKey(d);\r\n        const isVisible = selectedSections.has(sectionKey);\r\n        d3.select(this).style('display', isVisible ? 'block' : 'none');\r\n      }\r\n    });\r\n    \r\n    label.each(function(this: SVGTextElement, d: LinkMapNode) {\r\n      const sectionKey = getNodeSectionKey(d);\r\n      const isVisible = selectedSections.has(sectionKey);\r\n      d3.select(this).style('display', isVisible ? 'block' : 'none');\r\n    });\r\n    \r\n    // Hide links if either source or target is hidden\r\n    link.each(function(this: SVGLineElement, d: any) {\r\n      const sourceId = typeof d.source === 'string' ? d.source : d.source.id;\r\n      const targetId = typeof d.target === 'string' ? d.target : d.target.id;\r\n      const sourceNode = currentGraphData.nodes.find(n =\u003e n.id === sourceId);\r\n      const targetNode = currentGraphData.nodes.find(n =\u003e n.id === targetId);\r\n      \r\n      const sourceVisible = sourceNode \u0026\u0026 selectedSections.has(getNodeSectionKey(sourceNode));\r\n      const targetVisible = targetNode \u0026\u0026 selectedSections.has(getNodeSectionKey(targetNode));\r\n      const isVisible = sourceVisible \u0026\u0026 targetVisible;\r\n      \r\n      d3.select(this).style('display', isVisible ? 'block' : 'none');\r\n    });\r\n    \r\n    // If there's a focused node, update focus styles to maintain focus state\r\n    if (focusedNode) {\r\n      updateFocusStyles();\r\n    }\r\n    \r\n    // Restart simulation to adjust layout\r\n    simulation.alpha(0.3).restart();\r\n  };\r\n  \r\n  // Add event listeners to section checkboxes\r\n  const legendItems = container.querySelectorAll('.page-list-link-map__legend-item');\r\n  legendItems.forEach(item =\u003e {\r\n    const checkbox = item.querySelector('.page-list-link-map__legend-checkbox') as HTMLInputElement;\r\n    const sectionKey = item.getAttribute('data-section-key');\r\n    \r\n    if (checkbox \u0026\u0026 sectionKey) {\r\n      checkbox.addEventListener('change', () =\u003e {\r\n        if (checkbox.checked) {\r\n          selectedSections.add(sectionKey);\r\n        } else {\r\n          selectedSections.delete(sectionKey);\r\n        }\r\n        updateSectionVisibility();\r\n      });\r\n    }\r\n  });\r\n  \r\n  // Throttle DOM updates using requestAnimationFrame\r\n  let rafId: number | null = null;\r\n  let needsUpdate = false;\r\n  \r\n  const scheduleUpdate = () =\u003e {\r\n    if (!needsUpdate) {\r\n      needsUpdate = true;\r\n      rafId = requestAnimationFrame(() =\u003e {\r\n        needsUpdate = false;\r\n        // Only update positions, not styles (styles updated separately)\r\n        link\r\n          .attr('x1', (d: any) =\u003e d.source.x)\r\n          .attr('y1', (d: any) =\u003e d.source.y)\r\n          .attr('x2', (d: any) =\u003e d.target.x)\r\n          .attr('y2', (d: any) =\u003e d.target.y);\r\n        \r\n        // Update node positions - handle both circles and rectangles\r\n        node.each(function(this: SVGCircleElement | SVGRectElement, d: any) {\r\n          const el = d3.select(this);\r\n          const isExternal = d.isExternal || false;\r\n          if (isExternal) {\r\n            // Rectangles use x/y\r\n            el.attr('x', d.x)\r\n              .attr('y', d.y);\r\n          } else {\r\n            // Circles use cx/cy\r\n            el.attr('cx', d.x)\r\n              .attr('cy', d.y);\r\n          }\r\n        });\r\n        \r\n        label\r\n          .attr('x', (d: any) =\u003e d.x)\r\n          .attr('y', (d: any) =\u003e d.y);\r\n      });\r\n    }\r\n  };\r\n  \r\n  // Track if initial fit has been done\r\n  let initialFitDone = false;\r\n  \r\n  // Improved function to fit graph to viewport (works with focus, view switching, etc.)\r\n  const fitEntireGraphToViewport = (targetNodes?: LinkMapNode[]) =\u003e {\r\n    // Wait for next animation frame to ensure positions are updated\r\n    requestAnimationFrame(() =\u003e {\r\n      const nodesToFit = targetNodes || currentGraphData.nodes;\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      let hasValidNodes = false;\r\n      \r\n      nodesToFit.forEach(node =\u003e {\r\n        const nodeData = node as any;\r\n        // Use fixed position if available, otherwise use current position\r\n        const x = (nodeData.fx !== null \u0026\u0026 nodeData.fx !== undefined) ? nodeData.fx : nodeData.x;\r\n        const y = (nodeData.fy !== null \u0026\u0026 nodeData.fy !== undefined) ? nodeData.fy : nodeData.y;\r\n        \r\n        if (x !== undefined \u0026\u0026 y !== undefined \u0026\u0026 isFinite(x) \u0026\u0026 isFinite(y)) {\r\n          hasValidNodes = true;\r\n          // Determine radius based on node state\r\n          let radius = 25;\r\n          if (focusedNode \u0026\u0026 node.id === focusedNode.id) {\r\n            radius = 50;\r\n          } else if (focusedNode \u0026\u0026 connectedNodeIds.has(node.id)) {\r\n            radius = 30;\r\n          }\r\n          \r\n          minX = Math.min(minX, x - radius);\r\n          minY = Math.min(minY, y - radius);\r\n          maxX = Math.max(maxX, x + radius);\r\n          maxY = Math.max(maxY, y + radius);\r\n        }\r\n      });\r\n      \r\n      // If we have valid bounds, fit to viewport\r\n      if (hasValidNodes \u0026\u0026 isFinite(minX) \u0026\u0026 isFinite(minY) \u0026\u0026 isFinite(maxX) \u0026\u0026 isFinite(maxY)) {\r\n        const padding = 60;\r\n        minX -= padding;\r\n        minY -= padding;\r\n        maxX += padding;\r\n        maxY += padding;\r\n        \r\n        const boundsWidth = maxX - minX;\r\n        const boundsHeight = maxY - minY;\r\n        const boundsCenterX = (minX + maxX) / 2;\r\n        const boundsCenterY = (minY + maxY) / 2;\r\n        \r\n        // Calculate scale to fit in viewport\r\n        const margin = 0.85;\r\n        const scaleX = (width * margin) / boundsWidth;\r\n        const scaleY = (height * margin) / boundsHeight;\r\n        const scale = Math.min(scaleX, scaleY, 3); // Cap at 3x zoom\r\n        \r\n        // Calculate translation to center the bounds\r\n        const translateX = width / 2 - boundsCenterX * scale;\r\n        const translateY = height / 2 - boundsCenterY * scale;\r\n        \r\n        // Apply transformation\r\n        svg.transition()\r\n          .duration(750)\r\n          .call(zoom.transform as any, d3.zoomIdentity.translate(translateX, translateY).scale(scale));\r\n      }\r\n    });\r\n  };\r\n  \r\n  // Function to center graph (without zooming)\r\n  const centerGraph = (targetNodes?: LinkMapNode[]) =\u003e {\r\n    requestAnimationFrame(() =\u003e {\r\n      const nodesToCenter = targetNodes || currentGraphData.nodes;\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      let hasValidNodes = false;\r\n      \r\n      nodesToCenter.forEach(node =\u003e {\r\n        const nodeData = node as any;\r\n        const x = (nodeData.fx !== null \u0026\u0026 nodeData.fx !== undefined) ? nodeData.fx : nodeData.x;\r\n        const y = (nodeData.fy !== null \u0026\u0026 nodeData.fy !== undefined) ? nodeData.fy : nodeData.y;\r\n        \r\n        if (x !== undefined \u0026\u0026 y !== undefined \u0026\u0026 isFinite(x) \u0026\u0026 isFinite(y)) {\r\n          hasValidNodes = true;\r\n          let radius = 25;\r\n          if (focusedNode \u0026\u0026 node.id === focusedNode.id) {\r\n            radius = 50;\r\n          } else if (focusedNode \u0026\u0026 connectedNodeIds.has(node.id)) {\r\n            radius = 30;\r\n          }\r\n          \r\n          minX = Math.min(minX, x - radius);\r\n          minY = Math.min(minY, y - radius);\r\n          maxX = Math.max(maxX, x + radius);\r\n          maxY = Math.max(maxY, y + radius);\r\n        }\r\n      });\r\n      \r\n      if (hasValidNodes \u0026\u0026 isFinite(minX) \u0026\u0026 isFinite(minY) \u0026\u0026 isFinite(maxX) \u0026\u0026 isFinite(maxY)) {\r\n        const boundsCenterX = (minX + maxX) / 2;\r\n        const boundsCenterY = (minY + maxY) / 2;\r\n        \r\n        // Get current transform\r\n        const currentTransform = d3.zoomTransform(svg.node() as any);\r\n        const currentScale = currentTransform.k;\r\n        \r\n        // Calculate translation to center (keeping current scale)\r\n        const translateX = width / 2 - boundsCenterX * currentScale;\r\n        const translateY = height / 2 - boundsCenterY * currentScale;\r\n        \r\n        // Apply transformation\r\n        svg.transition()\r\n          .duration(750)\r\n          .call(zoom.transform as any, d3.zoomIdentity.translate(translateX, translateY).scale(currentScale));\r\n      }\r\n    });\r\n  };\r\n  \r\n  // Update positions on simulation tick (throttled)\r\n  simulation.on('tick', () =\u003e {\r\n    const currentAlpha = simulation.alpha();\r\n    \r\n    // Check if simulation is stable (alpha very low and not changing much)\r\n    if (currentAlpha \u003c 0.01 \u0026\u0026 Math.abs(currentAlpha - lastAlpha) \u003c 0.001) {\r\n      stableTicks++;\r\n      \r\n      // Fit entire graph to viewport on initial load (once)\r\n      if (!initialFitDone \u0026\u0026 stableTicks \u003e 5) {\r\n        initialFitDone = true;\r\n        fitEntireGraphToViewport();\r\n      }\r\n      \r\n      // Stop simulation after 10 stable ticks to save CPU\r\n      if (stableTicks \u003e 10) {\r\n        simulation.stop();\r\n        return;\r\n      }\r\n    } else {\r\n      stableTicks = 0;\r\n    }\r\n    lastAlpha = currentAlpha;\r\n    \r\n    scheduleUpdate();\r\n  });\r\n  \r\n  // Reset view button\r\n  const resetBtn = document.getElementById('link-map-reset');\r\n  if (resetBtn) {\r\n    resetBtn.addEventListener('click', () =\u003e {\r\n      clearFocus();\r\n      svg.transition()\r\n        .duration(750)\r\n        .call(zoom.transform as any, d3.zoomIdentity);\r\n    });\r\n  }\r\n  \r\n  // View mode buttons\r\n  const pagesBtn = document.getElementById('link-map-view-pages');\r\n  if (pagesBtn) {\r\n    pagesBtn.addEventListener('click', () =\u003e {\r\n      switchView('pages');\r\n    });\r\n  }\r\n  \r\n  const sectionsBtn = document.getElementById('link-map-view-sections');\r\n  if (sectionsBtn) {\r\n    sectionsBtn.addEventListener('click', () =\u003e {\r\n      switchView('sections');\r\n    });\r\n  }\r\n  \r\n  const topicsBtn = document.getElementById('link-map-view-topics');\r\n  if (topicsBtn) {\r\n    topicsBtn.addEventListener('click', () =\u003e {\r\n      switchView('topics');\r\n    });\r\n  }\r\n  \r\n  // Link direction toggle buttons\r\n  const outboundBtn = document.getElementById('link-map-link-direction-outbound');\r\n  const inboundBtn = document.getElementById('link-map-link-direction-inbound');\r\n  \r\n  const switchLinkDirection = (mode: LinkDirectionMode) =\u003e {\r\n    if (linkDirectionMode === mode) return;\r\n    \r\n    linkDirectionMode = mode;\r\n    \r\n    // Update button active states\r\n    if (outboundBtn) {\r\n      outboundBtn.classList.toggle('page-list-link-map__control-btn--active', mode === 'outbound');\r\n    }\r\n    if (inboundBtn) {\r\n      inboundBtn.classList.toggle('page-list-link-map__control-btn--active', mode === 'inbound');\r\n    }\r\n    \r\n    // If there's a focused node, refocus to update connections\r\n    if (focusedNode) {\r\n      const nodeToRefocus = focusedNode;\r\n      clearFocus();\r\n      // Use setTimeout to ensure clearFocus completes\r\n      setTimeout(() =\u003e {\r\n        focusNode(nodeToRefocus);\r\n      }, 0);\r\n    } else {\r\n      // Just update styles if no focus\r\n      updateFocusStyles();\r\n    }\r\n  };\r\n  \r\n  if (outboundBtn) {\r\n    outboundBtn.addEventListener('click', () =\u003e switchLinkDirection('outbound'));\r\n  }\r\n  if (inboundBtn) {\r\n    inboundBtn.addEventListener('click', () =\u003e switchLinkDirection('inbound'));\r\n  }\r\n  \r\n  // Center button - centers without zooming\r\n  const centerBtn = document.getElementById('link-map-center');\r\n  if (centerBtn) {\r\n    centerBtn.addEventListener('click', () =\u003e {\r\n      if (focusedNode) {\r\n        const connectedNodes: LinkMapNode[] = [];\r\n        connectedNodeIds.forEach(id =\u003e {\r\n          const node = currentGraphData.nodes.find(n =\u003e n.id === id);\r\n          if (node) connectedNodes.push(node);\r\n        });\r\n        centerGraph([focusedNode, ...connectedNodes]);\r\n      } else {\r\n        centerGraph();\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Fit to screen button - fits and centers\r\n  const fitBtn = document.getElementById('link-map-fit');\r\n  if (fitBtn) {\r\n    fitBtn.addEventListener('click', () =\u003e {\r\n      if (focusedNode) {\r\n        const connectedNodes: LinkMapNode[] = [];\r\n        connectedNodeIds.forEach(id =\u003e {\r\n          const node = currentGraphData.nodes.find(n =\u003e n.id === id);\r\n          if (node) connectedNodes.push(node);\r\n        });\r\n        fitEntireGraphToViewport([focusedNode, ...connectedNodes]);\r\n      } else {\r\n        fitEntireGraphToViewport();\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Build search data function (accessible from switchView)\r\n  const buildSearchData = () =\u003e {\r\n    return currentGraphData.nodes.map(node =\u003e ({\r\n      node,\r\n      titleLower: node.title.toLowerCase(),\r\n      urlLower: node.url.toLowerCase(),\r\n      sectionLower: node.section ? node.section.toLowerCase() : ''\r\n    }));\r\n  };\r\n  \r\n  let nodeSearchData = buildSearchData();\r\n  \r\n  // Search functionality with debouncing\r\n  const searchInput = document.getElementById('link-map-search') as HTMLInputElement;\r\n  if (searchInput) {\r\n    let searchTimeout: number | null = null;\r\n    const searchDebounceDelay = 150; // ms\r\n    \r\n    // Update search placeholder based on view mode\r\n    const updateSearchPlaceholder = () =\u003e {\r\n      if (searchInput) {\r\n        if (currentViewMode === 'topics') {\r\n          searchInput.placeholder = 'Search topics...';\r\n        } else if (currentViewMode === 'sections') {\r\n          searchInput.placeholder = 'Search sections...';\r\n        } else {\r\n          searchInput.placeholder = 'Search pages...';\r\n        }\r\n      }\r\n    };\r\n    updateSearchPlaceholder();\r\n    \r\n    const performSearch = (searchTerm: string) =\u003e {\r\n      const term = searchTerm.toLowerCase();\r\n      if (term === '') {\r\n        // Reset to focus state (which will hide unconnected if focused)\r\n        updateFocusStyles();\r\n        return;\r\n      }\r\n      \r\n      // Batch updates - respect focus state\r\n      const focusedId = focusedNode?.id;\r\n      const hasFocus = !!focusedNode;\r\n      \r\n      node.each(function(this: SVGCircleElement, d: LinkMapNode) {\r\n        const data = nodeSearchData.find(nd =\u003e nd.node.id === d.id);\r\n        // Search in title, URL, and section/topic name\r\n        const matches = data \u0026\u0026 (\r\n          data.titleLower.includes(term) || \r\n          data.urlLower.includes(term) ||\r\n          (currentViewMode === 'topics' \u0026\u0026 data.sectionLower.includes(term))\r\n        );\r\n        const isFocused = hasFocus \u0026\u0026 d.id === focusedId;\r\n        const isConnected = hasFocus \u0026\u0026 connectedNodeIds.has(d.id);\r\n        \r\n        // If focused, only show focused/connected nodes that match search\r\n        if (hasFocus \u0026\u0026 !isFocused \u0026\u0026 !isConnected) {\r\n          d3.select(this).style('opacity', 0); // Hide unconnected even if they match search\r\n        } else {\r\n          d3.select(this).style('opacity', matches ? 1 : 0.2);\r\n        }\r\n      });\r\n      \r\n      label.each(function(this: SVGTextElement, d: LinkMapNode) {\r\n        const data = nodeSearchData.find(nd =\u003e nd.node.id === d.id);\r\n        // Search in title, URL, and section/topic name\r\n        const matches = data \u0026\u0026 (\r\n          data.titleLower.includes(term) || \r\n          data.urlLower.includes(term) ||\r\n          (currentViewMode === 'topics' \u0026\u0026 data.sectionLower.includes(term))\r\n        );\r\n        const isFocused = hasFocus \u0026\u0026 d.id === focusedId;\r\n        const isConnected = hasFocus \u0026\u0026 connectedNodeIds.has(d.id);\r\n        \r\n        // If focused, only show focused/connected labels that match search\r\n        if (hasFocus \u0026\u0026 !isFocused \u0026\u0026 !isConnected) {\r\n          d3.select(this).style('opacity', 0); // Hide unconnected labels even if they match search\r\n        } else {\r\n          d3.select(this).style('opacity', matches ? 1 : 0.2);\r\n        }\r\n      });\r\n    };\r\n    \r\n    searchInput.addEventListener('input', (e) =\u003e {\r\n      const searchTerm = (e.target as HTMLInputElement).value;\r\n      \r\n      // Clear existing timeout\r\n      if (searchTimeout !== null) {\r\n        clearTimeout(searchTimeout);\r\n      }\r\n      \r\n      // Debounce the search\r\n      searchTimeout = window.setTimeout(() =\u003e {\r\n        performSearch(searchTerm);\r\n        searchTimeout = null;\r\n      }, searchDebounceDelay);\r\n    });\r\n  }\r\n  \r\n  // Heatmap functionality\r\n  let heatmapEnabled = false;\r\n  const heatmapToggleBtn = document.getElementById('link-map-heatmap-toggle');\r\n  if (heatmapToggleBtn) {\r\n    heatmapToggleBtn.addEventListener('click', () =\u003e {\r\n      heatmapEnabled = !heatmapEnabled;\r\n      heatmapToggleBtn.classList.toggle('page-list-link-map__control-btn--active', heatmapEnabled);\r\n      updateHeatmap();\r\n    });\r\n  }\r\n  \r\n  const updateHeatmap = () =\u003e {\r\n    // Show/hide heatmap legend\r\n    const heatmapLegend = document.getElementById('link-map-heatmap-legend');\r\n    const focusedPanel = document.getElementById('link-map-focused-panel');\r\n    \r\n    if (heatmapLegend) {\r\n      heatmapLegend.style.display = heatmapEnabled ? 'block' : 'none';\r\n      \r\n      // Adjust position based on focused panel visibility\r\n      if (heatmapEnabled \u0026\u0026 focusedPanel \u0026\u0026 focusedPanel.style.display !== 'none') {\r\n        const panelHeight = focusedPanel.offsetHeight || 200;\r\n        heatmapLegend.style.top = `${panelHeight + 1.5}rem`;\r\n      } else if (heatmapEnabled) {\r\n        heatmapLegend.style.top = '1rem';\r\n      }\r\n    }\r\n    \r\n    if (!heatmapEnabled) {\r\n      // Reset to normal colors, but respect focus and external nodes\r\n      node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n        const isFocused = focusedNode \u0026\u0026 d.id === focusedNode.id;\r\n        const isConnected = focusedNode \u0026\u0026 connectedNodeIds.has(d.id);\r\n        if (!isFocused \u0026\u0026 !isConnected) {\r\n          d3.select(this).attr('fill', getNodeColor(d));\r\n        }\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Calculate max degree for normalization\r\n    let maxDegree = 0;\r\n    let minDegree = Infinity;\r\n    currentGraphData.nodes.forEach(node =\u003e {\r\n      const degree = node.inboundLinks + node.outboundLinks;\r\n      maxDegree = Math.max(maxDegree, degree);\r\n      minDegree = Math.min(minDegree, degree);\r\n    });\r\n    \r\n    // Use a vibrant color scale from cool blue to hot red with enhanced contrast\r\n    // Non-linear mapping makes differences more visible across the spectrum\r\n    const vibrantColorScale = (t: number): string =\u003e {\r\n      // t is normalized from 0 (min) to 1 (max)\r\n      // Use a power curve to enhance contrast - makes differences more dramatic\r\n      // Lower exponent = more contrast in lower ranges, higher = more in upper ranges\r\n      const contrastCurve = Math.pow(t, 0.6); // Balanced curve for good visibility\r\n      \r\n      // Create a vibrant spectrum: Deep Blue -\u003e Bright Cyan -\u003e Yellow -\u003e Orange -\u003e Bright Red\r\n      if (contrastCurve \u003c 0.2) {\r\n        // Deep Blue to Bright Cyan (very low connectivity)\r\n        const localT = contrastCurve / 0.2;\r\n        const r = Math.floor(0 + (0 * localT));\r\n        const g = Math.floor(50 + (200 * localT));\r\n        const b = Math.floor(150 + (105 * localT));\r\n        return d3.rgb(r, g, b).toString();\r\n      } else if (contrastCurve \u003c 0.4) {\r\n        // Cyan to Green-Yellow (low-medium connectivity)\r\n        const localT = (contrastCurve - 0.2) / 0.2;\r\n        const r = Math.floor(0 + (200 * localT));\r\n        const g = 255;\r\n        const b = Math.floor(255 - (255 * localT));\r\n        return d3.rgb(r, g, b).toString();\r\n      } else if (contrastCurve \u003c 0.6) {\r\n        // Yellow to Orange (medium connectivity)\r\n        const localT = (contrastCurve - 0.4) / 0.2;\r\n        const r = 255;\r\n        const g = Math.floor(255 - (100 * localT));\r\n        const b = 0;\r\n        return d3.rgb(r, g, b).toString();\r\n      } else if (contrastCurve \u003c 0.8) {\r\n        // Orange to Red-Orange (high connectivity)\r\n        const localT = (contrastCurve - 0.6) / 0.2;\r\n        const r = 255;\r\n        const g = Math.floor(155 - (100 * localT));\r\n        const b = 0;\r\n        return d3.rgb(r, g, b).toString();\r\n      } else {\r\n        // Red-Orange to Bright Red (very high connectivity - hubs)\r\n        const localT = (contrastCurve - 0.8) / 0.2;\r\n        const r = 255;\r\n        const g = Math.floor(55 - (55 * localT));\r\n        const b = 0;\r\n        return d3.rgb(r, g, b).toString();\r\n      }\r\n    };\r\n    \r\n    // Apply heatmap colors based on degree, but preserve focus colors and external node colors\r\n    node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n      const isFocused = focusedNode \u0026\u0026 d.id === focusedNode.id;\r\n      const isConnected = focusedNode \u0026\u0026 connectedNodeIds.has(d.id);\r\n      \r\n      // Don't override focus/connected colors or external node colors\r\n      if (isFocused || isConnected || d.isExternal) {\r\n        return;\r\n      }\r\n      \r\n      const degree = d.inboundLinks + d.outboundLinks;\r\n      const normalizedT = maxDegree \u003e minDegree \r\n        ? (degree - minDegree) / (maxDegree - minDegree)\r\n        : 0;\r\n      \r\n      // Use vibrant color scale with enhanced contrast\r\n      const heatColor = vibrantColorScale(normalizedT);\r\n      \r\n      d3.select(this).attr('fill', heatColor);\r\n    });\r\n  };\r\n  \r\n  // Shortest path highlighting\r\n  let selectedNodesForPath: LinkMapNode[] = [];\r\n  let highlightedPath: string[] = [];\r\n  \r\n  const findShortestPath = (startId: string, endId: string): string[] =\u003e {\r\n    // BFS to find shortest path\r\n    const queue: Array\u003c{ id: string; path: string[] }\u003e = [{ id: startId, path: [startId] }];\r\n    const visited = new Set\u003cstring\u003e([startId]);\r\n    \r\n    while (queue.length \u003e 0) {\r\n      const current = queue.shift()!;\r\n      \r\n      if (current.id === endId) {\r\n        return current.path;\r\n      }\r\n      \r\n      const connections = connectionMap.get(current.id);\r\n      if (connections) {\r\n        connections.forEach(neighborId =\u003e {\r\n          if (!visited.has(neighborId)) {\r\n            visited.add(neighborId);\r\n            queue.push({ id: neighborId, path: [...current.path, neighborId] });\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    return []; // No path found\r\n  };\r\n  \r\n  const highlightPath = (path: string[]) =\u003e {\r\n    highlightedPath = path;\r\n    \r\n    // Highlight nodes in path - handle both circles and rectangles\r\n    node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n      const inPath = path.includes(d.id);\r\n      d3.select(this)\r\n        .attr('stroke', inPath ? '#FF6B6B' : '#333')\r\n        .attr('stroke-width', inPath ? 4 : 2);\r\n    });\r\n    \r\n    // Highlight links in path\r\n    link.each(function(this: SVGLineElement, d: any) {\r\n      const sourceId = typeof d.source === 'string' ? d.source : d.source.id;\r\n      const targetId = typeof d.target === 'string' ? d.target : d.target.id;\r\n      const inPath = path.includes(sourceId) \u0026\u0026 path.includes(targetId) \u0026\u0026\r\n                     Math.abs(path.indexOf(sourceId) - path.indexOf(targetId)) === 1;\r\n      \r\n      d3.select(this)\r\n        .attr('stroke', inPath ? '#FF6B6B' : '#999')\r\n        .attr('stroke-width', inPath ? 3 : 1)\r\n        .attr('opacity', inPath ? 1 : (focusedNode ? 0.3 : 1));\r\n    });\r\n  };\r\n  \r\n  const clearPathHighlight = () =\u003e {\r\n    highlightedPath = [];\r\n    selectedNodesForPath = [];\r\n    \r\n    // Reset node strokes (but preserve focus styles) - handle both circles and rectangles\r\n    node.each(function(this: SVGCircleElement | SVGRectElement, d: LinkMapNode) {\r\n      const isFocused = focusedNode \u0026\u0026 d.id === focusedNode.id;\r\n      const isConnected = focusedNode \u0026\u0026 connectedNodeIds.has(d.id);\r\n      if (!isFocused \u0026\u0026 !isConnected) {\r\n        d3.select(this).attr('stroke', '#333').attr('stroke-width', 2);\r\n      }\r\n    });\r\n    \r\n    // Reset link colors using updateFocusStyles to restore proper outbound/inbound colors\r\n    updateFocusStyles();\r\n  };\r\n  \r\n  // Graph editing functionality (stretch goal)\r\n  let isEditMode = false;\r\n  let dragSource: LinkMapNode | null = null;\r\n  let tempLink: any = null;\r\n  \r\n  // Right-click context menu for adding/removing topics (only in topics view)\r\n  node.on('contextmenu', (event: MouseEvent, d: LinkMapNode) =\u003e {\r\n    if (currentViewMode !== 'topics') return;\r\n    \r\n    event.preventDefault();\r\n    // Note: Full context menu implementation would require additional UI\r\n    // This is a placeholder for the functionality\r\n  });\r\n  \r\n}\r\n\r\n/**\r\n * Drag behavior for nodes\r\n */\r\nfunction drag(simulation: any, d3: any) {\r\n  function dragstarted(event: any) {\r\n    if (!event.active) simulation.alphaTarget(0.3).restart();\r\n    event.subject.fx = event.subject.x;\r\n    event.subject.fy = event.subject.y;\r\n  }\r\n  \r\n  function dragged(event: any) {\r\n    event.subject.fx = event.x;\r\n    event.subject.fy = event.y;\r\n  }\r\n  \r\n  function dragended(event: any) {\r\n    if (!event.active) simulation.alphaTarget(0);\r\n    event.subject.fx = null;\r\n    event.subject.fy = null;\r\n  }\r\n  \r\n  return d3.drag()\r\n    .on('start', dragstarted)\r\n    .on('drag', dragged)\r\n    .on('end', dragended);\r\n}\r\n\r\n/**\r\n * Extract external links from pages\r\n * Attempts to extract external link URLs from page content or data\r\n * Note: This requires external link URLs to be available in page data\r\n * or page content to be parsed. Currently checks for externalLinks property.\r\n */\r\nfunction extractExternalLinksFromPages(pages: PageData[]): Map\u003cstring, string[]\u003e {\r\n  const externalLinksMap = new Map\u003cstring, string[]\u003e();\r\n  const pageUrls = new Set(pages.map(p =\u003e p.relPermalink));\r\n  \r\n  pages.forEach(page =\u003e {\r\n    const externalLinks: string[] = [];\r\n    \r\n    // Try to get external links from page data\r\n    // Option 1: If page has externalLinks property (array of URLs)\r\n    if (page.externalLinks \u0026\u0026 Array.isArray(page.externalLinks)) {\r\n      page.externalLinks.forEach((url: string) =\u003e {\r\n        try {\r\n          // Ensure URL is absolute\r\n          const absoluteUrl = url.startsWith('http') ? url : `https://${url}`;\r\n          const urlObj = new URL(absoluteUrl);\r\n          // Only include if it's truly external (not same domain)\r\n          const currentHost = window.location.hostname.replace('www.', '');\r\n          const linkHost = urlObj.hostname.replace('www.', '');\r\n          if (linkHost !== currentHost \u0026\u0026 !linkHost.includes(currentHost) \u0026\u0026 !currentHost.includes(linkHost)) {\r\n            externalLinks.push(absoluteUrl);\r\n          }\r\n        } catch (e) {\r\n          // Invalid URL, skip\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Option 2: Calculate from outboundLinks and totalInternalLinks\r\n    // If we know total outbound links and internal links, we can infer external count\r\n    // But we need the actual URLs, so this is limited\r\n    \r\n    // Option 3: Parse from page content (would require fetching content)\r\n    // This could be implemented by fetching page HTML and parsing \u003ca\u003e tags\r\n    \r\n    externalLinksMap.set(page.relPermalink, externalLinks);\r\n  });\r\n  \r\n  return externalLinksMap;\r\n}\r\n\r\n/**\r\n * Extract internal links from pages\r\n * Uses page data to infer links - in production, you'd parse the actual HTML content\r\n * Optimized with pre-built indexes to reduce O(n²) complexity\r\n */\r\nfunction extractInternalLinksFromPages(pages: PageData[]): Map\u003cstring, string[]\u003e {\r\n  const linkMap = new Map\u003cstring, string[]\u003e();\r\n  const pageUrls = new Set(pages.map(p =\u003e p.relPermalink));\r\n  \r\n  // Pre-build indexes for O(1) lookups instead of O(n) searches\r\n  const pagesBySection = new Map\u003cstring, PageData[]\u003e();\r\n  const pagesByPathPrefix = new Map\u003cstring, PageData[]\u003e();\r\n  const mainSections = new Set\u003cstring\u003e();\r\n  \r\n  // Build indexes in single pass\r\n  pages.forEach(page =\u003e {\r\n    linkMap.set(page.relPermalink, []);\r\n    \r\n    // Index by section\r\n    if (page.section) {\r\n      if (!pagesBySection.has(page.section)) {\r\n        pagesBySection.set(page.section, []);\r\n      }\r\n      pagesBySection.get(page.section)!.push(page);\r\n    }\r\n    \r\n    // Index by path prefix (first segment)\r\n    const pathParts = page.relPermalink.split('/').filter(p =\u003e p);\r\n    if (pathParts.length \u003e 0) {\r\n      const prefix = '/' + pathParts[0] + '/';\r\n      if (!pagesByPathPrefix.has(prefix)) {\r\n        pagesByPathPrefix.set(prefix, []);\r\n      }\r\n      pagesByPathPrefix.get(prefix)!.push(page);\r\n      \r\n      // Collect main sections for home page\r\n      if (page.relPermalink !== '/' \u0026\u0026 page.section) {\r\n        const sectionPath = '/' + page.section.split('/')[0] + '/';\r\n        if (pageUrls.has(sectionPath)) {\r\n          mainSections.add(sectionPath);\r\n        }\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Extract links using optimized indexes\r\n  pages.forEach(page =\u003e {\r\n    const links = new Set\u003cstring\u003e();\r\n    \r\n    // Add links from brokenLinkUrls (these are actual links in the content, even if broken)\r\n    if (page.brokenLinkUrls \u0026\u0026 Array.isArray(page.brokenLinkUrls)) {\r\n      for (const url of page.brokenLinkUrls) {\r\n        // Remove anchor fragments\r\n        const path = url.split('#')[0];\r\n        // Only include if it's a known page URL\r\n        if (pageUrls.has(path) \u0026\u0026 path !== page.relPermalink) {\r\n          links.add(path);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Infer likely links based on section structure\r\n    // Home page links to main sections\r\n    if (page.relPermalink === '/') {\r\n      mainSections.forEach(link =\u003e links.add(link));\r\n    }\r\n    \r\n    // Pages in same section link to each other (common pattern)\r\n    if (page.section \u0026\u0026 pagesBySection.has(page.section)) {\r\n      const sectionPages = pagesBySection.get(page.section)!;\r\n      for (const otherPage of sectionPages) {\r\n        if (otherPage.relPermalink !== page.relPermalink \u0026\u0026 links.size \u003c 10) {\r\n          links.add(otherPage.relPermalink);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If page has internal links count, try to infer more connections\r\n    if (page.totalInternalLinks \u003e 0 \u0026\u0026 links.size \u003c page.totalInternalLinks) {\r\n      const pagePathParts = page.relPermalink.split('/').filter(p =\u003e p);\r\n      if (pagePathParts.length \u003e 0) {\r\n        const prefix = '/' + pagePathParts[0] + '/';\r\n        const prefixPages = pagesByPathPrefix.get(prefix);\r\n        \r\n        if (prefixPages) {\r\n          for (const otherPage of prefixPages) {\r\n            if (otherPage.relPermalink === page.relPermalink || links.size \u003e= page.totalInternalLinks) {\r\n              break;\r\n            }\r\n            \r\n            const otherPathParts = otherPage.relPermalink.split('/').filter(p =\u003e p);\r\n            // Check if pages share a common path prefix (likely related)\r\n            if (otherPathParts.length \u003e 0) {\r\n              if (pagePathParts[0] === otherPathParts[0] || \r\n                  page.relPermalink.startsWith(otherPage.relPermalink + '/') ||\r\n                  otherPage.relPermalink.startsWith(page.relPermalink + '/')) {\r\n                links.add(otherPage.relPermalink);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (links.size \u003e 0) {\r\n      linkMap.set(page.relPermalink, Array.from(links));\r\n    }\r\n  });\r\n  \r\n  return linkMap;\r\n}\r\n\r\n","/**\r\n * Page List Sidebar Toggle\r\n * Handles sidebar collapse/expand functionality for both mobile and desktop\r\n */\r\n\r\nimport { isLocalhost } from \"../utils/dom\";\r\n\r\nexport function initPageListSidebar(): void {\r\n  // Only run in dev/localhost\r\n  if (!isLocalhost()) {\r\n    return;\r\n  }\r\n\r\n  const sidebar = document.querySelector('.page-list-sidebar');\r\n  const sidebarWrapper = document.querySelector('.page-list-sidebar-wrapper');\r\n  const toggle = document.querySelector('[data-sidebar-toggle]') as HTMLButtonElement;\r\n\r\n  if (!sidebar || !toggle) {\r\n    return;\r\n  }\r\n\r\n  // Check localStorage for saved preference\r\n  const savedState = localStorage.getItem('page-list-sidebar-collapsed');\r\n  const isCollapsed = savedState === 'true';\r\n\r\n  // Check if we're on mobile/tablet\r\n  const isMobile = window.matchMedia('(max-width: 768px)').matches;\r\n\r\n  // Initialize state\r\n  if (isMobile) {\r\n    // On mobile, use expanded/collapsed for nav visibility\r\n    if (isCollapsed) {\r\n      sidebar.classList.remove('page-list-sidebar--expanded');\r\n      toggle.setAttribute('aria-expanded', 'false');\r\n      if (sidebarWrapper) sidebarWrapper.classList.add('page-list-sidebar-wrapper--collapsed');\r\n    } else {\r\n      sidebar.classList.add('page-list-sidebar--expanded');\r\n      toggle.setAttribute('aria-expanded', 'true');\r\n      if (sidebarWrapper) sidebarWrapper.classList.remove('page-list-sidebar-wrapper--collapsed');\r\n    }\r\n  } else {\r\n    // On desktop, use collapsed class for compact view\r\n    if (isCollapsed) {\r\n      if (sidebarWrapper) sidebarWrapper.classList.add('page-list-sidebar-wrapper--collapsed');\r\n      sidebar.classList.add('page-list-sidebar--collapsed');\r\n      toggle.setAttribute('aria-expanded', 'false');\r\n    } else {\r\n      if (sidebarWrapper) sidebarWrapper.classList.remove('page-list-sidebar-wrapper--collapsed');\r\n      sidebar.classList.remove('page-list-sidebar--collapsed');\r\n      toggle.setAttribute('aria-expanded', 'true');\r\n    }\r\n  }\r\n\r\n  // Update icon based on state\r\n  const icon = toggle.querySelector('[data-toggle-icon]') as HTMLElement;\r\n  if (icon) {\r\n    const isCurrentlyCollapsed = sidebarWrapper?.classList.contains('page-list-sidebar-wrapper--collapsed') || false;\r\n    icon.textContent = isCurrentlyCollapsed ? 'chevron_right' : 'chevron_left';\r\n  }\r\n\r\n  toggle.addEventListener('click', () =\u003e {\r\n    const isCurrentlyCollapsed = sidebarWrapper?.classList.contains('page-list-sidebar-wrapper--collapsed') || false;\r\n    \r\n    if (isMobile) {\r\n      // Mobile: toggle nav visibility\r\n      const isExpanded = sidebar.classList.contains('page-list-sidebar--expanded');\r\n      if (isExpanded) {\r\n        sidebar.classList.remove('page-list-sidebar--expanded');\r\n        toggle.setAttribute('aria-expanded', 'false');\r\n        if (icon) icon.textContent = 'chevron_right';\r\n        localStorage.setItem('page-list-sidebar-collapsed', 'true');\r\n      } else {\r\n        sidebar.classList.add('page-list-sidebar--expanded');\r\n        toggle.setAttribute('aria-expanded', 'true');\r\n        if (icon) icon.textContent = 'chevron_left';\r\n        localStorage.setItem('page-list-sidebar-collapsed', 'false');\r\n      }\r\n    } else {\r\n      // Desktop: toggle compact view\r\n      if (isCurrentlyCollapsed) {\r\n        sidebarWrapper?.classList.remove('page-list-sidebar-wrapper--collapsed');\r\n        sidebar.classList.remove('page-list-sidebar--collapsed');\r\n        toggle.setAttribute('aria-expanded', 'true');\r\n        if (icon) icon.textContent = 'chevron_left';\r\n        localStorage.setItem('page-list-sidebar-collapsed', 'false');\r\n      } else {\r\n        sidebarWrapper?.classList.add('page-list-sidebar-wrapper--collapsed');\r\n        sidebar.classList.add('page-list-sidebar--collapsed');\r\n        toggle.setAttribute('aria-expanded', 'false');\r\n        if (icon) icon.textContent = 'chevron_right';\r\n        localStorage.setItem('page-list-sidebar-collapsed', 'true');\r\n      }\r\n    }\r\n  });\r\n\r\n  // Update on window resize with proper cleanup\r\n  let resizeTimer: number | undefined;\r\n  const resizeHandler = () =\u003e {\r\n    if (resizeTimer !== undefined) {\r\n      clearTimeout(resizeTimer);\r\n    }\r\n    resizeTimer = window.setTimeout(() =\u003e {\r\n      const isMobileNow = window.matchMedia('(max-width: 768px)').matches;\r\n      if (!isMobileNow) {\r\n        // On desktop, restore saved collapsed state\r\n        const saved = localStorage.getItem('page-list-sidebar-collapsed') === 'true';\r\n        if (saved) {\r\n          sidebarWrapper?.classList.add('page-list-sidebar-wrapper--collapsed');\r\n          sidebar.classList.add('page-list-sidebar--collapsed');\r\n          toggle.setAttribute('aria-expanded', 'false');\r\n          if (icon) icon.textContent = 'chevron_right';\r\n        } else {\r\n          sidebarWrapper?.classList.remove('page-list-sidebar-wrapper--collapsed');\r\n          sidebar.classList.remove('page-list-sidebar--collapsed');\r\n          toggle.setAttribute('aria-expanded', 'true');\r\n          if (icon) icon.textContent = 'chevron_left';\r\n        }\r\n      }\r\n    }, 250);\r\n  };\r\n  \r\n  window.addEventListener('resize', resizeHandler, { passive: true });\r\n  \r\n  // Note: Cleanup function not returned to maintain API compatibility\r\n  // Event listener will persist for the page lifetime, which is acceptable\r\n  // for a sidebar toggle that should remain active while the page is open\r\n}\r\n\r\n","/**\r\n * Table of Contents Module\r\n * Handles mobile dropdown toggle for TOC widget in sidebar\r\n * Builds TOC dynamically from all headers in the DOM (including shortcodes)\r\n * Also fixes shortcode placeholders in TOC links by matching with actual headings\r\n */\r\n\r\n/**\r\n * Generate a Hugo-style ID from text (matches Hugo's ID generation algorithm)\r\n */\r\nconst generateHeadingId = (text: string): string =\u003e {\r\n  return text\r\n    .toLowerCase()\r\n    .trim()\r\n    // Replace spaces and multiple spaces with hyphens\r\n    .replace(/\\s+/g, \"-\")\r\n    // Remove special characters except hyphens\r\n    .replace(/[^\\w\\-]/g, \"\")\r\n    // Remove multiple consecutive hyphens\r\n    .replace(/-+/g, \"-\")\r\n    // Remove leading/trailing hyphens\r\n    .replace(/^-+|-+$/g, \"\");\r\n};\r\n\r\n/**\r\n * Build TOC from all headings in the page content (including shortcodes)\r\n * Only includes headings within the .prose container\r\n */\r\nconst buildTOCFromDOM = (): void =\u003e {\r\n  const tocContent = document.querySelector\u003cHTMLElement\u003e(\".sidebar-widget__toc-content\");\r\n  if (!tocContent) return;\r\n\r\n  // Find the prose content area - this is where the main page content lives\r\n  const proseContent = document.querySelector\u003cHTMLElement\u003e(\".prose\");\r\n\r\n  if (!proseContent) {\r\n    // Hide TOC if no prose area found\r\n    const tocWidget = tocContent.closest(\".sidebar-widget--toc\") as HTMLElement | null;\r\n    if (tocWidget) {\r\n      tocWidget.style.display = \"none\";\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Get all headings from h2 to h4 in the prose content only (matching Hugo's TOC config)\r\n  const headings = Array.from(proseContent.querySelectorAll\u003cHTMLElement\u003e(\"h2, h3, h4\"));\r\n\r\n  if (headings.length === 0) {\r\n    // Hide TOC if no headings found\r\n    const tocWidget = tocContent.closest(\".sidebar-widget--toc\") as HTMLElement | null;\r\n    if (tocWidget) {\r\n      tocWidget.style.display = \"none\";\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Ensure headings have IDs\r\n  headings.forEach((heading) =\u003e {\r\n    if (!heading.id) {\r\n      const text = heading.textContent?.trim() || heading.innerText?.trim() || \"\";\r\n      if (text) {\r\n        heading.id = generateHeadingId(text);\r\n      }\r\n    } else {\r\n      // Fix IDs that contain shortcode placeholders\r\n      if (heading.id.includes(\"hahahugoshortcode\") || heading.id.includes(\"hbhb\")) {\r\n        const text = heading.textContent?.trim() || heading.innerText?.trim() || \"\";\r\n        if (text) {\r\n          heading.id = generateHeadingId(text);\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  // Build TOC structure\r\n  const nav = tocContent.querySelector\u003cHTMLElement\u003e(\"#TableOfContents\");\r\n  if (!nav) return;\r\n\r\n  const ul = nav.querySelector(\"ul\");\r\n  if (!ul) return;\r\n\r\n  // Clear existing content\r\n  ul.innerHTML = \"\";\r\n\r\n  // Track the current nesting level and ul stack\r\n  // ulStack[0] is always the root ul\r\n  const ulStack: HTMLUListElement[] = [ul];\r\n  const startLevel = 2; // Hugo TOC starts at h2\r\n\r\n  headings.forEach((heading) =\u003e {\r\n    const level = parseInt(heading.tagName.substring(1), 10); // h2 -\u003e 2, h3 -\u003e 3, h4 -\u003e 4\r\n    const id = heading.id;\r\n    const text = heading.textContent?.trim() || heading.innerText?.trim() || \"\";\r\n\r\n    if (!id || !text) return;\r\n\r\n    const relativeLevel = level - startLevel; // 0 for h2, 1 for h3, 2 for h4\r\n    const targetDepth = relativeLevel + 1; // Depth in ul stack (1-based)\r\n\r\n    // Pop stack until we're at the right depth\r\n    while (ulStack.length \u003e targetDepth) {\r\n      ulStack.pop();\r\n    }\r\n\r\n    // Push new nested lists if we need to go deeper\r\n    while (ulStack.length \u003c targetDepth) {\r\n      const newUl = document.createElement(\"ul\");\r\n      const currentUl = ulStack[ulStack.length - 1];\r\n      const lastLi = currentUl.lastElementChild as HTMLLIElement;\r\n      \r\n      if (lastLi) {\r\n        // Append nested ul to last li\r\n        lastLi.appendChild(newUl);\r\n      } else {\r\n        // If no li exists, create one with empty content (shouldn't happen, but handle it)\r\n        const li = document.createElement(\"li\");\r\n        li.appendChild(newUl);\r\n        currentUl.appendChild(li);\r\n      }\r\n      \r\n      ulStack.push(newUl);\r\n    }\r\n\r\n    // Get current ul (should be at targetDepth)\r\n    const currentUl = ulStack[ulStack.length - 1];\r\n\r\n    // Create list item\r\n    const li = document.createElement(\"li\");\r\n    const a = document.createElement(\"a\");\r\n    a.href = `#${id}`;\r\n    a.textContent = text;\r\n    li.appendChild(a);\r\n    currentUl.appendChild(li);\r\n  });\r\n\r\n  // Show TOC widget if it was hidden\r\n  const tocWidget = tocContent.closest(\".sidebar-widget--toc\") as HTMLElement | null;\r\n  if (tocWidget) {\r\n    tocWidget.style.display = \"\";\r\n  }\r\n};\r\n\r\n/**\r\n * Fix header IDs that contain shortcode placeholders\r\n */\r\nconst fixHeaderIds = (): void =\u003e {\r\n  // Get all headings from the page content\r\n  const headings = document.querySelectorAll\u003cHTMLElement\u003e(\"h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]\");\r\n  \r\n  // Map of old IDs to new IDs\r\n  const idMap = new Map\u003cstring, string\u003e();\r\n  \r\n  headings.forEach((heading) =\u003e {\r\n    const oldId = heading.id;\r\n    if (!oldId) return;\r\n    \r\n    // Check if ID contains shortcode placeholder\r\n    if (oldId.includes(\"hahahugoshortcode\") || oldId.includes(\"hbhb\")) {\r\n      // Get the actual rendered text content\r\n      const text = heading.textContent?.trim() || heading.innerText?.trim() || \"\";\r\n      if (text) {\r\n        // Generate new ID from the actual text\r\n        const newId = generateHeadingId(text);\r\n        \r\n        if (newId \u0026\u0026 newId !== oldId) {\r\n          idMap.set(oldId, newId);\r\n          heading.id = newId;\r\n        }\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Update all links that point to the old IDs\r\n  if (idMap.size \u003e 0) {\r\n    // Update TOC links\r\n    const tocLinks = document.querySelectorAll\u003cHTMLAnchorElement\u003e(\".sidebar-widget__toc-content a[href^='#']\");\r\n    tocLinks.forEach((link) =\u003e {\r\n      const href = link.getAttribute(\"href\");\r\n      if (!href) return;\r\n      const targetId = href.substring(1);\r\n      const newId = idMap.get(targetId);\r\n      if (newId) {\r\n        link.setAttribute(\"href\", `#${newId}`);\r\n      }\r\n    });\r\n    \r\n    // Update any other anchor links on the page\r\n    const allLinks = document.querySelectorAll\u003cHTMLAnchorElement\u003e(\"a[href^='#']\");\r\n    allLinks.forEach((link) =\u003e {\r\n      const href = link.getAttribute(\"href\");\r\n      if (!href) return;\r\n      const targetId = href.substring(1);\r\n      const newId = idMap.get(targetId);\r\n      if (newId) {\r\n        link.setAttribute(\"href\", `#${newId}`);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Fix TOC link text by replacing shortcode placeholders with actual heading text\r\n */\r\nconst fixTOCShortcodes = (): void =\u003e {\r\n  const tocContent = document.querySelector\u003cHTMLElement\u003e(\".sidebar-widget__toc-content\");\r\n  if (!tocContent) return;\r\n\r\n  // Get all headings from the page content (these have shortcodes already processed)\r\n  const headings = document.querySelectorAll\u003cHTMLElement\u003e(\"h1[id], h2[id], h3[id], h4[id]\");\r\n  \r\n  // Create a map of heading IDs to their text content\r\n  const headingMap = new Map\u003cstring, string\u003e();\r\n  headings.forEach((heading) =\u003e {\r\n    const id = heading.id;\r\n    if (id) {\r\n      // Get text content, preserving HTML structure for shortcodes\r\n      const text = heading.textContent?.trim() || heading.innerText?.trim() || \"\";\r\n      if (text) {\r\n        headingMap.set(id, text);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Find all TOC links and update their text\r\n  const tocLinks = tocContent.querySelectorAll\u003cHTMLAnchorElement\u003e(\"a[href^='#']\");\r\n  tocLinks.forEach((link) =\u003e {\r\n    const href = link.getAttribute(\"href\");\r\n    if (!href) return;\r\n\r\n    // Extract ID from href (e.g., \"#heading-id\" -\u003e \"heading-id\")\r\n    const targetId = href.substring(1);\r\n    const actualText = headingMap.get(targetId);\r\n\r\n    // If we found the actual heading text and the link text contains placeholder, replace it\r\n    if (actualText \u0026\u0026 (link.textContent?.includes(\"HAHAHUGOSHORTCODE\") || link.textContent !== actualText)) {\r\n      link.textContent = actualText;\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Initialize TOC dropdown functionality\r\n */\r\nexport const initTOC = (): void =\u003e {\r\n  const tocWidgets = document.querySelectorAll\u003cHTMLElement\u003e(\".sidebar-widget--toc\");\r\n\r\n  tocWidgets.forEach((widget) =\u003e {\r\n    const toggle = widget.querySelector\u003cHTMLButtonElement\u003e(\".sidebar-widget__toc-toggle\");\r\n    const content = widget.querySelector\u003cHTMLElement\u003e(\".sidebar-widget__toc-content\");\r\n\r\n    if (!toggle || !content) return;\r\n\r\n    // Toggle functionality - works on all screen sizes\r\n    const handleToggle = () =\u003e {\r\n      const isOpen = toggle.getAttribute(\"aria-expanded\") === \"true\";\r\n      const newState = !isOpen;\r\n\r\n      toggle.setAttribute(\"aria-expanded\", newState.toString());\r\n      if (newState) {\r\n        content.classList.add(\"is-open\");\r\n      } else {\r\n        content.classList.remove(\"is-open\");\r\n      }\r\n    };\r\n\r\n    // Set initial state - start collapsed on all screen sizes\r\n    const setInitialState = () =\u003e {\r\n      toggle.setAttribute(\"aria-expanded\", \"false\");\r\n      content.classList.remove(\"is-open\");\r\n    };\r\n\r\n    // Set initial state\r\n    setInitialState();\r\n\r\n    // Build TOC from DOM (includes headers from shortcodes)\r\n    // Run after delays to ensure DOM is fully rendered and shortcodes (including geolocation) are processed\r\n    const buildAndFix = () =\u003e {\r\n      buildTOCFromDOM(); // Build TOC from all headers in DOM\r\n      fixHeaderIds(); // Fix any remaining ID issues\r\n    };\r\n\r\n    // Initial build after short delay\r\n    setTimeout(() =\u003e {\r\n      buildAndFix();\r\n    }, 100);\r\n\r\n    // Build again after longer delay to catch async geolocation updates\r\n    setTimeout(() =\u003e {\r\n      buildAndFix();\r\n    }, 1000);\r\n\r\n    // Also build on window load in case content loads later\r\n    if (document.readyState === \"complete\") {\r\n      buildAndFix();\r\n    } else {\r\n      window.addEventListener(\"load\", () =\u003e {\r\n        setTimeout(buildAndFix, 500); // Delay after load to ensure geolocation is processed\r\n      });\r\n    }\r\n\r\n    // Track interaction type to prevent double-firing\r\n    let lastInteractionType: \"pointer\" | \"touch\" | \"click\" | null = null;\r\n    let interactionTimeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n    let hasHandledInteraction = false;\r\n\r\n    // Universal handler that works for all input types\r\n    const handleInteraction = (e: Event, interactionType: \"pointer\" | \"touch\" | \"click\") =\u003e {\r\n      // Clear any pending timeout\r\n      if (interactionTimeout) {\r\n        clearTimeout(interactionTimeout);\r\n      }\r\n\r\n      // If we just handled a touch/pointer event, ignore the click\r\n      if (interactionType === \"click\" \u0026\u0026 (lastInteractionType === \"touch\" || lastInteractionType === \"pointer\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        return;\r\n      }\r\n\r\n      // Prevent double-firing within a short time window\r\n      if (hasHandledInteraction \u0026\u0026 interactionType === lastInteractionType) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        return;\r\n      }\r\n\r\n      // Handle the interaction\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      lastInteractionType = interactionType;\r\n      hasHandledInteraction = true;\r\n      handleToggle();\r\n\r\n      // Reset flags after a delay to allow subsequent interactions\r\n      interactionTimeout = setTimeout(() =\u003e {\r\n        lastInteractionType = null;\r\n        hasHandledInteraction = false;\r\n      }, 400);\r\n    };\r\n\r\n    // Use Pointer Events API (works across all modern browsers including Brave)\r\n    // This is the most reliable cross-browser method\r\n    if (window.PointerEvent) {\r\n      toggle.addEventListener(\"pointerdown\", (e) =\u003e {\r\n        // Only handle touch-like pointer events (not mouse)\r\n        if (e.pointerType === \"touch\" || e.pointerType === \"pen\") {\r\n          lastInteractionType = \"pointer\";\r\n        }\r\n      }, { passive: true });\r\n\r\n      toggle.addEventListener(\"pointerup\", (e) =\u003e {\r\n        if (e.pointerType === \"touch\" || e.pointerType === \"pen\") {\r\n          handleInteraction(e, \"pointer\");\r\n        }\r\n      });\r\n    }\r\n\r\n    // Touch events - work in parallel with pointer events for maximum compatibility\r\n    // Some browsers (like Brave) may handle these differently\r\n    let touchStartTime = 0;\r\n    let touchStartTarget: EventTarget | null = null;\r\n\r\n    toggle.addEventListener(\"touchstart\", (e) =\u003e {\r\n      lastInteractionType = \"touch\";\r\n      touchStartTime = Date.now();\r\n      touchStartTarget = e.target;\r\n      // Don't prevent default here - let touchend handle it\r\n    }, { passive: true });\r\n\r\n    toggle.addEventListener(\"touchend\", (e) =\u003e {\r\n      // Ensure this is the same touch that started on this element\r\n      if (e.target !== touchStartTarget \u0026\u0026 e.target !== toggle) {\r\n        return;\r\n      }\r\n\r\n      // Prevent default immediately (Brave requires this to be synchronous)\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      \r\n      // Only handle if touch was quick (not a scroll gesture)\r\n      const touchDuration = Date.now() - touchStartTime;\r\n      if (touchDuration \u003c 500) {\r\n        handleInteraction(e, \"touch\");\r\n      }\r\n      \r\n      // Reset touch tracking\r\n      touchStartTime = 0;\r\n      touchStartTarget = null;\r\n    }, { passive: false }); // Must be non-passive to allow preventDefault\r\n\r\n    // Click handler for mouse and as fallback\r\n    // This will also fire after touch events in some browsers, but we filter it out\r\n    toggle.addEventListener(\"click\", (e) =\u003e {\r\n      handleInteraction(e, \"click\");\r\n    });\r\n\r\n\r\n    // Handle keyboard navigation\r\n    toggle.addEventListener(\"keydown\", (e) =\u003e {\r\n      if (e.key === \"Enter\" || e.key === \" \") {\r\n        e.preventDefault();\r\n        handleToggle();\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\n","/**\r\n * Dev Score Bubble Module\r\n * Shows SEO and AI scores for the current page in a floating bubble (dev-only)\r\n * Circular minimized state, expands on hover, locks open on click\r\n */\r\n\r\nimport { isLocalhost, onDOMReady } from \"../utils/dom\";\r\nimport {\r\n  requestSiteRootAccess,\r\n  getSiteRootDirectoryHandle,\r\n  setSiteRootDirectoryHandle,\r\n  readFileContent,\r\n  writeFileContent,\r\n  findActualFilePath,\r\n  createBackupFilename,\r\n  relPermalinkToContentFile,\r\n  removeLinkFromContent,\r\n  escapeRegex\r\n} from \"../utils/file-system\";\r\nimport {\r\n  showToast,\r\n  createConfirmationDialog,\r\n  createUrlInputDialog,\r\n  escapeHtml\r\n} from \"../utils/dev-ui\";\r\nimport {\r\n  analyzeKeywords,\r\n  renderKeywordResearchModal,\r\n  attachSeedKeywordSearch,\r\n  attachCompetitorKeywordRemoval,\r\n  attachExportHandlers\r\n} from \"./keyword-research\";\r\n\r\ninterface PageData {\r\n  relPermalink: string;\r\n  seoScore: number;\r\n  aiCrawlabilityScore: number;\r\n  title: string;\r\n  hasMetaTitle: boolean;\r\n  hasMetaDescription: boolean;\r\n  titleOverLimit: boolean;\r\n  titleOverPixels: boolean;\r\n  descriptionOverLimit: boolean;\r\n  descriptionOverPixels: boolean;\r\n  brokenLinks: number;\r\n  hasBrokenLinks: boolean;\r\n  imagesWithoutAlt: number;\r\n  hasImagesWithoutAlt: boolean;\r\n  h1Count: number;\r\n  hasMultipleH1: boolean;\r\n  hasH2s: boolean;\r\n  hasSchemaMarkup?: boolean;\r\n  hasSummary?: boolean;\r\n  summaryTooShort?: boolean;\r\n  summaryTooLong?: boolean;\r\n  isStale?: boolean;\r\n  hasLangAttribute?: boolean;\r\n  hasCanonical?: boolean;\r\n  wordCount?: number;\r\n  wordCountPoor?: boolean;\r\n  longSentences?: string[];\r\n  brokenLinkUrls?: string[];\r\n  genericAnchorCount?: number;\r\n  hasGenericAnchors?: boolean;\r\n  imagesWithGenericAlt?: number;\r\n  hasGenericAltText?: boolean;\r\n  imagesNotNextGen?: number;\r\n  imagesWithoutLazyLoading?: number;\r\n  // Additional SEO/AI factors\r\n  internalLinksGood?: boolean;\r\n  internalLinksTooFew?: boolean;\r\n  internalLinksTooMany?: boolean;\r\n  firstParaGood?: boolean;\r\n  firstParaLength?: number;\r\n  urlLengthGood?: boolean;\r\n  urlLengthOver?: boolean;\r\n  urlLength?: number;\r\n  outboundLinksGood?: boolean;\r\n  outboundLinksTooFew?: boolean;\r\n  paragraphLengthGood?: boolean;\r\n  paragraphLengthIssues?: number;\r\n  subheadingDistributionGood?: boolean;\r\n  mediaUsageGood?: boolean;\r\n  mediaUsageTooFew?: boolean;\r\n  hasDateInfo?: boolean;\r\n  hasDatePublished?: boolean;\r\n  hasDateUpdated?: boolean;\r\n  hasMobileViewport?: boolean;\r\n  socialMetaGood?: boolean;\r\n  hasOpenGraph?: boolean;\r\n  hasTwitterCard?: boolean;\r\n  hasMixedContent?: boolean;\r\n  mixedContentIssues?: number;\r\n  hasLists?: boolean;\r\n  hasBoldText?: boolean;\r\n  hasCitations?: boolean;\r\n  citationsGood?: boolean;\r\n  citationCount?: number;\r\n  hasAuthor?: boolean;\r\n  authorName?: string | null;\r\n  hasVideos?: boolean;\r\n  videoCount?: number;\r\n  hasTranscript?: boolean;\r\n  readabilityGood?: boolean;\r\n  avgSentenceLength?: number;\r\n  // Accessibility fields\r\n  contrastRatioIssues?: number;\r\n  hasContrastRatioIssues?: boolean;\r\n  hasFocusIndicators?: boolean;\r\n  missingAriaLabels?: number;\r\n  hasMissingAriaLabels?: boolean;\r\n  keyboardNavigationIssues?: number;\r\n  hasKeyboardNavigationIssues?: boolean;\r\n  accessibilityScore?: number;\r\n}\r\n\r\ninterface PageListData {\r\n  pages: PageData[];\r\n}\r\n\r\n/**\r\n * Get score class based on score value (matches page-list.ts)\r\n */\r\nfunction getScoreClass(score: number): string {\r\n  if (score \u003e= 80) return \"score-excellent\";\r\n  if (score \u003e= 60) return \"score-good\";\r\n  if (score \u003e= 40) return \"score-fair\";\r\n  return \"score-poor\";\r\n}\r\n\r\n/**\r\n * Calculate average score\r\n */\r\nfunction getAverageScore(seoScore: number, aiScore: number): number {\r\n  return Math.round((seoScore + aiScore) / 2);\r\n}\r\n\r\n/**\r\n * Collect page issues - comprehensive check of all factors affecting SEO and AI scores\r\n */\r\nfunction getPageIssues(page: PageData): Array\u003c{ text: string; severity: \"error\" | \"warning\" }\u003e {\r\n  const issues: Array\u003c{ text: string; severity: \"error\" | \"warning\" }\u003e = [];\r\n\r\n  // ============================================================================\r\n  // Critical SEO Issues (Errors)\r\n  // ============================================================================\r\n  if (!page.hasMetaTitle) {\r\n    issues.push({ text: \"Missing meta title\", severity: \"error\" });\r\n  } else if (page.titleOverPixels) {\r\n    issues.push({ text: \"Title too wide (over pixel limit)\", severity: \"error\" });\r\n  } else if (page.titleOverLimit) {\r\n    issues.push({ text: \"Title too long\", severity: \"error\" });\r\n  }\r\n\r\n  if (!page.hasMetaDescription) {\r\n    issues.push({ text: \"Missing meta description\", severity: \"error\" });\r\n  } else if (page.descriptionOverPixels) {\r\n    issues.push({ text: \"Description too wide (over pixel limit)\", severity: \"error\" });\r\n  } else if (page.descriptionOverLimit) {\r\n    issues.push({ text: \"Description too long\", severity: \"error\" });\r\n  }\r\n\r\n  if (page.hasBrokenLinks \u0026\u0026 page.brokenLinks \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.brokenLinks} broken link${page.brokenLinks \u003e 1 ? \"s\" : \"\"}`, \r\n      severity: \"error\" \r\n    });\r\n  }\r\n\r\n  if (page.h1Count === 0) {\r\n    issues.push({ text: \"No H1 heading\", severity: \"error\" });\r\n  } else if (page.hasMultipleH1) {\r\n    issues.push({ text: `${page.h1Count} H1 headings (should be 1)`, severity: \"error\" });\r\n  }\r\n\r\n  if (page.hasLangAttribute !== undefined \u0026\u0026 !page.hasLangAttribute) {\r\n    issues.push({ text: \"Missing lang attribute\", severity: \"error\" });\r\n  }\r\n\r\n  if (page.hasCanonical !== undefined \u0026\u0026 !page.hasCanonical) {\r\n    issues.push({ text: \"Missing canonical URL\", severity: \"error\" });\r\n  }\r\n\r\n  if (page.hasMixedContent \u0026\u0026 page.mixedContentIssues \u0026\u0026 page.mixedContentIssues \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.mixedContentIssues} mixed content issue${page.mixedContentIssues \u003e 1 ? \"s\" : \"\"} (HTTP on HTTPS)`, \r\n      severity: \"error\" \r\n    });\r\n  }\r\n\r\n  // ============================================================================\r\n  // SEO Warning Issues\r\n  // ============================================================================\r\n  if (page.hasImagesWithoutAlt \u0026\u0026 page.imagesWithoutAlt \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.imagesWithoutAlt} image${page.imagesWithoutAlt \u003e 1 ? \"s\" : \"\"} without alt text`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  if (!page.hasH2s) {\r\n    issues.push({ text: \"No H2 headings\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasSchemaMarkup !== undefined \u0026\u0026 !page.hasSchemaMarkup) {\r\n    issues.push({ text: \"Missing schema markup\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasGenericAnchors \u0026\u0026 page.genericAnchorCount \u0026\u0026 page.genericAnchorCount \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.genericAnchorCount} generic anchor link${page.genericAnchorCount \u003e 1 ? \"s\" : \"\"} (e.g., \"click here\")`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  if (page.hasGenericAltText \u0026\u0026 page.imagesWithGenericAlt \u0026\u0026 page.imagesWithGenericAlt \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.imagesWithGenericAlt} image${page.imagesWithGenericAlt \u003e 1 ? \"s\" : \"\"} with generic alt text`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  if (page.internalLinksGood !== undefined \u0026\u0026 !page.internalLinksGood) {\r\n    if (page.internalLinksTooFew) {\r\n      issues.push({ text: \"Too few internal links\", severity: \"warning\" });\r\n    } else if (page.internalLinksTooMany) {\r\n      issues.push({ text: \"Too many internal links\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.firstParaGood !== undefined \u0026\u0026 !page.firstParaGood) {\r\n    issues.push({ text: \"First paragraph too short or missing\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.urlLengthGood !== undefined \u0026\u0026 !page.urlLengthGood) {\r\n    if (page.urlLengthOver \u0026\u0026 page.urlLength) {\r\n      issues.push({ text: `URL too long (${page.urlLength} chars)`, severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.outboundLinksGood !== undefined \u0026\u0026 !page.outboundLinksGood) {\r\n    if (page.outboundLinksTooFew) {\r\n      issues.push({ text: \"Too few outbound links\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.paragraphLengthGood !== undefined \u0026\u0026 !page.paragraphLengthGood) {\r\n    if (page.paragraphLengthIssues \u0026\u0026 page.paragraphLengthIssues \u003e 0) {\r\n      issues.push({ \r\n        text: `${page.paragraphLengthIssues} long paragraph${page.paragraphLengthIssues \u003e 1 ? \"s\" : \"\"}`, \r\n        severity: \"warning\" \r\n      });\r\n    }\r\n  }\r\n\r\n  if (page.subheadingDistributionGood !== undefined \u0026\u0026 !page.subheadingDistributionGood) {\r\n    issues.push({ text: \"Poor subheading distribution\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.mediaUsageGood !== undefined \u0026\u0026 !page.mediaUsageGood) {\r\n    if (page.mediaUsageTooFew) {\r\n      issues.push({ text: \"Too few images/media\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.hasDateInfo !== undefined \u0026\u0026 !page.hasDateInfo) {\r\n    issues.push({ text: \"Missing date information (published/updated)\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasMobileViewport !== undefined \u0026\u0026 !page.hasMobileViewport) {\r\n    issues.push({ text: \"Missing mobile viewport meta tag\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.socialMetaGood !== undefined \u0026\u0026 !page.socialMetaGood) {\r\n    // Provide specific details about what's missing\r\n    const missingParts: string[] = [];\r\n    if (page.hasOpenGraph !== undefined \u0026\u0026 !page.hasOpenGraph) {\r\n      missingParts.push(\"Open Graph (og:title, og:description, og:image)\");\r\n    }\r\n    if (page.hasTwitterCard !== undefined \u0026\u0026 !page.hasTwitterCard) {\r\n      missingParts.push(\"Twitter Card (twitter:card)\");\r\n    }\r\n    \r\n    if (missingParts.length \u003e 0) {\r\n      issues.push({ \r\n        text: `Missing social media tags: ${missingParts.join(\", \")}`, \r\n        severity: \"warning\" \r\n      });\r\n    } else {\r\n      // Fallback if individual flags aren't available\r\n      issues.push({ text: \"Incomplete social media meta tags (Open Graph/Twitter)\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.imagesNotNextGen \u0026\u0026 page.imagesNotNextGen \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.imagesNotNextGen} image${page.imagesNotNextGen \u003e 1 ? \"s\" : \"\"} not using next-gen format (WebP/AVIF)`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  if (page.imagesWithoutLazyLoading \u0026\u0026 page.imagesWithoutLazyLoading \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.imagesWithoutLazyLoading} image${page.imagesWithoutLazyLoading \u003e 1 ? \"s\" : \"\"} without lazy loading`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  // ============================================================================\r\n  // AI Crawlability Issues\r\n  // ============================================================================\r\n  if (page.hasSummary !== undefined) {\r\n    if (!page.hasSummary) {\r\n      issues.push({ text: \"Missing page summary/excerpt (critical for AI)\", severity: \"error\" });\r\n    } else if (page.summaryTooShort) {\r\n      issues.push({ text: \"Summary too short (\u003c50 chars) - AI needs more context\", severity: \"warning\" });\r\n    } else if (page.summaryTooLong) {\r\n      issues.push({ text: \"Summary too long (\u003e300 chars) - may be truncated\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (!page.hasH2s) {\r\n    issues.push({ text: \"No H2 headings - poor content structure for AI\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.wordCountPoor) {\r\n    issues.push({ text: \"Low word count - insufficient content for AI\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.readabilityGood !== undefined \u0026\u0026 !page.readabilityGood) {\r\n    if (page.avgSentenceLength \u0026\u0026 page.avgSentenceLength \u003e 20) {\r\n      issues.push({ \r\n        text: `Average sentence length too long (${Math.round(page.avgSentenceLength)} words) - affects readability`, \r\n        severity: \"warning\" \r\n      });\r\n    } else if (page.longSentences \u0026\u0026 page.longSentences.length \u003e 0) {\r\n      issues.push({ \r\n        text: `${page.longSentences.length} long sentence${page.longSentences.length \u003e 1 ? \"s\" : \"\"} (\u003e20 words)`, \r\n        severity: \"warning\" \r\n      });\r\n    }\r\n  }\r\n\r\n  if (page.hasLists !== undefined \u0026\u0026 !page.hasLists) {\r\n    issues.push({ text: \"No lists (bulleted/numbered) - structure helps AI parsing\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasBoldText !== undefined \u0026\u0026 !page.hasBoldText) {\r\n    issues.push({ text: \"No bold text - emphasis helps AI identify key points\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasCitations !== undefined \u0026\u0026 !page.hasCitations) {\r\n    issues.push({ text: \"No citations/references - reduces E-E-A-T score\", severity: \"warning\" });\r\n  } else if (page.citationsGood !== undefined \u0026\u0026 !page.citationsGood \u0026\u0026 page.citationCount !== undefined) {\r\n    issues.push({ text: `Only ${page.citationCount} citation${page.citationCount !== 1 ? \"s\" : \"\"} - more would improve E-E-A-T`, severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasAuthor !== undefined \u0026\u0026 !page.hasAuthor) {\r\n    issues.push({ text: \"Missing author information - reduces E-E-A-T score\", severity: \"warning\" });\r\n  }\r\n\r\n  if (page.hasVideos !== undefined \u0026\u0026 page.hasVideos \u0026\u0026 page.videoCount \u0026\u0026 page.videoCount \u003e 0) {\r\n    if (page.hasTranscript !== undefined \u0026\u0026 !page.hasTranscript) {\r\n      issues.push({ text: \"Video(s) without transcript - AI can't access video content\", severity: \"warning\" });\r\n    }\r\n  }\r\n\r\n  if (page.isStale) {\r\n    issues.push({ text: \"Stale content (needs update) - freshness affects AI ranking\", severity: \"warning\" });\r\n  }\r\n\r\n  // ============================================================================\r\n  // Accessibility Issues\r\n  // ============================================================================\r\n  if (page.hasContrastRatioIssues \u0026\u0026 page.contrastRatioIssues \u0026\u0026 page.contrastRatioIssues \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.contrastRatioIssues} contrast ratio issue${page.contrastRatioIssues \u003e 1 ? \"s\" : \"\"}`, \r\n      severity: \"error\" \r\n    });\r\n  }\r\n\r\n  if (page.hasMissingAriaLabels \u0026\u0026 page.missingAriaLabels \u0026\u0026 page.missingAriaLabels \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.missingAriaLabels} missing ARIA label${page.missingAriaLabels \u003e 1 ? \"s\" : \"\"}`, \r\n      severity: \"warning\" \r\n    });\r\n  }\r\n\r\n  if (page.hasKeyboardNavigationIssues \u0026\u0026 page.keyboardNavigationIssues \u0026\u0026 page.keyboardNavigationIssues \u003e 0) {\r\n    issues.push({ \r\n      text: `${page.keyboardNavigationIssues} keyboard navigation issue${page.keyboardNavigationIssues \u003e 1 ? \"s\" : \"\"}`, \r\n      severity: \"error\" \r\n    });\r\n  }\r\n\r\n  if (page.hasFocusIndicators !== undefined \u0026\u0026 page.hasFocusIndicators === false) {\r\n    issues.push({ text: \"Missing focus indicators\", severity: \"error\" });\r\n  }\r\n\r\n  return issues;\r\n}\r\n\r\n/**\r\n * Render issues HTML - sorted by severity (errors first, then warnings)\r\n */\r\nfunction renderIssues(issues: Array\u003c{ text: string; severity: \"error\" | \"warning\" }\u003e): string {\r\n  if (issues.length === 0) {\r\n    return `\r\n      \u003cdiv class=\"dev-score-bubble__issues\"\u003e\r\n        \u003cdiv class=\"dev-score-bubble__issues-header\"\u003e\r\n          \u003cspan class=\"dev-score-bubble__issues-title\"\u003eIssues\u003c/span\u003e\r\n          \u003cspan class=\"dev-score-bubble__issues-count issues-count--success\"\u003e0\u003c/span\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"dev-score-bubble__issues-list\"\u003e\r\n          \u003cdiv class=\"dev-score-bubble__issue-item issue-item--success\"\u003e\r\n            \u003cspan class=\"dev-score-bubble__issue-icon\"\u003e✓\u003c/span\u003e\r\n            \u003cspan class=\"dev-score-bubble__issue-text\"\u003eAll good! Perfect scores possible.\u003c/span\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    `;\r\n  }\r\n\r\n  // Sort issues: errors first, then warnings\r\n  const sortedIssues = [...issues].sort((a, b) =\u003e {\r\n    if (a.severity === \"error\" \u0026\u0026 b.severity === \"warning\") return -1;\r\n    if (a.severity === \"warning\" \u0026\u0026 b.severity === \"error\") return 1;\r\n    return 0;\r\n  });\r\n\r\n  const errorIssues = sortedIssues.filter(i =\u003e i.severity === \"error\");\r\n  const warningIssues = sortedIssues.filter(i =\u003e i.severity === \"warning\");\r\n\r\n  // Show more issues (up to 8) since we now have comprehensive checks\r\n  const maxIssues = 8;\r\n  const displayedIssues = sortedIssues.slice(0, maxIssues);\r\n  const remainingCount = sortedIssues.length - maxIssues;\r\n\r\n  return `\r\n    \u003cdiv class=\"dev-score-bubble__issues\"\u003e\r\n      \u003cdiv class=\"dev-score-bubble__issues-header\"\u003e\r\n        \u003cspan class=\"dev-score-bubble__issues-title\"\u003eIssues Affecting Scores\u003c/span\u003e\r\n        \u003cspan class=\"dev-score-bubble__issues-count ${errorIssues.length \u003e 0 ? \"issues-count--error\" : \"issues-count--warning\"}\"\u003e\r\n          ${issues.length}\r\n        \u003c/span\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"dev-score-bubble__issues-list\"\u003e\r\n        ${displayedIssues.map(issue =\u003e `\r\n          \u003cdiv class=\"dev-score-bubble__issue-item issue-item--${issue.severity}\"\u003e\r\n            \u003cspan class=\"dev-score-bubble__issue-icon\"\u003e${issue.severity === \"error\" ? \"✗\" : \"⚠\"}\u003c/span\u003e\r\n            \u003cspan class=\"dev-score-bubble__issue-text\"\u003e${issue.text}\u003c/span\u003e\r\n          \u003c/div\u003e\r\n        `).join(\"\")}\r\n        ${remainingCount \u003e 0 ? `\r\n          \u003cdiv class=\"dev-score-bubble__issue-more\"\u003e\r\n            +${remainingCount} more issue${remainingCount \u003e 1 ? \"s\" : \"\"}\r\n          \u003c/div\u003e\r\n        ` : \"\"}\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Render highlight tools section\r\n */\r\nfunction renderHighlightTools(page: PageData): string {\r\n  const tools: Array\u003c{ id: string; label: string; count: number }\u003e = [];\r\n\r\n  if (page.longSentences \u0026\u0026 page.longSentences.length \u003e 0) {\r\n    tools.push({\r\n      id: \"long-sentences\",\r\n      label: \"Long Sentences\",\r\n      count: page.longSentences.length,\r\n    });\r\n  }\r\n\r\n  if (page.hasImagesWithoutAlt \u0026\u0026 page.imagesWithoutAlt \u003e 0) {\r\n    tools.push({\r\n      id: \"images-no-alt\",\r\n      label: \"Images Without Alt Text\",\r\n      count: page.imagesWithoutAlt,\r\n    });\r\n  }\r\n\r\n  if (page.hasGenericAnchors \u0026\u0026 page.genericAnchorCount \u0026\u0026 page.genericAnchorCount \u003e 0) {\r\n    tools.push({\r\n      id: \"generic-anchors\",\r\n      label: \"Generic Anchor Links\",\r\n      count: page.genericAnchorCount,\r\n    });\r\n  }\r\n\r\n  if (page.hasBrokenLinks \u0026\u0026 page.brokenLinks \u003e 0) {\r\n    tools.push({\r\n      id: \"broken-links\",\r\n      label: \"Broken Links\",\r\n      count: page.brokenLinks,\r\n    });\r\n  }\r\n\r\n  if (page.hasGenericAltText \u0026\u0026 page.imagesWithGenericAlt \u0026\u0026 page.imagesWithGenericAlt \u003e 0) {\r\n    tools.push({\r\n      id: \"generic-alt-text\",\r\n      label: \"Generic Alt Text\",\r\n      count: page.imagesWithGenericAlt,\r\n    });\r\n  }\r\n\r\n  if (page.hasMultipleH1 \u0026\u0026 page.h1Count \u003e 1) {\r\n    tools.push({\r\n      id: \"multiple-h1\",\r\n      label: \"Multiple H1 Headings\",\r\n      count: page.h1Count,\r\n    });\r\n  }\r\n\r\n  if (tools.length === 0) {\r\n    return \"\";\r\n  }\r\n\r\n  return `\r\n    \u003cdiv class=\"dev-score-bubble__tools\"\u003e\r\n      \u003cdiv class=\"dev-score-bubble__tools-title\"\u003eHighlight on Page\u003c/div\u003e\r\n      ${tools.map(\r\n        (tool) =\u003e `\r\n        \u003cdiv class=\"dev-score-bubble__tool-item\"\u003e\r\n          \u003clabel class=\"dev-score-bubble__tool-toggle\"\u003e\r\n            \u003cinput type=\"checkbox\" class=\"dev-score-bubble__tool-checkbox\" data-toggle=\"${tool.id}\"\u003e\r\n            \u003cspan class=\"dev-score-bubble__tool-label\"\u003e${tool.label}\u003c/span\u003e\r\n            \u003cspan class=\"dev-score-bubble__tool-count\"\u003e(${tool.count})\u003c/span\u003e\r\n          \u003c/label\u003e\r\n        \u003c/div\u003e\r\n      `\r\n      ).join(\"\")}\r\n    \u003c/div\u003e\r\n    \u003cdiv class=\"dev-score-bubble__actions-section\"\u003e\r\n      \u003cbutton class=\"dev-score-bubble__action-button\" id=\"dev-score-bubble-keyword-research\" type=\"button\" aria-label=\"Analyze keywords\"\u003e\r\n        \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003esearch\u003c/span\u003e\r\n        \u003cspan\u003eKeyword Research\u003c/span\u003e\r\n      \u003c/button\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Calculate circumference for circular progress (radius = 54)\r\n */\r\nconst CIRCUMFERENCE = 2 * Math.PI * 54;\r\n\r\n/**\r\n * Create circular progress SVG\r\n */\r\nfunction createCircularProgress(score: number | null | undefined, size: number = 120): string {\r\n  // Defensive check: don't render if score is null, undefined, or not a number\r\n  if (score === null || score === undefined || typeof score !== 'number' || isNaN(score)) {\r\n    return `\r\n      \u003csvg class=\"dev-score-bubble__circle-svg\" viewBox=\"0 0 120 120\" width=\"${size}\" height=\"${size}\"\u003e\r\n        \u003ccircle class=\"dev-score-bubble__circle-bg\" cx=\"60\" cy=\"60\" r=\"54\"\u003e\u003c/circle\u003e\r\n      \u003c/svg\u003e\r\n    `;\r\n  }\r\n  \r\n  const scoreClass = getScoreClass(score);\r\n  const dashArray = (score / 100) * CIRCUMFERENCE;\r\n  \r\n  return `\r\n    \u003csvg class=\"dev-score-bubble__circle-svg\" viewBox=\"0 0 120 120\" width=\"${size}\" height=\"${size}\"\u003e\r\n      \u003ccircle class=\"dev-score-bubble__circle-bg\" cx=\"60\" cy=\"60\" r=\"54\"\u003e\u003c/circle\u003e\r\n      \u003ccircle \r\n        class=\"dev-score-bubble__circle-fill ${scoreClass}\" \r\n        cx=\"60\" \r\n        cy=\"60\" \r\n        r=\"54\"\r\n        style=\"stroke-dasharray: ${dashArray} ${CIRCUMFERENCE};\"\r\n      \u003e\u003c/circle\u003e\r\n    \u003c/svg\u003e\r\n  `;\r\n}\r\n\r\n/**\r\n * Create and render the score bubble\r\n */\r\nfunction createBubble(pageData: PageData | null): void {\r\n  // Remove existing bubble if present\r\n  const existingBubble = document.querySelector(\".dev-score-bubble\");\r\n  if (existingBubble) {\r\n    existingBubble.remove();\r\n  }\r\n\r\n  // Don't create bubble if no page data\r\n  if (!pageData) {\r\n    return;\r\n  }\r\n\r\n  const averageScore = getAverageScore(pageData.seoScore, pageData.aiCrawlabilityScore);\r\n  const averageScoreClass = getScoreClass(averageScore);\r\n  const seoColorClass = getScoreClass(pageData.seoScore);\r\n  const aiColorClass = getScoreClass(pageData.aiCrawlabilityScore);\r\n\r\n  const bubble = document.createElement(\"div\");\r\n  bubble.className = \"dev-score-bubble\";\r\n  bubble.setAttribute(\"data-dev-only\", \"true\");\r\n  bubble.setAttribute(\"data-state\", \"minimized\");\r\n\r\n  bubble.innerHTML = `\r\n    \u003c!-- Minimized circular state --\u003e\r\n    \u003cdiv class=\"dev-score-bubble__minimized\"\u003e\r\n      \u003cdiv class=\"dev-score-bubble__circle\"\u003e\r\n        ${createCircularProgress(averageScore, 80)}\r\n        \u003cdiv class=\"dev-score-bubble__circle-value\"\u003e\r\n          \u003cspan class=\"dev-score-bubble__circle-number\"\u003e${averageScore}\u003c/span\u003e\r\n          \u003cspan class=\"dev-score-bubble__circle-label\"\u003eAvg\u003c/span\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n\r\n    \u003c!-- Expanded state (shown on hover/click) --\u003e\r\n    \u003cdiv class=\"dev-score-bubble__expanded\"\u003e\r\n      \u003cdiv class=\"dev-score-bubble__header\"\u003e\r\n        \u003cdiv class=\"dev-score-bubble__header-content\"\u003e\r\n          \u003cspan class=\"dev-score-bubble__title\"\u003ePage Scores\u003c/span\u003e\r\n          \u003ca href=\"/page-list/\" class=\"dev-score-bubble__header-link\" aria-label=\"View full page list tool\" title=\"View Page List\"\u003e\r\n            \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elist\u003c/span\u003e\r\n          \u003c/a\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"dev-score-bubble__actions\"\u003e\r\n          \u003cbutton class=\"dev-score-bubble__minimize\" aria-label=\"Minimize score bubble\" title=\"Minimize\"\u003e−\u003c/button\u003e\r\n          \u003cbutton class=\"dev-score-bubble__close\" aria-label=\"Close score bubble\" title=\"Close\"\u003e×\u003c/button\u003e\r\n        \u003c/div\u003e\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"dev-score-bubble__content\"\u003e\r\n        \u003cdiv class=\"dev-score-bubble__score-item\"\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-circle\"\u003e\r\n            ${createCircularProgress(pageData.seoScore, 70)}\r\n            \u003cdiv class=\"dev-score-bubble__circle-value\"\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-number\"\u003e${pageData.seoScore}\u003c/span\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-label\"\u003eSEO\u003c/span\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-details\"\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-name\"\u003eSEO Score\u003c/div\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-description\"\u003eSearch engine optimization quality\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        \u003cdiv class=\"dev-score-bubble__score-item\"\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-circle\"\u003e\r\n            ${createCircularProgress(pageData.aiCrawlabilityScore, 70)}\r\n            \u003cdiv class=\"dev-score-bubble__circle-value\"\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-number\"\u003e${pageData.aiCrawlabilityScore}\u003c/span\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-label\"\u003eAI\u003c/span\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-details\"\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-name\"\u003eAI Crawlability\u003c/div\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-description\"\u003eAI bot accessibility score\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        ${pageData.accessibilityScore !== undefined \u0026\u0026 pageData.accessibilityScore !== null ? `\r\n        \u003cdiv class=\"dev-score-bubble__score-item\"\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-circle\"\u003e\r\n            ${createCircularProgress(pageData.accessibilityScore, 70)}\r\n            \u003cdiv class=\"dev-score-bubble__circle-value\"\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-number\"\u003e${pageData.accessibilityScore}\u003c/span\u003e\r\n              \u003cspan class=\"dev-score-bubble__circle-label\"\u003eA11Y\u003c/span\u003e\r\n            \u003c/div\u003e\r\n          \u003c/div\u003e\r\n          \u003cdiv class=\"dev-score-bubble__score-details\"\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-name\"\u003eAccessibility\u003c/div\u003e\r\n            \u003cdiv class=\"dev-score-bubble__score-description\"\u003eWCAG compliance score\u003c/div\u003e\r\n          \u003c/div\u003e\r\n        \u003c/div\u003e\r\n        ` : ''}\r\n        ${renderIssues(getPageIssues(pageData))}\r\n        ${renderHighlightTools(pageData)}\r\n      \u003c/div\u003e\r\n      \u003cdiv class=\"dev-score-bubble__footer\"\u003e\r\n        \u003cspan class=\"dev-score-bubble__page\"\u003e${pageData.title}\u003c/span\u003e\r\n      \u003c/div\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n\r\n  document.body.appendChild(bubble);\r\n  attachBubbleHandlers(bubble, pageData);\r\n}\r\n\r\n/**\r\n * Highlight long sentences on the page\r\n */\r\nfunction highlightLongSentences(sentences: string[]): void {\r\n  if (!sentences || sentences.length === 0) return;\r\n\r\n  // Remove existing highlights first\r\n  removeLongSentenceHighlights();\r\n\r\n  const mainContentElement = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const mainContent = mainContentElement instanceof HTMLElement ? mainContentElement : document.body;\r\n  \r\n  sentences.forEach((sentence, index) =\u003e {\r\n    // Normalize the sentence text for searching (remove extra whitespace)\r\n    const normalizedSentence = sentence.trim().replace(/\\s+/g, \" \");\r\n    \r\n    // Simple text-based search and highlight\r\n    highlightTextInElement(mainContent, normalizedSentence, index);\r\n  });\r\n}\r\n\r\n/**\r\n * Highlight text within an element using a simple replace approach\r\n */\r\nfunction highlightTextInElement(element: HTMLElement, searchText: string, index: number): boolean {\r\n  // Skip if already highlighted anywhere\r\n  if (document.querySelector(`.dev-score-bubble__highlight[data-sentence-index=\"${index}\"]`)) {\r\n    return true; // Already highlighted\r\n  }\r\n\r\n  // Skip script, style, and other non-content elements\r\n  if (\r\n    element.tagName === \"SCRIPT\" ||\r\n    element.tagName === \"STYLE\" ||\r\n    element.classList.contains(\"dev-score-bubble\") ||\r\n    element.closest(\".dev-score-bubble\")\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  // Process child nodes recursively\r\n  const children = Array.from(element.childNodes);\r\n  let found = false;\r\n  \r\n  for (const node of children) {\r\n    if (found) break; // Stop after first match\r\n    \r\n    if (node.nodeType === Node.TEXT_NODE) {\r\n      const textNode = node as Text;\r\n      const text = textNode.textContent || \"\";\r\n      \r\n      // Check if this exact sentence is in the text\r\n      if (text.includes(searchText) \u0026\u0026 !found) {\r\n        // Found the text - highlight it\r\n        const parent = textNode.parentElement;\r\n        if (!parent) continue;\r\n\r\n        const parts = text.split(searchText);\r\n        const fragment = document.createDocumentFragment();\r\n\r\n        parts.forEach((part, i) =\u003e {\r\n          if (part) {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n          if (i \u003c parts.length - 1) {\r\n            const highlight = document.createElement(\"mark\");\r\n            highlight.className = \"dev-score-bubble__highlight dev-score-bubble__highlight--long-sentence\";\r\n            highlight.setAttribute(\"data-sentence-index\", index.toString());\r\n            highlight.setAttribute(\"data-highlight-type\", \"long-sentences\");\r\n            highlight.textContent = searchText;\r\n            fragment.appendChild(highlight);\r\n            found = true; // Mark as found to stop further processing\r\n          }\r\n        });\r\n\r\n        if (found) {\r\n          parent.replaceChild(fragment, textNode);\r\n          return true; // Found and highlighted, stop searching\r\n        }\r\n      }\r\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n      if (highlightTextInElement(node as HTMLElement, searchText, index)) {\r\n        found = true;\r\n        break; // Found, stop processing\r\n      }\r\n    }\r\n  }\r\n\r\n  return found;\r\n}\r\n\r\n/**\r\n * Remove all long sentence highlights\r\n */\r\nfunction removeLongSentenceHighlights(): void {\r\n  const highlights = document.querySelectorAll(\".dev-score-bubble__highlight[data-highlight-type='long-sentences']\");\r\n  highlights.forEach((highlight) =\u003e {\r\n    const parent = highlight.parentElement;\r\n    if (parent \u0026\u0026 highlight.textContent) {\r\n      // Replace the highlight with its text content\r\n      const textNode = document.createTextNode(highlight.textContent);\r\n      parent.replaceChild(textNode, highlight);\r\n      // Normalize to merge adjacent text nodes\r\n      parent.normalize();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Attach event handlers to the bubble\r\n */\r\nfunction attachBubbleHandlers(bubble: HTMLElement, pageData: PageData): void {\r\n  const closeButton = bubble.querySelector(\".dev-score-bubble__close\") as HTMLElement;\r\n  const minimizeButton = bubble.querySelector(\".dev-score-bubble__minimize\") as HTMLElement;\r\n  const minimized = bubble.querySelector(\".dev-score-bubble__minimized\") as HTMLElement;\r\n\r\n  // Close button handler\r\n  if (closeButton) {\r\n    closeButton.addEventListener(\"click\", (e) =\u003e {\r\n      e.stopPropagation();\r\n      bubble.remove();\r\n      sessionStorage.setItem(\"dev-score-bubble-hidden\", \"true\");\r\n    });\r\n  }\r\n\r\n  // Minimize button handler\r\n  if (minimizeButton) {\r\n    minimizeButton.addEventListener(\"click\", (e) =\u003e {\r\n      e.stopPropagation();\r\n      bubble.setAttribute(\"data-state\", \"minimized\");\r\n      sessionStorage.setItem(\"dev-score-bubble-expanded\", \"false\");\r\n    });\r\n  }\r\n\r\n  // Click on minimized to expand and lock\r\n  if (minimized) {\r\n    minimized.addEventListener(\"click\", (e) =\u003e {\r\n      e.stopPropagation();\r\n      bubble.setAttribute(\"data-state\", \"expanded-locked\");\r\n      sessionStorage.setItem(\"dev-score-bubble-expanded\", \"true\");\r\n    });\r\n  }\r\n\r\n  // Hover to expand (only if not locked)\r\n  bubble.addEventListener(\"mouseenter\", () =\u003e {\r\n    const state = bubble.getAttribute(\"data-state\");\r\n    if (state === \"minimized\") {\r\n      bubble.setAttribute(\"data-state\", \"expanded-hover\");\r\n    }\r\n  });\r\n\r\n  bubble.addEventListener(\"mouseleave\", () =\u003e {\r\n    const state = bubble.getAttribute(\"data-state\");\r\n    if (state === \"expanded-hover\") {\r\n      bubble.setAttribute(\"data-state\", \"minimized\");\r\n    }\r\n  });\r\n\r\n  // Restore expanded state if previously locked\r\n  const expanded = sessionStorage.getItem(\"dev-score-bubble-expanded\");\r\n  if (expanded === \"true\") {\r\n    bubble.setAttribute(\"data-state\", \"expanded-locked\");\r\n  }\r\n\r\n  // Setup all highlight toggles\r\n  setupHighlightToggles(bubble, pageData);\r\n\r\n  // Setup keyword research button\r\n  setupKeywordResearch(bubble, pageData);\r\n\r\n  // Clean up highlights when bubble is removed\r\n  const observer = new MutationObserver(() =\u003e {\r\n    if (!document.body.contains(bubble)) {\r\n      removeAllHighlights();\r\n      observer.disconnect();\r\n    }\r\n  });\r\n  observer.observe(document.body, { childList: true, subtree: true });\r\n}\r\n\r\n/**\r\n * Setup all highlight toggle handlers\r\n */\r\nfunction setupHighlightToggles(bubble: HTMLElement, pageData: PageData): void {\r\n  const toggles = bubble.querySelectorAll('[data-toggle]') as NodeListOf\u003cHTMLInputElement\u003e;\r\n  \r\n  toggles.forEach((toggle) =\u003e {\r\n    const toggleType = toggle.getAttribute(\"data-toggle\");\r\n    if (!toggleType) return;\r\n\r\n    // Restore state\r\n    const storageKey = `dev-score-bubble-highlight-${toggleType}`;\r\n    const wasEnabled = sessionStorage.getItem(storageKey) === \"true\";\r\n    if (wasEnabled) {\r\n      toggle.checked = true;\r\n      applyHighlight(toggleType, pageData, true);\r\n    }\r\n\r\n    // Add change handler\r\n    toggle.addEventListener(\"change\", (e) =\u003e {\r\n      const target = e.target as HTMLInputElement;\r\n      applyHighlight(toggleType, pageData, target.checked);\r\n      sessionStorage.setItem(storageKey, target.checked ? \"true\" : \"false\");\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Apply or remove highlight based on type\r\n */\r\nfunction applyHighlight(type: string, pageData: PageData, enabled: boolean): void {\r\n  if (enabled) {\r\n    switch (type) {\r\n      case \"long-sentences\":\r\n        if (pageData.longSentences) {\r\n          highlightLongSentences(pageData.longSentences);\r\n        }\r\n        break;\r\n      case \"images-no-alt\":\r\n        highlightImagesWithoutAlt();\r\n        break;\r\n      case \"generic-anchors\":\r\n        highlightGenericAnchors();\r\n        break;\r\n      case \"broken-links\":\r\n        if (pageData.brokenLinkUrls) {\r\n          highlightBrokenLinks(pageData.brokenLinkUrls);\r\n        }\r\n        break;\r\n      case \"generic-alt-text\":\r\n        highlightGenericAltText();\r\n        break;\r\n      case \"multiple-h1\":\r\n        highlightMultipleH1();\r\n        break;\r\n    }\r\n  } else {\r\n    removeHighlight(type);\r\n  }\r\n}\r\n\r\n/**\r\n * Setup keyword research button handler\r\n */\r\nasync function setupKeywordResearch(bubble: HTMLElement, pageData: PageData): Promise\u003cvoid\u003e {\r\n  const keywordBtn = bubble.querySelector('#dev-score-bubble-keyword-research') as HTMLElement;\r\n  if (!keywordBtn) return;\r\n\r\n  keywordBtn.addEventListener('click', async (e) =\u003e {\r\n    e.stopPropagation();\r\n    \r\n    // Show loading indicator on button\r\n    const originalContent = keywordBtn.innerHTML;\r\n    keywordBtn.setAttribute('disabled', 'true');\r\n    keywordBtn.innerHTML = `\r\n      \u003cspan class=\"material-symbols-outlined\" style=\"animation: spin 1s linear infinite;\" aria-hidden=\"true\"\u003ehourglass_empty\u003c/span\u003e\r\n      \u003cspan\u003eAnalyzing...\u003c/span\u003e\r\n    `;\r\n    \r\n    try {\r\n      // Small delay to show loading state\r\n      await new Promise(resolve =\u003e setTimeout(resolve, 100));\r\n      \r\n      // Get current page content\r\n      const title = document.querySelector('title')?.textContent || pageData.title;\r\n      const metaDescription = document.querySelector('meta[name=\"description\"]')?.getAttribute('content') || '';\r\n      \r\n      // Get body text content\r\n      const bodyText = document.body?.textContent || '';\r\n      \r\n      // Remove script and style content from rendered DOM\r\n      const bodyClone = document.body.cloneNode(true) as HTMLElement;\r\n      let cleanText: string;\r\n      if (bodyClone) {\r\n        // Remove non-content elements\r\n        bodyClone.querySelectorAll('script, style, nav, header, footer, .dev-score-bubble, aside').forEach(el =\u003e el.remove());\r\n        cleanText = bodyClone.textContent || bodyText;\r\n      } else {\r\n        // Fallback if clone fails\r\n        cleanText = bodyText;\r\n      }\r\n      \r\n      // Analyze keywords\r\n      const analysis = analyzeKeywords(cleanText, title, metaDescription);\r\n      \r\n      // For gap analysis, we'd need all pages data - skip for now or fetch it\r\n      // For simplicity, we'll skip gap analysis in dev-score-bubble\r\n      const gapAnalysis = undefined;\r\n      \r\n      // Load competitor keywords from localStorage\r\n      const STORAGE_KEY = 'page-list-competitors';\r\n      let competitorKeywords: Array\u003c{ url: string; keywords: any }\u003e = [];\r\n      try {\r\n        const stored = localStorage.getItem(STORAGE_KEY);\r\n        if (stored) {\r\n          const parsed = JSON.parse(stored);\r\n          competitorKeywords = parsed.filter((c: any) =\u003e c.keywords \u0026\u0026 !c.loading);\r\n        }\r\n      } catch (error) {\r\n        console.warn('Could not load competitor keywords:', error);\r\n      }\r\n      \r\n      // Restore button state\r\n      keywordBtn.removeAttribute('disabled');\r\n      keywordBtn.innerHTML = originalContent;\r\n      \r\n      // Render and show keyword research modal\r\n      const modalHtml = renderKeywordResearchModal(analysis, pageData.title, pageData.relPermalink, gapAnalysis, competitorKeywords);\r\n      document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n      \r\n      const keywordModal = document.getElementById('dev-keyword-research-modal');\r\n      if (!keywordModal) return;\r\n      \r\n      // Attach close handlers\r\n      const closeBtn = keywordModal.querySelector('#dev-keyword-research-close');\r\n      const overlay = keywordModal.querySelector('.dev-score-bubble-modal-overlay');\r\n      const modalClose = keywordModal.querySelector('.dev-score-bubble-modal-close');\r\n      \r\n      const closeModal = () =\u003e {\r\n        keywordModal.remove();\r\n      };\r\n      \r\n      if (closeBtn) closeBtn.addEventListener('click', closeModal);\r\n      if (overlay) overlay.addEventListener('click', closeModal);\r\n      if (modalClose) modalClose.addEventListener('click', closeModal);\r\n      \r\n      // Close on Escape key\r\n      const handleEscape = (e: KeyboardEvent) =\u003e {\r\n        if (e.key === 'Escape' \u0026\u0026 keywordModal) {\r\n          closeModal();\r\n          document.removeEventListener('keydown', handleEscape);\r\n        }\r\n      };\r\n      document.addEventListener('keydown', handleEscape);\r\n      \r\n      // Attach seed keyword search functionality\r\n      attachSeedKeywordSearch(keywordModal);\r\n      \r\n      // Attach competitor keyword removal functionality\r\n      attachCompetitorKeywordRemoval(keywordModal);\r\n      \r\n      // Attach export handlers (no allPageKeywords in dev-score-bubble context)\r\n      attachExportHandlers(keywordModal, analysis);\r\n      \r\n    } catch (error) {\r\n      console.error('Error analyzing keywords:', error);\r\n      // Restore button state on error\r\n      keywordBtn.removeAttribute('disabled');\r\n      keywordBtn.innerHTML = originalContent;\r\n      showToast('Error analyzing keywords. Please try again.', 'error', 5000, 'dev');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Remove specific highlight type\r\n */\r\nfunction removeHighlight(type: string): void {\r\n  if (type === \"long-sentences\") {\r\n    removeLongSentenceHighlights();\r\n    return;\r\n  }\r\n\r\n  const selector = `.dev-score-bubble__highlight[data-highlight-type=\"${type}\"]`;\r\n  const highlights = document.querySelectorAll(selector);\r\n  \r\n  highlights.forEach((highlight) =\u003e {\r\n    if (highlight instanceof HTMLElement) {\r\n      // Remove highlight classes and inline styles\r\n      highlight.classList.remove(\"dev-score-bubble__highlight\");\r\n      highlight.classList.remove(`dev-score-bubble__highlight--${type.replace(/-/g, \"-\")}`);\r\n      highlight.removeAttribute(\"data-highlight-type\");\r\n      \r\n      // Remove inline styles added for highlighting\r\n      highlight.style.outline = \"\";\r\n      highlight.style.outlineOffset = \"\";\r\n      highlight.style.boxShadow = \"\";\r\n      highlight.style.backgroundColor = \"\";\r\n      highlight.style.borderBottom = \"\";\r\n      highlight.style.borderLeft = \"\";\r\n      highlight.style.padding = \"\";\r\n      highlight.style.paddingLeft = \"\";\r\n      highlight.style.marginLeft = \"\";\r\n      highlight.style.textDecoration = \"\";\r\n      highlight.style.borderRadius = \"\";\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Remove all highlights\r\n */\r\nfunction removeAllHighlights(): void {\r\n  const types = [\"long-sentences\", \"images-no-alt\", \"generic-anchors\", \"broken-links\", \"generic-alt-text\", \"multiple-h1\"];\r\n  types.forEach((type) =\u003e removeHighlight(type));\r\n}\r\n\r\n/**\r\n * Highlight images without alt text\r\n */\r\nfunction highlightImagesWithoutAlt(): void {\r\n  const mainContent = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const images = mainContent.querySelectorAll(\"img:not([alt]), img[alt='']\");\r\n  \r\n  images.forEach((img) =\u003e {\r\n    if (img.classList.contains(\"dev-score-bubble__highlight\")) return;\r\n    \r\n    const imgElement = img as HTMLElement;\r\n    imgElement.classList.add(\"dev-score-bubble__highlight\", \"dev-score-bubble__highlight--image-no-alt\");\r\n    imgElement.setAttribute(\"data-highlight-type\", \"images-no-alt\");\r\n    imgElement.style.cssText += `\r\n      outline: 3px solid #ef4444 !important;\r\n      outline-offset: 2px !important;\r\n      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2) !important;\r\n    `;\r\n  });\r\n}\r\n\r\n/**\r\n * Highlight generic anchor links\r\n */\r\nfunction highlightGenericAnchors(): void {\r\n  const genericTexts = [\"click here\", \"read more\", \"here\", \"link\", \"more\", \"see more\", \"learn more\", \"click\", \"link\"];\r\n  const mainContent = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const links = mainContent.querySelectorAll(\"a\");\r\n  \r\n  links.forEach((link) =\u003e {\r\n    const text = (link.textContent || \"\").trim().toLowerCase();\r\n    if (genericTexts.includes(text)) {\r\n      link.classList.add(\"dev-score-bubble__highlight\", \"dev-score-bubble__highlight--generic-anchor\");\r\n      link.setAttribute(\"data-highlight-type\", \"generic-anchors\");\r\n      link.style.cssText += `\r\n        background-color: #fee2e2 !important;\r\n        border-bottom: 2px solid #dc2626 !important;\r\n        padding: 1px 2px !important;\r\n        border-radius: 2px !important;\r\n      `;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Highlight broken links\r\n */\r\nfunction highlightBrokenLinks(brokenUrls: string[]): void {\r\n  const mainContent = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const links = mainContent.querySelectorAll(\"a[href]\");\r\n  \r\n  links.forEach((link) =\u003e {\r\n    const href = link.getAttribute(\"href\") || \"\";\r\n    // Normalize URL for comparison\r\n    const normalizedHref = href.split(\"#\")[0]; // Remove fragment\r\n    \r\n    if (brokenUrls.some((brokenUrl) =\u003e {\r\n      const normalizedBroken = brokenUrl.split(\"#\")[0];\r\n      return normalizedHref === normalizedBroken || normalizedHref.endsWith(normalizedBroken);\r\n    })) {\r\n      const linkElement = link as HTMLElement;\r\n      linkElement.classList.add(\"dev-score-bubble__highlight\", \"dev-score-bubble__highlight--broken-link\");\r\n      linkElement.setAttribute(\"data-highlight-type\", \"broken-links\");\r\n      linkElement.setAttribute(\"data-broken-url\", href);\r\n      linkElement.style.cssText += `\r\n        background-color: #fee2e2 !important;\r\n        border-bottom: 2px dashed #dc2626 !important;\r\n        padding: 1px 2px !important;\r\n        text-decoration: line-through !important;\r\n      `;\r\n      \r\n      // Add click handler for broken link actions\r\n      attachBrokenLinkHandler(linkElement, href);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Highlight images with generic alt text\r\n */\r\nfunction highlightGenericAltText(): void {\r\n  const genericAlts = [\"image\", \"img\", \"photo\", \"picture\", \"graphic\", \"\"];\r\n  const mainContent = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const images = mainContent.querySelectorAll(\"img[alt]\");\r\n  \r\n  images.forEach((img) =\u003e {\r\n    const alt = (img.getAttribute(\"alt\") || \"\").trim().toLowerCase();\r\n    if (genericAlts.includes(alt)) {\r\n      const imgElement = img as HTMLElement;\r\n      imgElement.classList.add(\"dev-score-bubble__highlight\", \"dev-score-bubble__highlight--generic-alt\");\r\n      imgElement.setAttribute(\"data-highlight-type\", \"generic-alt-text\");\r\n      imgElement.style.cssText += `\r\n        outline: 3px solid #f59e0b !important;\r\n        outline-offset: 2px !important;\r\n        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.2) !important;\r\n      `;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Highlight multiple H1 headings\r\n */\r\nfunction highlightMultipleH1(): void {\r\n  const mainContent = document.querySelector(\".prose, main, .page-content\") || document.body;\r\n  const h1s = mainContent.querySelectorAll(\"h1\");\r\n  \r\n  if (h1s.length \u003e 1) {\r\n    h1s.forEach((h1) =\u003e {\r\n      h1.classList.add(\"dev-score-bubble__highlight\", \"dev-score-bubble__highlight--multiple-h1\");\r\n      h1.setAttribute(\"data-highlight-type\", \"multiple-h1\");\r\n      h1.style.cssText += `\r\n        background-color: #fef3c7 !important;\r\n        border-left: 4px solid #f59e0b !important;\r\n        padding-left: 8px !important;\r\n        margin-left: -4px !important;\r\n      `;\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Attach click handler to broken link for context menu\r\n */\r\nfunction attachBrokenLinkHandler(link: HTMLElement, brokenUrl: string): void {\r\n  // Store original href to restore if needed\r\n  const originalHref = (link as HTMLAnchorElement).href;\r\n  \r\n  // Prevent default navigation for broken links, but allow normal clicks to show menu\r\n  link.addEventListener(\"click\", (e) =\u003e {\r\n    // Show menu on any click (since link is broken anyway)\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    showBrokenLinkContextMenu(link, brokenUrl, e);\r\n  });\r\n  \r\n  // Also handle right-click context menu\r\n  link.addEventListener(\"contextmenu\", (e) =\u003e {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    showBrokenLinkContextMenu(link, brokenUrl, e);\r\n  });\r\n  \r\n  // Add visual indicator that link is interactive\r\n  link.setAttribute(\"title\", `Broken link: ${brokenUrl}\\nClick to fix, edit, or remove`);\r\n}\r\n\r\n// createConfirmationDialog and createUrlInputDialog are now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Show context menu for broken link actions\r\n */\r\nfunction showBrokenLinkContextMenu(link: HTMLElement, brokenUrl: string, event: MouseEvent): void {\r\n  // Remove existing menu if any\r\n  const existingMenu = document.querySelector(\".dev-score-bubble__broken-link-menu\");\r\n  if (existingMenu) {\r\n    existingMenu.remove();\r\n  }\r\n  \r\n  const menu = document.createElement(\"div\");\r\n  menu.className = \"dev-score-bubble__broken-link-menu\";\r\n  menu.setAttribute(\"role\", \"menu\");\r\n  menu.setAttribute(\"aria-label\", \"Broken link actions\");\r\n  \r\n  menu.innerHTML = `\r\n    \u003cdiv class=\"dev-score-bubble__broken-link-menu-header\"\u003e\r\n      \u003cspan class=\"dev-score-bubble__broken-link-menu-title\"\u003eBroken Link\u003c/span\u003e\r\n      \u003cbutton class=\"dev-score-bubble__broken-link-menu-close\" aria-label=\"Close menu\" type=\"button\"\u003e×\u003c/button\u003e\r\n    \u003c/div\u003e\r\n    \u003cdiv class=\"dev-score-bubble__broken-link-menu-url\"\u003e\r\n      \u003ccode\u003e${escapeHtml(brokenUrl)}\u003c/code\u003e\r\n    \u003c/div\u003e\r\n    \u003cdiv class=\"dev-score-bubble__broken-link-menu-actions\" role=\"group\"\u003e\r\n      \u003cbutton \r\n        class=\"dev-score-bubble__broken-link-menu-action\" \r\n        data-action=\"fix\"\r\n        type=\"button\"\r\n        aria-label=\"Auto-fix broken link\"\r\n      \u003e\r\n        \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eauto_fix_high\u003c/span\u003e\r\n        \u003cspan\u003eAuto-Fix\u003c/span\u003e\r\n      \u003c/button\u003e\r\n      \u003cbutton \r\n        class=\"dev-score-bubble__broken-link-menu-action\" \r\n        data-action=\"edit\"\r\n        type=\"button\"\r\n        aria-label=\"Edit link URL\"\r\n      \u003e\r\n        \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003eedit\u003c/span\u003e\r\n        \u003cspan\u003eEdit URL\u003c/span\u003e\r\n      \u003c/button\u003e\r\n      \u003cbutton \r\n        class=\"dev-score-bubble__broken-link-menu-action\" \r\n        data-action=\"remove\"\r\n        type=\"button\"\r\n        aria-label=\"Remove link and keep text\"\r\n      \u003e\r\n        \u003cspan class=\"material-symbols-outlined\" aria-hidden=\"true\"\u003elink_off\u003c/span\u003e\r\n        \u003cspan\u003eRemove Link\u003c/span\u003e\r\n      \u003c/button\u003e\r\n    \u003c/div\u003e\r\n  `;\r\n  \r\n  document.body.appendChild(menu);\r\n  \r\n  // Position menu near the link\r\n  const linkRect = link.getBoundingClientRect();\r\n  const menuRect = menu.getBoundingClientRect();\r\n  const viewportWidth = window.innerWidth;\r\n  const viewportHeight = window.innerHeight;\r\n  \r\n  let left = linkRect.left + (linkRect.width / 2) - (menuRect.width / 2);\r\n  let top = linkRect.bottom + 8;\r\n  \r\n  // Adjust if menu would go off screen\r\n  if (left + menuRect.width \u003e viewportWidth) {\r\n    left = viewportWidth - menuRect.width - 10;\r\n  }\r\n  if (left \u003c 10) {\r\n    left = 10;\r\n  }\r\n  if (top + menuRect.height \u003e viewportHeight) {\r\n    top = linkRect.top - menuRect.height - 8;\r\n  }\r\n  if (top \u003c 10) {\r\n    top = 10;\r\n  }\r\n  \r\n  menu.style.left = `${left}px`;\r\n  menu.style.top = `${top}px`;\r\n  \r\n  // Attach handlers\r\n  const closeBtn = menu.querySelector(\".dev-score-bubble__broken-link-menu-close\");\r\n  const fixBtn = menu.querySelector('[data-action=\"fix\"]');\r\n  const editBtn = menu.querySelector('[data-action=\"edit\"]');\r\n  const removeBtn = menu.querySelector('[data-action=\"remove\"]');\r\n  \r\n  let clickHandlerRef: ((e: MouseEvent) =\u003e void) | null = null;\r\n  \r\n  const closeMenu = () =\u003e {\r\n    menu.remove();\r\n    if (clickHandlerRef) {\r\n      document.removeEventListener(\"click\", clickHandlerRef);\r\n      clickHandlerRef = null;\r\n    }\r\n    document.removeEventListener(\"keydown\", handleEscape);\r\n  };\r\n  \r\n  const handleOutsideClick = (e: MouseEvent) =\u003e {\r\n    const target = e.target as Node;\r\n    // Don't close if clicking on a modal or dialog\r\n    const isModal = (target as Element)?.closest('.dev-score-bubble-modal, .dev-score-bubble-modal-overlay');\r\n    if (!menu.contains(target) \u0026\u0026 !link.contains(target) \u0026\u0026 !isModal) {\r\n      closeMenu();\r\n    }\r\n  };\r\n  \r\n  const handleEscape = (e: KeyboardEvent) =\u003e {\r\n    if (e.key === \"Escape\") {\r\n      closeMenu();\r\n    }\r\n  };\r\n  \r\n  closeBtn?.addEventListener(\"click\", (e) =\u003e {\r\n    e.stopPropagation();\r\n    closeMenu();\r\n  });\r\n  \r\n  // Use a more persistent click handler that checks for modals\r\n  clickHandlerRef = (e: MouseEvent) =\u003e {\r\n    handleOutsideClick(e);\r\n  };\r\n  \r\n  // Delay adding the outside click handler slightly to avoid immediate closure\r\n  setTimeout(() =\u003e {\r\n    if (clickHandlerRef) {\r\n      document.addEventListener(\"click\", clickHandlerRef);\r\n    }\r\n  }, 100);\r\n  \r\n  document.addEventListener(\"keydown\", handleEscape);\r\n  \r\n  fixBtn?.addEventListener(\"click\", async (e) =\u003e {\r\n    e.stopPropagation();\r\n    closeMenu();\r\n    \r\n    // Show confirmation modal before fixing\r\n    const confirmed = await createConfirmationDialog(\r\n      'Auto-Fix Broken Link',\r\n      `Attempt to automatically fix the broken link \"${brokenUrl}\"?\\n\\n` +\r\n      'This will search for a matching URL and update the link if found.',\r\n      'Fix Link',\r\n      'Cancel',\r\n      'dev'\r\n    );\r\n    \r\n    if (confirmed) {\r\n      await handleFixBrokenLink(link, brokenUrl);\r\n    }\r\n  });\r\n  \r\n  editBtn?.addEventListener(\"click\", async (e) =\u003e {\r\n    e.stopPropagation();\r\n    closeMenu();\r\n    \r\n    // Show confirmation modal before editing\r\n    const confirmed = await createConfirmationDialog(\r\n      'Edit Broken Link',\r\n      `Edit the URL for the broken link \"${brokenUrl}\"?\\n\\n` +\r\n      'You will be prompted to enter a new URL.',\r\n      'Edit Link',\r\n      'Cancel',\r\n      'dev'\r\n    );\r\n    \r\n    if (confirmed) {\r\n      await handleEditBrokenLink(link, brokenUrl);\r\n    }\r\n  });\r\n  \r\n  removeBtn?.addEventListener(\"click\", async (e) =\u003e {\r\n    e.stopPropagation();\r\n    closeMenu();\r\n    \r\n    // Show confirmation modal before removing\r\n    const confirmed = await createConfirmationDialog(\r\n      'Remove Broken Link',\r\n      `Remove the link \"${brokenUrl}\" and keep only the text?\\n\\nText: \"${link.textContent?.trim() || \"\"}\"\\n\\n` +\r\n      'A backup will be created before making changes.',\r\n      'Remove Link',\r\n      'Cancel',\r\n      'dev'\r\n    );\r\n    \r\n    if (confirmed) {\r\n      await handleRemoveBrokenLink(link, brokenUrl);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\n// escapeHtml is now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Handle auto-fix broken link\r\n */\r\nasync function handleFixBrokenLink(link: HTMLElement, brokenUrl: string): Promise\u003cvoid\u003e {\r\n  if (!isLocalhost()) {\r\n    await createConfirmationDialog(\r\n      'Development Mode Only',\r\n      'This feature is only available in development mode.',\r\n      'OK',\r\n      undefined, // No cancel button for info messages\r\n      'dev'\r\n    );\r\n    return;\r\n  }\r\n  \r\n  // ALWAYS request directory access first if not already granted\r\n  if ('showDirectoryPicker' in window \u0026\u0026 !getSiteRootDirectoryHandle()) {\r\n    const accessGranted = await createConfirmationDialog(\r\n      'Select Site Root Folder',\r\n      'To fix broken links, you need to select your Hugo site root folder.\\n\\n' +\r\n      'Click \"Select Folder\" below, then navigate to and select the folder that contains your \"content\" folder.\\n\\n' +\r\n      'Example: If your site is at /Users/you/my-site/, select that folder.\\n\\n' +\r\n      'This permission is only requested once per browser session.',\r\n      'Select Folder',\r\n      'Skip (Use Manual File Selection)',\r\n      'dev'\r\n    );\r\n    \r\n    if (accessGranted) {\r\n      const dirHandle = await requestSiteRootAccess();\r\n      if (!dirHandle) {\r\n        showToast('You can still manually select the file when prompted.', 'info', 5000, 'dev');\r\n      } else {\r\n        showToast('Directory access granted!', 'success', 5000, 'dev');\r\n      }\r\n    } else {\r\n      showToast('You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n    }\r\n  } else if (!('showDirectoryPicker' in window)) {\r\n    showToast('File System Access API not supported. You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n  }\r\n  \r\n  try {\r\n    // Fetch all page paths to find a match\r\n    const response = await fetch(\"/page-list/index.json\");\r\n    if (!response.ok) {\r\n      throw new Error(\"Could not fetch page data\");\r\n    }\r\n    \r\n    const data = await response.json();\r\n    const allPagePaths = data.pages.map((p: PageData) =\u003e p.relPermalink);\r\n    \r\n    // Find potential match using similar logic to page-list.ts\r\n    const match = findUrlMatch(brokenUrl, allPagePaths, data.pages);\r\n    \r\n    if (match) {\r\n      // Update the link\r\n      if (link.tagName === \"A\") {\r\n        (link as HTMLAnchorElement).href = match.match;\r\n        link.classList.remove(\"dev-score-bubble__highlight--broken-link\");\r\n        link.removeAttribute(\"data-broken-url\");\r\n        link.style.textDecoration = \"\";\r\n        link.style.backgroundColor = \"\";\r\n        link.style.borderBottom = \"\";\r\n        \r\n        // Show success message\r\n        showToast(`Link fixed: ${brokenUrl} → ${match.match}`, \"success\", 5000, 'dev');\r\n        \r\n        // Try to update the source file\r\n        await updateLinkInSourceFile(brokenUrl, match.match);\r\n      }\r\n    } else {\r\n      showToast(`No match found for: ${brokenUrl}`, \"error\", 5000, 'dev');\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error fixing broken link:\", error);\r\n    showToast(`Error fixing link: ${error instanceof Error ? error.message : \"Unknown error\"}`, \"error\", 5000, 'dev');\r\n  }\r\n}\r\n\r\n/**\r\n * Handle edit broken link URL\r\n */\r\nasync function handleEditBrokenLink(link: HTMLElement, brokenUrl: string): Promise\u003cvoid\u003e {\r\n  if (!isLocalhost()) {\r\n    await createConfirmationDialog(\r\n      'Development Mode Only',\r\n      'This feature is only available in development mode.',\r\n      'OK',\r\n      undefined, // No cancel button for info messages\r\n      'dev'\r\n    );\r\n    return;\r\n  }\r\n  \r\n  // ALWAYS request directory access first if not already granted\r\n  if ('showDirectoryPicker' in window \u0026\u0026 !getSiteRootDirectoryHandle()) {\r\n    const accessGranted = await createConfirmationDialog(\r\n      'Select Site Root Folder',\r\n      'To edit broken links, you need to select your Hugo site root folder.\\n\\n' +\r\n      'Click \"Select Folder\" below, then navigate to and select the folder that contains your \"content\" folder.\\n\\n' +\r\n      'Example: If your site is at /Users/you/my-site/, select that folder.\\n\\n' +\r\n      'This permission is only requested once per browser session.',\r\n      'Select Folder',\r\n      'Skip (Use Manual File Selection)'\r\n    );\r\n    \r\n    if (accessGranted) {\r\n      const dirHandle = await requestSiteRootAccess();\r\n      if (!dirHandle) {\r\n        showToast('You can still manually select the file when prompted.', 'info', 5000, 'dev');\r\n      } else {\r\n        showToast('Directory access granted!', 'success', 5000, 'dev');\r\n      }\r\n    } else {\r\n      showToast('You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n    }\r\n  } else if (!('showDirectoryPicker' in window)) {\r\n    showToast('File System Access API not supported. You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n  }\r\n  \r\n  // Use a modal for URL input instead of native prompt\r\n  const newUrl = await createUrlInputDialog(\"Enter new URL:\", brokenUrl, 'dev');\r\n  \r\n  if (newUrl \u0026\u0026 newUrl !== brokenUrl \u0026\u0026 link.tagName === \"A\") {\r\n    // Try to update the source file first\r\n    const sourceUpdated = await updateLinkInSourceFile(brokenUrl, newUrl);\r\n    \r\n    if (sourceUpdated) {\r\n      // Update DOM\r\n      (link as HTMLAnchorElement).href = newUrl;\r\n      link.classList.remove(\"dev-score-bubble__highlight--broken-link\");\r\n      link.removeAttribute(\"data-broken-url\");\r\n      link.style.textDecoration = \"\";\r\n      link.style.backgroundColor = \"\";\r\n      link.style.borderBottom = \"\";\r\n      \r\n      showToast(`Link updated in source file: ${brokenUrl} → ${newUrl}`, \"success\");\r\n    } else {\r\n      // Fallback: just update DOM if file update failed\r\n      (link as HTMLAnchorElement).href = newUrl;\r\n      link.classList.remove(\"dev-score-bubble__highlight--broken-link\");\r\n      link.removeAttribute(\"data-broken-url\");\r\n      link.style.textDecoration = \"\";\r\n      link.style.backgroundColor = \"\";\r\n      link.style.borderBottom = \"\";\r\n      \r\n      showToast(`Link updated on page (source file not updated): ${brokenUrl} → ${newUrl}`, \"info\");\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Handle remove broken link (keep text)\r\n */\r\nasync function handleRemoveBrokenLink(link: HTMLElement, brokenUrl: string): Promise\u003cvoid\u003e {\r\n  if (!isLocalhost()) {\r\n    await createConfirmationDialog(\r\n      'Development Mode Only',\r\n      'This feature is only available in development mode.',\r\n      'OK',\r\n      undefined, // No cancel button for info messages\r\n      'dev'\r\n    );\r\n    return;\r\n  }\r\n  \r\n  // ALWAYS request directory access first if not already granted\r\n  // This ensures the user sees the folder picker dialog\r\n  if ('showDirectoryPicker' in window \u0026\u0026 !getSiteRootDirectoryHandle()) {\r\n    const accessGranted = await createConfirmationDialog(\r\n      'Select Site Root Folder',\r\n      'To update source files, you need to select your Hugo site root folder.\\n\\n' +\r\n      'Click \"Select Folder\" below, then navigate to and select the folder that contains your \"content\" folder.\\n\\n' +\r\n      'Example: If your site is at /Users/you/my-site/, select that folder.\\n\\n' +\r\n      'This permission is only requested once per browser session.',\r\n      'Select Folder',\r\n      'Skip (Use Manual File Selection)',\r\n      'dev'\r\n    );\r\n    \r\n    if (accessGranted) {\r\n      const dirHandle = await requestSiteRootAccess(\r\n        (msg) =\u003e showToast(msg, 'success', 5000, 'dev'),\r\n        (msg) =\u003e showToast(msg, 'error', 5000, 'dev')\r\n      );\r\n      if (!dirHandle) {\r\n        // User cancelled or failed - they can still use manual file selection\r\n        showToast('You can still manually select the file when prompted.', 'info', 5000, 'dev');\r\n      }\r\n    } else {\r\n      // User chose to skip - they'll use manual file selection\r\n      showToast('You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n    }\r\n  } else if (!('showDirectoryPicker' in window)) {\r\n    // File System Access API not supported\r\n    showToast('File System Access API not supported. You can manually select the file when prompted.', 'info', 5000, 'dev');\r\n  }\r\n  \r\n  // Note: Confirmation dialog is now shown in the menu button handler, before this function is called\r\n  \r\n  try {\r\n    const text = link.textContent || \"\";\r\n    \r\n    // First, try to update the source file\r\n    const sourceUpdated = await removeLinkFromSourceFile(brokenUrl);\r\n    \r\n    if (sourceUpdated) {\r\n      // If source file was updated, update DOM\r\n      const parent = link.parentElement;\r\n      if (parent) {\r\n        // Replace link with text node\r\n        const textNode = document.createTextNode(text);\r\n        parent.replaceChild(textNode, link);\r\n        \r\n        // Remove highlight if it's still there\r\n        const highlights = document.querySelectorAll(`.dev-score-bubble__highlight--broken-link[data-broken-url=\"${brokenUrl}\"]`);\r\n        highlights.forEach(h =\u003e {\r\n          h.classList.remove(\"dev-score-bubble__highlight--broken-link\");\r\n          h.removeAttribute(\"data-broken-url\");\r\n          (h as HTMLElement).style.textDecoration = \"\";\r\n          (h as HTMLElement).style.backgroundColor = \"\";\r\n          (h as HTMLElement).style.borderBottom = \"\";\r\n        });\r\n      }\r\n      \r\n      showToast(`Link removed from source file, text kept: \"${text}\"`, \"success\");\r\n    } else {\r\n      // Fallback: just update DOM if file update failed\r\n      const parent = link.parentElement;\r\n      if (parent) {\r\n        const textNode = document.createTextNode(text);\r\n        parent.replaceChild(textNode, link);\r\n        showToast(`Link removed from page (source file not updated): \"${text}\"`, \"info\");\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error removing broken link:\", error);\r\n    showToast(`Error removing link: ${error instanceof Error ? error.message : \"Unknown error\"}`, \"error\");\r\n  }\r\n}\r\n\r\n/**\r\n * Find URL match (simplified version of page-list.ts logic)\r\n */\r\nfunction findUrlMatch(brokenUrl: string, allPagePaths: string[], allPages?: PageData[]): { match: string; reason: string } | null {\r\n  const brokenPath = brokenUrl.split(\"#\")[0];\r\n  const brokenLower = brokenPath.toLowerCase();\r\n  const brokenNoSlash = brokenPath.replace(/\\/$/, \"\");\r\n  const brokenNoHtml = brokenPath.replace(/\\.html$/, \"\");\r\n  \r\n  // Rule 1: Exact match ignoring case\r\n  for (const path of allPagePaths) {\r\n    if (path.toLowerCase() === brokenLower) {\r\n      return { match: path, reason: \"Exact match (case-insensitive)\" };\r\n    }\r\n  }\r\n  \r\n  // Rule 2: Exact match ignoring trailing slash\r\n  for (const path of allPagePaths) {\r\n    const pathNoSlash = path.replace(/\\/$/, \"\");\r\n    if (pathNoSlash === brokenNoSlash || path === brokenNoSlash || pathNoSlash === brokenPath) {\r\n      return { match: path, reason: \"Exact match (trailing slash difference)\" };\r\n    }\r\n  }\r\n  \r\n  // Rule 3: Exact match ignoring .html extension\r\n  for (const path of allPagePaths) {\r\n    const pathNoHtml = path.replace(/\\.html$/, \"\");\r\n    if (pathNoHtml === brokenNoHtml || path === brokenNoHtml || pathNoHtml === brokenPath) {\r\n      return { match: path, reason: \"Exact match (.html extension difference)\" };\r\n    }\r\n  }\r\n  \r\n  // Rule 4: Missing section prefix (e.g., /why-is-my-maytag-dryer-not-drying/ → /blog/why-is-my-maytag-dryer-not-drying/)\r\n  const sections = new Set\u003cstring\u003e();\r\n  if (allPages) {\r\n    allPages.forEach(page =\u003e {\r\n      if (page.relPermalink.includes(\"/\") \u0026\u0026 page.relPermalink !== \"/\") {\r\n        const section = page.relPermalink.split(\"/\")[1];\r\n        if (section) {\r\n          sections.add(section);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  // Also check common sections as fallback\r\n  const commonSections = [\"blog\", \"our-services\", \"service-areas\", \"about-us\", \"brands-we-serve\"];\r\n  commonSections.forEach(s =\u003e sections.add(s));\r\n  \r\n  for (const section of sections) {\r\n    const pathWithSection = `/${section}${brokenPath}`;\r\n    const pathWithSectionNoSlash = `/${section}${brokenNoSlash}`;\r\n    \r\n    for (const path of allPagePaths) {\r\n      if (path === pathWithSection || path === pathWithSectionNoSlash) {\r\n        return { match: path, reason: `Missing section prefix: added /${section}/` };\r\n      }\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n// File System Access API support - using shared utility\r\n// getSiteRootDirectoryHandle() is managed by file-system.ts\r\n\r\n/**\r\n * Map current page URL to content file path\r\n */\r\nfunction getCurrentPageContentFile(): string[] {\r\n  let currentPath = window.location.pathname;\r\n  \r\n  // Normalize path - remove trailing slash except for root\r\n  if (currentPath !== '/' \u0026\u0026 currentPath.endsWith('/')) {\r\n    currentPath = currentPath.slice(0, -1);\r\n  }\r\n  \r\n  console.log('Current page path:', currentPath);\r\n  const possiblePaths = relPermalinkToContentFile(currentPath);\r\n  console.log('Possible file paths:', possiblePaths);\r\n  \r\n  return possiblePaths;\r\n}\r\n\r\n// relPermalinkToContentFile is now imported from utils/file-system.ts\r\n\r\n// File system functions are now imported from utils/file-system.ts\r\n\r\n/**\r\n * Update link in source file\r\n */\r\nasync function updateLinkInSourceFile(oldUrl: string, newUrl: string): Promise\u003cboolean\u003e {\r\n  try {\r\n    // Get current page file paths\r\n    const possiblePaths = getCurrentPageContentFile();\r\n    let filePath = await findActualFilePath(possiblePaths, true); // Enable verbose logging\r\n    \r\n    if (!filePath) {\r\n      console.warn('Could not find source file for current page. Tried:', possiblePaths);\r\n      \r\n      // Offer manual file selection\r\n      if ('showOpenFilePicker' in window) {\r\n        const tryManual = await createConfirmationDialog(\r\n          'Select Source File',\r\n          `Could not automatically find the source file.\\n\\n` +\r\n          `Expected paths:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n          `Would you like to manually select the markdown file?`,\r\n          'Select File',\r\n          'Cancel',\r\n          'dev'\r\n        );\r\n        \r\n        if (tryManual) {\r\n          try {\r\n            const fileHandles = await (window as any).showOpenFilePicker({\r\n              types: [{\r\n                description: 'Markdown files',\r\n                accept: { 'text/markdown': ['.md'] }\r\n              }],\r\n              excludeAcceptAllOption: false,\r\n              multiple: false\r\n            });\r\n            \r\n            if (fileHandles \u0026\u0026 fileHandles.length \u003e 0) {\r\n              const fileHandle = fileHandles[0];\r\n              const file = await fileHandle.getFile();\r\n              const content = await file.text();\r\n              \r\n              console.log('User manually selected file:', file.name);\r\n              \r\n              // Update the link in the manually selected file\r\n              const escapedOldUrl = escapeRegex(oldUrl);\r\n              let modifiedContent = content;\r\n              let modified = false;\r\n              \r\n              // Replace markdown links\r\n              const markdownPattern = new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedOldUrl}([^)]*\\\\))`, 'g');\r\n              modifiedContent = modifiedContent.replace(markdownPattern, (match: string, prefix: string, suffix: string) =\u003e {\r\n                modified = true;\r\n                return `${prefix}${newUrl}${suffix}`;\r\n              });\r\n              \r\n              // Replace HTML links\r\n              const htmlPattern = new RegExp(`(href=[\"'])${escapedOldUrl}([\"'])`, 'gi');\r\n              modifiedContent = modifiedContent.replace(htmlPattern, (match: string, prefix: string, suffix: string) =\u003e {\r\n                modified = true;\r\n                return `${prefix}${newUrl}${suffix}`;\r\n              });\r\n              \r\n              if (!modified) {\r\n                showToast('Link not found in selected file content', 'info', 5000, 'dev');\r\n                return false;\r\n              }\r\n              \r\n              // Create backup\r\n              try {\r\n                const backupFile = await fileHandle.getFile();\r\n                const backupContent = await backupFile.text();\r\n                const backupPath = createBackupFilename(file.name);\r\n                // Try to create backup in same directory (if we have access)\r\n                // For now, just log it\r\n                console.log('Would create backup at:', backupPath);\r\n              } catch (backupError) {\r\n                console.warn('Could not create backup file:', backupError);\r\n              }\r\n              \r\n              // Write the modified content\r\n              try {\r\n                const writable = await fileHandle.createWritable();\r\n                await writable.write(modifiedContent);\r\n                await writable.close();\r\n                \r\n                showToast(`Link updated in ${file.name}`, 'success', 5000, 'dev');\r\n                return true;\r\n              } catch (writeError) {\r\n                console.error('Error writing to manually selected file:', writeError);\r\n                showToast(`Error writing file: ${writeError instanceof Error ? writeError.message : 'Unknown error'}`, 'error', 5000, 'dev');\r\n                return false;\r\n              }\r\n            }\r\n          } catch (pickerError) {\r\n            if ((pickerError as Error).name !== 'AbortError') {\r\n              console.error('File picker error:', pickerError);\r\n              showToast(`File picker error: ${pickerError instanceof Error ? pickerError.message : 'Unknown error'}`, 'error', 5000, 'dev');\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Show error modal if manual selection wasn't used or available\r\n      await createConfirmationDialog(\r\n        'Could Not Find Source File',\r\n        `Could not automatically find the source file.\\n\\n` +\r\n        `Tried:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n        `To fix this:\\n` +\r\n        `1. Grant File System Access when prompted (select your site root directory)\\n` +\r\n        `2. Use the manual file selection option when offered`,\r\n        'OK',\r\n        undefined, // Single button for info\r\n        'dev'\r\n      );\r\n      return false;\r\n    }\r\n    \r\n    const fileData = await readFileContent(filePath, true); // Enable verbose logging\r\n    if (!fileData) {\r\n      console.warn(`Could not read file: ${filePath}`);\r\n      showToast(`Could not read file: ${filePath}`, 'error', 5000, 'dev');\r\n      return false;\r\n    }\r\n    \r\n    const escapedOldUrl = escapeRegex(oldUrl);\r\n    let modifiedContent = fileData.content;\r\n    let modified = false;\r\n    \r\n    // Replace markdown links\r\n    const markdownPattern = new RegExp(`(\\\\[[^\\\\]]+\\\\]\\\\()${escapedOldUrl}([^)]*\\\\))`, 'g');\r\n    modifiedContent = modifiedContent.replace(markdownPattern, (match, prefix, suffix) =\u003e {\r\n      modified = true;\r\n      return `${prefix}${newUrl}${suffix}`;\r\n    });\r\n    \r\n    // Replace HTML links\r\n    const htmlPattern = new RegExp(`(href=[\"'])${escapedOldUrl}([\"'])`, 'gi');\r\n    modifiedContent = modifiedContent.replace(htmlPattern, (match, prefix, suffix) =\u003e {\r\n      modified = true;\r\n      return `${prefix}${newUrl}${suffix}`;\r\n    });\r\n    \r\n    if (!modified) {\r\n      console.warn('No matches found in file');\r\n      return false;\r\n    }\r\n    \r\n    // Create backup\r\n    const backupPath = createBackupFilename(filePath);\r\n    const backupCreated = await writeFileContent(backupPath, fileData.content);\r\n    \r\n    if (!backupCreated) {\r\n      console.warn(`Could not create backup: ${backupPath}`);\r\n    }\r\n    \r\n    // Write modified content\r\n    const writeSuccess = await writeFileContent(filePath, modifiedContent);\r\n    \r\n    if (writeSuccess) {\r\n      console.log(`✅ Updated link in ${filePath}${backupCreated ? ` (backup: ${backupPath})` : ''}`);\r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  } catch (error) {\r\n    console.error('Error updating link in source file:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove link from source file\r\n */\r\nasync function removeLinkFromSourceFile(url: string): Promise\u003cboolean\u003e {\r\n  try {\r\n    // Directory access should already be requested in handleRemoveBrokenLink\r\n    // But if we still don't have it, skip automatic file detection and go straight to manual selection\r\n    const siteRootHandle = getSiteRootDirectoryHandle();\r\n    if (!siteRootHandle) {\r\n      console.log('No directory access available, will offer manual file selection');\r\n    }\r\n    \r\n    // If we have directory access, try to find the file automatically\r\n    let filePath: string | null = null;\r\n    \r\n    if (siteRootHandle) {\r\n      // Verify directory access is working\r\n      try {\r\n        // Test that we can actually access the content directory\r\n        await siteRootHandle.getDirectoryHandle('content', { create: false });\r\n        console.log('✅ Directory access verified - content folder is accessible');\r\n        \r\n        // Get current page file paths\r\n        const possiblePaths = getCurrentPageContentFile();\r\n        console.log('Looking for file in paths:', possiblePaths);\r\n        \r\n        filePath = await findActualFilePath(possiblePaths, true); // Enable verbose logging\r\n        \r\n        if (filePath) {\r\n          console.log('✅ File found automatically:', filePath);\r\n        } else {\r\n          console.warn('Could not find source file automatically. Tried:', possiblePaths);\r\n        }\r\n      } catch (verifyError) {\r\n        console.error('❌ Directory access verification failed:', verifyError);\r\n        showToast('Directory access was lost. Please grant access again.', 'error', 5000, 'dev');\r\n        setSiteRootDirectoryHandle(null); // Reset so user can grant access again\r\n      }\r\n    } else {\r\n      console.log('No directory access available - will offer manual file selection');\r\n    }\r\n    \r\n    // If file not found and we don't have directory access, offer manual file selection\r\n    if (!filePath) {\r\n      const possiblePaths = getCurrentPageContentFile();\r\n      \r\n      // Always offer manual file selection if automatic detection failed\r\n      if ('showOpenFilePicker' in window) {\r\n        const tryManual = await createConfirmationDialog(\r\n          'Select Source File',\r\n          `Could not automatically find the source file.\\n\\n` +\r\n          `Expected paths:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n          `Would you like to manually select the markdown file?`,\r\n          'Select File',\r\n          'Cancel',\r\n          'dev'\r\n        );\r\n        \r\n        if (tryManual) {\r\n          try {\r\n            const fileHandles = await (window as any).showOpenFilePicker({\r\n              types: [{\r\n                description: 'Markdown files',\r\n                accept: { 'text/markdown': ['.md'] }\r\n              }],\r\n              excludeAcceptAllOption: false,\r\n              multiple: false\r\n            });\r\n            \r\n            if (fileHandles \u0026\u0026 fileHandles.length \u003e 0) {\r\n              const fileHandle = fileHandles[0];\r\n              const file = await fileHandle.getFile();\r\n              const content = await file.text();\r\n              \r\n              console.log('User manually selected file:', file.name);\r\n              \r\n              // Continue with the removal process using the manually selected file\r\n              const removalResult = removeLinkFromContent(content, url);\r\n              \r\n              if (removalResult.changes.length === 0) {\r\n                showToast('Link not found in selected file content', 'info');\r\n                return false;\r\n              }\r\n              \r\n              // Create backup by reading the original content again\r\n              const backupContent = content;\r\n              \r\n              // For manually selected files, we need to use the file handle to write\r\n              try {\r\n                // Write the modified content\r\n                const writable = await fileHandle.createWritable();\r\n                await writable.write(removalResult.content);\r\n                await writable.close();\r\n                \r\n                // Try to create a backup file in the same directory\r\n                try {\r\n                  const backupFileName = `${file.name}.backup-${new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5)}`;\r\n                  // Note: We can't create backup in same directory without directory handle\r\n                  // But we've already modified the file, so at least log it\r\n                  console.log(`✅ Modified file: ${file.name} (backup would be: ${backupFileName})`);\r\n                } catch (backupError) {\r\n                  console.warn('Could not create backup file:', backupError);\r\n                }\r\n                \r\n                showToast(`Link removed from ${file.name}`, 'success');\r\n                return true;\r\n              } catch (writeError) {\r\n                console.error('Error writing to manually selected file:', writeError);\r\n                showToast(`Error writing file: ${writeError instanceof Error ? writeError.message : 'Unknown error'}`, 'error');\r\n                return false;\r\n              }\r\n            }\r\n          } catch (pickerError) {\r\n            if ((pickerError as Error).name !== 'AbortError') {\r\n              console.error('File picker error:', pickerError);\r\n              showToast(`File picker error: ${pickerError instanceof Error ? pickerError.message : 'Unknown error'}`, 'error');\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Show error modal instead of toast for better visibility\r\n      await createConfirmationDialog(\r\n        'Could Not Find Source File',\r\n        `Could not automatically find the source file.\\n\\n` +\r\n        `Tried:\\n${possiblePaths.map(p =\u003e `  • ${p}`).join('\\n')}\\n\\n` +\r\n        `To fix this:\\n` +\r\n        `1. Grant File System Access when prompted (select your site root directory)\\n` +\r\n        `2. Use the manual file selection option when offered`,\r\n        'OK',\r\n        undefined, // Single button for info\r\n        'dev'\r\n      );\r\n      return false;\r\n    }\r\n    \r\n    console.log('Found source file:', filePath);\r\n    \r\n    const fileData = await readFileContent(filePath, true); // Enable verbose logging\r\n    if (!fileData) {\r\n      console.warn(`Could not read file: ${filePath}`);\r\n      showToast(`Could not read file: ${filePath}`, 'error', 5000, 'dev');\r\n      return false;\r\n    }\r\n    \r\n    // Normalize URL for matching (handle trailing slashes, etc.)\r\n    const normalizedUrl = url.split('#')[0].replace(/\\/$/, '');\r\n    const urlVariations = [\r\n      url, // Original\r\n      normalizedUrl, // Without trailing slash\r\n      url + '/', // With trailing slash\r\n      normalizedUrl + '/', // Normalized with trailing slash\r\n    ];\r\n    \r\n    // Try removing with each URL variation\r\n    let removalResult: { content: string; changes: Array\u003c{ oldUrl: string; newUrl: string; lineNumber: number; text: string }\u003e } | null = null;\r\n    let matchedUrl: string | null = null;\r\n    \r\n    for (const urlVar of urlVariations) {\r\n      removalResult = removeLinkFromContent(fileData.content, urlVar);\r\n      if (removalResult.changes.length \u003e 0) {\r\n        matchedUrl = urlVar;\r\n        console.log(`Found link with URL variation: ${urlVar}`);\r\n        break;\r\n      }\r\n    }\r\n    \r\n    if (!removalResult || removalResult.changes.length === 0) {\r\n      console.warn('Link not found in file content. Tried URL variations:', urlVariations);\r\n      console.log('File content preview:', fileData.content.substring(0, 500));\r\n      showToast(`Link not found in file content. URL: ${url}`, 'info');\r\n      return false;\r\n    }\r\n    \r\n    console.log(`Removing link: ${matchedUrl} (${removalResult.changes.length} occurrence(s))`);\r\n    \r\n    // Create backup\r\n    const backupPath = createBackupFilename(filePath);\r\n    console.log('Creating backup:', backupPath);\r\n    const backupCreated = await writeFileContent(backupPath, fileData.content);\r\n    \r\n    if (!backupCreated) {\r\n      console.warn(`Could not create backup: ${backupPath}`);\r\n      showToast(`Warning: Could not create backup file`, 'error');\r\n    } else {\r\n      console.log('✅ Backup created:', backupPath);\r\n    }\r\n    \r\n    // Write modified content\r\n    console.log('Writing modified content to:', filePath);\r\n    const writeSuccess = await writeFileContent(filePath, removalResult.content);\r\n    \r\n    if (writeSuccess) {\r\n      console.log(`✅ Removed link from ${filePath}${backupCreated ? ` (backup: ${backupPath})` : ''}`);\r\n      if (backupCreated) {\r\n        showToast(`Link removed. Backup: ${backupPath.split('/').pop()}`, 'success');\r\n      } else {\r\n        showToast('Link removed from source file', 'success');\r\n      }\r\n      return true;\r\n    }\r\n    \r\n    console.error(`Failed to write file: ${filePath}`);\r\n    showToast(`Could not write file: ${filePath}`, 'error');\r\n    return false;\r\n  } catch (error) {\r\n    console.error('Error removing link from source file:', error);\r\n    showToast(`Error: ${error instanceof Error ? error.message : 'Unknown error'}`, 'error');\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Show toast notification for broken link actions\r\n */\r\n// showToast is now imported from utils/dev-ui.ts\r\n\r\n/**\r\n * Fetch page data and find current page\r\n */\r\nasync function fetchPageData(): Promise\u003cPageData | null\u003e {\r\n  try {\r\n    const response = await fetch(\"/page-list/index.json\");\r\n    if (!response.ok) {\r\n      console.warn(\"Dev Score Bubble: Could not fetch page data\", response.status, response.statusText);\r\n      return null;\r\n    }\r\n\r\n    const data: PageListData = await response.json();\r\n    const currentPath = window.location.pathname;\r\n\r\n    // Debug logging in development\r\n    if (isLocalhost()) {\r\n      console.log(\"Dev Score Bubble: Current path:\", currentPath);\r\n      console.log(\"Dev Score Bubble: Total pages in JSON:\", data.pages.length);\r\n    }\r\n\r\n    // Find matching page with improved matching logic\r\n    const currentPage = data.pages.find((page) =\u003e {\r\n      // Handle home page\r\n      if (currentPath === \"/\" \u0026\u0026 (page.relPermalink === \"/\" || page.relPermalink === \"\")) {\r\n        return true;\r\n      }\r\n      \r\n      // Normalize paths for comparison - remove trailing slashes (except for root)\r\n      const normalizePath = (path: string): string =\u003e {\r\n        if (path === \"/\" || path === \"\") return \"/\";\r\n        return path.endsWith(\"/\") ? path.slice(0, -1) : path;\r\n      };\r\n      \r\n      const pagePath = normalizePath(page.relPermalink);\r\n      const currentPathNormalized = normalizePath(currentPath);\r\n      \r\n      // Exact match\r\n      if (pagePath === currentPathNormalized) {\r\n        if (isLocalhost()) {\r\n          console.log(\"Dev Score Bubble: Found exact match:\", page.relPermalink, \"for path:\", currentPath);\r\n        }\r\n        return true;\r\n      }\r\n      \r\n      // Also try matching with/without index.html suffix (Hugo sometimes generates these)\r\n      const pagePathWithIndex = pagePath + \"/index.html\";\r\n      const pagePathWithoutIndex = pagePath.replace(/\\/index\\.html$/, \"\");\r\n      \r\n      if (currentPathNormalized === pagePathWithIndex || currentPathNormalized === pagePathWithoutIndex) {\r\n        if (isLocalhost()) {\r\n          console.log(\"Dev Score Bubble: Found match with index.html variant:\", page.relPermalink, \"for path:\", currentPath);\r\n        }\r\n        return true;\r\n      }\r\n      \r\n      return false;\r\n    });\r\n\r\n    if (!currentPage \u0026\u0026 isLocalhost()) {\r\n      // Log potential matches for debugging\r\n      const similarPages = data.pages.filter((page) =\u003e {\r\n        const pagePath = page.relPermalink.endsWith(\"/\") \u0026\u0026 page.relPermalink !== \"/\"\r\n          ? page.relPermalink.slice(0, -1)\r\n          : page.relPermalink;\r\n        const currentPathNormalized = currentPath.endsWith(\"/\") \u0026\u0026 currentPath !== \"/\"\r\n          ? currentPath.slice(0, -1)\r\n          : currentPath;\r\n        return pagePath.includes(currentPathNormalized) || currentPathNormalized.includes(pagePath);\r\n      });\r\n      \r\n      if (similarPages.length \u003e 0) {\r\n        console.warn(\"Dev Score Bubble: No exact match found. Similar pages:\", similarPages.map(p =\u003e p.relPermalink));\r\n      } else {\r\n        console.warn(\"Dev Score Bubble: No matching page found for:\", currentPath);\r\n        console.warn(\"Dev Score Bubble: Available pages (first 10):\", data.pages.slice(0, 10).map(p =\u003e p.relPermalink));\r\n      }\r\n    }\r\n\r\n    return currentPage || null;\r\n  } catch (error) {\r\n    console.warn(\"Dev Score Bubble: Error fetching page data\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize the dev score bubble (only in dev mode)\r\n */\r\nexport function initDevScoreBubble(): void {\r\n  // Only run in dev/localhost\r\n  if (!isLocalhost()) {\r\n    return;\r\n  }\r\n\r\n  // Skip on page-list pages (they're dev tools, not content pages)\r\n  const currentPath = window.location.pathname;\r\n  if (currentPath.startsWith('/page-list/')) {\r\n    return;\r\n  }\r\n\r\n  // Check if user has hidden the bubble in this session\r\n  if (sessionStorage.getItem(\"dev-score-bubble-hidden\") === \"true\") {\r\n    return;\r\n  }\r\n\r\n  onDOMReady(async () =\u003e {\r\n    // Small delay to ensure page is fully loaded\r\n    setTimeout(async () =\u003e {\r\n      const pageData = await fetchPageData();\r\n      if (pageData) {\r\n        createBubble(pageData);\r\n      }\r\n    }, 500);\r\n  });\r\n}","/**\r\n * Blog Module\r\n * Handles search, filter, and sorting functionality for blog posts\r\n */\r\n\r\ninterface BlogPost {\r\n  element: HTMLElement;\r\n  title: string;\r\n  tags: string[];\r\n  categories: string[];\r\n  date: string;\r\n}\r\n\r\n/**\r\n * Debounce function to limit function calls\r\n */\r\nfunction debounce\u003cT extends (...args: unknown[]) =\u003e void\u003e(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters\u003cT\u003e) =\u003e void {\r\n  let timeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n  return function executedFunction(...args: Parameters\u003cT\u003e) {\r\n    const later = () =\u003e {\r\n      timeout = null;\r\n      func(...args);\r\n    };\r\n    if (timeout) {\r\n      clearTimeout(timeout);\r\n    }\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Handle category filter clicks from blog cards and single posts\r\n * This works on all pages, not just the blog list page\r\n */\r\nconst handleCategoryFilterClicks = (): void =\u003e {\r\n  document.addEventListener(\"click\", (e) =\u003e {\r\n    const target = e.target as HTMLElement;\r\n    const filterButton = target.closest\u003cHTMLElement\u003e(\"[data-blog-filter]\");\r\n    \r\n    if (!filterButton) return;\r\n    \r\n    // Check if this is a category button from a blog card or single post\r\n    // (not from the blog controls)\r\n    const container = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-controls]\");\r\n    const isInControls = container \u0026\u0026 container.contains(filterButton);\r\n    \r\n    if (!isInControls) {\r\n      e.preventDefault();\r\n      const filter = filterButton.getAttribute(\"data-blog-filter\");\r\n      if (!filter) return;\r\n      \r\n      // If we're on a single post page, navigate to blog list with filter\r\n      if (!container) {\r\n        const blogListUrl = new URL(\"/blog/\", window.location.origin);\r\n        if (filter !== \"all\") {\r\n          blogListUrl.searchParams.set(\"filter\", filter);\r\n        }\r\n        window.location.href = blogListUrl.toString();\r\n        return;\r\n      }\r\n      \r\n      // If we're on the blog list page, trigger the filter via the control button\r\n      const controlButton = container.querySelector\u003cHTMLElement\u003e(\r\n        `[data-blog-filter=\"${filter}\"]`\r\n      );\r\n      if (controlButton) {\r\n        controlButton.click();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n// Initialize category filter clicks on page load\r\nif (typeof document !== \"undefined\") {\r\n  handleCategoryFilterClicks();\r\n}\r\n\r\n/**\r\n * Initialize blog functionality\r\n */\r\nexport const initBlog = (): void =\u003e {\r\n  const container = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-controls]\");\r\n  if (!container) return;\r\n\r\n  const searchInput = container.querySelector\u003cHTMLInputElement\u003e(\"[data-blog-search]\");\r\n  const searchClear = container.querySelector\u003cHTMLButtonElement\u003e(\"[data-blog-search-clear]\");\r\n  const filterButtons = container.querySelectorAll\u003cHTMLButtonElement\u003e(\"[data-blog-filter]\");\r\n  const sortSelect = container.querySelector\u003cHTMLSelectElement\u003e(\"[data-blog-sort]\");\r\n  const perPageSelect = container.querySelector\u003cHTMLSelectElement\u003e(\"[data-blog-per-page]\");\r\n  const grid = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-grid]\");\r\n  const noResults = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-no-results]\");\r\n  const resultsCount = container.querySelector\u003cHTMLElement\u003e(\"[data-blog-results-count]\");\r\n  const resultsTotal = container.querySelector\u003cHTMLElement\u003e(\"[data-blog-results-total]\");\r\n  const resultsText = container.querySelector\u003cHTMLElement\u003e(\"[data-blog-results]\");\r\n  const pagination = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-pagination]\");\r\n  const paginationPrev = document.querySelector\u003cHTMLButtonElement\u003e(\"[data-blog-pagination-prev]\");\r\n  const paginationNext = document.querySelector\u003cHTMLButtonElement\u003e(\"[data-blog-pagination-next]\");\r\n  const paginationPages = document.querySelector\u003cHTMLElement\u003e(\"[data-blog-pagination-pages]\");\r\n\r\n  if (!grid) {\r\n    console.warn(\"Blog grid not found\");\r\n    return;\r\n  }\r\n\r\n  // Get all blog posts\r\n  const posts: BlogPost[] = Array.from(\r\n    grid.querySelectorAll\u003cHTMLElement\u003e(\"[data-blog-post]\")\r\n  ).map((element) =\u003e {\r\n    const title = element.getAttribute(\"data-post-title\") || \"\";\r\n    const tagsStr = element.getAttribute(\"data-post-tags\") || \"\";\r\n    const categoriesStr = element.getAttribute(\"data-post-categories\") || \"\";\r\n    const date = element.getAttribute(\"data-post-date\") || \"\";\r\n\r\n    return {\r\n      element,\r\n      title: title.toLowerCase(),\r\n      tags: tagsStr ? tagsStr.split(\" \").filter(Boolean) : [],\r\n      categories: categoriesStr ? categoriesStr.split(\" \").filter(Boolean) : [],\r\n      date,\r\n    };\r\n  });\r\n\r\n  let currentSearch = \"\";\r\n  let currentFilter = \"all\";\r\n  let currentSort = \"date-desc\";\r\n  let currentPage = 1;\r\n  let postsPerPage = 20;\r\n\r\n  // Check URL parameters on load\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  const filterParam = urlParams.get(\"filter\");\r\n  const sortParam = urlParams.get(\"sort\");\r\n  const pageParam = urlParams.get(\"page\");\r\n  const perPageParam = urlParams.get(\"perPage\");\r\n  \r\n  if (filterParam) {\r\n    currentFilter = filterParam;\r\n    // Activate the corresponding filter button\r\n    filterButtons.forEach((btn) =\u003e {\r\n      if (btn.getAttribute(\"data-blog-filter\") === filterParam) {\r\n        btn.classList.add(\"blog-container__filter--active\");\r\n      } else {\r\n        btn.classList.remove(\"blog-container__filter--active\");\r\n      }\r\n    });\r\n  }\r\n  \r\n  if (sortParam \u0026\u0026 sortSelect) {\r\n    const validSorts = [\"date-desc\", \"date-asc\", \"title-asc\", \"title-desc\"];\r\n    if (validSorts.includes(sortParam)) {\r\n      currentSort = sortParam;\r\n      sortSelect.value = sortParam;\r\n    }\r\n  }\r\n\r\n  if (perPageParam \u0026\u0026 perPageSelect) {\r\n    const validPerPage = [\"10\", \"20\", \"30\"];\r\n    if (validPerPage.includes(perPageParam)) {\r\n      postsPerPage = parseInt(perPageParam, 10);\r\n      perPageSelect.value = perPageParam;\r\n    }\r\n  }\r\n\r\n  if (pageParam) {\r\n    const page = parseInt(pageParam, 10);\r\n    if (page \u003e 0) {\r\n      currentPage = page;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Filter posts based on search, filter, and sort\r\n   */\r\n  const updateView = (): void =\u003e {\r\n    let filtered = posts.filter((post) =\u003e {\r\n      // Search filter\r\n      if (currentSearch) {\r\n        const searchLower = currentSearch.toLowerCase();\r\n        const titleMatch = post.title.includes(searchLower);\r\n        const contentMatch = post.element.textContent?.toLowerCase().includes(searchLower);\r\n        if (!titleMatch \u0026\u0026 !contentMatch) return false;\r\n      }\r\n\r\n      // Tag/Category filter\r\n      if (currentFilter !== \"all\") {\r\n        if (currentFilter.startsWith(\"tag-\")) {\r\n          if (!post.tags.includes(currentFilter)) return false;\r\n        } else if (currentFilter.startsWith(\"category-\")) {\r\n          if (!post.categories.includes(currentFilter)) return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    });\r\n\r\n    // Sort posts\r\n    filtered.sort((a, b) =\u003e {\r\n      switch (currentSort) {\r\n        case \"date-desc\":\r\n          return b.date.localeCompare(a.date);\r\n        case \"date-asc\":\r\n          return a.date.localeCompare(b.date);\r\n        case \"title-asc\":\r\n          return a.title.localeCompare(b.title);\r\n        case \"title-desc\":\r\n          return b.title.localeCompare(a.title);\r\n        default:\r\n          return 0;\r\n      }\r\n    });\r\n\r\n    // Calculate pagination\r\n    const totalPosts = filtered.length;\r\n    const totalPages = Math.ceil(totalPosts / postsPerPage);\r\n    \r\n    // Reset to page 1 if current page is out of bounds\r\n    if (currentPage \u003e totalPages \u0026\u0026 totalPages \u003e 0) {\r\n      currentPage = 1;\r\n    }\r\n\r\n    // Calculate pagination range\r\n    const startIndex = (currentPage - 1) * postsPerPage;\r\n    const endIndex = startIndex + postsPerPage;\r\n    const paginatedPosts = filtered.slice(startIndex, endIndex);\r\n\r\n    // Update DOM - show/hide posts based on pagination\r\n    posts.forEach((post) =\u003e {\r\n      const isInFiltered = filtered.includes(post);\r\n      const isInCurrentPage = paginatedPosts.includes(post);\r\n      \r\n      if (isInFiltered \u0026\u0026 isInCurrentPage) {\r\n        post.element.style.display = \"\";\r\n        post.element.setAttribute(\"aria-hidden\", \"false\");\r\n      } else {\r\n        post.element.style.display = \"none\";\r\n        post.element.setAttribute(\"aria-hidden\", \"true\");\r\n      }\r\n    });\r\n\r\n    // Show/hide no results message\r\n    if (filtered.length === 0) {\r\n      if (grid) grid.style.display = \"none\";\r\n      if (noResults) {\r\n        noResults.style.display = \"block\";\r\n      }\r\n      if (pagination) pagination.style.display = \"none\";\r\n    } else {\r\n      if (grid) grid.style.display = \"grid\";\r\n      if (noResults) {\r\n        noResults.style.display = \"none\";\r\n      }\r\n      \r\n      // Show/hide pagination\r\n      if (pagination) {\r\n        if (totalPages \u003e 1) {\r\n          pagination.style.display = \"flex\";\r\n          updatePagination(totalPages, currentPage);\r\n        } else {\r\n          pagination.style.display = \"none\";\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update results count\r\n    if (resultsCount) {\r\n      resultsCount.textContent = paginatedPosts.length.toString();\r\n    }\r\n    if (resultsTotal) {\r\n      resultsTotal.textContent = totalPosts.toString();\r\n    }\r\n    if (resultsText) {\r\n      const showing = paginatedPosts.length;\r\n      const total = totalPosts;\r\n      const text = total === 1 ? \"post\" : \"posts\";\r\n      resultsText.innerHTML = `Showing \u003cspan class=\"blog-container__results-count\"\u003e${showing}\u003c/span\u003e of \u003cspan class=\"blog-container__results-total\"\u003e${total}\u003c/span\u003e ${text}`;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Update pagination controls\r\n   */\r\n  const updatePagination = (totalPages: number, currentPage: number): void =\u003e {\r\n    if (!paginationPages || !paginationPrev || !paginationNext) return;\r\n\r\n    // Update prev/next buttons\r\n    paginationPrev.disabled = currentPage === 1;\r\n    paginationNext.disabled = currentPage === totalPages;\r\n\r\n    // Clear existing page numbers\r\n    paginationPages.innerHTML = \"\";\r\n\r\n    // Calculate which page numbers to show\r\n    const maxVisiblePages = 7;\r\n    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));\r\n    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);\r\n\r\n    // Adjust if we're near the end\r\n    if (endPage - startPage \u003c maxVisiblePages - 1) {\r\n      startPage = Math.max(1, endPage - maxVisiblePages + 1);\r\n    }\r\n\r\n    // Add first page and ellipsis if needed\r\n    if (startPage \u003e 1) {\r\n      const firstBtn = document.createElement(\"button\");\r\n      firstBtn.type = \"button\";\r\n      firstBtn.className = \"blog-container__pagination-page\";\r\n      firstBtn.textContent = \"1\";\r\n      firstBtn.setAttribute(\"data-blog-page\", \"1\");\r\n      firstBtn.addEventListener(\"click\", () =\u003e goToPage(1));\r\n      paginationPages.appendChild(firstBtn);\r\n\r\n      if (startPage \u003e 2) {\r\n        const ellipsis = document.createElement(\"span\");\r\n        ellipsis.className = \"blog-container__pagination-ellipsis\";\r\n        ellipsis.textContent = \"...\";\r\n        paginationPages.appendChild(ellipsis);\r\n      }\r\n    }\r\n\r\n    // Add page numbers\r\n    for (let i = startPage; i \u003c= endPage; i++) {\r\n      const pageBtn = document.createElement(\"button\");\r\n      pageBtn.type = \"button\";\r\n      pageBtn.className = \"blog-container__pagination-page\";\r\n      if (i === currentPage) {\r\n        pageBtn.classList.add(\"blog-container__pagination-page--active\");\r\n      }\r\n      pageBtn.textContent = i.toString();\r\n      pageBtn.setAttribute(\"data-blog-page\", i.toString());\r\n      pageBtn.addEventListener(\"click\", () =\u003e goToPage(i));\r\n      paginationPages.appendChild(pageBtn);\r\n    }\r\n\r\n    // Add last page and ellipsis if needed\r\n    if (endPage \u003c totalPages) {\r\n      if (endPage \u003c totalPages - 1) {\r\n        const ellipsis = document.createElement(\"span\");\r\n        ellipsis.className = \"blog-container__pagination-ellipsis\";\r\n        ellipsis.textContent = \"...\";\r\n        paginationPages.appendChild(ellipsis);\r\n      }\r\n\r\n      const lastBtn = document.createElement(\"button\");\r\n      lastBtn.type = \"button\";\r\n      lastBtn.className = \"blog-container__pagination-page\";\r\n      lastBtn.textContent = totalPages.toString();\r\n      lastBtn.setAttribute(\"data-blog-page\", totalPages.toString());\r\n      lastBtn.addEventListener(\"click\", () =\u003e goToPage(totalPages));\r\n      paginationPages.appendChild(lastBtn);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Navigate to a specific page\r\n   */\r\n  const goToPage = (page: number): void =\u003e {\r\n    currentPage = page;\r\n    \r\n    // Update URL without reload\r\n    const url = new URL(window.location.href);\r\n    if (page === 1) {\r\n      url.searchParams.delete(\"page\");\r\n    } else {\r\n      url.searchParams.set(\"page\", page.toString());\r\n    }\r\n    window.history.pushState({}, \"\", url);\r\n    \r\n    // Scroll to top of blog section\r\n    if (grid) {\r\n      grid.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\r\n    }\r\n    \r\n    updateView();\r\n  };\r\n\r\n  // Debounced search handler\r\n  const debouncedUpdateView = debounce(() =\u003e {\r\n    updateView();\r\n  }, 300);\r\n\r\n  // Search input handler with debouncing\r\n  if (searchInput) {\r\n    searchInput.addEventListener(\"input\", (e) =\u003e {\r\n      const target = e.target as HTMLInputElement;\r\n      const newSearch = target.value;\r\n      \r\n      // Reset to page 1 if search changed\r\n      if (newSearch !== currentSearch) {\r\n        currentPage = 1;\r\n      }\r\n      \r\n      currentSearch = newSearch;\r\n\r\n      // Show/hide clear button immediately\r\n      if (searchClear) {\r\n        if (currentSearch) {\r\n          searchClear.classList.add(\"blog-container__search-clear--visible\");\r\n        } else {\r\n          searchClear.classList.remove(\"blog-container__search-clear--visible\");\r\n        }\r\n      }\r\n\r\n      // Debounce the actual filtering\r\n      debouncedUpdateView();\r\n    });\r\n\r\n    // Clear search handler\r\n    if (searchClear) {\r\n      searchClear.addEventListener(\"click\", (e) =\u003e {\r\n        e.preventDefault();\r\n        if (searchInput) {\r\n          searchInput.value = \"\";\r\n          currentSearch = \"\";\r\n          currentPage = 1; // Reset to first page when clearing search\r\n          \r\n          // Clear search from URL if present\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete(\"search\");\r\n          url.searchParams.delete(\"page\"); // Reset to page 1\r\n          window.history.pushState({}, \"\", url);\r\n          \r\n          updateView();\r\n          searchClear.classList.remove(\"blog-container__search-clear--visible\");\r\n          searchInput.focus();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle filter button click\r\n   */\r\n  const handleFilterClick = (button: HTMLElement, e: Event): void =\u003e {\r\n    e.preventDefault();\r\n    const filter = button.getAttribute(\"data-blog-filter\");\r\n    if (!filter || filter === currentFilter) return;\r\n\r\n    currentFilter = filter;\r\n    currentPage = 1; // Reset to first page when filter changes\r\n\r\n    // Update active state for filter buttons in controls\r\n    filterButtons.forEach((btn) =\u003e {\r\n      btn.classList.remove(\"blog-container__filter--active\");\r\n    });\r\n    // Also update the clicked button if it's in the controls\r\n    if (button.hasAttribute(\"data-blog-filter\")) {\r\n      const matchingControlButton = Array.from(filterButtons).find(\r\n        (btn) =\u003e btn.getAttribute(\"data-blog-filter\") === filter\r\n      );\r\n      if (matchingControlButton) {\r\n        matchingControlButton.classList.add(\"blog-container__filter--active\");\r\n      }\r\n    }\r\n\r\n    // Update URL without reload (but don't create crawlable URLs - this is client-side only)\r\n    const url = new URL(window.location.href);\r\n    if (filter === \"all\") {\r\n      url.searchParams.delete(\"filter\");\r\n    } else {\r\n      url.searchParams.set(\"filter\", filter);\r\n    }\r\n    url.searchParams.delete(\"page\"); // Reset to page 1\r\n    window.history.pushState({}, \"\", url);\r\n\r\n    updateView();\r\n  };\r\n\r\n  // Filter button handlers in controls\r\n  filterButtons.forEach((button) =\u003e {\r\n    button.addEventListener(\"click\", (e) =\u003e handleFilterClick(button, e));\r\n  });\r\n\r\n\r\n  // Sort select handler\r\n  if (sortSelect) {\r\n    sortSelect.addEventListener(\"change\", (e) =\u003e {\r\n      const target = e.target as HTMLSelectElement;\r\n      currentSort = target.value;\r\n      currentPage = 1; // Reset to first page when sorting changes\r\n      \r\n      // Update URL without reload\r\n      const url = new URL(window.location.href);\r\n      url.searchParams.set(\"sort\", currentSort);\r\n      url.searchParams.delete(\"page\"); // Reset to page 1\r\n      window.history.pushState({}, \"\", url);\r\n      \r\n      updateView();\r\n    });\r\n  }\r\n\r\n  // Per-page select handler\r\n  if (perPageSelect) {\r\n    perPageSelect.addEventListener(\"change\", (e) =\u003e {\r\n      const target = e.target as HTMLSelectElement;\r\n      postsPerPage = parseInt(target.value, 10);\r\n      currentPage = 1; // Reset to first page when per-page changes\r\n      \r\n      // Update URL without reload\r\n      const url = new URL(window.location.href);\r\n      url.searchParams.set(\"perPage\", target.value);\r\n      url.searchParams.delete(\"page\"); // Reset to page 1\r\n      window.history.pushState({}, \"\", url);\r\n      \r\n      updateView();\r\n    });\r\n  }\r\n\r\n  // Pagination button handlers\r\n  if (paginationPrev) {\r\n    paginationPrev.addEventListener(\"click\", () =\u003e {\r\n      if (currentPage \u003e 1) {\r\n        goToPage(currentPage - 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  if (paginationNext) {\r\n    paginationNext.addEventListener(\"click\", () =\u003e {\r\n      const totalPosts = posts.filter((post) =\u003e {\r\n        if (currentSearch) {\r\n          const searchLower = currentSearch.toLowerCase();\r\n          const titleMatch = post.title.includes(searchLower);\r\n          const contentMatch = post.element.textContent?.toLowerCase().includes(searchLower);\r\n          if (!titleMatch \u0026\u0026 !contentMatch) return false;\r\n        }\r\n        if (currentFilter !== \"all\") {\r\n          if (currentFilter.startsWith(\"tag-\")) {\r\n            if (!post.tags.includes(currentFilter)) return false;\r\n          } else if (currentFilter.startsWith(\"category-\")) {\r\n            if (!post.categories.includes(currentFilter)) return false;\r\n          }\r\n        }\r\n        return true;\r\n      }).length;\r\n      const totalPages = Math.ceil(totalPosts / postsPerPage);\r\n      \r\n      if (currentPage \u003c totalPages) {\r\n        goToPage(currentPage + 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial update\r\n  updateView();\r\n};\r\n\r\n","// ============================================================================\r\n// Sitemap Search Functionality\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize sitemap search functionality\r\n */\r\nexport const initSitemap = (): void =\u003e {\r\n  const container = document.querySelector\u003cHTMLElement\u003e(\".section-sitemap\");\r\n  if (!container) return;\r\n\r\n  const searchInput = container.querySelector\u003cHTMLInputElement\u003e(\"[data-sitemap-search]\");\r\n  const searchClear = container.querySelector\u003cHTMLButtonElement\u003e(\"[data-sitemap-search-clear]\");\r\n  const grid = container.querySelector\u003cHTMLElement\u003e(\"[data-sitemap-grid]\");\r\n  const noResults = container.querySelector\u003cHTMLElement\u003e(\"[data-sitemap-no-results]\");\r\n  const allItems = container.querySelectorAll\u003cHTMLElement\u003e(\"[data-sitemap-item]\");\r\n  const allGroups = container.querySelectorAll\u003cHTMLElement\u003e(\"[data-sitemap-group]\");\r\n\r\n  if (!grid || !searchInput) return;\r\n\r\n  let currentSearch = \"\";\r\n\r\n  // Get search term from URL if present\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  const searchParam = urlParams.get(\"search\");\r\n  if (searchParam) {\r\n    currentSearch = searchParam;\r\n    searchInput.value = currentSearch;\r\n    if (searchClear \u0026\u0026 currentSearch) {\r\n      searchClear.classList.add(\"sitemap__search-clear--visible\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the view based on current search\r\n   */\r\n  const updateView = (): void =\u003e {\r\n    const searchTerm = currentSearch.toLowerCase().trim();\r\n    let visibleCount = 0;\r\n    let hasVisibleGroups = false;\r\n\r\n    // If no search term, show everything\r\n    if (!searchTerm) {\r\n      allItems.forEach((item) =\u003e {\r\n        item.style.display = \"\";\r\n      });\r\n      allGroups.forEach((group) =\u003e {\r\n        group.style.display = \"\";\r\n      });\r\n      if (grid) grid.style.display = \"\";\r\n      if (noResults) noResults.style.display = \"none\";\r\n      return;\r\n    }\r\n\r\n    // Filter items and groups\r\n    allGroups.forEach((group) =\u003e {\r\n      const groupItems = group.querySelectorAll\u003cHTMLElement\u003e(\"[data-sitemap-item]\");\r\n      let groupVisibleCount = 0;\r\n\r\n      groupItems.forEach((item) =\u003e {\r\n        const title = item.getAttribute(\"data-sitemap-title\") || \"\";\r\n        const linkText = item.textContent?.toLowerCase() || \"\";\r\n        const matches = title.includes(searchTerm) || linkText.includes(searchTerm);\r\n\r\n        if (matches) {\r\n          item.style.display = \"\";\r\n          groupVisibleCount++;\r\n          visibleCount++;\r\n        } else {\r\n          item.style.display = \"none\";\r\n        }\r\n      });\r\n\r\n      // Show/hide group based on visible items\r\n      if (groupVisibleCount \u003e 0) {\r\n        group.style.display = \"\";\r\n        hasVisibleGroups = true;\r\n      } else {\r\n        group.style.display = \"none\";\r\n      }\r\n    });\r\n\r\n    // Show/hide grid and no results message\r\n    if (hasVisibleGroups \u0026\u0026 visibleCount \u003e 0) {\r\n      if (grid) grid.style.display = \"\";\r\n      if (noResults) noResults.style.display = \"none\";\r\n    } else {\r\n      if (grid) grid.style.display = \"none\";\r\n      if (noResults) noResults.style.display = \"block\";\r\n    }\r\n  };\r\n\r\n  // Debounce function for search\r\n  let searchTimeout: number | null = null;\r\n  const debouncedUpdateView = (): void =\u003e {\r\n    if (searchTimeout) {\r\n      clearTimeout(searchTimeout);\r\n    }\r\n    searchTimeout = window.setTimeout(() =\u003e {\r\n      updateView();\r\n    }, 300);\r\n  };\r\n\r\n  // Search input handler with debouncing\r\n  if (searchInput) {\r\n    searchInput.addEventListener(\"input\", (e) =\u003e {\r\n      const target = e.target as HTMLInputElement;\r\n      const newSearch = target.value;\r\n      currentSearch = newSearch;\r\n\r\n      // Show/hide clear button immediately\r\n      if (searchClear) {\r\n        if (currentSearch) {\r\n          searchClear.classList.add(\"sitemap__search-clear--visible\");\r\n        } else {\r\n          searchClear.classList.remove(\"sitemap__search-clear--visible\");\r\n        }\r\n      }\r\n\r\n      // Update URL without page reload\r\n      const url = new URL(window.location.href);\r\n      if (currentSearch) {\r\n        url.searchParams.set(\"search\", currentSearch);\r\n      } else {\r\n        url.searchParams.delete(\"search\");\r\n      }\r\n      window.history.pushState({}, \"\", url);\r\n\r\n      // Debounce the actual filtering\r\n      debouncedUpdateView();\r\n    });\r\n\r\n    // Clear search handler\r\n    if (searchClear) {\r\n      searchClear.addEventListener(\"click\", (e) =\u003e {\r\n        e.preventDefault();\r\n        if (searchInput) {\r\n          searchInput.value = \"\";\r\n          currentSearch = \"\";\r\n\r\n          // Clear search from URL\r\n          const url = new URL(window.location.href);\r\n          url.searchParams.delete(\"search\");\r\n          window.history.pushState({}, \"\", url);\r\n\r\n          updateView();\r\n          searchClear.classList.remove(\"sitemap__search-clear--visible\");\r\n          searchInput.focus();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Initial view update\r\n  updateView();\r\n};\r\n\r\n","/**\r\n * Smooth scroll with offset for anchor links\r\n * Handles anchor link clicks and adds offset to account for fixed/sticky headers\r\n */\r\n\r\n/**\r\n * Calculate the offset needed for smooth scrolling\r\n * Accounts for sticky header height\r\n */\r\nconst getScrollOffset = (): number =\u003e {\r\n  const header = document.querySelector\u003cHTMLElement\u003e('.site-header');\r\n  if (header) {\r\n    // Get the actual height of the header\r\n    const headerHeight = header.offsetHeight;\r\n    // Add a small buffer (e.g., 20px) for better spacing\r\n    return headerHeight + 20;\r\n  }\r\n  // Fallback offset if header not found\r\n  return 100;\r\n};\r\n\r\n/**\r\n * Smooth scroll to element with offset\r\n */\r\nconst scrollToElement = (element: HTMLElement, offset: number): void =\u003e {\r\n  const elementPosition = element.getBoundingClientRect().top;\r\n  const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n  window.scrollTo({\r\n    top: offsetPosition,\r\n    behavior: 'smooth'\r\n  });\r\n};\r\n\r\n/**\r\n * Handle anchor link clicks\r\n */\r\nconst handleAnchorClick = (e: Event): void =\u003e {\r\n  const link = (e.target as HTMLElement).closest\u003cHTMLAnchorElement\u003e('a[href^=\"#\"]');\r\n  if (!link) return;\r\n\r\n  const href = link.getAttribute('href');\r\n\r\n  // Only handle anchor links (starting with #)\r\n  if (!href || !href.startsWith('#')) {\r\n    return;\r\n  }\r\n\r\n  // Skip if it's just \"#\" (empty anchor)\r\n  if (href === '#') {\r\n    return;\r\n  }\r\n\r\n  // Extract the target ID\r\n  const targetId = href.substring(1);\r\n  const targetElement = document.getElementById(targetId);\r\n\r\n  if (targetElement) {\r\n    e.preventDefault();\r\n    const offset = getScrollOffset();\r\n    scrollToElement(targetElement, offset);\r\n\r\n    // Update URL hash without triggering scroll\r\n    if (history.pushState) {\r\n      history.pushState(null, '', href);\r\n    } else {\r\n      window.location.hash = href;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Handle initial page load with hash in URL\r\n */\r\nconst handleInitialHash = (): void =\u003e {\r\n  if (window.location.hash) {\r\n    const hash = window.location.hash.substring(1);\r\n    const targetElement = document.getElementById(hash);\r\n\r\n    if (targetElement) {\r\n      // Small delay to ensure page is fully rendered\r\n      setTimeout(() =\u003e {\r\n        const offset = getScrollOffset();\r\n        scrollToElement(targetElement, offset);\r\n      }, 100);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Initialize smooth scroll functionality\r\n */\r\nexport const initSmoothScroll = (): void =\u003e {\r\n  // Use event delegation to handle all anchor links, including dynamically added ones\r\n  // This ensures TOC links and any other dynamically created anchor links work\r\n  document.addEventListener('click', handleAnchorClick);\r\n\r\n  // Handle initial hash if present in URL\r\n  handleInitialHash();\r\n\r\n  // Handle hash changes (e.g., when user navigates back/forward)\r\n  window.addEventListener('hashchange', () =\u003e {\r\n    if (window.location.hash) {\r\n      const hash = window.location.hash.substring(1);\r\n      const targetElement = document.getElementById(hash);\r\n\r\n      if (targetElement) {\r\n        const offset = getScrollOffset();\r\n        scrollToElement(targetElement, offset);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n","/**\r\n * FAQ module\r\n * Handles expand/collapse functionality for FAQ items with accordion behavior\r\n */\r\n\r\n/**\r\n * Closes a FAQ item with smooth transition\r\n */\r\nconst closeItem = (item: HTMLElement, button: HTMLButtonElement, content: HTMLElement): void =\u003e {\r\n  // Update ARIA attributes\r\n  button.setAttribute(\"aria-expanded\", \"false\");\r\n  \r\n  // Remove open class to trigger CSS transition\r\n  item.classList.remove(\"faq-item--open\");\r\n  \r\n  // Wait for transition to complete before adding hidden attribute\r\n  const handleTransitionEnd = (): void =\u003e {\r\n    content.setAttribute(\"hidden\", \"\");\r\n    content.removeEventListener(\"transitionend\", handleTransitionEnd);\r\n  };\r\n  \r\n  content.addEventListener(\"transitionend\", handleTransitionEnd, { once: true });\r\n  \r\n  // Fallback: if transition doesn't fire, add hidden after timeout\r\n  setTimeout(() =\u003e {\r\n    if (button.getAttribute(\"aria-expanded\") === \"false\") {\r\n      content.setAttribute(\"hidden\", \"\");\r\n    }\r\n  }, 350);\r\n};\r\n\r\n/**\r\n * Opens a FAQ item with smooth transition\r\n */\r\nconst openItem = (item: HTMLElement, button: HTMLButtonElement, content: HTMLElement): void =\u003e {\r\n  // Remove hidden attribute first to allow transition\r\n  content.removeAttribute(\"hidden\");\r\n  \r\n  // Use requestAnimationFrame to ensure the DOM update is processed\r\n  requestAnimationFrame(() =\u003e {\r\n    // Update ARIA attributes\r\n    button.setAttribute(\"aria-expanded\", \"true\");\r\n    \r\n    // Add open class to trigger CSS transition\r\n    item.classList.add(\"faq-item--open\");\r\n  });\r\n};\r\n\r\n/**\r\n * Closes all FAQ items in the same FAQ list container\r\n */\r\nconst closeOtherItems = (currentItem: HTMLElement): void =\u003e {\r\n  // Find the parent FAQ list container\r\n  const faqList = currentItem.closest(\".faq__list\");\r\n  if (!faqList) return;\r\n  \r\n  // Get all FAQ items in the same list\r\n  const allItems = faqList.querySelectorAll\u003cHTMLElement\u003e(\"[data-faq-item]\");\r\n  \r\n  allItems.forEach((item) =\u003e {\r\n    // Skip the current item\r\n    if (item === currentItem) return;\r\n    \r\n    const button = item.querySelector\u003cHTMLButtonElement\u003e(\".faq-item__button\");\r\n    const content = item.querySelector\u003cHTMLElement\u003e(\".faq-item__content\");\r\n    \r\n    if (!button || !content) return;\r\n    \r\n    // Only close if it's currently open\r\n    if (button.getAttribute(\"aria-expanded\") === \"true\") {\r\n      closeItem(item, button, content);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Initializes the FAQ expand/collapse functionality with accordion behavior\r\n */\r\nexport const initFAQ = (): void =\u003e {\r\n  const faqItems = document.querySelectorAll\u003cHTMLElement\u003e(\"[data-faq-item]\");\r\n  \r\n  faqItems.forEach((item) =\u003e {\r\n    const button = item.querySelector\u003cHTMLButtonElement\u003e(\".faq-item__button\");\r\n    const content = item.querySelector\u003cHTMLElement\u003e(\".faq-item__content\");\r\n    \r\n    if (!button || !content) return;\r\n    \r\n    const toggle = (): void =\u003e {\r\n      const isExpanded = button.getAttribute(\"aria-expanded\") === \"true\";\r\n      const newState = !isExpanded;\r\n      \r\n      // If opening, close all other items in the same FAQ list first\r\n      if (newState) {\r\n        closeOtherItems(item);\r\n      }\r\n      \r\n      // Toggle the current item\r\n      if (newState) {\r\n        openItem(item, button, content);\r\n      } else {\r\n        closeItem(item, button, content);\r\n      }\r\n    };\r\n    \r\n    button.addEventListener(\"click\", (event) =\u003e {\r\n      event.preventDefault();\r\n      toggle();\r\n    });\r\n  });\r\n};\r\n\r\n","/**\r\n * Feedback Form + Sidebar Progress Module\r\n *\r\n * Handles:\r\n * - Feedback form validation and branching logic\r\n * - Sidebar feedback progress bar + steps (kept in sync with form sections)\r\n */\r\n\r\nimport { onDOMReady } from \"../utils/dom\";\r\n\r\ntype Nullable\u003cT\u003e = T | null;\r\n\r\ninterface FeedbackElements {\r\n  form: HTMLFormElement;\r\n  submitButton: Nullable\u003cHTMLButtonElement\u003e;\r\n  liveRegion: Nullable\u003cHTMLElement\u003e;\r\n  errorContainer: Nullable\u003cHTMLElement\u003e;\r\n  lowRatingMessage: Nullable\u003cHTMLElement\u003e;\r\n  recommendationReasonWrapper: Nullable\u003cHTMLElement\u003e;\r\n  serviceDetailsSection: Nullable\u003cHTMLElement\u003e;\r\n  serviceDetailsHelp: Nullable\u003cHTMLElement\u003e;\r\n  serviceDetailsSimplified: Nullable\u003cHTMLElement\u003e;\r\n  contactDetailsWrapper: Nullable\u003cHTMLElement\u003e;\r\n  contactDetailsIntro: Nullable\u003cHTMLElement\u003e;\r\n  progressRoot: Nullable\u003cHTMLElement\u003e;\r\n  progressBar: Nullable\u003cHTMLElement\u003e;\r\n  progressStepText: Nullable\u003cHTMLElement\u003e;\r\n  progressSteps: NodeListOf\u003cHTMLElement\u003e | null;\r\n  stepFieldsets: NodeListOf\u003cHTMLFieldSetElement\u003e;\r\n  totalSteps: number;\r\n}\r\n\r\nfunction getElements(): FeedbackElements | null {\r\n  const form = document.querySelector('form[name=\"feedback\"]') as HTMLFormElement | null;\r\n  if (!form) return null;\r\n\r\n  const progressRoot = document.getElementById(\"feedback-progress\");\r\n  const progressBar = document.getElementById(\"feedback-progress-bar\");\r\n  const progressStepText = document.getElementById(\"feedback-progress-step-text\");\r\n\r\n  const progressSteps =\r\n    progressRoot?.querySelectorAll\u003cHTMLElement\u003e(\"[data-progress-step]\") ?? null;\r\n  const stepFieldsets = form.querySelectorAll\u003cHTMLFieldSetElement\u003e(\"fieldset[data-step]\");\r\n  const totalSteps = stepFieldsets.length || 4;\r\n\r\n  return {\r\n    form,\r\n    submitButton: document.getElementById(\"feedback-submit\") as HTMLButtonElement | null,\r\n    liveRegion: document.getElementById(\"feedback-live-region\"),\r\n    errorContainer: document.getElementById(\"feedback-error\"),\r\n    lowRatingMessage: document.getElementById(\"feedback-low-rating-message\"),\r\n    recommendationReasonWrapper: document.getElementById(\"recommendation-reason-wrapper\"),\r\n    serviceDetailsSection: document.getElementById(\"service-details-section\"),\r\n    serviceDetailsHelp: document.getElementById(\"service-details-help\"),\r\n    serviceDetailsSimplified: document.getElementById(\"service-details-simplified\"),\r\n    contactDetailsWrapper: document.getElementById(\"contact-details-wrapper\"),\r\n    contactDetailsIntro: document.getElementById(\"contact-details-intro\"),\r\n    progressRoot,\r\n    progressBar,\r\n    progressStepText,\r\n    progressSteps,\r\n    stepFieldsets,\r\n    totalSteps,\r\n  };\r\n}\r\n\r\nfunction showError(fieldId: string, message: string): void {\r\n  const errorEl = document.getElementById(fieldId + \"-error\");\r\n  if (errorEl) {\r\n    errorEl.textContent = message;\r\n    (errorEl as HTMLElement).style.display = \"block\";\r\n  }\r\n\r\n  // Reflect error state on associated form controls for a11y\r\n  const form = document.querySelector('form[name=\"feedback\"]') as HTMLFormElement | null;\r\n  if (!form) return;\r\n\r\n  const controls: HTMLElement[] = [];\r\n  const named = form.elements.namedItem(fieldId);\r\n\r\n  if (named instanceof RadioNodeList) {\r\n    Array.prototype.forEach.call(named, (el: Element) =\u003e {\r\n      if (el instanceof HTMLElement) controls.push(el);\r\n    });\r\n  } else if (named instanceof HTMLElement) {\r\n    controls.push(named);\r\n  } else {\r\n    const byId = document.getElementById(fieldId);\r\n    if (byId instanceof HTMLElement) {\r\n      controls.push(byId);\r\n    }\r\n  }\r\n\r\n  controls.forEach((control) =\u003e {\r\n    control.setAttribute(\"aria-invalid\", \"true\");\r\n\r\n    const errorId = fieldId + \"-error\";\r\n    const existingDescribedBy = control.getAttribute(\"aria-describedby\") || \"\";\r\n    const tokens = existingDescribedBy.split(\" \").filter(Boolean);\r\n    if (!tokens.includes(errorId)) {\r\n      tokens.push(errorId);\r\n      control.setAttribute(\"aria-describedby\", tokens.join(\" \"));\r\n    }\r\n  });\r\n}\r\n\r\nfunction clearError(fieldId: string): void {\r\n  const errorEl = document.getElementById(fieldId + \"-error\");\r\n  if (errorEl) {\r\n    errorEl.textContent = \"\";\r\n    (errorEl as HTMLElement).style.display = \"none\";\r\n  }\r\n\r\n  // Clear error state on associated form controls for a11y\r\n  const form = document.querySelector('form[name=\"feedback\"]') as HTMLFormElement | null;\r\n  if (!form) return;\r\n\r\n  const controls: HTMLElement[] = [];\r\n  const named = form.elements.namedItem(fieldId);\r\n\r\n  if (named instanceof RadioNodeList) {\r\n    Array.prototype.forEach.call(named, (el: Element) =\u003e {\r\n      if (el instanceof HTMLElement) controls.push(el);\r\n    });\r\n  } else if (named instanceof HTMLElement) {\r\n    controls.push(named);\r\n  } else {\r\n    const byId = document.getElementById(fieldId);\r\n    if (byId instanceof HTMLElement) {\r\n      controls.push(byId);\r\n    }\r\n  }\r\n\r\n  controls.forEach((control) =\u003e {\r\n    control.removeAttribute(\"aria-invalid\");\r\n\r\n    const errorId = fieldId + \"-error\";\r\n    const existingDescribedBy = control.getAttribute(\"aria-describedby\") || \"\";\r\n    const tokens = existingDescribedBy\r\n      .split(\" \")\r\n      .filter((token) =\u003e token \u0026\u0026 token !== errorId);\r\n\r\n    if (tokens.length \u003e 0) {\r\n      control.setAttribute(\"aria-describedby\", tokens.join(\" \"));\r\n    } else {\r\n      control.removeAttribute(\"aria-describedby\");\r\n    }\r\n  });\r\n}\r\n\r\nfunction hasChecked(form: HTMLFormElement, name: string): boolean {\r\n  const inputs = form.querySelectorAll\u003cHTMLInputElement\u003e('input[name=\"' + name + '\"]');\r\n  return Array.prototype.some.call(inputs, (input: HTMLInputElement) =\u003e input.checked);\r\n}\r\n\r\nfunction getCheckedValue(form: HTMLFormElement, name: string): string {\r\n  const inputs = form.querySelectorAll\u003cHTMLInputElement\u003e('input[name=\"' + name + '\"]');\r\n  const checked = Array.prototype.find.call(\r\n    inputs,\r\n    (input: HTMLInputElement) =\u003e input.checked\r\n  ) as HTMLInputElement | undefined;\r\n  return checked ? checked.value : \"\";\r\n}\r\n\r\nfunction setSectionVisibility(el: Nullable\u003cHTMLElement\u003e, visible: boolean): void {\r\n  if (!el) return;\r\n  el.style.display = visible ? \"\" : \"none\";\r\n  el.setAttribute(\"aria-hidden\", visible ? \"false\" : \"true\");\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Progress bar behavior\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction getStepFromFieldset(fieldset: HTMLFieldSetElement | null): number {\r\n  if (!fieldset) return 0;\r\n  const v = parseInt(fieldset.getAttribute(\"data-step\") || \"0\", 10);\r\n  return Number.isNaN(v) ? 0 : v;\r\n}\r\n\r\nfunction getStepFromElement(el: Element | null): number {\r\n  if (!el) return 0;\r\n  const fieldset = el.closest(\"fieldset[data-step]\") as HTMLFieldSetElement | null;\r\n  return getStepFromFieldset(fieldset);\r\n}\r\n\r\n/**\r\n * Calculate question-level progress based on answered fields.\r\n * Each \"question\" contributes equally to the progress bar.\r\n */\r\nfunction getQuestionProgress(els: FeedbackElements): { answered: number; total: number } {\r\n  const { form } = els;\r\n  let answered = 0;\r\n\r\n  // Track which logical questions count toward progress\r\n  // Keep in sync with checks below. Only required questions count here.\r\n  const total = 9;\r\n\r\n  // 1. Overall experience\r\n  if (hasChecked(form, \"overall_experience\")) answered++;\r\n\r\n  // 2. Recommendation\r\n  if (hasChecked(form, \"recommendation\")) answered++;\r\n\r\n  // 3. Visit type\r\n  const visitType = (document.getElementById(\"visit_type\") as HTMLSelectElement | null)?.value || \"\";\r\n  if (visitType) answered++;\r\n\r\n  // 4. Technician knowledge (required)\r\n  if (hasChecked(form, \"tech_knowledge\")) answered++;\r\n\r\n  // 5. Timeliness (required)\r\n  if (hasChecked(form, \"timeliness\")) answered++;\r\n\r\n  // 6. What went well (required)\r\n  const wentWell =\r\n    (document.getElementById(\"went_well\") as HTMLTextAreaElement | null)?.value || \"\";\r\n  if (wentWell.trim().length \u003e 0) answered++;\r\n\r\n  // 7. Share permission (required)\r\n  if (hasChecked(form, \"share_permission\")) answered++;\r\n\r\n  // 8. Follow-up preference (required)\r\n  if (hasChecked(form, \"follow_up\")) answered++;\r\n\r\n  // 9. Contact details (email or phone provided when user chooses follow-up)\r\n  const emailVal =\r\n    (document.getElementById(\"email\") as HTMLInputElement | null)?.value?.trim() || \"\";\r\n  const phoneVal =\r\n    (document.getElementById(\"phone\") as HTMLInputElement | null)?.value?.trim() || \"\";\r\n  if (emailVal || phoneVal) answered++;\r\n\r\n  // Clamp just in case\r\n  const clampedAnswered = Math.max(0, Math.min(total, answered));\r\n\r\n  return { answered: clampedAnswered, total };\r\n}\r\n\r\ntype StepCompletionState = \"none\" | \"partial\" | \"complete\";\r\n\r\n/**\r\n * Determine completion state for a given step based on required questions\r\n * within that section.\r\n */\r\nfunction getStepCompletion(step: number, els: FeedbackElements): StepCompletionState {\r\n  const { form } = els;\r\n  let answered = 0;\r\n  let total = 0;\r\n\r\n  switch (step) {\r\n    case 1: {\r\n      // Overall experience, recommendation, visit type\r\n      total = 3;\r\n      if (hasChecked(form, \"overall_experience\")) answered++;\r\n      if (hasChecked(form, \"recommendation\")) answered++;\r\n      const visitType =\r\n        (document.getElementById(\"visit_type\") as HTMLSelectElement | null)?.value || \"\";\r\n      if (visitType) answered++;\r\n      break;\r\n    }\r\n    case 2: {\r\n      // Service details section.\r\n      // Only the required questions (technician knowledge and timeliness) are needed\r\n      // to mark the step as complete. Optional contextual fields contribute to a\r\n      // \"partial\" state when filled.\r\n\r\n      let requiredAnswered = 0;\r\n      const requiredTotal = 2;\r\n\r\n      if (hasChecked(form, \"tech_knowledge\")) requiredAnswered++;\r\n      if (hasChecked(form, \"timeliness\")) requiredAnswered++;\r\n\r\n      let anyOptionalAnswered = false;\r\n\r\n      const applianceType =\r\n        (document.getElementById(\"appliance_type\") as HTMLSelectElement | null)?.value || \"\";\r\n      if (applianceType) anyOptionalAnswered = true;\r\n\r\n      const serviceDate =\r\n        (document.getElementById(\"service_date\") as HTMLInputElement | null)?.value || \"\";\r\n      if (serviceDate) anyOptionalAnswered = true;\r\n\r\n      const techName =\r\n        (document.getElementById(\"technician_name\") as HTMLInputElement | null)?.value?.trim() ||\r\n        \"\";\r\n      if (techName) anyOptionalAnswered = true;\r\n\r\n      // If nothing in the section has been answered, keep the step \"none\"\r\n      if (requiredAnswered === 0 \u0026\u0026 !anyOptionalAnswered) {\r\n        return \"none\";\r\n      }\r\n\r\n      // All required questions answered → complete,\r\n      // otherwise there is at least some progress → partial.\r\n      if (requiredAnswered === requiredTotal) {\r\n        return \"complete\";\r\n      }\r\n\r\n      return \"partial\";\r\n    }\r\n    case 3: {\r\n      // Feedback section: treat \"what went well\" as required with a minimum length,\r\n      // and \"what could be improved\" as optional but contributing to partial state.\r\n      const wentWell =\r\n        (document.getElementById(\"went_well\") as HTMLTextAreaElement | null)?.value || \"\";\r\n      const wentWellTrimmedLen = wentWell.trim().length;\r\n\r\n      const couldImprove =\r\n        (document.getElementById(\"could_improve\") as HTMLTextAreaElement | null)?.value || \"\";\r\n      const couldImproveLen = couldImprove.trim().length;\r\n\r\n      // No input in either textarea → step not started.\r\n      if (wentWellTrimmedLen === 0 \u0026\u0026 couldImproveLen === 0) {\r\n        return \"none\";\r\n      }\r\n\r\n      // Match validation logic: \"what went well\" must have some non-whitespace content\r\n      // and be at least 10 characters long (untrimmed) to be considered fully answered.\r\n      if (wentWellTrimmedLen \u003e 0 \u0026\u0026 wentWell.length \u003e= 10) {\r\n        return \"complete\";\r\n      }\r\n\r\n      return \"partial\";\r\n    }\r\n    case 4: {\r\n      // Permissions \u0026 follow-up (contact details required when follow-up is requested)\r\n      total = 2;\r\n      if (hasChecked(form, \"share_permission\")) answered++;\r\n      const followUp = getCheckedValue(form, \"follow_up\");\r\n      if (followUp) answered++;\r\n\r\n      if (followUp \u0026\u0026 followUp !== \"No follow-up needed\") {\r\n        total = 3;\r\n        const emailVal =\r\n          (document.getElementById(\"email\") as HTMLInputElement | null)?.value?.trim() || \"\";\r\n        const phoneVal =\r\n          (document.getElementById(\"phone\") as HTMLInputElement | null)?.value?.trim() || \"\";\r\n        if (emailVal || phoneVal) answered++;\r\n      }\r\n      break;\r\n    }\r\n    default:\r\n      return \"none\";\r\n  }\r\n\r\n  if (answered \u003c= 0) return \"none\";\r\n  if (answered \u003c total) return \"partial\";\r\n  return \"complete\";\r\n}\r\n\r\nfunction setProgress(step: number, els: FeedbackElements): void {\r\n  const { progressRoot, progressBar, progressStepText, progressSteps, totalSteps } = els;\r\n  if (!progressRoot || !progressBar || !progressSteps) return;\r\n\r\n  const clampedStep = Math.max(0, Math.min(totalSteps, step));\r\n  const { answered, total } = getQuestionProgress(els);\r\n  const percent = total \u003e 0 ? (answered / total) * 100 : 0;\r\n\r\n  (progressBar as HTMLElement).style.width = percent + \"%\";\r\n\r\n  const label =\r\n    answered === 0\r\n      ? \"Feedback progress: Not started\"\r\n      : \"Feedback progress: \" + answered + \" of \" + total + \" questions answered\";\r\n  progressRoot.setAttribute(\"aria-label\", label);\r\n  if (progressStepText) {\r\n    progressStepText.textContent =\r\n      clampedStep === 0 ? \"Not started\" : \"Step \" + clampedStep + \" of \" + totalSteps;\r\n  }\r\n\r\n  Array.prototype.forEach.call(progressSteps, (stepEl: HTMLElement) =\u003e {\r\n    const stepNum = parseInt(stepEl.getAttribute(\"data-progress-step\") || \"0\", 10);\r\n    stepEl.classList.remove(\"is-active\", \"is-complete\", \"is-partial\");\r\n\r\n    const completion = getStepCompletion(stepNum, els);\r\n\r\n    if (clampedStep === 0 \u0026\u0026 completion === \"none\") {\r\n      // No steps started yet\r\n      return;\r\n    }\r\n\r\n    if (stepNum === clampedStep) {\r\n      stepEl.classList.add(\"is-active\");\r\n    }\r\n\r\n    if (completion === \"complete\") {\r\n      stepEl.classList.add(\"is-complete\");\r\n    } else if (completion === \"partial\") {\r\n      stepEl.classList.add(\"is-partial\");\r\n    }\r\n  });\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Branching logic\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction initBranching(els: FeedbackElements): void {\r\n  const {\r\n    form,\r\n    recommendationReasonWrapper,\r\n    contactDetailsIntro,\r\n    contactDetailsWrapper,\r\n    serviceDetailsHelp,\r\n    serviceDetailsSimplified,\r\n  } = els;\r\n\r\n  function updateRecommendationBranching(): void {\r\n    const value = getCheckedValue(form, \"recommendation\");\r\n    const shouldShow = value === \"No\" || value === \"Maybe / not sure\";\r\n    setSectionVisibility(recommendationReasonWrapper, shouldShow);\r\n  }\r\n\r\n  function updateFollowUpBranching(): void {\r\n    const value = getCheckedValue(form, \"follow_up\");\r\n    const wantsFollowUp = !!value \u0026\u0026 value !== \"No follow-up needed\";\r\n\r\n    setSectionVisibility(contactDetailsIntro, wantsFollowUp);\r\n    setSectionVisibility(contactDetailsWrapper, wantsFollowUp);\r\n  }\r\n\r\n  function updateServiceDetailsBranching(): void {\r\n    const value = getCheckedValue(form, \"overall_experience\");\r\n    if (!value) {\r\n      // No selection yet; keep default messaging\r\n      if (serviceDetailsHelp) {\r\n        serviceDetailsHelp.style.display = \"\";\r\n      }\r\n      if (serviceDetailsSimplified) {\r\n        serviceDetailsSimplified.style.display = \"none\";\r\n      }\r\n      return;\r\n    }\r\n\r\n    const isPoor = value.startsWith(\"1 -\") || value.startsWith(\"2 -\");\r\n\r\n    if (isPoor) {\r\n      if (serviceDetailsHelp) {\r\n        serviceDetailsHelp.style.display = \"none\";\r\n      }\r\n      if (serviceDetailsSimplified) {\r\n        serviceDetailsSimplified.style.display = \"\";\r\n      }\r\n    } else {\r\n      if (serviceDetailsHelp) {\r\n        serviceDetailsHelp.style.display = \"\";\r\n      }\r\n      if (serviceDetailsSimplified) {\r\n        serviceDetailsSimplified.style.display = \"none\";\r\n      }\r\n    }\r\n  }\r\n\r\n  // Attach listeners\r\n  Array.prototype.forEach.call(\r\n    form.querySelectorAll('input[name=\"recommendation\"]'),\r\n    (input: HTMLInputElement) =\u003e {\r\n      input.addEventListener(\"change\", updateRecommendationBranching);\r\n    }\r\n  );\r\n\r\n  Array.prototype.forEach.call(\r\n    form.querySelectorAll('input[name=\"follow_up\"]'),\r\n    (input: HTMLInputElement) =\u003e {\r\n      input.addEventListener(\"change\", updateFollowUpBranching);\r\n    }\r\n  );\r\n\r\n  Array.prototype.forEach.call(\r\n    form.querySelectorAll('input[name=\"overall_experience\"]'),\r\n    (input: HTMLInputElement) =\u003e {\r\n      input.addEventListener(\"change\", updateServiceDetailsBranching);\r\n    }\r\n  );\r\n\r\n  // Initial branching state\r\n  updateRecommendationBranching();\r\n  updateFollowUpBranching();\r\n  updateServiceDetailsBranching();\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Validation\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction initValidation(els: FeedbackElements): void {\r\n  const { form, errorContainer, liveRegion, submitButton } = els;\r\n\r\n  const validators: Record\u003cstring, () =\u003e string | null\u003e = {\r\n    overall_experience: () =\u003e {\r\n      if (!hasChecked(form, \"overall_experience\"))\r\n        return \"Please select your overall experience.\";\r\n      return null;\r\n    },\r\n    recommendation: () =\u003e {\r\n      if (!hasChecked(form, \"recommendation\"))\r\n        return \"Please let us know if you would recommend us.\";\r\n      return null;\r\n    },\r\n    visit_type: () =\u003e {\r\n      const value = (document.getElementById(\"visit_type\") as HTMLSelectElement | null)?.value || \"\";\r\n      if (!value) return \"Please select the type of visit.\";\r\n      return null;\r\n    },\r\n    tech_knowledge: () =\u003e {\r\n      if (!hasChecked(form, \"tech_knowledge\"))\r\n        return \"Please rate the technician's knowledge and explanation.\";\r\n      return null;\r\n    },\r\n    timeliness: () =\u003e {\r\n      if (!hasChecked(form, \"timeliness\")) return \"Please rate our timeliness.\";\r\n      return null;\r\n    },\r\n    went_well: () =\u003e {\r\n      const value =\r\n        (document.getElementById(\"went_well\") as HTMLTextAreaElement | null)?.value || \"\";\r\n      if (!value.trim()) return \"Please tell us at least one thing that went well.\";\r\n      if (value.length \u003c 10)\r\n        return \"Please add a bit more detail so we can understand your experience.\";\r\n      return null;\r\n    },\r\n    share_permission: () =\u003e {\r\n      if (!hasChecked(form, \"share_permission\"))\r\n        return \"Please choose how we may use your feedback.\";\r\n      return null;\r\n    },\r\n    follow_up: () =\u003e {\r\n      if (!hasChecked(form, \"follow_up\"))\r\n        return \"Please let us know if you would like a follow-up.\";\r\n      return null;\r\n    },\r\n    email: () =\u003e {\r\n      const emailField = document.getElementById(\"email\") as HTMLInputElement | null;\r\n      const phoneField = document.getElementById(\"phone\") as HTMLInputElement | null;\r\n      const followUp = getCheckedValue(form, \"follow_up\");\r\n\r\n      const emailVal = emailField?.value?.trim() || \"\";\r\n      const phoneVal = phoneField?.value?.trim() || \"\";\r\n\r\n      if (followUp \u0026\u0026 followUp !== \"No follow-up needed\" \u0026\u0026 !emailVal \u0026\u0026 !phoneVal) {\r\n        return \"Please provide at least an email or phone number so we can follow up.\";\r\n      }\r\n\r\n      if (emailVal) {\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(emailVal)) return \"Please enter a valid email address.\";\r\n      }\r\n\r\n      return null;\r\n    },\r\n    phone: () =\u003e {\r\n      const field = document.getElementById(\"phone\") as HTMLInputElement | null;\r\n      if (!field || !field.value) return null;\r\n      const digitsOnly = field.value.replace(/\\D/g, \"\");\r\n      if (digitsOnly.length \u003e 0 \u0026\u0026 digitsOnly.length \u003c 10) {\r\n        return \"Please enter a valid phone number.\";\r\n      }\r\n      return null;\r\n    },\r\n  };\r\n\r\n  form.addEventListener(\"submit\", (e: Event) =\u003e {\r\n    e.preventDefault();\r\n\r\n    if (errorContainer) (errorContainer as HTMLElement).style.display = \"none\";\r\n\r\n    Object.keys(validators).forEach((fieldId) =\u003e {\r\n      clearError(fieldId);\r\n    });\r\n\r\n    let isValid = true;\r\n    Object.keys(validators).forEach((fieldId) =\u003e {\r\n      const error = validators[fieldId]();\r\n      if (error) {\r\n        showError(fieldId, error);\r\n        isValid = false;\r\n      }\r\n    });\r\n\r\n    if (!isValid) {\r\n      if (errorContainer) {\r\n        errorContainer.textContent =\r\n          \"Please review the highlighted questions and complete any missing answers.\";\r\n        (errorContainer as HTMLElement).style.display = \"block\";\r\n      }\r\n      if (liveRegion) {\r\n        liveRegion.textContent =\r\n          \"Form has errors. Please review the highlighted questions.\";\r\n      }\r\n\r\n      const firstError = form.querySelector\u003cHTMLElement\u003e(\r\n        '.contact-form__error[style*=\"block\"]'\r\n      );\r\n      if (firstError) {\r\n        let target: HTMLElement | HTMLFormElement | null =\r\n          (firstError.previousElementSibling as HTMLElement | null) ?? form;\r\n        if (target \u0026\u0026 typeof (target as HTMLElement).focus === \"function\") {\r\n          (target as HTMLElement).focus();\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (submitButton) {\r\n      submitButton.classList.add(\"contact-form__submit--loading\");\r\n      submitButton.disabled = true;\r\n      const btnText = submitButton.querySelector(\".btn__text\");\r\n      if (btnText) btnText.textContent = \"Sending...\";\r\n    }\r\n\r\n    if (liveRegion) {\r\n      liveRegion.textContent = \"Sending your feedback...\";\r\n    }\r\n\r\n    // Prepare form data for Web3Forms\r\n    const formData = new FormData(form);\r\n\r\n    fetch(\"https://api.web3forms.com/submit\", {\r\n      method: \"POST\",\r\n      body: formData,\r\n    })\r\n      .then((response) =\u003e response.json())\r\n      .then((data) =\u003e {\r\n        if (data.success) {\r\n          // Success - redirect to thank you page\r\n          if (liveRegion) {\r\n            liveRegion.textContent = \"Feedback sent successfully! Redirecting...\";\r\n          }\r\n          const redirectInput = form.querySelector\u003cHTMLInputElement\u003e(\r\n            'input[name=\"redirect\"]'\r\n          );\r\n          const redirectUrl = redirectInput?.value || \"/give-feedback/thank-you/\";\r\n          window.location.replace(redirectUrl);\r\n        } else {\r\n          // Handle error from Web3Forms\r\n          throw new Error(data.message || \"Failed to send feedback\");\r\n        }\r\n      })\r\n      .catch((error) =\u003e {\r\n        // Handle network or other errors\r\n        const errorMessage =\r\n          error instanceof Error\r\n            ? error.message\r\n            : \"An error occurred. Please try again later.\";\r\n\r\n        if (errorContainer) {\r\n          errorContainer.textContent = errorMessage;\r\n          (errorContainer as HTMLElement).style.display = \"block\";\r\n        }\r\n        if (liveRegion) {\r\n          liveRegion.textContent = \"Error sending feedback. Please try again.\";\r\n        }\r\n\r\n        if (submitButton) {\r\n          submitButton.classList.remove(\"contact-form__submit--loading\");\r\n          submitButton.disabled = false;\r\n          const btnText = submitButton.querySelector(\".btn__text\");\r\n          if (btnText) btnText.textContent = \"Submit Feedback\";\r\n        }\r\n      });\r\n  });\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n// Public init\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction checkAndShowLowRatingMessage(els: FeedbackElements): void {\r\n  if (!els.lowRatingMessage) return;\r\n\r\n  try {\r\n    const stored = sessionStorage.getItem(\"ars_reviews_stage1\");\r\n    if (!stored) return;\r\n\r\n    const data = JSON.parse(stored);\r\n    const now = Date.now();\r\n\r\n    // Check if data exists, hasn't expired, is from review form, AND rating is low (\u003c= 2)\r\n    if (\r\n      data \u0026\u0026\r\n      data.expiresAt \u0026\u0026\r\n      data.expiresAt \u003e now \u0026\u0026\r\n      data.mode === \"review_stage1\" \u0026\u0026\r\n      typeof data.rating === \"number\" \u0026\u0026\r\n      data.rating \u003c= 2\r\n    ) {\r\n      // Show the message box\r\n      els.lowRatingMessage.classList.remove(\"contact-form__status--hidden\");\r\n      els.lowRatingMessage.style.display = \"\";\r\n\r\n      // Announce to screen readers\r\n      if (els.liveRegion) {\r\n        els.liveRegion.textContent =\r\n          \"We noticed you weren't fully satisfied. Please share your feedback so we can improve.\";\r\n      }\r\n\r\n      // Optionally clear the sessionStorage after showing (or keep it for reference)\r\n      // sessionStorage.removeItem(\"ars_reviews_stage1\");\r\n    }\r\n  } catch (error) {\r\n    // Silently fail if sessionStorage is unavailable or data is corrupted\r\n    console.warn(\"Could not check review stage1 data:\", error);\r\n  }\r\n}\r\n\r\nexport function initFeedback(): void {\r\n  onDOMReady(() =\u003e {\r\n    const els = getElements();\r\n    if (!els) return;\r\n\r\n    // Check for low rating redirect and show message if applicable\r\n    checkAndShowLowRatingMessage(els);\r\n\r\n    // Initialize progress behavior\r\n    const { form, stepFieldsets } = els;\r\n\r\n    form.addEventListener(\"focusin\", (event: FocusEvent) =\u003e {\r\n      const step = getStepFromElement(event.target as Element | null);\r\n      setProgress(step, els);\r\n    });\r\n\r\n    // Keep question-level progress in sync as users type or change answers\r\n    const syncProgressForEvent = (event: Event): void =\u003e {\r\n      const step = getStepFromElement(event.target as Element | null);\r\n      setProgress(step, els);\r\n    };\r\n\r\n    form.addEventListener(\"input\", syncProgressForEvent);\r\n    form.addEventListener(\"change\", syncProgressForEvent);\r\n\r\n    // Scroll-driven step highlighting, throttled via requestAnimationFrame\r\n    let scrollRafId: number | null = null;\r\n\r\n    const handleScroll = (): void =\u003e {\r\n      if (!stepFieldsets.length) return;\r\n\r\n      let bestStep = 0;\r\n      let bestTop = Infinity;\r\n\r\n      stepFieldsets.forEach((fs) =\u003e {\r\n        const rect = fs.getBoundingClientRect();\r\n        if (rect.top \u003e= 0 \u0026\u0026 rect.top \u003c bestTop) {\r\n          bestTop = rect.top;\r\n          bestStep = getStepFromFieldset(fs);\r\n        }\r\n      });\r\n\r\n      setProgress(bestStep, els);\r\n    };\r\n\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      () =\u003e {\r\n        if (scrollRafId !== null) return;\r\n        scrollRafId = window.requestAnimationFrame(() =\u003e {\r\n          scrollRafId = null;\r\n          handleScroll();\r\n        });\r\n      },\r\n      { passive: true }\r\n    );\r\n\r\n    // Initial progress state: 0 (empty) when form is untouched\r\n    setProgress(0, els);\r\n\r\n    // Branching + validation\r\n    initBranching(els);\r\n    initValidation(els);\r\n  });\r\n}\r\n\r\n\r\n","/**\r\n * Service Areas Leaflet Map Module\r\n * \r\n * Interactive map using Leaflet.js and OpenStreetMap\r\n * Displays service area locations with city boundary polygons\r\n */\r\n\r\n// Map style options\r\ntype MapStyle = 'default' | 'carto-positron' | 'carto-dark' | 'carto-voyager' | 'stamen-toner' | 'stamen-terrain' | 'osm-fr';\r\n\r\ninterface MapStyleConfig {\r\n  url: string;\r\n  attribution: string;\r\n  maxZoom?: number;\r\n}\r\n\r\n// Type definitions for Leaflet (will be loaded from CDN)\r\ndeclare const L: any;\r\n\r\ninterface ServiceAreaPage {\r\n  title: string;\r\n  url: string;\r\n  lat?: number;\r\n  lng?: number;\r\n  group: string;\r\n}\r\n\r\ninterface CityCoordinates {\r\n  [key: string]: { lat: number; lng: number };\r\n}\r\n\r\n/**\r\n * Default coordinates for major cities in South Florida\r\n * Used as fallback when lat/lng not provided in frontmatter\r\n */\r\nconst CITY_COORDINATES: CityCoordinates = {\r\n  'Miami': { lat: 25.7617, lng: -80.1918 },\r\n  'Fort Lauderdale': { lat: 26.1224, lng: -80.1373 },\r\n  'West Palm Beach': { lat: 26.7153, lng: -80.0534 },\r\n  'Boca Raton': { lat: 26.3683, lng: -80.1289 },\r\n  'Coral Gables': { lat: 25.7214, lng: -80.2684 },\r\n  'Hialeah': { lat: 25.8576, lng: -80.2781 },\r\n  'Hollywood': { lat: 26.0112, lng: -80.1495 },\r\n  'Aventura': { lat: 25.9565, lng: -80.1392 },\r\n  'Miami Beach': { lat: 25.7907, lng: -80.1300 },\r\n  'Doral': { lat: 25.8195, lng: -80.3553 },\r\n  'Kendall': { lat: 25.6792, lng: -80.3173 },\r\n  'Homestead': { lat: 25.4687, lng: -80.4776 },\r\n  'Key Biscayne': { lat: 25.6931, lng: -80.1620 },\r\n  'Pompano Beach': { lat: 26.2379, lng: -80.1248 },\r\n  'Deerfield Beach': { lat: 26.3184, lng: -80.0998 },\r\n  'Delray Beach': { lat: 26.4615, lng: -80.0728 },\r\n  'Jupiter': { lat: 26.9342, lng: -80.0942 },\r\n  'Palm Beach Gardens': { lat: 26.8234, lng: -80.1387 },\r\n  'Sunrise': { lat: 26.1665, lng: -80.2892 },\r\n  'North Miami': { lat: 25.8901, lng: -80.1867 },\r\n};\r\n\r\n/**\r\n * Group centroids for fallback when no coordinates available\r\n */\r\nconst GROUP_CENTROIDS: CityCoordinates = {\r\n  'Miami-Dade County': { lat: 25.7617, lng: -80.1918 },\r\n  'Broward County': { lat: 26.1224, lng: -80.1373 },\r\n  'Palm Beach County': { lat: 26.7153, lng: -80.0534 },\r\n};\r\n\r\n/**\r\n * Validates that a coordinate value is within valid latitude/longitude ranges\r\n * @param value - The coordinate value to validate\r\n * @param isLatitude - True if validating latitude, false for longitude\r\n * @returns True if the value is valid, false otherwise\r\n */\r\nconst isValidCoordinate = (value: number, isLatitude: boolean): boolean =\u003e {\r\n  if (typeof value !== 'number' || isNaN(value) || !isFinite(value)) {\r\n    return false;\r\n  }\r\n  \r\n  if (isLatitude) {\r\n    return value \u003e= -90 \u0026\u0026 value \u003c= 90;\r\n  } else {\r\n    return value \u003e= -180 \u0026\u0026 value \u003c= 180;\r\n  }\r\n};\r\n\r\n/**\r\n * Bulletproof coordinate retrieval function\r\n * Strictly parses and validates coordinates with range checks\r\n * Returns null if no valid coordinates can be found - NEVER returns NaN\r\n * \r\n * @param page - The service area page object\r\n * @returns Valid coordinates object or null if none found\r\n */\r\nconst getCoordinates = (page: ServiceAreaPage): { lat: number; lng: number } | null =\u003e {\r\n  // First, try frontmatter params with strict parsing\r\n  if (page.lat !== undefined \u0026\u0026 page.lng !== undefined) {\r\n    let lat: number;\r\n    let lng: number;\r\n    \r\n    // Parse with strict type checking\r\n    if (typeof page.lat === 'number') {\r\n      lat = page.lat;\r\n    } else if (typeof page.lat === 'string') {\r\n      lat = parseFloat(page.lat);\r\n    } else {\r\n      lat = NaN;\r\n    }\r\n    \r\n    if (typeof page.lng === 'number') {\r\n      lng = page.lng;\r\n    } else if (typeof page.lng === 'string') {\r\n      lng = parseFloat(page.lng);\r\n    } else {\r\n      lng = NaN;\r\n    }\r\n    \r\n    // Validate parsed coordinates with range checks\r\n    if (isValidCoordinate(lat, true) \u0026\u0026 isValidCoordinate(lng, false)) {\r\n      return { lat, lng };\r\n    }\r\n  }\r\n\r\n  // Second, try city lookup\r\n  const cityName = page.title.replace(/Appliance Repair in |Appliance Repair |/gi, '').trim();\r\n  if (CITY_COORDINATES[cityName]) {\r\n    const coords = CITY_COORDINATES[cityName];\r\n    if (coords \u0026\u0026 isValidCoordinate(coords.lat, true) \u0026\u0026 isValidCoordinate(coords.lng, false)) {\r\n      return coords;\r\n    }\r\n  }\r\n\r\n  // Third, try group centroid\r\n  if (GROUP_CENTROIDS[page.group]) {\r\n    const coords = GROUP_CENTROIDS[page.group];\r\n    if (coords \u0026\u0026 isValidCoordinate(coords.lat, true) \u0026\u0026 isValidCoordinate(coords.lng, false)) {\r\n      return coords;\r\n    }\r\n  }\r\n\r\n  // Return null if no valid coordinates found (never return default fallback)\r\n  return null;\r\n};\r\n\r\n/**\r\n * Initialize the Leaflet map\r\n */\r\nlet leafletInitAttempted = false;\r\nlet leafletCheckInterval: ReturnType\u003ctypeof setInterval\u003e | null = null;\r\nconst MAX_WAIT_TIME = 5000; // Wait up to 5 seconds for Leaflet to load\r\nconst CHECK_INTERVAL = 100; // Check every 100ms\r\nlet startTime = 0;\r\n\r\nexport const initServiceAreasLeaflet = (): void =\u003e {\r\n  // First, check if the map container exists (partial may be disabled)\r\n  const mapContainer = document.getElementById('service-areas-leaflet-map');\r\n  if (!mapContainer) {\r\n    // Map container doesn't exist - partial is likely disabled, return silently\r\n    return;\r\n  }\r\n\r\n  // Check if Leaflet is loaded\r\n  if (typeof L === 'undefined') {\r\n    // Check if the Leaflet script tag exists in the DOM\r\n    const leafletScript = document.querySelector('script[src*=\"leaflet\"]');\r\n    \r\n    // If script tag exists, wait for it to load\r\n    if (leafletScript) {\r\n      if (!leafletInitAttempted) {\r\n        leafletInitAttempted = true;\r\n        startTime = Date.now();\r\n        \r\n        // Poll for Leaflet to load - this handles slow CDN connections\r\n        leafletCheckInterval = setInterval(() =\u003e {\r\n          if (typeof L !== 'undefined') {\r\n            // Leaflet loaded successfully\r\n            if (leafletCheckInterval) {\r\n              clearInterval(leafletCheckInterval);\r\n              leafletCheckInterval = null;\r\n            }\r\n            leafletInitAttempted = false;\r\n            initServiceAreasLeaflet();\r\n          } else if (Date.now() - startTime \u003e MAX_WAIT_TIME) {\r\n            // Max wait time exceeded - script may have failed to load\r\n            if (leafletCheckInterval) {\r\n              clearInterval(leafletCheckInterval);\r\n              leafletCheckInterval = null;\r\n            }\r\n            console.warn('Leaflet.js failed to load after 5 seconds. Service areas map will not be initialized. Check network tab for script loading errors.');\r\n            leafletInitAttempted = false;\r\n          }\r\n        }, CHECK_INTERVAL);\r\n      } else {\r\n        // Already attempting to load, wait for it\r\n        return;\r\n      }\r\n    } else {\r\n      // Script tag not found - might be loading asynchronously or not included\r\n      // Wait a bit to see if it appears, then warn if it doesn't\r\n      if (!leafletInitAttempted) {\r\n        leafletInitAttempted = true;\r\n        startTime = Date.now();\r\n        \r\n        // Check if script appears in DOM\r\n        const checkForScript = setInterval(() =\u003e {\r\n          const script = document.querySelector('script[src*=\"leaflet\"]');\r\n          if (script) {\r\n            clearInterval(checkForScript);\r\n            leafletInitAttempted = false;\r\n            // Script appeared, try initializing again\r\n            initServiceAreasLeaflet();\r\n          } else if (Date.now() - startTime \u003e 1000) {\r\n            // After 1 second, if still no script tag, warn and give up\r\n            clearInterval(checkForScript);\r\n            console.warn('Leaflet.js script tag not found in DOM. Service areas map will not be initialized.');\r\n            leafletInitAttempted = false;\r\n          }\r\n        }, 100);\r\n      }\r\n    }\r\n    return;\r\n  }\r\n  \r\n  // Leaflet is loaded - clean up any pending checks\r\n  if (leafletCheckInterval) {\r\n    clearInterval(leafletCheckInterval);\r\n    leafletCheckInterval = null;\r\n  }\r\n  leafletInitAttempted = false;\r\n\r\n  // Map container already checked at the start of the function\r\n\r\n  // Ensure container has proper dimensions before initializing map\r\n  // This is critical for mobile devices where layout might not be complete\r\n  const ensureContainerSize = (): Promise\u003cvoid\u003e =\u003e {\r\n    return new Promise((resolve) =\u003e {\r\n      const checkSize = (): void =\u003e {\r\n        const rect = mapContainer.getBoundingClientRect();\r\n        if (rect.width \u003e 0 \u0026\u0026 rect.height \u003e 0) {\r\n          resolve();\r\n        } else {\r\n          // Container not sized yet, wait a bit and check again\r\n          setTimeout(checkSize, 50);\r\n        }\r\n      };\r\n      checkSize();\r\n    });\r\n  };\r\n\r\n  // Wait for container to be properly sized before initializing\r\n  ensureContainerSize().then(() =\u003e {\r\n    // Use requestAnimationFrame to ensure DOM is fully ready\r\n    requestAnimationFrame(() =\u003e {\r\n      // Force a reflow to ensure dimensions are calculated\r\n      void mapContainer.offsetHeight;\r\n      \r\n      // Small additional delay to ensure CSS has fully applied\r\n      setTimeout(() =\u003e {\r\n        // Initialize map centered on Ontario, Canada\r\n        const map = L.map('service-areas-leaflet-map', {\r\n          zoomControl: true,\r\n          scrollWheelZoom: true,\r\n          doubleClickZoom: true,\r\n          boxZoom: true,\r\n          keyboard: true,\r\n          dragging: true,\r\n          touchZoom: true,\r\n        });\r\n\r\n        // CRITICAL: Invalidate size immediately after map creation\r\n        // This ensures Leaflet knows the correct container dimensions\r\n        map.invalidateSize();\r\n\r\n        // Set initial view\r\n        map.setView([44.0, -79.0], 7);\r\n\r\n        // Continue with map initialization...\r\n        initializeMapContent(map);\r\n      }, 150);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Initialize map content after map instance is created\r\n */\r\nconst initializeMapContent = (map: any): void =\u003e {\r\n\r\n  // Store polygons and layers for cleanup\r\n  let currentLayers: any[] = [];\r\n  let activeGroup: string | null = null;\r\n  let currentTileLayer: any = null;\r\n\r\n  /**\r\n   * Map style configurations\r\n   */\r\n  const mapStyles: Record\u003cMapStyle, MapStyleConfig\u003e = {\r\n    'default': {\r\n      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n      attribution: '© \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors',\r\n      maxZoom: 19,\r\n    },\r\n    'carto-positron': {\r\n      url: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',\r\n      attribution: '© \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors © \u003ca href=\"https://carto.com/attributions\"\u003eCARTO\u003c/a\u003e',\r\n      maxZoom: 19,\r\n    },\r\n    'carto-dark': {\r\n      url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',\r\n      attribution: '© \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors © \u003ca href=\"https://carto.com/attributions\"\u003eCARTO\u003c/a\u003e',\r\n      maxZoom: 19,\r\n    },\r\n    'carto-voyager': {\r\n      url: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',\r\n      attribution: '© \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors © \u003ca href=\"https://carto.com/attributions\"\u003eCARTO\u003c/a\u003e',\r\n      maxZoom: 19,\r\n    },\r\n    'stamen-toner': {\r\n      url: 'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.png',\r\n      attribution: 'Map tiles by \u003ca href=\"http://stamen.com\"\u003eStamen Design\u003c/a\u003e, \u003ca href=\"http://creativecommons.org/licenses/by/3.0\"\u003eCC BY 3.0\u003c/a\u003e \u0026mdash; Map data \u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors',\r\n      maxZoom: 20,\r\n    },\r\n    'stamen-terrain': {\r\n      url: 'https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.png',\r\n      attribution: 'Map tiles by \u003ca href=\"http://stamen.com\"\u003eStamen Design\u003c/a\u003e, \u003ca href=\"http://creativecommons.org/licenses/by/3.0\"\u003eCC BY 3.0\u003c/a\u003e \u0026mdash; Map data \u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors',\r\n      maxZoom: 18,\r\n    },\r\n    'osm-fr': {\r\n      url: 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',\r\n      attribution: '© \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors, Tiles style by \u003ca href=\"https://www.hot.openstreetmap.org/\" target=\"_blank\"\u003eHumanitarian OpenStreetMap Team\u003c/a\u003e',\r\n      maxZoom: 19,\r\n    },\r\n  };\r\n\r\n  /**\r\n   * Set map style\r\n   * @param style - The map style to apply\r\n   */\r\n  const setMapStyle = (style: MapStyle = 'carto-positron'): void =\u003e {\r\n    if (currentTileLayer) {\r\n      map.removeLayer(currentTileLayer);\r\n    }\r\n\r\n    const styleConfig = mapStyles[style];\r\n    currentTileLayer = L.tileLayer(styleConfig.url, {\r\n      attribution: styleConfig.attribution,\r\n      maxZoom: styleConfig.maxZoom || 19,\r\n      subdomains: 'abc',\r\n    }).addTo(map);\r\n    \r\n    // CRITICAL: Invalidate size immediately after adding tile layer\r\n    // This fixes tile spacing issues, especially on mobile\r\n    map.invalidateSize();\r\n    \r\n    // Additional invalidation after a short delay to ensure proper rendering\r\n    setTimeout(() =\u003e {\r\n      map.invalidateSize();\r\n    }, 50);\r\n  };\r\n\r\n  // Initialize with default style\r\n  setMapStyle('default');\r\n  \r\n  // Force another size invalidation after tile layer is fully loaded\r\n  if (currentTileLayer) {\r\n    currentTileLayer.on('load', () =\u003e {\r\n      map.invalidateSize();\r\n      // Additional invalidation after tiles load\r\n      setTimeout(() =\u003e {\r\n        map.invalidateSize();\r\n      }, 100);\r\n    });\r\n    \r\n    // Also invalidate if tiles fail to load (edge case)\r\n    currentTileLayer.on('tileerror', () =\u003e {\r\n      map.invalidateSize();\r\n    });\r\n  }\r\n  \r\n  // One more invalidation after a short delay to catch any remaining issues\r\n  setTimeout(() =\u003e {\r\n    map.invalidateSize();\r\n  }, 200);\r\n\r\n  // Collect all service area pages from hidden group data elements\r\n  const groupDataElements = document.querySelectorAll\u003cHTMLElement\u003e('.service-areas-group-data');\r\n  const pages: ServiceAreaPage[] = [];\r\n\r\n  groupDataElements.forEach((groupData) =\u003e {\r\n    const groupContainer = groupData.closest('.service-areas-sidebar-group');\r\n    const groupName = groupContainer?.getAttribute('data-group') || '';\r\n    const pageElements = groupData.querySelectorAll\u003cHTMLElement\u003e('span[data-page-title]');\r\n\r\n    pageElements.forEach((pageEl) =\u003e {\r\n      const title = pageEl.getAttribute('data-page-title') || '';\r\n      const url = pageEl.getAttribute('data-page-url') || '';\r\n      const latStr = pageEl.getAttribute('data-lat');\r\n      const lngStr = pageEl.getAttribute('data-lng');\r\n\r\n      // Parse coordinates with strict validation\r\n      let lat: number | undefined;\r\n      let lng: number | undefined;\r\n      \r\n      if (latStr \u0026\u0026 latStr.trim() !== '') {\r\n        const parsedLat = parseFloat(latStr);\r\n        lat = isValidCoordinate(parsedLat, true) ? parsedLat : undefined;\r\n      }\r\n      \r\n      if (lngStr \u0026\u0026 lngStr.trim() !== '') {\r\n        const parsedLng = parseFloat(lngStr);\r\n        lng = isValidCoordinate(parsedLng, false) ? parsedLng : undefined;\r\n      }\r\n\r\n      pages.push({\r\n        title,\r\n        url,\r\n        group: groupName,\r\n        lat,\r\n        lng,\r\n      });\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Clear all polygons/layers from the map\r\n   */\r\n  const clearLayers = (): void =\u003e {\r\n    currentLayers.forEach((layer) =\u003e {\r\n      map.removeLayer(layer);\r\n    });\r\n    currentLayers = [];\r\n  };\r\n\r\n  /**\r\n   * Create a city boundary polygon (circular approximation)\r\n   * @param coords - Valid coordinate object\r\n   * @param cityName - Name of the city for size lookup\r\n   * @returns Leaflet polygon object\r\n   */\r\n  const createCityPolygon = (coords: { lat: number; lng: number }, cityName: string): any =\u003e {\r\n    // Approximate city radius based on city size (in degrees)\r\n    const citySizes: Record\u003cstring, number\u003e = {\r\n      'Miami': 0.12,\r\n      'Fort Lauderdale': 0.10,\r\n      'West Palm Beach': 0.08,\r\n      'Boca Raton': 0.07,\r\n      'Coral Gables': 0.06,\r\n      'Hialeah': 0.06,\r\n      'Hollywood': 0.06,\r\n      'Aventura': 0.05,\r\n      'Miami Beach': 0.05,\r\n      'Doral': 0.05,\r\n      'Kendall': 0.05,\r\n      'Homestead': 0.05,\r\n      'Key Biscayne': 0.04,\r\n      'Pompano Beach': 0.05,\r\n      'Deerfield Beach': 0.05,\r\n      'Delray Beach': 0.05,\r\n      'Jupiter': 0.05,\r\n      'Palm Beach Gardens': 0.05,\r\n      'Sunrise': 0.05,\r\n      'North Miami': 0.05,\r\n      'Burlington': 0.06,\r\n      'Oshawa': 0.06,\r\n      'St. Catharines': 0.06,\r\n      'Cambridge': 0.05,\r\n      'Guelph': 0.05,\r\n      'Barrie': 0.05,\r\n      'Kingston': 0.05,\r\n      'Peterborough': 0.05,\r\n    };\r\n\r\n    const radius = citySizes[cityName] || 0.04;\r\n\r\n    // Create a circular polygon\r\n    const points: [number, number][] = [];\r\n    const numPoints = 64;\r\n\r\n    for (let i = 0; i \u003c numPoints; i++) {\r\n      const angle = (i / numPoints) * 2 * Math.PI;\r\n      const latOffset = radius * Math.cos(angle);\r\n      const lngOffset = radius * Math.sin(angle) / Math.cos(coords.lat * Math.PI / 180);\r\n      points.push([coords.lat + latOffset, coords.lng + lngOffset]);\r\n    }\r\n\r\n    return L.polygon(points, {\r\n      color: '#D91A24',\r\n      fillColor: '#D91A24',\r\n      fillOpacity: 0.2,\r\n      weight: 2,\r\n      opacity: 0.8,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Shared logic for creating polygons and collecting valid coordinates\r\n   * @param pagesToProcess - Array of pages to process\r\n   * @returns Array of valid coordinates [lat, lng] tuples\r\n   */\r\n  const createPolygonsAndCollectCoords = (pagesToProcess: ServiceAreaPage[]): [number, number][] =\u003e {\r\n    const validCoords: [number, number][] = [];\r\n\r\n    pagesToProcess.forEach((page) =\u003e {\r\n      const coords = getCoordinates(page);\r\n      \r\n      if (!coords) {\r\n        console.warn(`[Service Areas Map] No valid coordinates found for \"${page.title}\". Please add lat/lng to frontmatter.`);\r\n        return;\r\n      }\r\n\r\n      // Double-check coordinates are valid (should never fail due to getCoordinates, but be extra safe)\r\n      if (!isValidCoordinate(coords.lat, true) || !isValidCoordinate(coords.lng, false)) {\r\n        console.warn(`[Service Areas Map] Invalid coordinates for \"${page.title}\":`, coords);\r\n        return;\r\n      }\r\n\r\n      // Create city boundary polygon\r\n      const polygon = createCityPolygon(coords, page.title);\r\n      \r\n      // Add popup to polygon\r\n      polygon.bindPopup(`\r\n        \u003cdiv class=\"service-areas-popup\"\u003e\r\n          \u003ch6 class=\"service-areas-popup-title\"\u003e${page.title}\u003c/h6\u003e\r\n          \u003ca href=\"${page.url}\" class=\"btn btn--sm btn--primary\"\u003eView Details\u003c/a\u003e\r\n        \u003c/div\u003e\r\n      `);\r\n\r\n      // Add hover effects\r\n      polygon.on('mouseover', function(this: any) {\r\n        this.setStyle({\r\n          fillOpacity: 0.3,\r\n          weight: 3,\r\n        });\r\n      });\r\n\r\n      polygon.on('mouseout', function(this: any) {\r\n        this.setStyle({\r\n          fillOpacity: 0.2,\r\n          weight: 2,\r\n        });\r\n      });\r\n\r\n      polygon.addTo(map);\r\n      currentLayers.push(polygon);\r\n\r\n      // Add to valid coordinates array\r\n      validCoords.push([coords.lat, coords.lng]);\r\n    });\r\n\r\n    return validCoords;\r\n  };\r\n\r\n  /**\r\n   * Fit map bounds with proper sidebar padding using Leaflet's native paddingTopLeft\r\n   * @param validCoords - Array of valid coordinate tuples\r\n   */\r\n  const fitMapToBounds = (validCoords: [number, number][]): void =\u003e {\r\n    if (validCoords.length === 0) {\r\n      // Graceful fallback to Ontario center\r\n      map.setView([44.0, -79.0], 7);\r\n      return;\r\n    }\r\n\r\n    if (validCoords.length === 1) {\r\n      // Single location - center on it\r\n      map.setView(validCoords[0], 11);\r\n      return;\r\n    }\r\n\r\n    // Multiple locations - fit bounds with sidebar padding\r\n    const boundsObj = L.latLngBounds(validCoords);\r\n    const sidebarPadding = window.innerWidth \u003e 768 ? 340 : 50; // 300px sidebar + 20px margins + 20px padding\r\n    \r\n    map.fitBounds(boundsObj, {\r\n      paddingTopLeft: [sidebarPadding, 50],\r\n      paddingBottomRight: [50, 50],\r\n      maxZoom: 13,\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Add city boundary polygons for a specific group\r\n   * @param groupName - Name of the group to display\r\n   */\r\n  const showGroupMarkers = (groupName: string): void =\u003e {\r\n    clearLayers();\r\n    activeGroup = groupName;\r\n\r\n    const groupPages = pages.filter((page) =\u003e page.group === groupName);\r\n\r\n    if (groupPages.length === 0) {\r\n      return;\r\n    }\r\n\r\n    // Create polygons and collect valid coordinates\r\n    const validCoords = createPolygonsAndCollectCoords(groupPages);\r\n\r\n    // Fit map to bounds\r\n    fitMapToBounds(validCoords);\r\n\r\n    // Update active state in sidebar\r\n    const groupTitles = document.querySelectorAll\u003cHTMLButtonElement\u003e('.service-areas-sidebar-group-title');\r\n    groupTitles.forEach((title) =\u003e {\r\n      const itemGroup = title.getAttribute('data-group') || '';\r\n      if (itemGroup === groupName) {\r\n        title.classList.add('is-active');\r\n      } else {\r\n        title.classList.remove('is-active');\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Show all city boundary polygons\r\n   */\r\n  const showAllMarkers = (): void =\u003e {\r\n    clearLayers();\r\n    activeGroup = null;\r\n\r\n    // Create polygons and collect valid coordinates\r\n    const validCoords = createPolygonsAndCollectCoords(pages);\r\n\r\n    // Fit map to bounds\r\n    fitMapToBounds(validCoords);\r\n\r\n    // Remove active state from all group titles\r\n    const groupTitles = document.querySelectorAll\u003cHTMLButtonElement\u003e('.service-areas-sidebar-group-title');\r\n    groupTitles.forEach((title) =\u003e {\r\n      title.classList.remove('is-active');\r\n    });\r\n  };\r\n\r\n  // Handle group title clicks\r\n  const groupTitles = document.querySelectorAll\u003cHTMLButtonElement\u003e('.service-areas-sidebar-group-title');\r\n  groupTitles.forEach((title) =\u003e {\r\n    title.addEventListener('click', () =\u003e {\r\n      const groupName = title.getAttribute('data-group') || '';\r\n      if (groupName) {\r\n        showGroupMarkers(groupName);\r\n      }\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Initialize sidebar toggle functionality for mobile\r\n   */\r\n  const initSidebarToggle = (): void =\u003e {\r\n    const sidebar = document.getElementById('service-areas-sidebar');\r\n    const toggle = document.querySelector\u003cHTMLButtonElement\u003e('.service-areas-sidebar-toggle');\r\n    const sidebarContent = document.getElementById('service-areas-sidebar-content');\r\n    \r\n    if (!sidebar || !toggle || !sidebarContent) {\r\n      return;\r\n    }\r\n\r\n    // Check if we're on mobile/tablet\r\n    const isMobile = (): boolean =\u003e {\r\n      return window.matchMedia('(max-width: 768px)').matches;\r\n    };\r\n\r\n    // Set initial state based on screen size\r\n    const updateSidebarState = (): void =\u003e {\r\n      if (isMobile()) {\r\n        // On mobile, start collapsed\r\n        const isExpanded = sidebar.getAttribute('data-expanded') === 'true';\r\n        if (!isExpanded) {\r\n          sidebarContent.style.display = 'none';\r\n        }\r\n      } else {\r\n        // On desktop, always show\r\n        sidebarContent.style.display = 'block';\r\n        sidebar.removeAttribute('data-expanded');\r\n      }\r\n    };\r\n\r\n    // Handle toggle click\r\n    toggle.addEventListener('click', () =\u003e {\r\n      const isExpanded = sidebar.getAttribute('data-expanded') === 'true';\r\n      \r\n      if (isExpanded) {\r\n        sidebar.setAttribute('data-expanded', 'false');\r\n        toggle.setAttribute('aria-expanded', 'false');\r\n        sidebarContent.style.display = 'none';\r\n      } else {\r\n        sidebar.setAttribute('data-expanded', 'true');\r\n        toggle.setAttribute('aria-expanded', 'true');\r\n        sidebarContent.style.display = 'block';\r\n      }\r\n      \r\n      // Invalidate map size after sidebar toggle to fix tile rendering\r\n      setTimeout(() =\u003e {\r\n        map.invalidateSize();\r\n      }, 150);\r\n    });\r\n\r\n    // Initialize state\r\n    updateSidebarState();\r\n  };\r\n\r\n  // Initialize sidebar toggle\r\n  initSidebarToggle();\r\n\r\n  // Initialize: show all markers on load\r\n  // Use requestAnimationFrame to ensure DOM is fully ready\r\n  const initMap = (): void =\u003e {\r\n    requestAnimationFrame(() =\u003e {\r\n      if (pages.length \u003e 0) {\r\n        showAllMarkers();\r\n      }\r\n      // Invalidate size after initial render to fix mobile tile issues\r\n      map.invalidateSize();\r\n      \r\n      // Additional invalidations to ensure proper rendering on all devices\r\n      setTimeout(() =\u003e {\r\n        map.invalidateSize();\r\n      }, 100);\r\n      setTimeout(() =\u003e {\r\n        map.invalidateSize();\r\n      }, 300);\r\n      setTimeout(() =\u003e {\r\n        map.invalidateSize();\r\n      }, 500);\r\n    });\r\n  };\r\n\r\n  // Initialize markers after a short delay to ensure everything is ready\r\n  setTimeout(initMap, 200);\r\n\r\n  // Handle window resize to invalidate map size and update sidebar state\r\n  let resizeTimeout: ReturnType\u003ctypeof setTimeout\u003e;\r\n  window.addEventListener('resize', () =\u003e {\r\n    clearTimeout(resizeTimeout);\r\n    resizeTimeout = setTimeout(() =\u003e {\r\n      map.invalidateSize();\r\n      // Update sidebar state on resize\r\n      const sidebar = document.getElementById('service-areas-sidebar');\r\n      const sidebarContent = document.getElementById('service-areas-sidebar-content');\r\n      if (sidebar \u0026\u0026 sidebarContent) {\r\n        const isMobile = window.matchMedia('(max-width: 768px)').matches;\r\n        if (!isMobile) {\r\n          sidebarContent.style.display = 'block';\r\n          sidebar.removeAttribute('data-expanded');\r\n        }\r\n      }\r\n    }, 250);\r\n  });\r\n};\r\n","import { logger } from \"../utils/logger\";\r\n\r\ntype Nullable\u003cT\u003e = T | null;\r\n\r\ninterface ReviewsFormConfig {\r\n  redirectLowTo: string;\r\n  threshold: number;\r\n  googleReviewUrl: string | null;\r\n  endpointUrl: string | null;\r\n}\r\n\r\ninterface ReviewsFormElements {\r\n  root: HTMLElement;\r\n  form: HTMLFormElement;\r\n  liveRegion: Nullable\u003cHTMLElement\u003e;\r\n  statusError: Nullable\u003cHTMLElement\u003e;\r\n  statusSuccess: Nullable\u003cHTMLElement\u003e;\r\n  honeypot: Nullable\u003cHTMLInputElement\u003e;\r\n  continueButton: Nullable\u003cHTMLButtonElement\u003e;\r\n  submitButton: Nullable\u003cHTMLButtonElement\u003e;\r\n  stageTwo: Nullable\u003cHTMLElement\u003e;\r\n  ratingInput: Nullable\u003cHTMLInputElement\u003e;\r\n  ratingValue: Nullable\u003cHTMLElement\u003e;\r\n  ratingLabel: Nullable\u003cHTMLElement\u003e;\r\n  nameInput: Nullable\u003cHTMLInputElement\u003e;\r\n  emailInput: Nullable\u003cHTMLInputElement\u003e;\r\n  phoneInput: Nullable\u003cHTMLInputElement\u003e;\r\n  applianceSelect: Nullable\u003cHTMLSelectElement\u003e;\r\n  messageInput: Nullable\u003cHTMLTextAreaElement\u003e;\r\n  consentCheckbox: Nullable\u003cHTMLInputElement\u003e;\r\n}\r\n\r\nconst STORAGE_KEY = \"ars_reviews_stage1\";\r\nconst STORAGE_TTL_MS = 15 * 60 * 1000; // 15 minutes\r\n\r\nconst RATING_LABELS: Record\u003cnumber, string\u003e = {\r\n  1: \"Not great\",\r\n  2: \"Could be better\",\r\n  3: \"Okay\",\r\n  4: \"Great\",\r\n  5: \"Amazing\",\r\n};\r\n\r\nfunction getDatasetNumber(value: string | null | undefined, fallback: number): number {\r\n  if (!value) return fallback;\r\n  const parsed = parseInt(value, 10);\r\n  if (Number.isNaN(parsed)) return fallback;\r\n  return parsed;\r\n}\r\n\r\nfunction getConfig(root: HTMLElement): ReviewsFormConfig {\r\n  const redirectLowTo = root.getAttribute(\"data-redirect-low-to\") || \"/give-feedback/\";\r\n  const thresholdAttr = root.getAttribute(\"data-threshold\");\r\n  const threshold = getDatasetNumber(thresholdAttr, 2);\r\n\r\n  const googleReviewUrl = root.getAttribute(\"data-google-review-url\");\r\n  const endpointUrl = root.getAttribute(\"data-endpoint-url\");\r\n\r\n  return {\r\n    redirectLowTo,\r\n    threshold,\r\n    googleReviewUrl: googleReviewUrl \u0026\u0026 googleReviewUrl.trim() !== \"\" ? googleReviewUrl : null,\r\n    endpointUrl: endpointUrl \u0026\u0026 endpointUrl.trim() !== \"\" ? endpointUrl : null,\r\n  };\r\n}\r\n\r\nfunction getElements(root: HTMLElement): ReviewsFormElements | null {\r\n  const form = root.querySelector(\"form\") as HTMLFormElement | null;\r\n  if (!form) return null;\r\n\r\n  const ratingInput = form.querySelector\u003cHTMLInputElement\u003e(\"#reviews-rating\");\r\n  const ratingValue = form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-rating-value]\");\r\n  const ratingLabel = form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-rating-label]\");\r\n\r\n  return {\r\n    root,\r\n    form,\r\n    liveRegion: form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-live-region]\"),\r\n    statusError: form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-status-error]\"),\r\n    statusSuccess: form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-status-success]\"),\r\n    honeypot: form.querySelector\u003cHTMLInputElement\u003e(\"[data-reviews-honeypot]\"),\r\n    continueButton: form.querySelector\u003cHTMLButtonElement\u003e(\"[data-reviews-continue]\"),\r\n    submitButton: form.querySelector\u003cHTMLButtonElement\u003e(\"[data-reviews-submit]\"),\r\n    stageTwo: form.querySelector\u003cHTMLElement\u003e(\"[data-reviews-stage-two]\"),\r\n    ratingInput,\r\n    ratingValue,\r\n    ratingLabel,\r\n    nameInput: form.querySelector\u003cHTMLInputElement\u003e(\"#reviews-name\"),\r\n    emailInput: form.querySelector\u003cHTMLInputElement\u003e(\"#reviews-email\"),\r\n    phoneInput: form.querySelector\u003cHTMLInputElement\u003e(\"#reviews-phone\"),\r\n    applianceSelect: form.querySelector\u003cHTMLSelectElement\u003e(\"#reviews-appliance\"),\r\n    messageInput: form.querySelector\u003cHTMLTextAreaElement\u003e(\"#reviews-message\"),\r\n    consentCheckbox: form.querySelector\u003cHTMLInputElement\u003e(\"#reviews-consent\"),\r\n  };\r\n}\r\n\r\nfunction setFieldError(\r\n  els: ReviewsFormElements,\r\n  fieldKey: \"rating\" | \"name\" | \"email\" | \"phone\",\r\n  message: string | null\r\n): void {\r\n  const errorSpan = els.form.querySelector\u003cHTMLElement\u003e(`[data-reviews-error=\"${fieldKey}\"]`);\r\n  let field: Nullable\u003cHTMLElement\u003e = null;\r\n\r\n  switch (fieldKey) {\r\n    case \"rating\":\r\n      field = els.ratingInput;\r\n      break;\r\n    case \"name\":\r\n      field = els.nameInput;\r\n      break;\r\n    case \"email\":\r\n      field = els.emailInput;\r\n      break;\r\n    case \"phone\":\r\n      field = els.phoneInput;\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  if (errorSpan) {\r\n    errorSpan.textContent = message || \"\";\r\n    (errorSpan as HTMLElement).style.display = message ? \"block\" : \"none\";\r\n  }\r\n\r\n  if (field) {\r\n    if (message) {\r\n      field.setAttribute(\"aria-invalid\", \"true\");\r\n      field.classList.add(\"contact-form__input--error\");\r\n    } else {\r\n      field.removeAttribute(\"aria-invalid\");\r\n      field.classList.remove(\"contact-form__input--error\");\r\n    }\r\n  }\r\n}\r\n\r\nfunction clearAllErrors(els: ReviewsFormElements): void {\r\n  setFieldError(els, \"rating\", null);\r\n  setFieldError(els, \"name\", null);\r\n  setFieldError(els, \"email\", null);\r\n  setFieldError(els, \"phone\", null);\r\n\r\n  if (els.statusError) {\r\n    els.statusError.textContent = \"\";\r\n    els.statusError.classList.add(\"contact-form__status--hidden\");\r\n  }\r\n}\r\n\r\nfunction showStatus(\r\n  els: ReviewsFormElements,\r\n  type: \"error\" | \"success\",\r\n  message: string\r\n): void {\r\n  const target = type === \"error\" ? els.statusError : els.statusSuccess;\r\n  const other = type === \"error\" ? els.statusSuccess : els.statusError;\r\n\r\n  if (other) {\r\n    other.textContent = \"\";\r\n    other.classList.add(\"contact-form__status--hidden\");\r\n  }\r\n\r\n  if (target) {\r\n    target.textContent = message;\r\n    target.classList.remove(\"contact-form__status--hidden\");\r\n  }\r\n\r\n  if (els.liveRegion) {\r\n    els.liveRegion.textContent = message;\r\n  }\r\n}\r\n\r\nfunction validateStageOne(els: ReviewsFormElements): boolean {\r\n  let isValid = true;\r\n\r\n  const ratingRaw = els.ratingInput?.value;\r\n  const rating = ratingRaw ? parseInt(ratingRaw, 10) : NaN;\r\n  if (!ratingRaw || Number.isNaN(rating)) {\r\n    setFieldError(els, \"rating\", \"Please select how satisfied you are.\");\r\n    isValid = false;\r\n  } else {\r\n    setFieldError(els, \"rating\", null);\r\n  }\r\n\r\n  const nameVal = els.nameInput?.value?.trim() || \"\";\r\n  if (!nameVal) {\r\n    setFieldError(els, \"name\", \"Please enter your name.\");\r\n    isValid = false;\r\n  } else if (nameVal.length \u003c 2) {\r\n    setFieldError(els, \"name\", \"Name should be at least 2 characters.\");\r\n    isValid = false;\r\n  } else {\r\n    setFieldError(els, \"name\", null);\r\n  }\r\n\r\n  const emailVal = els.emailInput?.value?.trim() || \"\";\r\n  if (!emailVal) {\r\n    setFieldError(els, \"email\", \"Please enter your email.\");\r\n    isValid = false;\r\n  } else {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(emailVal)) {\r\n      setFieldError(els, \"email\", \"Please enter a valid email address.\");\r\n      isValid = false;\r\n    } else {\r\n      setFieldError(els, \"email\", null);\r\n    }\r\n  }\r\n\r\n  const phoneVal = els.phoneInput?.value?.trim() || \"\";\r\n  if (phoneVal) {\r\n    const digitsOnly = phoneVal.replace(/\\D/g, \"\");\r\n    if (digitsOnly.length \u003e 0 \u0026\u0026 digitsOnly.length \u003c 10) {\r\n      setFieldError(els, \"phone\", \"Please enter a valid phone number.\");\r\n      isValid = false;\r\n    } else {\r\n      setFieldError(els, \"phone\", null);\r\n    }\r\n  } else {\r\n    setFieldError(els, \"phone\", null);\r\n  }\r\n\r\n  if (!isValid) {\r\n    showStatus(\r\n      els,\r\n      \"error\",\r\n      \"Please fix the highlighted fields before continuing.\"\r\n    );\r\n    const firstErrorField = els.form.querySelector\u003cHTMLElement\u003e(\r\n      '[aria-invalid=\"true\"]'\r\n    );\r\n    if (firstErrorField \u0026\u0026 typeof firstErrorField.focus === \"function\") {\r\n      firstErrorField.focus();\r\n    }\r\n  }\r\n\r\n  return isValid;\r\n}\r\n\r\nfunction saveStageOneToSession(\r\n  rating: number,\r\n  name: string,\r\n  email: string,\r\n  phone: string\r\n): void {\r\n  try {\r\n    const now = Date.now();\r\n    const payload = {\r\n      mode: \"review_stage1\",\r\n      rating,\r\n      name,\r\n      email,\r\n      phone,\r\n      pageUrl: window.location.href,\r\n      createdAt: now,\r\n      expiresAt: now + STORAGE_TTL_MS,\r\n    };\r\n\r\n    sessionStorage.setItem(STORAGE_KEY, JSON.stringify(payload));\r\n  } catch (error) {\r\n    logger.warn(\"Unable to persist review stage1 data to sessionStorage:\", error);\r\n  }\r\n}\r\n\r\nfunction showStageTwo(els: ReviewsFormElements): void {\r\n  if (!els.stageTwo) return;\r\n\r\n  els.stageTwo.style.display = \"\";\r\n  els.stageTwo.setAttribute(\"aria-hidden\", \"false\");\r\n\r\n  if (els.continueButton) {\r\n    els.continueButton.disabled = true;\r\n  }\r\n\r\n  const firstInput =\r\n    els.applianceSelect || els.messageInput || els.consentCheckbox || null;\r\n  if (firstInput \u0026\u0026 typeof firstInput.focus === \"function\") {\r\n    firstInput.focus();\r\n  }\r\n}\r\n\r\nfunction setSubmitLoading(els: ReviewsFormElements, isLoading: boolean): void {\r\n  const btn = els.submitButton;\r\n  if (!btn) return;\r\n\r\n  const textSpan = btn.querySelector\u003cHTMLElement\u003e(\".btn__text\");\r\n\r\n  if (isLoading) {\r\n    btn.classList.add(\"contact-form__submit--loading\");\r\n    btn.disabled = true;\r\n    if (textSpan) textSpan.textContent = \"Sending...\";\r\n  } else {\r\n    btn.classList.remove(\"contact-form__submit--loading\");\r\n    btn.disabled = false;\r\n    if (textSpan) textSpan.textContent = \"Submit review\";\r\n  }\r\n}\r\n\r\nfunction buildPayload(\r\n  els: ReviewsFormElements,\r\n  config: ReviewsFormConfig\r\n): Record\u003cstring, unknown\u003e {\r\n  const rating = els.ratingInput?.value ? parseInt(els.ratingInput.value, 10) : null;\r\n  const name = els.nameInput?.value?.trim() || \"\";\r\n  const email = els.emailInput?.value?.trim() || \"\";\r\n  const phone = els.phoneInput?.value?.trim() || \"\";\r\n  const appliance = els.applianceSelect?.value?.trim() || \"\";\r\n  const message = els.messageInput?.value?.trim() || \"\";\r\n  const consent = !!els.consentCheckbox?.checked;\r\n\r\n  const url = new URL(window.location.href);\r\n  const params = url.searchParams;\r\n  const utm: Record\u003cstring, string\u003e = {};\r\n  [\"utm_source\", \"utm_medium\", \"utm_campaign\", \"utm_term\", \"utm_content\"].forEach(\r\n    (key) =\u003e {\r\n      const value = params.get(key);\r\n      if (value) utm[key] = value;\r\n    }\r\n  );\r\n\r\n  return {\r\n    mode: \"review_submit\",\r\n    timestamp: new Date().toISOString(),\r\n    rating,\r\n    name,\r\n    email,\r\n    phone,\r\n    appliance: appliance || null,\r\n    message: message || null,\r\n    consent,\r\n    pageUrl: window.location.href,\r\n    referrer: document.referrer || null,\r\n    utm,\r\n    config: {\r\n      threshold: config.threshold,\r\n      redirectLowTo: config.redirectLowTo,\r\n    },\r\n  };\r\n}\r\n\r\nasync function handleSubmit(\r\n  els: ReviewsFormElements,\r\n  config: ReviewsFormConfig\r\n): Promise\u003cvoid\u003e {\r\n  if (!config.endpointUrl) {\r\n    showStatus(\r\n      els,\r\n      \"error\",\r\n      \"Review endpoint is not configured yet. Please try again later or use the Google review link.\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (els.honeypot \u0026\u0026 els.honeypot.value.trim() !== \"\") {\r\n    logger.warn(\"Blocking review submission due to honeypot being filled.\");\r\n    return;\r\n  }\r\n\r\n  const isValid = validateStageOne(els);\r\n  if (!isValid) return;\r\n\r\n  const payload = buildPayload(els, config);\r\n\r\n  try {\r\n    setSubmitLoading(els, true);\r\n    showStatus(els, \"success\", \"Sending your review...\");\r\n\r\n    const response = await fetch(config.endpointUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(payload),\r\n      credentials: \"same-origin\",\r\n    });\r\n\r\n    if (!response.ok) {\r\n      logger.error(\"Review submission failed with status:\", response.status);\r\n      showStatus(\r\n        els,\r\n        \"error\",\r\n        \"We couldn't send your review right now. Please try again in a moment.\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    showStatus(\r\n      els,\r\n      \"success\",\r\n      \"Thank you for sharing your experience! Your review has been submitted.\"\r\n    );\r\n  } catch (error) {\r\n    logger.error(\"Review submission error:\", error);\r\n    showStatus(\r\n      els,\r\n      \"error\",\r\n      \"Something went wrong while sending your review. Please try again shortly.\"\r\n    );\r\n  } finally {\r\n    setSubmitLoading(els, false);\r\n  }\r\n}\r\n\r\nfunction initSlider(els: ReviewsFormElements): void {\r\n  if (!els.ratingInput) return;\r\n\r\n  const update = (): void =\u003e {\r\n    const raw = els.ratingInput?.value;\r\n    const rating = raw ? parseInt(raw, 10) : 5;\r\n    const clamped = Math.min(5, Math.max(1, rating));\r\n\r\n    if (els.ratingValue) {\r\n      els.ratingValue.textContent = String(clamped);\r\n    }\r\n\r\n    if (els.ratingLabel) {\r\n      els.ratingLabel.textContent = RATING_LABELS[clamped] || \"\";\r\n    }\r\n\r\n    els.ratingInput?.setAttribute(\"aria-valuenow\", String(clamped));\r\n\r\n    const container = els.root.querySelector\u003cHTMLElement\u003e(\".reviews-form__rating\");\r\n    if (container) {\r\n      container.classList.remove(\"reviews-form__rating--low\", \"reviews-form__rating--mid\", \"reviews-form__rating--high\");\r\n      if (clamped \u003c= 2) {\r\n        container.classList.add(\"reviews-form__rating--low\");\r\n      } else if (clamped === 3) {\r\n        container.classList.add(\"reviews-form__rating--mid\");\r\n      } else {\r\n        container.classList.add(\"reviews-form__rating--high\");\r\n      }\r\n    }\r\n\r\n    const faces = els.root.querySelectorAll\u003cHTMLElement\u003e(\".reviews-form__face\");\r\n    faces.forEach((face) =\u003e {\r\n      const valueAttr = face.getAttribute(\"data-value\");\r\n      const faceValue = valueAttr ? parseInt(valueAttr, 10) : null;\r\n      if (faceValue === clamped) {\r\n        face.classList.add(\"is-active\");\r\n      } else {\r\n        face.classList.remove(\"is-active\");\r\n      }\r\n    });\r\n  };\r\n\r\n  els.ratingInput.addEventListener(\"input\", update);\r\n  els.ratingInput.addEventListener(\"change\", update);\r\n\r\n  // Make faces interactive: clicking (or pressing Enter/Space) sets the slider value\r\n  const faces = els.root.querySelectorAll\u003cHTMLElement\u003e(\".reviews-form__face\");\r\n  faces.forEach((face) =\u003e {\r\n    const valueAttr = face.getAttribute(\"data-value\");\r\n    const faceValue = valueAttr ? parseInt(valueAttr, 10) : null;\r\n    if (!faceValue || !els.ratingInput) return;\r\n\r\n    face.setAttribute(\"role\", \"button\");\r\n    face.setAttribute(\"tabindex\", \"0\");\r\n\r\n    const setFromFace = (): void =\u003e {\r\n      if (!els.ratingInput) return;\r\n      els.ratingInput.value = String(faceValue);\r\n      els.ratingInput.dispatchEvent(new Event(\"input\", { bubbles: true }));\r\n      els.ratingInput.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n      els.ratingInput.focus();\r\n    };\r\n\r\n    face.addEventListener(\"click\", setFromFace);\r\n    face.addEventListener(\"keydown\", (event: KeyboardEvent) =\u003e {\r\n      if (event.key === \"Enter\" || event.key === \" \") {\r\n        event.preventDefault();\r\n        setFromFace();\r\n      }\r\n    });\r\n  });\r\n\r\n  update();\r\n}\r\n\r\nfunction attachEvents(els: ReviewsFormElements, config: ReviewsFormConfig): void {\r\n  initSlider(els);\r\n\r\n  if (els.continueButton) {\r\n    els.continueButton.addEventListener(\"click\", () =\u003e {\r\n      clearAllErrors(els);\r\n\r\n      const ok = validateStageOne(els);\r\n      if (!ok) return;\r\n\r\n      const ratingVal = els.ratingInput?.value ? parseInt(els.ratingInput.value, 10) : NaN;\r\n      const rating = Number.isNaN(ratingVal) ? config.threshold : ratingVal;\r\n      const name = els.nameInput?.value?.trim() || \"\";\r\n      const email = els.emailInput?.value?.trim() || \"\";\r\n      const phone = els.phoneInput?.value?.trim() || \"\";\r\n\r\n      // Rating 1-2: redirect to feedback form\r\n      if (rating \u003c= config.threshold) {\r\n        saveStageOneToSession(rating, name, email, phone);\r\n        window.location.href = config.redirectLowTo;\r\n        return;\r\n      }\r\n\r\n      // Rating 3-4: redirect to thank you page\r\n      if (rating === 3 || rating === 4) {\r\n        window.location.href = \"/reviews/thank-you/\";\r\n        return;\r\n      }\r\n\r\n      // Rating 5: show Stage 2 for detailed review\r\n      if (rating === 5) {\r\n        showStageTwo(els);\r\n        showStatus(\r\n          els,\r\n          \"success\",\r\n          \"Thanks! You can optionally add a few details below before submitting your review.\"\r\n        );\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  els.form.addEventListener(\"submit\", (event: Event) =\u003e {\r\n    // Only intercept form submission if endpoint URL is configured for AJAX submission\r\n    if (config.endpointUrl) {\r\n      event.preventDefault();\r\n      void handleSubmit(els, config);\r\n      return;\r\n    }\r\n    \r\n    // Otherwise, intercept and submit to web3forms via fetch to control redirect\r\n    event.preventDefault();\r\n    \r\n    // Validate form before submission\r\n    const isValid = validateStageOne(els);\r\n    if (!isValid) return;\r\n    \r\n    // Prepare form data for Web3Forms\r\n    const formData = new FormData(els.form);\r\n    \r\n    setSubmitLoading(els, true);\r\n    showStatus(els, \"success\", \"Sending your review...\");\r\n    \r\n    fetch(\"https://api.web3forms.com/submit\", {\r\n      method: \"POST\",\r\n      body: formData,\r\n    })\r\n      .then((response) =\u003e response.json())\r\n      .then((data) =\u003e {\r\n        if (data.success) {\r\n          // Success - redirect to thank you page\r\n          const redirectInput = els.form.querySelector\u003cHTMLInputElement\u003e(\r\n            'input[name=\"redirect\"]'\r\n          );\r\n          const redirectUrl = redirectInput?.value || \"/reviews/thank-you/\";\r\n          window.location.replace(redirectUrl);\r\n        } else {\r\n          // Handle error from Web3Forms\r\n          throw new Error(data.message || \"Failed to send review\");\r\n        }\r\n      })\r\n      .catch((error) =\u003e {\r\n        logger.error(\"Review submission error:\", error);\r\n        const errorMessage =\r\n          error instanceof Error\r\n            ? error.message\r\n            : \"Something went wrong while sending your review. Please try again shortly.\";\r\n        showStatus(els, \"error\", errorMessage);\r\n        setSubmitLoading(els, false);\r\n      });\r\n  });\r\n}\r\n\r\nexport function initReviewsForm(): void {\r\n  const roots = document.querySelectorAll\u003cHTMLElement\u003e('[data-reviews-form=\"true\"]');\r\n  if (!roots.length) return;\r\n\r\n  roots.forEach((root) =\u003e {\r\n    const config = getConfig(root);\r\n    const els = getElements(root);\r\n    if (!els) return;\r\n\r\n    attachEvents(els, config);\r\n  });\r\n}\r\n\r\n\r\n","/**\r\n * Reviews Module\r\n * Handles reviews filtering and carousel functionality\r\n */\r\n\r\n// ============================================================================\r\n// Carousel Functionality\r\n// ============================================================================\r\n\r\ninterface CarouselState {\r\n  currentIndex: number;\r\n  totalItems: number;\r\n  isTransitioning: boolean;\r\n  touchStartX: number;\r\n  touchEndX: number;\r\n  mouseStartX: number;\r\n  isMouseDown: boolean;\r\n  autoplayInterval: ReturnType\u003ctypeof setInterval\u003e | null;\r\n  isAutoplayPaused: boolean;\r\n}\r\n\r\ninterface CarouselElements {\r\n  carousel: HTMLElement;\r\n  wrapper: HTMLElement;\r\n  cards: HTMLElement[];\r\n  prevButton: HTMLButtonElement | null;\r\n  nextButton: HTMLButtonElement | null;\r\n  dots: HTMLButtonElement[];\r\n}\r\n\r\n// Store cleanup functions for event listeners\r\nconst carouselCleanups = new Map\u003cHTMLElement, (() =\u003e void)[]\u003e();\r\n\r\n/**\r\n * Get transition duration from CSS in milliseconds\r\n */\r\nfunction getTransitionDuration(element: HTMLElement): number {\r\n  const style = window.getComputedStyle(element);\r\n  const duration = style.transitionDuration || '0.6s';\r\n  // Parse \"0.6s\" or \"600ms\" to milliseconds\r\n  const match = duration.match(/([\\d.]+)(s|ms)/);\r\n  if (match) {\r\n    const value = parseFloat(match[1]);\r\n    return match[2] === 's' ? value * 1000 : value;\r\n  }\r\n  return 600; // Default fallback\r\n}\r\n\r\n/**\r\n * Capitalize first letter of a string\r\n */\r\nfunction capitalize(str: string): string {\r\n  if (!str) return str;\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\nfunction initReviewsCarousel(): void {\r\n  const carousel = document.querySelector('[data-reviews-carousel]') as HTMLElement | null;\r\n  if (!carousel) return;\r\n\r\n  // Clean up previous instance if it exists\r\n  const existingCleanup = carouselCleanups.get(carousel);\r\n  if (existingCleanup) {\r\n    existingCleanup.forEach(fn =\u003e fn());\r\n    carouselCleanups.delete(carousel);\r\n  }\r\n\r\n  const wrapper = carousel.querySelector('.reviews__carousel-wrapper') as HTMLElement | null;\r\n  const cards = Array.from(carousel.querySelectorAll('.review-card--carousel')) as HTMLElement[];\r\n  const prevButton = carousel.querySelector('[data-carousel-prev]') as HTMLButtonElement | null;\r\n  const nextButton = carousel.querySelector('[data-carousel-next]') as HTMLButtonElement | null;\r\n  const dots = Array.from(carousel.querySelectorAll('[data-carousel-dot]')) as HTMLButtonElement[];\r\n\r\n  if (!wrapper || cards.length === 0) return;\r\n\r\n  // Handle edge case: too few cards for carousel\r\n  if (cards.length \u003c 2) {\r\n    // Hide navigation if only one card\r\n    if (prevButton) prevButton.style.display = 'none';\r\n    if (nextButton) nextButton.style.display = 'none';\r\n    if (dots.length \u003e 0) {\r\n      dots.forEach(dot =\u003e dot.style.display = 'none');\r\n    }\r\n    // Still need to set the single card as active so it displays\r\n    if (cards.length === 1) {\r\n      cards[0].setAttribute('data-carousel-active', 'true');\r\n    }\r\n    return;\r\n  }\r\n\r\n  const elements: CarouselElements = {\r\n    carousel,\r\n    wrapper,\r\n    cards,\r\n    prevButton,\r\n    nextButton,\r\n    dots,\r\n  };\r\n\r\n  const state: CarouselState = {\r\n    currentIndex: 0,\r\n    totalItems: cards.length,\r\n    isTransitioning: false,\r\n    touchStartX: 0,\r\n    touchEndX: 0,\r\n    mouseStartX: 0,\r\n    isMouseDown: false,\r\n    autoplayInterval: null,\r\n    isAutoplayPaused: false,\r\n  };\r\n\r\n  // Get transition duration dynamically\r\n  const transitionDuration = getTransitionDuration(wrapper);\r\n  const cleanupFunctions: (() =\u003e void)[] = [];\r\n  \r\n  // Check if user prefers reduced motion\r\n  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n\r\n  // Calculate wrapped difference between two indices (handles infinite loop)\r\n  function getWrappedDiff(index: number, currentIndex: number, total: number): number {\r\n    let diff = index - currentIndex;\r\n    // Handle wrapping - find shortest path\r\n    if (Math.abs(diff) \u003e total / 2) {\r\n      if (diff \u003e 0) {\r\n        diff = diff - total;\r\n      } else {\r\n        diff = diff + total;\r\n      }\r\n    }\r\n    return diff;\r\n  }\r\n\r\n  // Update card positions based on current index (optimized to only update changed attributes)\r\n  // Shows only: active card (center), 1 card on left, 1 card on right - hides all others\r\n  function updateCarousel(): void {\r\n    cards.forEach((card, index) =\u003e {\r\n      const diff = getWrappedDiff(index, state.currentIndex, state.totalItems);\r\n      const absDiff = Math.abs(diff);\r\n\r\n      // Determine new position - only show immediate neighbors\r\n      let newActive: string | null = null;\r\n      let newPosition: string | null = null;\r\n\r\n      if (diff === 0) {\r\n        // Active card (center)\r\n        newActive = 'true';\r\n      } else if (diff === -1 || diff === state.totalItems - 1) {\r\n        // Immediate left card (or wrapped from end)\r\n        newPosition = 'left';\r\n      } else if (diff === 1 || diff === -(state.totalItems - 1)) {\r\n        // Immediate right card (or wrapped from start)\r\n        newPosition = 'right';\r\n      } else {\r\n        // Hide all other cards\r\n        newPosition = 'hidden';\r\n      }\r\n\r\n      // Only update if changed\r\n      const currentActive = card.getAttribute('data-carousel-active');\r\n      const currentPosition = card.getAttribute('data-carousel-position');\r\n\r\n      if (newActive !== currentActive) {\r\n        if (newActive) {\r\n          card.setAttribute('data-carousel-active', newActive);\r\n        } else {\r\n          card.removeAttribute('data-carousel-active');\r\n        }\r\n      }\r\n\r\n      if (newPosition !== currentPosition) {\r\n        if (newPosition) {\r\n          card.setAttribute('data-carousel-position', newPosition);\r\n        } else {\r\n          card.removeAttribute('data-carousel-position');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Update dots (only if they exist and match count)\r\n    if (dots.length === state.totalItems) {\r\n      dots.forEach((dot, index) =\u003e {\r\n        const isActive = index === state.currentIndex;\r\n        const currentlyActive = dot.classList.contains('reviews__carousel-dot--active');\r\n\r\n        if (isActive !== currentlyActive) {\r\n          if (isActive) {\r\n            dot.classList.add('reviews__carousel-dot--active');\r\n            dot.setAttribute('aria-current', 'true');\r\n          } else {\r\n            dot.classList.remove('reviews__carousel-dot--active');\r\n            dot.removeAttribute('aria-current');\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // Buttons are never disabled in infinite loop mode\r\n    if (prevButton) {\r\n      prevButton.disabled = false;\r\n    }\r\n    if (nextButton) {\r\n      nextButton.disabled = false;\r\n    }\r\n  }\r\n\r\n  // Normalize index to valid range (handles wrapping)\r\n  function normalizeIndex(index: number): number {\r\n    if (index \u003c 0) {\r\n      return state.totalItems + (index % state.totalItems);\r\n    }\r\n    return index % state.totalItems;\r\n  }\r\n\r\n  // Navigate to specific index (with infinite loop support)\r\n  function goToIndex(index: number): void {\r\n    if (state.isTransitioning) {\r\n      return;\r\n    }\r\n\r\n    // Normalize index to handle wrapping\r\n    const normalizedIndex = normalizeIndex(index);\r\n    \r\n    if (normalizedIndex === state.currentIndex) {\r\n      return;\r\n    }\r\n\r\n    state.isTransitioning = true;\r\n    state.currentIndex = normalizedIndex;\r\n    updateCarousel();\r\n\r\n    // Reset transition flag after animation (use dynamic duration)\r\n    setTimeout(() =\u003e {\r\n      state.isTransitioning = false;\r\n    }, transitionDuration);\r\n  }\r\n\r\n  // Navigate to next (infinite loop)\r\n  function goToNext(): void {\r\n    goToIndex(state.currentIndex + 1);\r\n  }\r\n\r\n  // Navigate to previous (infinite loop)\r\n  function goToPrev(): void {\r\n    goToIndex(state.currentIndex - 1);\r\n  }\r\n\r\n  // Start autoplay\r\n  function startAutoplay(): void {\r\n    // Don't autoplay if user prefers reduced motion\r\n    if (prefersReducedMotion) {\r\n      return;\r\n    }\r\n\r\n    // Clear any existing interval\r\n    stopAutoplay();\r\n\r\n    // Set up autoplay interval (5 seconds = 5000ms)\r\n    state.autoplayInterval = setInterval(() =\u003e {\r\n      if (!state.isAutoplayPaused \u0026\u0026 !state.isTransitioning) {\r\n        goToNext();\r\n      }\r\n    }, 5000);\r\n  }\r\n\r\n  // Stop autoplay\r\n  function stopAutoplay(): void {\r\n    if (state.autoplayInterval) {\r\n      clearInterval(state.autoplayInterval);\r\n      state.autoplayInterval = null;\r\n    }\r\n  }\r\n\r\n  // Pause autoplay (temporarily)\r\n  function pauseAutoplay(): void {\r\n    state.isAutoplayPaused = true;\r\n  }\r\n\r\n  // Resume autoplay\r\n  function resumeAutoplay(): void {\r\n    state.isAutoplayPaused = false;\r\n  }\r\n\r\n  // Touch/swipe handlers\r\n  function handleTouchStart(e: TouchEvent): void {\r\n    if (e.touches.length \u003e 0) {\r\n      state.touchStartX = e.touches[0].clientX;\r\n    }\r\n  }\r\n\r\n  function handleTouchMove(e: TouchEvent): void {\r\n    if (!state.touchStartX || e.touches.length === 0) return;\r\n    \r\n    const currentX = e.touches[0].clientX;\r\n    const deltaX = Math.abs(currentX - state.touchStartX);\r\n    const deltaY = Math.abs(e.touches[0].clientY - (e.touches[0].clientY || 0));\r\n    \r\n    // Prevent vertical scrolling if horizontal swipe detected\r\n    if (deltaX \u003e deltaY \u0026\u0026 deltaX \u003e 10) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  function handleTouchEnd(e: TouchEvent): void {\r\n    if (!state.touchStartX) return;\r\n\r\n    if (e.changedTouches \u0026\u0026 e.changedTouches.length \u003e 0) {\r\n      state.touchEndX = e.changedTouches[0].clientX;\r\n      const diff = state.touchStartX - state.touchEndX;\r\n      const minSwipeDistance = 50;\r\n\r\n      if (Math.abs(diff) \u003e minSwipeDistance) {\r\n        if (diff \u003e 0) {\r\n          // Swiped left - go to next\r\n          goToNext();\r\n        } else {\r\n          // Swiped right - go to previous\r\n          goToPrev();\r\n        }\r\n      }\r\n    }\r\n\r\n    state.touchStartX = 0;\r\n    state.touchEndX = 0;\r\n  }\r\n\r\n  // Mouse drag handlers for desktop\r\n  function handleMouseDown(e: MouseEvent): void {\r\n    state.isMouseDown = true;\r\n    state.mouseStartX = e.clientX;\r\n    e.preventDefault();\r\n  }\r\n\r\n  function handleMouseMove(e: MouseEvent): void {\r\n    if (!state.isMouseDown) return;\r\n    // Prevent text selection during drag\r\n    e.preventDefault();\r\n  }\r\n\r\n  function handleMouseUp(e: MouseEvent): void {\r\n    if (!state.isMouseDown) return;\r\n\r\n    const diff = state.mouseStartX - e.clientX;\r\n    const minDragDistance = 50;\r\n\r\n    if (Math.abs(diff) \u003e minDragDistance) {\r\n      if (diff \u003e 0) {\r\n        // Dragged left - go to next\r\n        goToNext();\r\n      } else {\r\n        // Dragged right - go to previous\r\n        goToPrev();\r\n      }\r\n    }\r\n\r\n    state.isMouseDown = false;\r\n    state.mouseStartX = 0;\r\n  }\r\n\r\n  function handleMouseLeave(): void {\r\n    state.isMouseDown = false;\r\n    state.mouseStartX = 0;\r\n  }\r\n\r\n  // Set up accessibility attributes\r\n  carousel.setAttribute('role', 'region');\r\n  carousel.setAttribute('aria-label', 'Customer reviews carousel');\r\n  wrapper.setAttribute('role', 'group');\r\n  wrapper.setAttribute('aria-roledescription', 'carousel');\r\n  wrapper.setAttribute('aria-live', 'polite');\r\n  wrapper.setAttribute('tabindex', '0');\r\n\r\n  // Add aria-labels to buttons if missing\r\n  if (prevButton \u0026\u0026 !prevButton.getAttribute('aria-label')) {\r\n    prevButton.setAttribute('aria-label', 'Previous review');\r\n  }\r\n  if (nextButton \u0026\u0026 !nextButton.getAttribute('aria-label')) {\r\n    nextButton.setAttribute('aria-label', 'Next review');\r\n  }\r\n\r\n  // Event listeners with cleanup tracking\r\n  if (prevButton) {\r\n    const prevHandler = () =\u003e {\r\n      pauseAutoplay();\r\n      goToPrev();\r\n      // Resume after a delay\r\n      setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n    };\r\n    prevButton.addEventListener('click', prevHandler);\r\n    cleanupFunctions.push(() =\u003e prevButton?.removeEventListener('click', prevHandler));\r\n  }\r\n\r\n  if (nextButton) {\r\n    const nextHandler = () =\u003e {\r\n      pauseAutoplay();\r\n      goToNext();\r\n      // Resume after a delay\r\n      setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n    };\r\n    nextButton.addEventListener('click', nextHandler);\r\n    cleanupFunctions.push(() =\u003e nextButton?.removeEventListener('click', nextHandler));\r\n  }\r\n\r\n  if (dots.length === state.totalItems) {\r\n    dots.forEach((dot) =\u003e {\r\n      // Read the index from the data attribute to ensure correct mapping\r\n      const dotIndexAttr = dot.getAttribute('data-carousel-dot');\r\n      const dotIndex = dotIndexAttr !== null ? parseInt(dotIndexAttr, 10) : null;\r\n      \r\n      if (dotIndex === null || isNaN(dotIndex) || dotIndex \u003c 0 || dotIndex \u003e= state.totalItems) {\r\n        console.warn('Invalid carousel dot index:', dotIndexAttr);\r\n        return;\r\n      }\r\n      \r\n      const handler = () =\u003e {\r\n        pauseAutoplay();\r\n        goToIndex(dotIndex);\r\n        // Resume after a delay\r\n        setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n      };\r\n      dot.addEventListener('click', handler);\r\n      cleanupFunctions.push(() =\u003e dot.removeEventListener('click', handler));\r\n      \r\n      // Add Enter key support for dots\r\n      const keyHandler = (e: KeyboardEvent) =\u003e {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n          e.preventDefault();\r\n          pauseAutoplay();\r\n          goToIndex(dotIndex);\r\n          // Resume after a delay\r\n          setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n        }\r\n      };\r\n      dot.addEventListener('keydown', keyHandler);\r\n      cleanupFunctions.push(() =\u003e dot.removeEventListener('keydown', keyHandler));\r\n    });\r\n  }\r\n\r\n  // Touch events for mobile\r\n  const touchStartHandler = (e: TouchEvent) =\u003e {\r\n    pauseAutoplay();\r\n    handleTouchStart(e);\r\n  };\r\n  wrapper.addEventListener('touchstart', touchStartHandler, { passive: true });\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('touchstart', touchStartHandler));\r\n  \r\n  wrapper.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('touchmove', handleTouchMove));\r\n  \r\n  const touchEndHandler = (e: TouchEvent) =\u003e {\r\n    handleTouchEnd(e);\r\n    // Resume after a delay\r\n    setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n  };\r\n  wrapper.addEventListener('touchend', touchEndHandler, { passive: true });\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('touchend', touchEndHandler));\r\n\r\n  // Mouse drag events for desktop\r\n  const mouseDownHandler = (e: MouseEvent) =\u003e {\r\n    pauseAutoplay();\r\n    handleMouseDown(e);\r\n  };\r\n  wrapper.addEventListener('mousedown', mouseDownHandler);\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('mousedown', mouseDownHandler));\r\n  \r\n  document.addEventListener('mousemove', handleMouseMove);\r\n  cleanupFunctions.push(() =\u003e document.removeEventListener('mousemove', handleMouseMove));\r\n  \r\n  const mouseUpHandler = (e: MouseEvent) =\u003e {\r\n    handleMouseUp(e);\r\n    // Resume after a delay\r\n    setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n  };\r\n  document.addEventListener('mouseup', mouseUpHandler);\r\n  cleanupFunctions.push(() =\u003e document.removeEventListener('mouseup', mouseUpHandler));\r\n  \r\n  wrapper.addEventListener('mouseleave', handleMouseLeave);\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('mouseleave', handleMouseLeave));\r\n\r\n  // Pause autoplay on hover, resume on leave\r\n  const mouseEnterHandler = () =\u003e pauseAutoplay();\r\n  const mouseLeaveHandler = () =\u003e resumeAutoplay();\r\n  carousel.addEventListener('mouseenter', mouseEnterHandler);\r\n  carousel.addEventListener('mouseleave', mouseLeaveHandler);\r\n  cleanupFunctions.push(() =\u003e {\r\n    carousel.removeEventListener('mouseenter', mouseEnterHandler);\r\n    carousel.removeEventListener('mouseleave', mouseLeaveHandler);\r\n  });\r\n\r\n  // Pause autoplay on focus, resume on blur\r\n  const focusHandler = () =\u003e pauseAutoplay();\r\n  const blurHandler = () =\u003e resumeAutoplay();\r\n  wrapper.addEventListener('focusin', focusHandler);\r\n  wrapper.addEventListener('focusout', blurHandler);\r\n  cleanupFunctions.push(() =\u003e {\r\n    wrapper.removeEventListener('focusin', focusHandler);\r\n    wrapper.removeEventListener('focusout', blurHandler);\r\n  });\r\n\r\n  // Keyboard navigation (works when wrapper or any child is focused)\r\n  const keyHandler = (e: KeyboardEvent) =\u003e {\r\n    if (e.key === 'ArrowLeft') {\r\n      e.preventDefault();\r\n      pauseAutoplay();\r\n      goToPrev();\r\n      setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n    } else if (e.key === 'ArrowRight') {\r\n      e.preventDefault();\r\n      pauseAutoplay();\r\n      goToNext();\r\n      setTimeout(() =\u003e resumeAutoplay(), 10000);\r\n    }\r\n  };\r\n  wrapper.addEventListener('keydown', keyHandler);\r\n  cleanupFunctions.push(() =\u003e wrapper.removeEventListener('keydown', keyHandler));\r\n\r\n  // Store cleanup functions (include autoplay cleanup)\r\n  cleanupFunctions.push(() =\u003e stopAutoplay());\r\n  carouselCleanups.set(carousel, cleanupFunctions);\r\n\r\n  // Initialize carousel\r\n  updateCarousel();\r\n\r\n  // Start autoplay\r\n  startAutoplay();\r\n}\r\n\r\n// ============================================================================\r\n// Carousel/Grid Visibility Enforcement\r\n// ============================================================================\r\n\r\n/**\r\n * Ensure proper visibility of carousel vs grid based on screen size\r\n * This enforces the CSS rules via JavaScript as a backup\r\n */\r\nfunction enforceCarouselGridVisibility(): void {\r\n  const reviewsSection = document.querySelector('.reviews--carousel') as HTMLElement | null;\r\n  if (!reviewsSection) return;\r\n\r\n  const carousel = reviewsSection.querySelector('.reviews__carousel') as HTMLElement | null;\r\n  const mobileFallbackGrid = reviewsSection.querySelector('.reviews__grid--mobile-fallback') as HTMLElement | null;\r\n\r\n  if (!carousel || !mobileFallbackGrid) return;\r\n\r\n  // Check if we're on tablet/mobile (max-width: 768px)\r\n  const isTabletOrMobile = window.matchMedia('(max-width: 768px)').matches;\r\n\r\n  if (isTabletOrMobile) {\r\n    // On tablet/mobile: show grid, hide carousel\r\n    carousel.style.display = 'none';\r\n    mobileFallbackGrid.style.display = 'grid';\r\n  } else {\r\n    // On desktop: show carousel, hide grid\r\n    carousel.style.display = 'block';\r\n    mobileFallbackGrid.style.display = 'none';\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Filter Functionality\r\n// ============================================================================\r\n\r\nfunction initReviewsFilter(): void {\r\n  const serviceFilterSelect = document.getElementById('reviews-service-filter') as HTMLSelectElement | null;\r\n  const locationFilterSelect = document.getElementById('reviews-location-filter') as HTMLSelectElement | null;\r\n  const brandFilterSelect = document.getElementById('reviews-brand-filter') as HTMLSelectElement | null;\r\n  const reviewsSection = document.querySelector('.reviews') as HTMLElement | null;\r\n  \r\n  if (!reviewsSection) {\r\n    return;\r\n  }\r\n\r\n  // Check if we're in carousel mode\r\n  const isCarouselMode = reviewsSection.classList.contains('reviews--carousel');\r\n  const mobileFallbackGrid = reviewsSection.querySelector('.reviews__grid--mobile-fallback') as HTMLElement | null;\r\n  \r\n  // Get cards from the appropriate container based on screen size\r\n  // On desktop in carousel mode: only filter carousel cards\r\n  // On mobile in carousel mode: only filter grid cards\r\n  // In grid mode: filter all grid cards\r\n  const isTabletOrMobile = window.matchMedia('(max-width: 768px)').matches;\r\n  \r\n  let reviewCards: HTMLElement[] = [];\r\n  if (isCarouselMode) {\r\n    if (isTabletOrMobile \u0026\u0026 mobileFallbackGrid) {\r\n      // On mobile: filter grid cards\r\n      reviewCards = Array.from(mobileFallbackGrid.querySelectorAll('.review-card')) as HTMLElement[];\r\n    } else {\r\n      // On desktop: filter carousel cards\r\n      const carousel = reviewsSection.querySelector('.reviews__carousel') as HTMLElement | null;\r\n      if (carousel) {\r\n        reviewCards = Array.from(carousel.querySelectorAll('.review-card--carousel')) as HTMLElement[];\r\n      }\r\n    }\r\n  } else {\r\n    // Grid mode: filter all grid cards\r\n    const grid = reviewsSection.querySelector('.reviews__grid') as HTMLElement | null;\r\n    if (grid) {\r\n      reviewCards = Array.from(grid.querySelectorAll('.review-card')) as HTMLElement[];\r\n    }\r\n  }\r\n  \r\n  if (reviewCards.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // Store original display state (but don't override CSS visibility rules)\r\n  const originalDisplay: Map\u003cHTMLElement, string\u003e = new Map();\r\n  reviewCards.forEach(card =\u003e {\r\n    const computedStyle = window.getComputedStyle(card);\r\n    // Only store if the card is actually visible (not hidden by CSS)\r\n    if (computedStyle.display !== 'none') {\r\n      originalDisplay.set(card, computedStyle.display);\r\n    }\r\n  });\r\n\r\n  function filterReviews(): void {\r\n    const serviceType = serviceFilterSelect?.value || '';\r\n    const location = locationFilterSelect?.value || '';\r\n    const brand = brandFilterSelect?.value || '';\r\n    \r\n    let visibleCount = 0;\r\n    \r\n    reviewCards.forEach(card =\u003e {\r\n      const cardServiceType = card.getAttribute('data-service-type')?.toLowerCase() || '';\r\n      const cardLocation = card.getAttribute('data-location') || '';\r\n      const cardBrand = card.getAttribute('data-brand') || '';\r\n      \r\n      const serviceMatch = !serviceType || cardServiceType === serviceType.toLowerCase();\r\n      const locationMatch = !location || cardLocation === location;\r\n      const brandMatch = !brand || cardBrand === brand;\r\n      \r\n      if (serviceMatch \u0026\u0026 locationMatch \u0026\u0026 brandMatch) {\r\n        // Only set display if we have a stored original value\r\n        // This prevents overriding CSS that hides elements\r\n        const original = originalDisplay.get(card);\r\n        if (original) {\r\n          card.style.display = original;\r\n        } else {\r\n          // Remove inline style to let CSS take over\r\n          card.style.removeProperty('display');\r\n        }\r\n        visibleCount++;\r\n      } else {\r\n        card.style.display = 'none';\r\n      }\r\n    });\r\n    \r\n    // Re-enforce carousel/grid visibility after filtering\r\n    if (isCarouselMode) {\r\n      enforceCarouselGridVisibility();\r\n    }\r\n\r\n    // Show message if no reviews match\r\n    if (!reviewsSection) return;\r\n    \r\n    let noResultsMsg = reviewsSection.querySelector('.reviews__no-results') as HTMLElement | null;\r\n    const grid = reviewsSection.querySelector('.reviews__grid') as HTMLElement | null;\r\n    const carousel = reviewsSection.querySelector('.reviews__carousel') as HTMLElement | null;\r\n    \r\n    if (visibleCount === 0) {\r\n      if (!noResultsMsg) {\r\n        noResultsMsg = document.createElement('p');\r\n        noResultsMsg.className = 'reviews__no-results';\r\n        const filters: string[] = [];\r\n        if (serviceType) filters.push(capitalize(serviceType));\r\n        if (location) filters.push(location);\r\n        if (brand) filters.push(brand);\r\n        const filterText = filters.length \u003e 0 ? filters.join(', ') : 'selected filters';\r\n        noResultsMsg.textContent = `No reviews found for ${filterText}.`;\r\n        if (grid) {\r\n          grid.appendChild(noResultsMsg);\r\n        } else if (carousel) {\r\n          carousel.appendChild(noResultsMsg);\r\n        }\r\n      }\r\n    } else {\r\n      noResultsMsg?.remove();\r\n    }\r\n  }\r\n\r\n  // Handle filter changes\r\n  if (serviceFilterSelect) {\r\n    serviceFilterSelect.addEventListener('change', filterReviews);\r\n  }\r\n  \r\n  if (locationFilterSelect) {\r\n    locationFilterSelect.addEventListener('change', filterReviews);\r\n  }\r\n  \r\n  if (brandFilterSelect) {\r\n    brandFilterSelect.addEventListener('change', filterReviews);\r\n  }\r\n\r\n  // Initialize with current filter values\r\n  filterReviews();\r\n}\r\n\r\nexport function initReviews(): void {\r\n  // Initialize reviews carousel if present\r\n  if (document.querySelector('[data-reviews-carousel]')) {\r\n    initReviewsCarousel();\r\n    // Enforce visibility rules after carousel init\r\n    enforceCarouselGridVisibility();\r\n    \r\n    // Re-enforce on window resize\r\n    let resizeTimeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n    window.addEventListener('resize', () =\u003e {\r\n      if (resizeTimeout) clearTimeout(resizeTimeout);\r\n      resizeTimeout = setTimeout(() =\u003e {\r\n        enforceCarouselGridVisibility();\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  // Initialize reviews filter if present (check for any filter)\r\n  if (document.getElementById('reviews-service-filter') || \r\n      document.getElementById('reviews-location-filter') || \r\n      document.getElementById('reviews-brand-filter')) {\r\n    initReviewsFilter();\r\n  }\r\n}\r\n\r\n\r\n","/**\r\n * Confetti Animation\r\n * Creates confetti particles that rain down from the top of the screen\r\n * Particles fade out within 2 seconds (half-life)\r\n */\r\n\r\ninterface ConfettiOptions {\r\n  particleCount?: number;\r\n  spread?: number;\r\n  originX?: number;\r\n  originY?: number;\r\n}\r\n\r\nconst DEFAULT_OPTIONS: Required\u003cConfettiOptions\u003e = {\r\n  particleCount: 100,\r\n  spread: 360,\r\n  originX: 0.5, // 0-1, where 0.5 is center (not used for rain effect)\r\n  originY: 0.5, // 0-1, where 0.5 is center (not used for rain effect)\r\n};\r\n\r\nexport function createConfetti(options: ConfettiOptions = {}): void {\r\n  const opts = { ...DEFAULT_OPTIONS, ...options };\r\n  \r\n  // Get viewport dimensions\r\n  const viewportWidth = window.innerWidth;\r\n  const viewportHeight = window.innerHeight;\r\n  \r\n  // Create container if it doesn't exist\r\n  let container = document.querySelector\u003cHTMLElement\u003e('.confetti-container');\r\n  if (!container) {\r\n    container = document.createElement('div');\r\n    container.className = 'confetti-container';\r\n    document.body.appendChild(container);\r\n  }\r\n  \r\n  // Clear any existing particles\r\n  container.innerHTML = '';\r\n  \r\n  // Create particles\r\n  for (let i = 0; i \u003c opts.particleCount; i++) {\r\n    const particle = document.createElement('div');\r\n    particle.className = 'confetti-particle';\r\n    \r\n    // Random X position across the top of the screen\r\n    const startX = Math.random() * viewportWidth;\r\n    \r\n    // Start slightly above the screen for better effect\r\n    const startY = -20 - Math.random() * 20;\r\n    \r\n    // Fall straight down with slight horizontal drift\r\n    const horizontalDrift = (Math.random() - 0.5) * 100; // -50 to 50px drift\r\n    const fallDistance = viewportHeight + 40; // Fall past the bottom\r\n    \r\n    // Random rotation\r\n    const rotation = (Math.random() * 720 - 360); // -360 to 360 degrees\r\n    \r\n    // Random delay (0 to 0.5s) for staggered rain effect\r\n    const delay = Math.random() * 0.5;\r\n    \r\n    // Set initial position at top of screen\r\n    particle.style.left = `${startX}px`;\r\n    particle.style.top = `${startY}px`;\r\n    \r\n    // Set CSS custom properties for animation\r\n    particle.style.setProperty('--confetti-x', `${horizontalDrift}px`);\r\n    particle.style.setProperty('--confetti-y', `${fallDistance}px`);\r\n    particle.style.setProperty('--confetti-rotate', `${rotation}deg`);\r\n    particle.style.setProperty('--confetti-delay', `${delay}s`);\r\n    \r\n    container.appendChild(particle);\r\n  }\r\n  \r\n  // Clean up container after animation completes (2s + max delay)\r\n  setTimeout(() =\u003e {\r\n    if (container \u0026\u0026 container.parentNode) {\r\n      container.parentNode.removeChild(container);\r\n    }\r\n  }, 2500); // 2s animation + 0.5s max delay\r\n}\r\n\r\n","/**\r\n * VIP Membership Modal\r\n * - Opens from [data-vip-modal-open]\r\n * - Accessible dialog with focus trap and ESC/overlay close\r\n * - Triggers confetti on successful form submission\r\n */\r\n\r\nimport { createConfetti } from \"./confetti\";\r\n\r\nconst SELECTORS = {\r\n  modal: \"#vip-membership-modal\",\r\n  openTriggers: \"[data-vip-modal-open]\",\r\n  closeTriggers: \"[data-vip-modal-close]\",\r\n  successMessage: \"#success-message\",\r\n} as const;\r\n\r\nlet lastFocusedElement: HTMLElement | null = null;\r\n\r\nfunction getFocusableElements(container: HTMLElement): HTMLElement[] {\r\n  const focusableSelectors = [\r\n    'a[href]',\r\n    'button:not([disabled])',\r\n    'input:not([disabled]):not([type=\"hidden\"])',\r\n    'select:not([disabled])',\r\n    'textarea:not([disabled])',\r\n    '[tabindex]:not([tabindex=\"-1\"])',\r\n  ].join(\", \");\r\n\r\n  return Array.from(container.querySelectorAll\u003cHTMLElement\u003e(focusableSelectors)).filter(\r\n    (el) =\u003e !el.hasAttribute(\"aria-hidden\") \u0026\u0026 !el.closest(\"[aria-hidden='true']\"),\r\n  );\r\n}\r\n\r\nfunction openModal(modal: HTMLElement): void {\r\n  if (modal.getAttribute(\"aria-hidden\") === \"false\") return;\r\n\r\n  lastFocusedElement = (document.activeElement as HTMLElement) || null;\r\n\r\n  modal.setAttribute(\"aria-hidden\", \"false\");\r\n  document.body.style.overflow = \"hidden\";\r\n\r\n  // Reset confetti trigger when modal opens\r\n  confettiTriggered = false;\r\n\r\n  const focusable = getFocusableElements(modal);\r\n  const firstFocusable = focusable[0];\r\n  if (firstFocusable) {\r\n    firstFocusable.focus();\r\n  }\r\n\r\n  modal.addEventListener(\"keydown\", handleKeydown);\r\n  \r\n  // Start watching for success when modal opens\r\n  setTimeout(watchForSuccess, 100);\r\n}\r\n\r\nfunction closeModal(modal: HTMLElement): void {\r\n  if (modal.getAttribute(\"aria-hidden\") === \"true\") return;\r\n\r\n  modal.setAttribute(\"aria-hidden\", \"true\");\r\n  document.body.style.overflow = \"\";\r\n\r\n  modal.removeEventListener(\"keydown\", handleKeydown);\r\n\r\n  if (lastFocusedElement \u0026\u0026 document.contains(lastFocusedElement)) {\r\n    lastFocusedElement.focus();\r\n  }\r\n}\r\n\r\nfunction handleKeydown(event: KeyboardEvent): void {\r\n  const modal = document.querySelector\u003cHTMLElement\u003e(SELECTORS.modal);\r\n  if (!modal || modal.getAttribute(\"aria-hidden\") === \"true\") return;\r\n\r\n  if (event.key === \"Escape\") {\r\n    event.preventDefault();\r\n    closeModal(modal);\r\n    return;\r\n  }\r\n\r\n  if (event.key === \"Tab\") {\r\n    const focusable = getFocusableElements(modal);\r\n    if (focusable.length === 0) return;\r\n\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n    const current = document.activeElement as HTMLElement;\r\n\r\n    if (event.shiftKey) {\r\n      if (current === first || !modal.contains(current)) {\r\n        event.preventDefault();\r\n        last.focus();\r\n      }\r\n    } else {\r\n      if (current === last || !modal.contains(current)) {\r\n        event.preventDefault();\r\n        first.focus();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nlet confettiTriggered = false;\r\n\r\nfunction triggerConfettiIfSuccess(): boolean {\r\n  if (confettiTriggered) return true;\r\n  \r\n  const successMessage = document.querySelector\u003cHTMLElement\u003e(SELECTORS.successMessage);\r\n  const modal = document.querySelector\u003cHTMLElement\u003e(SELECTORS.modal);\r\n  \r\n  if (!successMessage || !modal || modal.getAttribute(\"aria-hidden\") === \"true\") {\r\n    return false;\r\n  }\r\n  \r\n  // Check if success message is visible\r\n  const isVisible = successMessage.offsetParent !== null \u0026\u0026\r\n                    window.getComputedStyle(successMessage).display !== \"none\" \u0026\u0026\r\n                    successMessage.textContent?.trim();\r\n  \r\n  if (isVisible) {\r\n    confettiTriggered = true;\r\n    \r\n    createConfetti({\r\n      particleCount: 120,\r\n    });\r\n    \r\n    return true;\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\nfunction watchForSuccess(): void {\r\n  const successMessage = document.querySelector\u003cHTMLElement\u003e(SELECTORS.successMessage);\r\n  if (!successMessage) return;\r\n\r\n  // Use MutationObserver to watch for when success message becomes visible\r\n  const observer = new MutationObserver(() =\u003e {\r\n    if (triggerConfettiIfSuccess()) {\r\n      observer.disconnect();\r\n      clearInterval(checkInterval);\r\n    }\r\n  });\r\n\r\n  // Observe style, class, and content changes\r\n  observer.observe(successMessage, {\r\n    attributes: true,\r\n    attributeFilter: [\"style\", \"class\"],\r\n    childList: true,\r\n    subtree: true,\r\n  });\r\n\r\n  // Also check periodically in case Brevo uses other methods\r\n  let checkCount = 0;\r\n  const maxChecks = 20; // Check for 10 seconds (20 * 500ms)\r\n  const checkInterval = setInterval(() =\u003e {\r\n    checkCount++;\r\n    \r\n    if (triggerConfettiIfSuccess()) {\r\n      observer.disconnect();\r\n      clearInterval(checkInterval);\r\n      return;\r\n    }\r\n    \r\n    if (checkCount \u003e= maxChecks) {\r\n      clearInterval(checkInterval);\r\n      observer.disconnect();\r\n    }\r\n  }, 500);\r\n}\r\n\r\nexport function initVIPModal(): void {\r\n  const modal = document.querySelector\u003cHTMLElement\u003e(SELECTORS.modal);\r\n  const openButtons = document.querySelectorAll\u003cHTMLElement\u003e(SELECTORS.openTriggers);\r\n  const closeButtons = document.querySelectorAll\u003cHTMLElement\u003e(SELECTORS.closeTriggers);\r\n\r\n  if (!modal || openButtons.length === 0) {\r\n    return;\r\n  }\r\n\r\n  openButtons.forEach((btn) =\u003e {\r\n    btn.addEventListener(\"click\", (event) =\u003e {\r\n      event.preventDefault();\r\n      openModal(modal);\r\n    });\r\n  });\r\n\r\n  closeButtons.forEach((btn) =\u003e {\r\n    btn.addEventListener(\"click\", (event) =\u003e {\r\n      event.preventDefault();\r\n      closeModal(modal);\r\n    });\r\n  });\r\n\r\n  const backdrop = modal.querySelector\u003cHTMLElement\u003e(\".modal__backdrop\");\r\n  if (backdrop) {\r\n    backdrop.addEventListener(\"click\", (event) =\u003e {\r\n      event.preventDefault();\r\n      closeModal(modal);\r\n    });\r\n  }\r\n}\r\n\r\n\r\n","/**\r\n * Booking Iframe Module\r\n * Listens for postMessage events from the booking iframe and handles\r\n * redirects to thank-you page and conversion tracking\r\n */\r\n\r\nimport { onDOMReady, isLocalhost } from '../utils/dom';\r\n\r\n// Constants\r\nconst DEV_LOG = isLocalhost();\r\nconst BOOKING_IFRAME_ORIGIN = 'https://booking.rossware.com';\r\nconst THANK_YOU_PAGE_URL = '/schedule-service/thank-you/';\r\n\r\n/**\r\n * Development logging helper\r\n */\r\nfunction devLog(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.log('[Booking Iframe]', ...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Development error logging helper\r\n */\r\nfunction devError(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.error('[Booking Iframe]', ...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Track conversion event in Google Analytics (gtag)\r\n */\r\nfunction trackConversionGA(data?: unknown): void {\r\n  if (typeof window === 'undefined' || !(window as any).gtag) {\r\n    devLog('Google Analytics (gtag) not available');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Track as a custom event for GA4\r\n    (window as any).gtag('event', 'booking_submission', {\r\n      event_category: 'Booking',\r\n      event_label: 'Online Booking',\r\n      value: 1\r\n    });\r\n\r\n    devLog('Conversion tracked in Google Analytics', data);\r\n  } catch (error) {\r\n    devError('Error tracking conversion in Google Analytics:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Track conversion event in Facebook Pixel\r\n */\r\nfunction trackConversionFB(data?: unknown): void {\r\n  if (typeof window === 'undefined' || !(window as any).fbq) {\r\n    devLog('Facebook Pixel not available');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    (window as any).fbq('track', 'Lead', {\r\n      content_name: 'Online Booking',\r\n      content_category: 'Appointment Booking'\r\n    });\r\n\r\n    // Also track as a custom event\r\n    (window as any).fbq('trackCustom', 'BookingSubmission', {\r\n      source: 'booking_iframe'\r\n    });\r\n\r\n    devLog('Conversion tracked in Facebook Pixel', data);\r\n  } catch (error) {\r\n    devError('Error tracking conversion in Facebook Pixel:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Track conversion event in dataLayer (for Google Tag Manager)\r\n */\r\nfunction trackConversionDataLayer(data?: unknown): void {\r\n  if (typeof window === 'undefined' || !(window as any).dataLayer) {\r\n    devLog('dataLayer not available');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    (window as any).dataLayer.push({\r\n      event: 'booking_submission',\r\n      event_category: 'Booking',\r\n      event_label: 'Online Booking',\r\n      value: 1,\r\n      booking_data: data\r\n    });\r\n\r\n    devLog('Conversion tracked in dataLayer', data);\r\n  } catch (error) {\r\n    devError('Error tracking conversion in dataLayer:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Track conversion using all available tracking methods\r\n */\r\nfunction trackConversion(bookingData?: unknown): void {\r\n  devLog('Tracking conversion for booking submission');\r\n\r\n  // Track in Google Analytics\r\n  trackConversionGA(bookingData);\r\n\r\n  // Track in Facebook Pixel\r\n  trackConversionFB(bookingData);\r\n\r\n  // Track in dataLayer (GTM)\r\n  trackConversionDataLayer(bookingData);\r\n}\r\n\r\n/**\r\n * Check if the message data indicates a successful booking submission\r\n * NOTE: The initialization data ({data: {id: 2327, ClientName: '...'}}) appears on page load\r\n * and should NOT be treated as a submission. We only look for explicit success indicators.\r\n */\r\nfunction isBookingSubmission(data: unknown): boolean {\r\n  if (!data || typeof data !== 'object') {\r\n    return false;\r\n  }\r\n\r\n  const message = data as Record\u003cstring, unknown\u003e;\r\n\r\n  // Only trigger on explicit success indicators\r\n  // Common patterns: type, event, status, action, etc.\r\n  if (message.type === 'booking_success' || \r\n      message.event === 'booking_success' ||\r\n      message.status === 'success' ||\r\n      message.action === 'booking_complete' ||\r\n      message.booking_status === 'completed' ||\r\n      message.submitted === true ||\r\n      message.success === true) {\r\n    return true;\r\n  }\r\n\r\n  // Check if message contains submission indicators in string format\r\n  if (typeof message.type === 'string') {\r\n    const type = message.type.toLowerCase();\r\n    if (type.includes('success') || type.includes('complete') || type.includes('submit')) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  if (typeof message.event === 'string') {\r\n    const event = message.event.toLowerCase();\r\n    if (event.includes('success') || event.includes('complete') || event.includes('submit')) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Handle successful booking submission\r\n */\r\nfunction handleBookingSuccess(event: MessageEvent, bookingData?: unknown): void {\r\n  devLog('Booking submission detected', event.data);\r\n\r\n  // Mark in sessionStorage that a booking was just submitted\r\n  // This persists across page refreshes\r\n  try {\r\n    sessionStorage.setItem('ars_booking_submitted', 'true');\r\n    sessionStorage.setItem('ars_booking_timestamp', Date.now().toString());\r\n    if (bookingData) {\r\n      try {\r\n        sessionStorage.setItem('ars_booking_data', JSON.stringify(bookingData));\r\n      } catch (e) {\r\n        devLog('Could not store booking data in sessionStorage');\r\n      }\r\n    }\r\n  } catch (e) {\r\n    devLog('Could not write to sessionStorage:', e);\r\n  }\r\n\r\n  // Track conversion\r\n  trackConversion(bookingData || event.data);\r\n\r\n  // Redirect to thank-you page\r\n  // Use replace() to avoid adding to browser history\r\n  devLog('Redirecting to thank-you page:', THANK_YOU_PAGE_URL);\r\n  window.location.replace(THANK_YOU_PAGE_URL);\r\n}\r\n\r\n/**\r\n * Check if we should redirect to thank-you page on page load\r\n * This handles cases where the booking system refreshes the page after submission\r\n */\r\nfunction checkForBookingSubmission(): void {\r\n  try {\r\n    // First, check URL parameters for success indicators\r\n    // Some booking systems add parameters like ?success=1 or ?booking=success\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const successParams = ['success', 'booking', 'submitted', 'confirmed', 'complete', 'thankyou'];\r\n    let hasSuccessParam = false;\r\n    \r\n    for (const param of successParams) {\r\n      const value = urlParams.get(param);\r\n      if (value \u0026\u0026 (value === '1' || value === 'true' || value.toLowerCase().includes('success'))) {\r\n        hasSuccessParam = true;\r\n        devLog(`✓ Success parameter detected in URL: ${param}=${value}`);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (hasSuccessParam) {\r\n      // Clear URL parameters\r\n      const newUrl = window.location.pathname;\r\n      window.history.replaceState({}, '', newUrl);\r\n\r\n      // Track conversion and redirect\r\n      trackConversion();\r\n      devLog('Redirecting to thank-you page based on URL parameter');\r\n      window.location.replace(THANK_YOU_PAGE_URL);\r\n      return;\r\n    }\r\n\r\n    // Check for explicit booking submission flag (from postMessage)\r\n    const bookingSubmitted = sessionStorage.getItem('ars_booking_submitted');\r\n    const bookingTimestamp = sessionStorage.getItem('ars_booking_timestamp');\r\n\r\n    if (bookingSubmitted === 'true' \u0026\u0026 bookingTimestamp) {\r\n      const timestamp = parseInt(bookingTimestamp, 10);\r\n      const now = Date.now();\r\n      const timeDiff = now - timestamp;\r\n\r\n      // Only redirect if booking was submitted within the last 10 seconds\r\n      if (timeDiff \u003c 10000) {\r\n        devLog('✓ Booking submission detected from sessionStorage (postMessage)');\r\n        devLog(`Time since submission: ${timeDiff}ms`);\r\n\r\n        // Get booking data if available\r\n        let bookingData: unknown = null;\r\n        try {\r\n          const dataStr = sessionStorage.getItem('ars_booking_data');\r\n          if (dataStr) {\r\n            bookingData = JSON.parse(dataStr);\r\n          }\r\n        } catch (e) {\r\n          // Ignore parsing errors\r\n        }\r\n\r\n        // Clear the flags\r\n        sessionStorage.removeItem('ars_booking_submitted');\r\n        sessionStorage.removeItem('ars_booking_timestamp');\r\n        sessionStorage.removeItem('ars_booking_data');\r\n        sessionStorage.removeItem('ars_booking_saw_confirmation');\r\n        sessionStorage.removeItem('ars_booking_confirmation_timestamp');\r\n        sessionStorage.removeItem('ars_booking_potential_submission');\r\n        sessionStorage.removeItem('ars_booking_potential_timestamp');\r\n\r\n        // Track conversion\r\n        trackConversion(bookingData);\r\n\r\n        // Redirect to thank-you page\r\n        devLog('Redirecting to thank-you page:', THANK_YOU_PAGE_URL);\r\n        window.location.replace(THANK_YOU_PAGE_URL);\r\n        return;\r\n      } else {\r\n        // Clear stale data\r\n        devLog('Clearing stale booking submission data');\r\n        sessionStorage.removeItem('ars_booking_submitted');\r\n        sessionStorage.removeItem('ars_booking_timestamp');\r\n        sessionStorage.removeItem('ars_booking_data');\r\n      }\r\n    }\r\n\r\n    // Check for potential submission (detected via iframe confirmation + page refresh pattern)\r\n    const sawConfirmation = sessionStorage.getItem('ars_booking_saw_confirmation');\r\n    const confirmationTimestamp = sessionStorage.getItem('ars_booking_confirmation_timestamp');\r\n    const potentialSubmission = sessionStorage.getItem('ars_booking_potential_submission');\r\n    const potentialTimestamp = sessionStorage.getItem('ars_booking_potential_timestamp');\r\n\r\n    // If we saw a confirmation AND a potential submission flag, it's likely a real booking\r\n    if (sawConfirmation === 'true' \u0026\u0026 potentialSubmission === 'true' \u0026\u0026 \r\n        confirmationTimestamp \u0026\u0026 potentialTimestamp) {\r\n      const confTime = parseInt(confirmationTimestamp, 10);\r\n      const potTime = parseInt(potentialTimestamp, 10);\r\n      const now = Date.now();\r\n      \r\n      // Both should be recent (within last 15 seconds)\r\n      if ((now - confTime \u003c 15000) \u0026\u0026 (now - potTime \u003c 15000)) {\r\n        devLog('✓ Potential booking submission detected (confirmation + refresh pattern)');\r\n        devLog('Redirecting to thank-you page based on iframe confirmation pattern');\r\n\r\n        // Clear the flags\r\n        sessionStorage.removeItem('ars_booking_saw_confirmation');\r\n        sessionStorage.removeItem('ars_booking_confirmation_timestamp');\r\n        sessionStorage.removeItem('ars_booking_potential_submission');\r\n        sessionStorage.removeItem('ars_booking_potential_timestamp');\r\n\r\n        // Track conversion (without booking data since we don't have it)\r\n        trackConversion();\r\n\r\n        // Redirect to thank-you page\r\n        window.location.replace(THANK_YOU_PAGE_URL);\r\n        return;\r\n      } else {\r\n        // Clear stale data\r\n        sessionStorage.removeItem('ars_booking_saw_confirmation');\r\n        sessionStorage.removeItem('ars_booking_confirmation_timestamp');\r\n        sessionStorage.removeItem('ars_booking_potential_submission');\r\n        sessionStorage.removeItem('ars_booking_potential_timestamp');\r\n      }\r\n    }\r\n  } catch (e) {\r\n    devLog('Error checking for booking submission:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize booking iframe message listener\r\n * \r\n * NOTE: We cannot monitor network requests from cross-origin iframes due to\r\n * browser security (Same-Origin Policy). We rely on:\r\n * 1. postMessage events from the iframe (if supported)\r\n * 2. Intercepting parent page redirects (if booking system redirects parent)\r\n * 3. Iframe load/navigation events (limited - cannot read cross-origin URLs)\r\n */\r\nfunction initBookingIframeListener(): void {\r\n  const iframe = document.querySelector\u003cHTMLIFrameElement\u003e('.booking-iframe');\r\n  \r\n  if (!iframe) {\r\n    devLog('Booking iframe not found on page');\r\n    return;\r\n  }\r\n\r\n  devLog('Initializing booking iframe listener');\r\n  devLog('Waiting for booking submission events from iframe...');\r\n  devLog('NOTE: Initialization data (id, ClientName) on page load is NOT a submission');\r\n  devLog('NOTE: Cannot monitor network requests from cross-origin iframes (browser security)');\r\n\r\n  // Track all messages for debugging\r\n  let messageCount = 0;\r\n  let initialHeight = iframe.offsetHeight;\r\n  let loadCount = 0;\r\n  let redirectIntercepted = false;\r\n  const currentUrl = window.location.href;\r\n\r\n  // Method 1: Listen for postMessage events from the iframe\r\n  window.addEventListener('message', (event: MessageEvent) =\u003e {\r\n    // Security: Only accept messages from the booking iframe origin\r\n    if (event.origin !== BOOKING_IFRAME_ORIGIN) {\r\n      devLog('Ignoring message from unauthorized origin:', event.origin);\r\n      return;\r\n    }\r\n\r\n    messageCount++;\r\n    devLog(`Message #${messageCount} received from booking iframe:`, {\r\n      data: event.data,\r\n      origin: event.origin,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n\r\n    // Log the full structure for debugging\r\n    try {\r\n      devLog('Full message structure:', JSON.stringify(event.data, null, 2));\r\n    } catch (e) {\r\n      devLog('Could not stringify message data');\r\n    }\r\n\r\n    // Check if this is a booking submission\r\n    if (isBookingSubmission(event.data)) {\r\n      devLog('✓ Booking submission detected via postMessage!');\r\n      redirectIntercepted = true;\r\n      handleBookingSuccess(event, event.data);\r\n    } else {\r\n      devLog('Message does not match submission criteria (this is normal for initialization/data messages)');\r\n    }\r\n  }, false);\r\n\r\n  // Method 2: Detect page refresh/reload after booking submission\r\n  // Since the booking system refreshes the page after showing confirmation in iframe,\r\n  // we need to detect this before the refresh happens\r\n  // We'll use sessionStorage to persist state across page refreshes\r\n  \r\n  // Track if we've seen multiple iframe load events (might indicate submission + refresh)\r\n  let lastIframeLoadTime = Date.now();\r\n  let iframeLoadEvents = 0;\r\n  \r\n  // Before the page unloads/refreshes, try to detect if a booking was submitted\r\n  // We'll set a flag in sessionStorage if we detect the page is about to refresh\r\n  window.addEventListener('beforeunload', () =\u003e {\r\n    // If we've seen multiple iframe loads recently, it might be a submission\r\n    // Set a flag that persists across page refresh\r\n    try {\r\n      const timeSinceLastLoad = Date.now() - lastIframeLoadTime;\r\n      // If iframe loaded multiple times in quick succession (within 5 seconds),\r\n      // and we're on the booking page, it might be a submission\r\n      if (iframeLoadEvents \u003e 1 \u0026\u0026 timeSinceLastLoad \u003c 5000) {\r\n        devLog('Multiple iframe loads detected before page unload - might be booking submission');\r\n        sessionStorage.setItem('ars_booking_potential_submission', 'true');\r\n        sessionStorage.setItem('ars_booking_potential_timestamp', Date.now().toString());\r\n      }\r\n    } catch (e) {\r\n      // Ignore errors\r\n    }\r\n  });\r\n\r\n  // Method 3: Monitor iframe load events (navigation detection)\r\n  // Note: We cannot read cross-origin iframe URLs, but we can detect navigation\r\n  iframe.addEventListener('load', () =\u003e {\r\n    loadCount++;\r\n    iframeLoadEvents++;\r\n    lastIframeLoadTime = Date.now();\r\n    devLog(`Iframe load event #${loadCount} detected`);\r\n    devLog('NOTE: Cannot read iframe URL due to cross-origin restrictions');\r\n    \r\n    // Check if height changed significantly (might indicate success page)\r\n    const currentHeight = iframe.offsetHeight;\r\n    const heightDiff = Math.abs(currentHeight - initialHeight);\r\n    \r\n    // If this is a subsequent load (not the initial one) and height changed significantly,\r\n    // it might indicate a confirmation/success page\r\n    if (loadCount \u003e 1) {\r\n      devLog(`Iframe loaded ${loadCount} times. Height: ${currentHeight}px (initial: ${initialHeight}px, diff: ${heightDiff}px)`);\r\n      \r\n      if (heightDiff \u003e 100) {\r\n        devLog(`Significant height change detected (${heightDiff}px). This might indicate a success/confirmation page.`);\r\n        \r\n        // Wait a moment, then check if page is about to refresh\r\n        // If we see confirmation page and then page refreshes, it's likely a submission\r\n        setTimeout(() =\u003e {\r\n          try {\r\n            // Check if we're still on the page (if not, page refreshed)\r\n            if (document.querySelector('.booking-iframe')) {\r\n              devLog('Page still loaded after iframe height change - monitoring for page refresh');\r\n              // Set a flag that we saw a potential confirmation\r\n              sessionStorage.setItem('ars_booking_saw_confirmation', 'true');\r\n              sessionStorage.setItem('ars_booking_confirmation_timestamp', Date.now().toString());\r\n            }\r\n          } catch (e) {\r\n            // Page might have refreshed\r\n          }\r\n        }, 1000);\r\n      }\r\n    }\r\n  });\r\n\r\n  devLog('Booking iframe listener initialized and ready');\r\n  devLog(`Initial iframe height: ${initialHeight}px`);\r\n  devLog('Monitoring for: postMessage events, parent page redirects, and iframe navigation');\r\n}\r\n\r\n/**\r\n * Initialize booking iframe tracking\r\n */\r\nexport const initBookingIframe = (): void =\u003e {\r\n  onDOMReady(() =\u003e {\r\n    // First, check if we should redirect based on sessionStorage\r\n    // This handles cases where the page was refreshed after booking submission\r\n    checkForBookingSubmission();\r\n\r\n    // Then initialize the listener for future submissions\r\n    initBookingIframeListener();\r\n  });\r\n};\r\n"],"mappings":"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","names":["cleanup","STORAGE_KEY","legendData","label","node","connectionMap","outboundMap","inboundMap","link","clearFocusBtn","pagesBtn","sectionsBtn","topicsBtn","g","CIRCUMFERENCE","scoresHtml","metaDescHtml","filterType","closeModal","isLocalhost","possiblePaths","sourceFile","confirmed","url","modal","pageAnalysis","cleanup","match","filteredPages","pagesHtml","analyzeKeywords","getDensityClass","STORAGE_KEY","removedKeywords","opportunitiesStat","isMobile","tocWidget","currentUl","li","getScoreClass","STORAGE_KEY","closeModal","e","findUrlMatch","escapedOldUrl","modifiedContent","modified","markdownPattern","htmlPattern","backupPath","removalResult","currentPage","groupTitles","isMobile","resizeTimeout","getElements","faces","handleTouchStart","handleTouchEnd","handleMouseLeave","keyHandler","location","resizeTimeout","DEV_LOG","devLog","devError","resizeTimeout"]}