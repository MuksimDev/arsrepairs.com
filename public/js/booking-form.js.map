{"version":3,"sources":["file:///C:/Users/maxim/Documents/Dev/arsrepairs.com/assets/ts/modules/booking-form.ts"],"sourcesContent":["/**\r\n * DOM utility functions\r\n */\r\n\r\n/**\r\n * Checks if the current viewport is mobile size\r\n */\r\nexport const isMobile = (): boolean =\u003e window.innerWidth \u003c= 1280;\r\n\r\n/**\r\n * Checks if running on localhost\r\n */\r\nexport const isLocalhost = (): boolean =\u003e {\r\n  return window.location.hostname === \"localhost\" || window.location.hostname === \"127.0.0.1\";\r\n};\r\n\r\n/**\r\n * Safely executes a function when DOM is ready\r\n */\r\nexport const onDOMReady = (callback: () =\u003e void): void =\u003e {\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", callback);\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\n\r\n","/**\r\n * Booking Form Module\r\n * Handles form validation, coupon code processing, and submission for the booking form\r\n */\r\n\r\nimport { onDOMReady, isLocalhost } from '../utils/dom';\r\n\r\ninterface Coupon {\r\n  title: string;\r\n  amount?: number;        // explicit dollar amount\r\n  code?: string;          // optional, future-proof\r\n  start_date?: string;\r\n  end_date?: string;\r\n}\r\n\r\ninterface CouponsData {\r\n  regular?: Coupon[];\r\n  seasonal?: Coupon[];\r\n}\r\n\r\n// Constants\r\nconst DEV_LOG = isLocalhost();\r\nconst VALIDATION_DEBOUNCE_MS = 300;\r\nconst MIN_NAME_LENGTH = 2;\r\nconst MAX_NAME_LENGTH = 100;\r\nconst MIN_PHONE_DIGITS = 10;\r\nconst MAX_PHONE_DIGITS = 15;\r\nconst MIN_PROBLEM_LENGTH = 10;\r\n\r\n// Cache current local date (normalized) to avoid UTC off-by-one issues\r\nconst CURRENT_DATE = (() =\u003e {\r\n  const now = new Date();\r\n  now.setMinutes(now.getMinutes() - now.getTimezoneOffset());\r\n  return now.toISOString().split('T')[0];\r\n})();\r\n\r\n/**\r\n * Development logging helper\r\n */\r\nfunction devLog(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.log(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Development error logging helper\r\n */\r\nfunction devError(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.error(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Development warning logging helper\r\n */\r\nfunction devWarn(...args: unknown[]): void {\r\n  if (DEV_LOG) {\r\n    console.warn(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Check if browser supports date input type\r\n */\r\nfunction supportsDateInput(): boolean {\r\n  const input = document.createElement('input');\r\n  input.setAttribute('type', 'date');\r\n  // In browsers that don't support date input, the type falls back to \"text\"\r\n  return input.type === 'date';\r\n}\r\n\r\n/**\r\n * Set minimum date to today for date input\r\n */\r\nfunction setMinDate(): void {\r\n  const dateInput = document.getElementById('booking-date') as HTMLInputElement | null;\r\n  if (dateInput) {\r\n    const now = new Date();\r\n    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());\r\n    dateInput.min = now.toISOString().slice(0, 10);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle date input with progressive enhancement\r\n * Upgrades to date input if supported, otherwise uses text input with formatting\r\n */\r\nfunction handleDateInputFallback(): void {\r\n  const dateInput = document.getElementById('booking-date') as HTMLInputElement | null;\r\n  if (!dateInput) return;\r\n\r\n  // Check if date input is supported\r\n  if (supportsDateInput()) {\r\n    devLog('Date input supported, upgrading to date type');\r\n    \r\n    // Upgrade to date input type\r\n    dateInput.type = 'date';\r\n    \r\n    // Set minimum date\r\n    setMinDate();\r\n    \r\n    // Update help text for date picker\r\n    const helpText = document.getElementById('booking-date-help');\r\n    if (helpText) {\r\n      helpText.textContent = 'Please select a date for your preferred appointment';\r\n    }\r\n  } else {\r\n    devLog('Date input not supported, using text input with formatting');\r\n    \r\n    // Keep as text input and add formatting helper\r\n    // Pattern and placeholder are already set in HTML\r\n    \r\n    // Add input formatting to help users enter dates correctly\r\n    dateInput.addEventListener('input', function(e: Event) {\r\n      const target = e.target as HTMLInputElement;\r\n      let value = target.value.replace(/\\D/g, ''); // Remove non-digits\r\n      \r\n      // Format as YYYY-MM-DD\r\n      if (value.length \u003e 4) {\r\n        value = value.slice(0, 4) + '-' + value.slice(4);\r\n      }\r\n      if (value.length \u003e 7) {\r\n        value = value.slice(0, 7) + '-' + value.slice(7, 9);\r\n      }\r\n      \r\n      target.value = value;\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Extract discount amount from URL query string\r\n * Handles formats like: ?25, ?code=25, ?coupon=25\r\n */\r\nfunction getDiscountAmountFromURL(): string | null {\r\n  if (typeof window === 'undefined' || !window.location) {\r\n    return null;\r\n  }\r\n\r\n  const params = new URLSearchParams(window.location.search);\r\n  const code = params.get('coupon') || params.get('code');\r\n  if (code) return code.replace(/[^0-9]/g, '');\r\n\r\n  // Keep backward compatibility with existing ?25 links\r\n  const legacy = window.location.search.match(/[?\u0026](\\d+)/);\r\n  return legacy ? legacy[1] : null;\r\n}\r\n\r\n/**\r\n * Find matching coupon by discount amount\r\n * Returns the coupon and its type ('regular' or 'seasonal')\r\n */\r\nfunction findMatchingCoupon(\r\n  discountAmountStr: string,\r\n  couponsData: CouponsData\r\n): { coupon: Coupon; type: 'regular' | 'seasonal' } | null {\r\n  const amount = Number(discountAmountStr);\r\n  if (isNaN(amount)) return null;\r\n\r\n  // Regular coupons\r\n  const regularMatch = couponsData.regular?.find(c =\u003e c.amount === amount);\r\n  if (regularMatch) {\r\n    devLog('Regular coupon matched:', regularMatch.title);\r\n    return { coupon: regularMatch, type: 'regular' };\r\n  }\r\n\r\n  // Seasonal coupons (only if active today)\r\n  const today = CURRENT_DATE;\r\n  const seasonalMatch = couponsData.seasonal?.find(c =\u003e\r\n    c.amount === amount \u0026\u0026\r\n    c.start_date \u0026\u0026 c.end_date \u0026\u0026\r\n    today \u003e= c.start_date \u0026\u0026 today \u003c= c.end_date\r\n  );\r\n\r\n  if (seasonalMatch) {\r\n    devLog('Seasonal coupon matched:', seasonalMatch.title);\r\n    return { coupon: seasonalMatch, type: 'seasonal' };\r\n  }\r\n\r\n  devLog('No coupon found for amount:', amount);\r\n  return null;\r\n}\r\n\r\n/**\r\n * Extract clean title from coupon (removes dashes and extra text)\r\n */\r\nfunction extractCouponTitle(coupon: Coupon): string {\r\n  return coupon.title.split(' - ')[0].split(' â€“ ')[0];\r\n}\r\n\r\n/**\r\n * Apply coupon to the form\r\n */\r\nfunction applyCoupon(coupon: Coupon, type: 'regular' | 'seasonal'): void {\r\n  devLog('Applying coupon:', coupon, 'Type:', type);\r\n  \r\n  const couponAppliedEl = document.getElementById('coupon-applied');\r\n  const couponTitleEl = document.getElementById('coupon-applied-title');\r\n  const couponCodeEl = document.getElementById('coupon-code') as HTMLInputElement | null;\r\n  const couponTypeEl = document.getElementById('coupon-type') as HTMLInputElement | null;\r\n  const infoContainer = document.getElementById('booking-info');\r\n\r\n  devLog('Coupon elements found:', {\r\n    couponAppliedEl: !!couponAppliedEl,\r\n    couponTitleEl: !!couponTitleEl,\r\n    couponCodeEl: !!couponCodeEl,\r\n    couponTypeEl: !!couponTypeEl\r\n  });\r\n\r\n  const niceTitle = extractCouponTitle(coupon);\r\n  const successMessage = `${niceTitle} Coupon Applied!`;\r\n\r\n  if (couponAppliedEl \u0026\u0026 couponTitleEl) {\r\n    couponTitleEl.textContent = successMessage;\r\n    devLog('Coupon applied successfully:', coupon.title, 'Type:', type);\r\n    couponAppliedEl.classList.remove('coupon-applied--hidden');\r\n    \r\n    // Hide any previous error/info messages\r\n    if (infoContainer) {\r\n      infoContainer.classList.add('contact-form__status--hidden');\r\n    }\r\n  } else {\r\n    devError('Coupon banner elements are missing after coupon match. Banner may have been detached by DOM mutation.', {\r\n      couponAppliedEl: couponAppliedEl,\r\n      couponTitleEl: couponTitleEl\r\n    });\r\n    \r\n    // Fallback: Show success message in #booking-info if banner is missing\r\n    if (infoContainer) {\r\n      infoContainer.textContent = successMessage;\r\n      infoContainer.classList.remove('contact-form__status--hidden');\r\n      devLog('Fell back to showing coupon message in info container');\r\n    }\r\n  }\r\n\r\n  if (couponCodeEl) {\r\n    couponCodeEl.value = coupon.title;\r\n  }\r\n\r\n  if (couponTypeEl) {\r\n    couponTypeEl.value = type;\r\n    devLog('Coupon type set to:', type);\r\n  }\r\n}\r\n\r\n/**\r\n * Create a coupon object from discount amount string\r\n */\r\nfunction createCouponFromAmount(discountAmount: string): Coupon | null {\r\n  const amount = Number(discountAmount);\r\n  if (isNaN(amount) || amount \u003c= 0) {\r\n    devWarn('Invalid discount amount:', discountAmount);\r\n    return null;\r\n  }\r\n  return {\r\n    title: `$${discountAmount} Off`,\r\n    amount: amount\r\n  };\r\n}\r\n\r\n/**\r\n * Process coupon code from URL\r\n */\r\nfunction processCouponCode(): void {\r\n  const discountAmount = getDiscountAmountFromURL();\r\n  if (!discountAmount) {\r\n    devLog('No discount amount found in URL');\r\n    return;\r\n  }\r\n\r\n  devLog('Discount amount from URL:', discountAmount);\r\n\r\n  // Create a coupon object from the discount amount (fallback if data not available)\r\n  const couponFromURL = createCouponFromAmount(discountAmount);\r\n  if (!couponFromURL) {\r\n    devError('Invalid discount amount in URL:', discountAmount);\r\n    return;\r\n  }\r\n\r\n  // Try to load coupons data to find a matching coupon with full details\r\n  const couponsScript = document.getElementById('coupons-data');\r\n  if (!couponsScript || !couponsScript.textContent) {\r\n    devWarn('Coupons data script not found or empty, applying coupon directly from URL');\r\n    applyCoupon(couponFromURL, 'regular');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const couponsData: CouponsData = JSON.parse(couponsScript.textContent);\r\n    devLog('Coupons data loaded:', couponsData);\r\n    devLog('Regular coupons:', couponsData.regular?.length || 0);\r\n    devLog('Seasonal coupons:', couponsData.seasonal?.length || 0);\r\n    \r\n    // Validate coupons data structure\r\n    if ((!couponsData.regular || couponsData.regular.length === 0) \u0026\u0026 \r\n        (!couponsData.seasonal || couponsData.seasonal.length === 0)) {\r\n      devWarn('Coupons data is empty, applying coupon directly from URL');\r\n      applyCoupon(couponFromURL, 'regular');\r\n      return;\r\n    }\r\n    \r\n    const matchResult = findMatchingCoupon(discountAmount, couponsData);\r\n    devLog('Matched coupon:', matchResult);\r\n\r\n    if (matchResult) {\r\n      applyCoupon(matchResult.coupon, matchResult.type);\r\n    } else {\r\n      devWarn('No matching coupon found in data, applying coupon directly from URL');\r\n      applyCoupon(couponFromURL, 'regular');\r\n    }\r\n  } catch (error) {\r\n    const errorMessage = error instanceof Error ? error.message : String(error);\r\n    devError('Error parsing coupons data:', errorMessage);\r\n    devWarn('Applying coupon directly from URL due to parsing error');\r\n    applyCoupon(couponFromURL, 'regular');\r\n  }\r\n}\r\n\r\n/**\r\n * Show error message for a field\r\n */\r\nfunction showError(fieldId: string, message: string): void {\r\n  const field = document.getElementById(fieldId);\r\n  const errorEl = document.getElementById(fieldId + '-error');\r\n\r\n  if (field \u0026\u0026 errorEl) {\r\n    field.setAttribute('aria-invalid', 'true');\r\n    field.classList.add('contact-form__input--error');\r\n    field.classList.remove('contact-form__input--success');\r\n    errorEl.textContent = message;\r\n    // Note: Error messages for individual fields don't use --hidden class\r\n    // They are always visible when they have content\r\n  }\r\n}\r\n\r\n/**\r\n * Clear error message for a field\r\n */\r\nfunction clearError(fieldId: string): void {\r\n  const field = document.getElementById(fieldId);\r\n  const errorEl = document.getElementById(fieldId + '-error');\r\n\r\n  if (field \u0026\u0026 errorEl) {\r\n    field.removeAttribute('aria-invalid');\r\n    field.classList.remove('contact-form__input--error');\r\n    errorEl.textContent = '';\r\n    // Note: Error messages for individual fields don't use --hidden class\r\n    // They are hidden by clearing their text content\r\n  }\r\n}\r\n\r\n/**\r\n * Validator function type\r\n */\r\ntype Validator = (value: string) =\u003e string | null;\r\n\r\n/**\r\n * Validate a field using its validator\r\n */\r\nfunction validateField(fieldId: string, value: string, validator: Validator): boolean {\r\n  const error = validator(value);\r\n  if (error) {\r\n    showError(fieldId, error);\r\n    return false;\r\n  } else {\r\n    clearError(fieldId);\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Validators for all form fields\r\n */\r\nconst validators: Record\u003cstring, Validator\u003e = {\r\n  'booking-name': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Name is required';\r\n    if (value.length \u003c MIN_NAME_LENGTH) return `Name must be at least ${MIN_NAME_LENGTH} characters`;\r\n    if (value.length \u003e MAX_NAME_LENGTH) return `Name must be less than ${MAX_NAME_LENGTH} characters`;\r\n    return null;\r\n  },\r\n  'booking-email': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Email is required';\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(value)) return 'Please enter a valid email address';\r\n    return null;\r\n  },\r\n  'booking-phone': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Phone number is required';\r\n    const digitsOnly = value.replace(/\\D/g, '');\r\n    const digitCount = digitsOnly.length;\r\n    \r\n    // Validate digit count (supports international: 10-15 digits)\r\n    if (digitCount \u003c MIN_PHONE_DIGITS || digitCount \u003e MAX_PHONE_DIGITS) {\r\n      return `Please enter a valid phone number (${MIN_PHONE_DIGITS}-${MAX_PHONE_DIGITS} digits)`;\r\n    }\r\n    \r\n    // North American format: if 11 digits, first must be 1 (country code)\r\n    if (digitCount === 11 \u0026\u0026 digitsOnly[0] !== '1') {\r\n        return 'Please enter a valid phone number';\r\n    }\r\n    \r\n    return null;\r\n  },\r\n  'booking-make': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Appliance make is required';\r\n    return null;\r\n  },\r\n  'booking-model': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Appliance model is required';\r\n    return null;\r\n  },\r\n  'booking-date': (value: string) =\u003e {\r\n    if (!value) return 'Preferred date is required';\r\n    \r\n    // Validate date format (YYYY-MM-DD)\r\n    const datePattern = /^\\d{4}-\\d{2}-\\d{2}$/;\r\n    if (!datePattern.test(value)) {\r\n      return 'Please enter a valid date in YYYY-MM-DD format';\r\n    }\r\n    \r\n    // Validate that it's a valid date\r\n    const selectedDate = new Date(value + 'T00:00:00');\r\n    if (isNaN(selectedDate.getTime())) {\r\n      return 'Please enter a valid date';\r\n    }\r\n    \r\n    // Validate that the date matches the input (catches invalid dates like 2025-13-45)\r\n    const dateParts = value.split('-').map(Number);\r\n    if (dateParts.length !== 3) {\r\n      return 'Please enter a valid date';\r\n    }\r\n    const [year, month, day] = dateParts;\r\n    if (selectedDate.getFullYear() !== year || \r\n        selectedDate.getMonth() + 1 !== month || \r\n        selectedDate.getDate() !== day) {\r\n      return 'Please enter a valid date';\r\n    }\r\n    \r\n    // Validate that it's a future date\r\n    const now = new Date();\r\n    now.setHours(0, 0, 0, 0);\r\n    if (selectedDate \u003c now) return 'Please select a future date';\r\n    return null;\r\n  },\r\n  'booking-time': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Preferred time is required';\r\n    return null;\r\n  },\r\n  'booking-problem': (value: string) =\u003e {\r\n    if (!value || value.trim().length === 0) return 'Problem description is required';\r\n    if (value.length \u003c MIN_PROBLEM_LENGTH) return `Please provide more details (at least ${MIN_PROBLEM_LENGTH} characters)`;\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Debounce function to limit how often a function is called\r\n */\r\nfunction debounce\u003cT extends (...args: unknown[]) =\u003e void\u003e(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters\u003cT\u003e) =\u003e void {\r\n  let timeout: ReturnType\u003ctypeof setTimeout\u003e | null = null;\r\n  return function executedFunction(...args: Parameters\u003cT\u003e) {\r\n    const later = () =\u003e {\r\n      timeout = null;\r\n      func(...args);\r\n    };\r\n    if (timeout) {\r\n      clearTimeout(timeout);\r\n    }\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize real-time validation for all fields\r\n */\r\nfunction initFieldValidation(): void {\r\n  Object.keys(validators).forEach(fieldId =\u003e {\r\n    const field = document.getElementById(fieldId) as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null;\r\n    if (!field) {\r\n      devWarn(`Field not found: ${fieldId}`);\r\n      return;\r\n    }\r\n\r\n    const validator = validators[fieldId];\r\n    if (!validator) {\r\n      devWarn(`No validator found for field: ${fieldId}`);\r\n      return;\r\n    }\r\n\r\n      // Validate on blur (immediate)\r\n      field.addEventListener('blur', () =\u003e {\r\n      validateField(fieldId, field.value, validator);\r\n      });\r\n\r\n      // Debounced validation on input (only if field already has errors)\r\n      const debouncedValidate = debounce(() =\u003e {\r\n        if (field.getAttribute('aria-invalid') === 'true') {\r\n        validateField(fieldId, field.value, validator);\r\n        }\r\n    }, VALIDATION_DEBOUNCE_MS);\r\n\r\n      field.addEventListener('input', debouncedValidate);\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Handle form submission\r\n */\r\nfunction initFormSubmission(): void {\r\n  const form = document.querySelector\u003cHTMLFormElement\u003e('form[name=\"booking\"]');\r\n  if (!form) return;\r\n\r\n  const submitButton = document.getElementById('booking-submit');\r\n  const liveRegion = document.getElementById('booking-live-region');\r\n  const errorContainer = document.getElementById('booking-error');\r\n  const infoContainer = document.getElementById('booking-info');\r\n\r\n  form.addEventListener('submit', async function(e: Event) {\r\n    e.preventDefault();\r\n\r\n    // Hide previous messages\r\n    if (errorContainer) errorContainer.classList.add('contact-form__status--hidden');\r\n    if (infoContainer) infoContainer.classList.add('contact-form__status--hidden');\r\n\r\n    // Validate all fields\r\n    let isValid = true;\r\n    Object.keys(validators).forEach(fieldId =\u003e {\r\n      const field = document.getElementById(fieldId) as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null;\r\n      const validator = validators[fieldId];\r\n      if (field \u0026\u0026 validator) {\r\n        if (!validateField(fieldId, field.value, validator)) {\r\n          isValid = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (!isValid) {\r\n      if (errorContainer) {\r\n        errorContainer.textContent = 'Please correct the errors below before submitting.';\r\n        errorContainer.classList.remove('contact-form__status--hidden');\r\n      }\r\n      if (liveRegion) {\r\n        liveRegion.textContent = 'Form has errors. Please review and correct them.';\r\n      }\r\n      // Focus first error field\r\n      const firstError = form.querySelector\u003cHTMLElement\u003e('[aria-invalid=\"true\"]');\r\n      if (firstError) firstError.focus();\r\n      return;\r\n    }\r\n\r\n    // Show loading state\r\n    if (submitButton) {\r\n      submitButton.classList.add('contact-form__submit--loading');\r\n      (submitButton as HTMLButtonElement).disabled = true;\r\n      const btnText = submitButton.querySelector\u003cHTMLElement\u003e('.btn__text');\r\n      if (btnText) btnText.textContent = 'Submitting...';\r\n    }\r\n\r\n    if (liveRegion) {\r\n      liveRegion.textContent = 'Submitting your booking request...';\r\n    }\r\n\r\n    // Prepare form data for Web3Forms\r\n    const formData = new FormData(form);\r\n\r\n    try {\r\n      const response = await fetch('https://api.web3forms.com/submit', {\r\n        method: 'POST',\r\n        body: formData\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        // Success - redirect to thank you page\r\n        if (liveRegion) {\r\n          liveRegion.textContent = 'Booking request sent successfully! Redirecting...';\r\n        }\r\n        // Use replace() to avoid adding to browser history\r\n        const redirectUrl = form.querySelector\u003cHTMLInputElement\u003e('input[name=\"redirect\"]')?.value || '/book/thank-you/';\r\n        window.location.replace(redirectUrl);\r\n      } else {\r\n        // Handle error from Web3Forms\r\n        throw new Error(data.message || 'Failed to send booking request');\r\n      }\r\n    } catch (error) {\r\n      // Handle network or other errors\r\n      const errorMessage = error instanceof Error ? error.message : 'An error occurred. Please try again later.';\r\n      \r\n      if (errorContainer) {\r\n        errorContainer.textContent = errorMessage;\r\n        errorContainer.classList.remove('contact-form__status--hidden');\r\n      }\r\n      if (liveRegion) {\r\n        liveRegion.textContent = 'Error sending booking request. Please try again.';\r\n      }\r\n      \r\n      if (submitButton) {\r\n        submitButton.classList.remove('contact-form__submit--loading');\r\n        (submitButton as HTMLButtonElement).disabled = false;\r\n        const btnText = submitButton.querySelector\u003cHTMLElement\u003e('.btn__text');\r\n        if (btnText) btnText.textContent = 'Book Appointment';\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Initialize booking form\r\n */\r\nexport const initBookingForm = (): void =\u003e {\r\n  // Wait for DOM to be ready before initializing\r\n  onDOMReady(() =\u003e {\r\n    // Process coupon code from URL FIRST\r\n    // This must run before handleDateInputFallback() because changing input.type\r\n    // in Safari triggers DOM mutations that can detach the coupon banner elements\r\n    processCouponCode();\r\n\r\n    // Handle date input (with Safari \u003c 14.1 fallback)\r\n    // This runs after coupon processing to avoid DOM mutations affecting coupon banner\r\n    handleDateInputFallback();\r\n\r\n    // Initialize form validation\r\n    initFieldValidation();\r\n\r\n    // Initialize form submission\r\n    initFormSubmission();\r\n  });\r\n};\r\n\r\n"],"mappings":"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","names":[]}