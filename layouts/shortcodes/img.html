{{- /*
  Image Shortcode (Wrapper for image partial) - AODA Compliant
  
  Usage:
    {{< img src="/images/photo.jpg" alt="Description" >}}
    {{< img src="/images/photo.jpg" alt="Description" class="my-class" title="Title" width="800" height="600" >}}
    {{< img src="/images/decorative.jpg" decorative="true" >}}
  
  Parameters:
    - src: Image source path (required)
    - alt: Alt text (optional, auto-generated from filename if not provided)
    - decorative: Set to "true" for decorative images (alt will be empty) (optional)
    - class: CSS class(es) (optional)
    - title: Title attribute for additional context (optional, auto-generated from filename if not provided)
    - loading: "lazy" or "eager" (default: "lazy")
    - width: Image width in pixels (optional, recommended for layout stability)
    - height: Image height in pixels (optional, recommended for layout stability)
    - sizes: Sizes attribute for responsive images (optional)
*/ -}}
{{- $src := .Get "src" | default (.Get 0) -}}
{{- $noClass := .Get "no-class" -}}

{{- /* Class handling: allow opting out of default "img-box" with `no-class` */ -}}
{{- $class := "" -}}
{{- if $noClass -}}
  {{- /* When `no-class` is present, only use an explicitly provided class (if any) */ -}}
  {{- $class = .Get "class" | default "" -}}
{{- else -}}
  {{- /* Default to "img-box" when no explicit class and no `no-class` flag */ -}}
  {{- $class = .Get "class" | default "img-box" -}}
{{- end -}}
{{- $loading := .Get "loading" | default "lazy" -}}
{{- $width := .Get "width" -}}
{{- $height := .Get "height" -}}
{{- $sizes := .Get "sizes" | default "" -}}
{{- $decorative := .Get "decorative" | default "false" -}}

{{- /* Generate filename-based alt/title if not provided */ -}}
{{- $filename := "" -}}
{{- if $src -}}
  {{- $baseName := path.Base $src -}}
  {{- $nameWithoutExt := $baseName | strings.TrimSuffix (path.Ext $baseName) -}}
  {{- $filename = $nameWithoutExt | replaceRE "[-_]" " " | title -}}
{{- end -}}

{{- /* AODA Compliance: Alt text handling */ -}}
{{- $alt := "" -}}
{{- if eq $decorative "true" -}}
  {{- /* Decorative images should have empty alt text */ -}}
  {{- $alt = "" -}}
{{- else -}}
  {{- /* Use provided alt, fallback to filename, or empty if truly not available */ -}}
  {{- $alt = .Get "alt" | default (.Get 1) | default $filename -}}
{{- end -}}

{{- /* Title attribute for additional context (optional but helpful) */ -}}
{{- $title := "" -}}
{{- if .Get "title" -}}
  {{- $title = .Get "title" -}}
{{- else if $filename -}}
  {{- $title = $filename -}}
{{- end -}}

{{- if $src -}}
  {{- partial "image.html" (dict 
    "src" $src
    "alt" $alt
    "class" $class
    "title" $title
    "loading" $loading
    "width" $width
    "height" $height
    "sizes" $sizes
  ) -}}
{{- end -}}
